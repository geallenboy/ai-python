{
  "url": "https://n8n.io/workflows/2371-request-and-receive-zigbee-backup-from-zigbee2mqtt-and-save-it-via-sftp/",
  "title": "Request and Receive Zigbee backup from zigbee2mqtt and save it via SFTP",
  "author": "Hubschrauber",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-25",
  "categories": [
    {
      "name": "DevOps"
    }
  ],
  "workflow_json": "{\"nodes\":[{\"name\":\"SFTP zip file content\",\"type\":\"n8n-nodes-base.ftp\",\"position\":[1520,680],\"parameters\":{\"path\":\"=zigbee_backups/zigbee_backup_{{ new Date().toISOString().replaceAll(':','_') }}.zip\",\"protocol\":\"sftp\",\"operation\":\"upload\"},\"credentials\":{\"sftp\":{\"name\":\"SFTP Zigbee Backups\"}},\"typeVersion\":1},{\"name\":\"CRON Monday 2:45 am\",\"type\":\"n8n-nodes-base.scheduleTrigger\",\"position\":[860,440],\"parameters\":{\"rule\":{\"interval\":[{\"field\":\"cronExpression\",\"expression\":\"45 2 * * 1\"}]}},\"typeVersion\":1.1},{\"name\":\"Send Zigbee2MQTT backup request\",\"type\":\"n8n-nodes-base.mqtt\",\"position\":[1040,440],\"parameters\":{\"topic\":\"zigbee2mqtt/bridge/request/backup\",\"message\":\"getbackup\",\"options\":{},\"sendInputData\":false},\"credentials\":{\"mqtt\":{\"name\":\"MQTT account\"}},\"typeVersion\":1},{\"name\":\"MQTT Trigger - Backup Response\",\"type\":\"n8n-nodes-base.mqttTrigger\",\"position\":[860,680],\"parameters\":{\"topics\":\"zigbee2mqtt/bridge/response/backup\",\"options\":{}},\"credentials\":{\"mqtt\":{\"name\":\"MQTT account\"}},\"typeVersion\":1},{\"name\":\"Parse JSON Object from Message Text\",\"type\":\"n8n-nodes-base.code\",\"position\":[1080,680],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"\\nlet containerObject = JSON.parse($json.message);\\nlet messageObject = containerObject.data;\\nreturn messageObject;\"},\"typeVersion\":2},{\"name\":\"Convert to File - base64 to binary\",\"type\":\"n8n-nodes-base.convertToFile\",\"position\":[1300,680],\"parameters\":{\"options\":{},\"operation\":\"toBinary\",\"sourceProperty\":\"zip\"},\"typeVersion\":1}],\"connections\":{\"CRON Monday 2:45 am\":{\"main\":[[{\"node\":\"Send Zigbee2MQTT backup request\",\"type\":\"main\",\"index\":0}]]},\"MQTT Trigger - Backup Response\":{\"main\":[[{\"node\":\"Parse JSON Object from Message Text\",\"type\":\"main\",\"index\":0}]]},\"Convert to File - base64 to binary\":{\"main\":[[{\"node\":\"SFTP zip file content\",\"type\":\"main\",\"index\":0}]]},\"Parse JSON Object from Message Text\":{\"main\":[[{\"node\":\"Convert to File - base64 to binary\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "A single workflow with 2 flows/paths that combine to handle the backup sequence for Zigbee device configuration from HomeAssistant / zigbee2mqtt. This provides a way to automate a periodic capture of Zigbee coordinators and device pairings to speed the recovery process when/if the HomeAssistant instance needs to be rebuilt. Setting up similar automation without n8n (e.g. shell scripts and system timers) is consiterably more challenging. n8n makes it easy and this template should remove any other excuse not to do it.\n\n## Flow 1\n\n  * Triggered by Cron/Timer \n    * set whatever interval for backups\n    * sends mqtt message to request zigbee2mqtt backup (via separate message)\n\n\n\n## Flow 2\n\n  * Triggered by zigbee2mqtt backup message\n  * Extracts zip file from the message and stores somewhere, with a date-stamp in the filename, via sftp\n\n\n\n## Setup\n\n  * Create a MQTT connection named **\"MQTT Account\"** with the appropriate protocol (mqtt), host, port (1883), username, and password\n  * Create an sftp connection named **\"SFTP Zigbee Backups\"** with the appropriate host, port (22), username, and password or key.\n\n\n\n## Reference\n\n  * [This article](https://home-assistant-guide.com/changelog/zigbee2mqtt/zigbee2mqtt-1-26-0/you-can-now-back-up-your-complete-zigbee2mqtt-configuration/) describes the mqtt parts.\n\n\n",
  "crawled_at": "2025-05-25T23:37:40.127021"
}
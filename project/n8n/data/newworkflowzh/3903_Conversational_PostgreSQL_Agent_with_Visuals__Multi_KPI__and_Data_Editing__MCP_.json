{
  "url": "https://n8n.io/workflows/3903-conversational-postgresql-agent-with-visuals-multi-kpi-and-data-editing-mcp/",
  "title": "Conversational PostgreSQL Agent with Visuals, Multi-KPI, and Data Editing (MCP)",
  "author": "hippolyte-hu",
  "publish_date": "Last update 19 days ago",
  "publish_date_absolute": "",
  "categories": [
    {
      "name": "Support"
    },
    {
      "name": "AI"
    },
    {
      "name": "IT Ops"
    }
  ],
  "workflow_json": "{\"id\":\"CXe5AJieJbpn6RYE\",\"meta\":{\"instanceId\":\"1fc85153dfc4ea22a8172f0d7347fa9f591f71e2064dc331f7bdc1d7ee422e7a\",\"templateId\":\"3631\",\"templateCredsSetupCompleted\":true},\"name\":\"Build your own PostgreSQL MCP server (visuals capable)\",\"tags\":[],\"nodes\":[{\"id\":\"0c49141e-128c-424e-afdf-ea131b7a3dd8\",\"name\":\"GetTableSchema\",\"type\":\"n8n-nodes-base.postgresTool\",\"position\":[-40,840],\"parameters\":{},\"typeVersion\":2.6},{\"id\":\"8ffeefb9-357c-41bc-8239-0c07c706be97\",\"name\":\"ListTables\",\"type\":\"n8n-nodes-base.postgresTool\",\"position\":[20,980],\"parameters\":{},\"typeVersion\":2.6},{\"id\":\"efcf7ff3-976e-448a-9d47-47a98f3b0fcb\",\"name\":\"When Executed by Another Workflow\",\"type\":\"n8n-nodes-base.executeWorkflowTrigger\",\"position\":[920,820],\"parameters\":{},\"typeVersion\":1.1},{\"id\":\"abd292d7-fc2b-4e98-a474-b50e44d16b6c\",\"name\":\"CreateTableRecords\",\"type\":\"@n8n/n8n-nodes-langchain.toolWorkflow\",\"position\":[160,1020],\"parameters\":{},\"typeVersion\":2.1},{\"id\":\"4a71d42a-99a5-489e-b449-09c3c5081505\",\"name\":\"ReadTableRecord\",\"type\":\"n8n-nodes-base.postgres\",\"position\":[1420,620],\"parameters\":{},\"typeVersion\":2.6,\"alwaysOutputData\":true},{\"id\":\"bdc60aa8-9ab1-4bbd-8b9e-89c968d54043\",\"name\":\"Operation\",\"type\":\"n8n-nodes-base.switch\",\"position\":[1120,820],\"parameters\":{},\"typeVersion\":3.2},{\"id\":\"cdb5b556-3638-4fa5-94c6-bff0c03f6c89\",\"name\":\"UpdateTableRecord\",\"type\":\"n8n-nodes-base.postgres\",\"position\":[1420,1020],\"parameters\":{},\"typeVersion\":2.6},{\"id\":\"9263fc78-321e-4c83-90d3-890dd87d6aed\",\"name\":\"UpdateTableRecords\",\"type\":\"@n8n/n8n-nodes-langchain.toolWorkflow\",\"position\":[320,1040],\"parameters\":{},\"typeVersion\":2.1},{\"id\":\"dd7e28fb-b2c7-4084-bc9b-9aa3e0187682\",\"name\":\"CreateTableRecord\",\"type\":\"n8n-nodes-base.postgres\",\"position\":[1420,820],\"parameters\":{},\"typeVersion\":2.6},{\"id\":\"9cf39ca3-b704-49ce-b6e2-db2703c4acad\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-80,540],\"parameters\":{\"content\":\"\"},\"typeVersion\":1},{\"id\":\"ac3d9b98-8f1e-4abd-972c-1725aac1ad1e\",\"name\":\"PostgreSQL MCP Server\",\"type\":\"@n8n/n8n-nodes-langchain.mcpTrigger\",\"position\":[80,620],\"webhookId\":\"a5fd7047-e31b-4c0d-bd68-c36072c3da0d\",\"parameters\":{},\"typeVersion\":1},{\"id\":\"416a09d5-c327-410d-b951-a2d08402c6fe\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[840,540],\"parameters\":{\"content\":\"\"},\"typeVersion\":1},{\"id\":\"c514c8a8-25b8-474b-8e3d-3a598e15c4ab\",\"name\":\"AI Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[360,1260],\"parameters\":{},\"typeVersion\":1.8},{\"id\":\"294589fe-2dc4-40ea-b4e4-d7c42d1a28e1\",\"name\":\"MCP Client\",\"type\":\"@n8n/n8n-nodes-langchain.mcpClientTool\",\"position\":[640,1560],\"parameters\":{},\"typeVersion\":1},{\"id\":\"c566125c-daac-4b3f-ac2c-19588fd96831\",\"name\":\"Anthropic Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatAnthropic\",\"position\":[340,1600],\"parameters\":{},\"typeVersion\":1.3},{\"id\":\"ce46a834-c43c-4d14-b98c-c37084534324\",\"name\":\"Think\",\"type\":\"@n8n/n8n-nodes-langchain.toolThink\",\"position\":[840,1540],\"parameters\":{},\"typeVersion\":1},{\"id\":\"2513b2d7-bcdd-4622-93a1-27608af78894\",\"name\":\"get table details\",\"type\":\"@n8n/n8n-nodes-langchain.toolWorkflow\",\"position\":[620,1040],\"parameters\":{},\"typeVersion\":2.1},{\"id\":\"324503c0-117b-45ec-97dd-7074eb1db22e\",\"name\":\"ReadTableRows\",\"type\":\"@n8n/n8n-nodes-langchain.toolWorkflow\",\"position\":[480,1040],\"parameters\":{},\"typeVersion\":2.1},{\"id\":\"39a88e5b-585e-4caa-8f4a-d7c313dce70e\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-160,1220],\"parameters\":{\"content\":\"\"},\"typeVersion\":1},{\"id\":\"87a1998e-0106-43c2-943f-7b9b6744fd7f\",\"name\":\"Plot tool\",\"type\":\"@n8n/n8n-nodes-langchain.toolWorkflow\",\"position\":[640,840],\"parameters\":{},\"typeVersion\":2.1},{\"id\":\"ed260e47-5ba9-44fd-93b8-1643304da110\",\"name\":\"Simple Memory\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[500,1600],\"parameters\":{},\"typeVersion\":1.3},{\"id\":\"05a17841-b900-4e5c-bd46-1707892f4a82\",\"name\":\"When chat message received\",\"type\":\"@n8n/n8n-nodes-langchain.chatTrigger\",\"position\":[0,1260],\"webhookId\":\"6b21cb28-f0e4-4f1c-8bba-3170e94b6dec\",\"parameters\":{},\"typeVersion\":1.1}],\"active\":true,\"pinData\":{},\"settings\":{},\"versionId\":\"ff22a4a9-cacc-423b-bc2e-ae822eefb53a\",\"connections\":{\"Think\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"AI Agent\":{\"main\":[[]]},\"Operation\":{\"main\":[[{\"node\":\"ReadTableRecord\",\"type\":\"main\",\"index\":0}],[{\"node\":\"CreateTableRecord\",\"type\":\"main\",\"index\":0}],[{\"node\":\"UpdateTableRecord\",\"type\":\"main\",\"index\":0}]]},\"Plot tool\":{\"ai_tool\":[[{\"node\":\"PostgreSQL MCP Server\",\"type\":\"ai_tool\",\"index\":0}]]},\"ListTables\":{\"ai_tool\":[[{\"node\":\"PostgreSQL MCP Server\",\"type\":\"ai_tool\",\"index\":0}]]},\"MCP Client\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"ReadTableRows\":{\"ai_tool\":[[{\"node\":\"PostgreSQL MCP Server\",\"type\":\"ai_tool\",\"index\":0}]]},\"Simple Memory\":{\"ai_memory\":[[{\"node\":\"AI Agent\",\"type\":\"ai_memory\",\"index\":0}]]},\"GetTableSchema\":{\"ai_tool\":[[{\"node\":\"PostgreSQL MCP Server\",\"type\":\"ai_tool\",\"index\":0}]]},\"ReadTableRecord\":{\"main\":[[]]},\"get table details\":{\"ai_tool\":[[{\"node\":\"PostgreSQL MCP Server\",\"type\":\"ai_tool\",\"index\":0}]]},\"CreateTableRecords\":{\"ai_tool\":[[{\"node\":\"PostgreSQL MCP Server\",\"type\":\"ai_tool\",\"index\":0}]]},\"UpdateTableRecords\":{\"ai_tool\":[[{\"node\":\"PostgreSQL MCP Server\",\"type\":\"ai_tool\",\"index\":0}]]},\"Anthropic Chat Model\":{\"ai_languageModel\":[[{\"node\":\"AI Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"When chat message received\":{\"main\":[[{\"node\":\"AI Agent\",\"type\":\"main\",\"index\":0}]]},\"When Executed by Another Workflow\":{\"main\":[[{\"node\":\"Operation\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "![ChatGPT Image 6 mai 2025, 17_58_38.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/Chat_GPT_Image_6_mai_2025_17_58_38_02ccd37ac0.png)\n\nAsk your PostgreSQL database complex questions and receive clear summaries, charts, and even update or insert data ‚Äî all through one smart agent powered by n8n‚Äôs Model Context Protocol (MCP).\n\nSupports:\n\n  * Multi-KPI insights in one prompt\n  * Auto-generated QuickChart bar/pie charts\n  * Natural-language inserts and updates\n  * Markdown-friendly output for dashboards\n\n\n\n* * *\n\n## üöÄ Why This Version Stands Out\n\nThis version goes beyond reporting:\n\n  * üìà Auto-generates charts (QuickChart)\n  * üßÆ Answers multiple KPIs in one message\n  * ‚úçÔ∏è Add and update records securely\n  * üß† Uses up to 30 planned steps for smart reasoning\n\n\n\nüí∞ Estimated cost per run: ~$0.02\n\n* * *\n\n## üí¨ Example Output\n\n## ![withvisual_sql.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/withvisual_sql_928f685304.png)\n\n## üß∞ Key Components\n\n  * MCP Server Trigger ‚Üí Receives natural queries\n  * Claude 3.5 Haiku ‚Üí Plans, reasons, splits tasks\n  * DeepSeek ‚Üí SQL and QuickChart generation\n  * checkdatabase subflow ‚Üí Validates SQL\n  * Plot Tool ‚Üí Converts data to QuickChart URLs\n  * Insert/Update nodes ‚Üí Edits PostgreSQL records\n  * Markdown Formatter ‚Üí Combines output into readable message\n\n\n\n* * *\n\n## ü§ñ Model Configuration Notes\n\nThis workflow uses two models:\n\n  1. **Claude 3.5 Haiku (Anthropic)**  \nUsed as the MCP agent for reasoning, planning, and tool calling. Claude is the native model for MCP and delivers reliable results in fewer steps.\n\n  2. **DeepSeek**  \nUsed in:\n\n\n\n  * `checkdatabase` for SQL generation\n  * `Plot Tool` for QuickChart JSON generation\n\n\n\nüß† All models are modular ‚Äî you can plug in OpenAI, Gemini, or Mistral if desired.\n\n* * *\n\n## üîê Security by Design\n\n  * No raw SQL from user input\n  * Fully parameterized queries\n  * Structured tool calling with validation\n  * Safe output format (text + chart links)\n\n\n\n* * *\n\n## üß™ Try This Prompt\n\n> ‚ÄúShow me top 5 products by revenue, revenue per month chart, and best customers.‚Äù\n\nExpected output:\n\n  * 3 KPIs\n  * Multiple SQL queries\n  * 2‚Äì3 QuickChart links\n  * Markdown summary for dashboard/Slack\n\n\n\n* * *\n\n## üõ† How to Use\n\n  1. Import:\n\n     * `Build_your_own_PostgreSQL_MCP_server__visuals_capable_.json`\n     * `checkdatabase.json`\n     * `Plot_tool.json`\n  2. Create your **PostgreSQL credential** under ‚ÄúCredentials‚Äù in n8n:\n\n     * Must match the name used in the workflow (e.g., `Postgres account 3`)\n  3. Assign AI models:\n\n     * Claude 3.5 Haiku ‚Üí MCP agent (`Claude 3.5 MCP Agent`)\n     * DeepSeek ‚Üí LLM nodes inside `checkdatabase` and `Plot Tool`\n  4. Trigger the workflow using the URL from the **MCP Server Trigger** node  \n(e.g., in a chatbot, HTTP request, or Webhook UI)\n\n\n\n\n* * *\n\n## üì¶ End-User Setup Guide\n\nIf you're using this template for the first time, follow these exact steps:\n\n  1. Go to your n8n dashboard and import all three workflows (main + subflows)\n  2. Create a PostgreSQL credential using your host, database, user, and password\n  3. Go to the Claude and DeepSeek nodes, and connect them to your account(s)\n  4. Use the Webhook URL in the `MCP Server Trigger` to connect your chatbot or frontend\n  5. Send a prompt like:  \n‚ÄúShow me revenue per month, top 5 products, and a chart of best customers.‚Äù\n\n\n\nOptional:\n\n  * You can increase the MCP Agent‚Äôs `MaxIterations` to go deeper (default is 30)\n  * You can use Switch nodes to limit access to certain tables or actions\n  * Insert/Update nodes are already included and can be safely enabled\n\n\n\n‚úÖ Once this is done, your AI assistant will:\n\n  * Read from your database\n  * Visualize data via QuickChart\n  * Insert or update rows\n  * Respond in clear, markdown-formatted summaries\n\n\n\n* * *\n\n## üîó More Templates by the Same Creator\n\n  1. [PostgreSQL Conversational Agent with Claude & DeepSeek (Multi-KPI, Secure)](https://n8n.io/workflows/3892-postgresql-conversational-agent-with-claude-and-deepseek-multi-kpi-secure/)\n\n  2. [Conversing with Data: Transforming Text into SQL Queries and Visual Curves](https://n8n.io/workflows/3497-conversing-with-data-transforming-text-into-sql-queries-and-visual-curves/)\n\n  3. [Customer Feedback Analysis with AI, QuickChart & HTML Report Generator](https://n8n.io/workflows/3642-customer-feedback-analysis-with-ai-quickchart-and-html-report-generator/)\n\n\n\n",
  "crawled_at": "2025-05-26T05:57:10.381885"
}
{
  "url": "https://n8n.io/workflows/4086-ai-agent-to-chat-with-files-in-supabase-storage-and-google-drive/",
  "title": "AI Agent To Chat With Files In Supabase Storage and Google Drive",
  "author": "Mark Shcherbakov",
  "publish_date": "Last update 9 days ago",
  "publish_date_absolute": "2025-05-17",
  "categories": [
    {
      "name": "Engineering"
    },
    {
      "name": "AI"
    },
    {
      "name": "IT Ops"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"6a2a7715680b8313f7cb4676321c5baa46680adfb913072f089f2766f42e43bd\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"003915bb-a2e9-42b0-b81f-5bb5bf0c8cb4\",\"name\":\"Get All files\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1180,1280],\"parameters\":{\"url\":\"=https://<project_id>.supabase.co/storage/v1/object/list/private\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n  \\\"prefix\\\": \\\"\\\",\\n  \\\"limit\\\": 100,\\n  \\\"offset\\\": 0,\\n  \\\"sortBy\\\": {\\n    \\\"column\\\": \\\"name\\\",\\n    \\\"order\\\": \\\"asc\\\"\\n  }\\n}\",\"sendBody\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\"},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":4.2},{\"id\":\"f46e056d-8311-4951-ad38-21759fabdaf7\",\"name\":\"Default Data Loader\",\"type\":\"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\"position\":[3500,1820],\"parameters\":{\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"=file_id\",\"value\":\"={{ $json.id }}\"}]}},\"jsonData\":\"={{ $('Merge Text').item.json.text }}\",\"jsonMode\":\"expressionData\"},\"typeVersion\":1},{\"id\":\"3cfdcacb-d0ef-422b-9048-a64e5f0dac66\",\"name\":\"Recursive Character Text Splitter\",\"type\":\"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\"position\":[3520,1960],\"parameters\":{\"options\":{},\"chunkSize\":500,\"chunkOverlap\":200},\"typeVersion\":1},{\"id\":\"3056ea0a-b788-43c7-a070-f40bd1ad3356\",\"name\":\"Embeddings OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[3320,1800],\"parameters\":{\"model\":\"text-embedding-3-small\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"fLfRtaXbR0EVD0pl\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"e6ad8067-0468-440d-a322-2a3de8851431\",\"name\":\"Create File record2\",\"type\":\"n8n-nodes-base.supabase\",\"position\":[3260,1620],\"parameters\":{\"tableId\":\"files\",\"fieldsUi\":{\"fieldValues\":[{\"fieldId\":\"name\",\"fieldValue\":\"={{ $('Loop Over Items').item.json.name }}\"},{\"fieldId\":\"storage_id\",\"fieldValue\":\"={{ $('Loop Over Items').item.json.id }}\"}]}},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":1},{\"id\":\"53ac0d69-d935-48a0-8fb8-5cc8f591dbb8\",\"name\":\"If\",\"type\":\"n8n-nodes-base.if\",\"position\":[1500,1280],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"9b14e306-a04d-40f7-bc5b-b8eda8d8f7f2\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ \\n    !$('Aggregate').item.json.data || \\n    !Array.isArray($('Aggregate').item.json.data) || \\n    !$('Aggregate').item.json.data.some(item => \\n        item.storage_id === $('Loop Over Items').item.json.id \\n    ) \\n}}\",\"rightValue\":\"\"},{\"id\":\"c3c0af88-9aea-4539-8948-1b69e601c27c\",\"operator\":{\"type\":\"string\",\"operation\":\"notEquals\"},\"leftValue\":\"={{ $json.name }}\",\"rightValue\":\".emptyFolderPlaceholder\"}]}},\"typeVersion\":2.2},{\"id\":\"f57e857a-094f-470c-ad27-9fc29466ab0e\",\"name\":\"Get All Files\",\"type\":\"n8n-nodes-base.supabase\",\"position\":[800,1280],\"parameters\":{\"tableId\":\"files\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":1,\"alwaysOutputData\":true},{\"id\":\"4484ca47-6879-43b7-8879-261f409014e1\",\"name\":\"Download\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1660,1280],\"parameters\":{\"url\":\"=https://<project_id>.supabase.co/storage/v1/object/private/{{ $json.name }}\",\"options\":{},\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\"},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":4.2},{\"id\":\"f81d2f91-d665-4217-8955-a308ef2b37be\",\"name\":\"Loop Over Items\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[1340,1280],\"parameters\":{\"options\":{},\"batchSize\":\"=1\"},\"typeVersion\":3},{\"id\":\"8857a553-37aa-4ac2-ac4d-e5402849cb2e\",\"name\":\"When clicking ‘Test workflow’\",\"type\":\"n8n-nodes-base.manualTrigger\",\"disabled\":true,\"position\":[620,1280],\"parameters\":{},\"typeVersion\":1},{\"id\":\"e967af7e-43bd-47cb-8b04-eb431a82c93b\",\"name\":\"Aggregate\",\"type\":\"n8n-nodes-base.aggregate\",\"position\":[1000,1280],\"parameters\":{\"options\":{},\"aggregate\":\"aggregateAllItemData\"},\"typeVersion\":1,\"alwaysOutputData\":true},{\"id\":\"8abdb8f6-e31d-48cf-8189-831adf7d4889\",\"name\":\"When chat message received\",\"type\":\"@n8n/n8n-nodes-langchain.chatTrigger\",\"position\":[1420,300],\"webhookId\":\"3c40d311-7996-4ed4-b2fa-c73bea5f4cf5\",\"parameters\":{\"options\":{}},\"typeVersion\":1.1},{\"id\":\"75cf7f9e-d8f6-4a7a-b464-d152fd025188\",\"name\":\"Insert into Supabase Vectorstore\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"position\":[3420,1620],\"parameters\":{\"mode\":\"insert\",\"options\":{\"queryName\":\"match_documents\"},\"tableName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"documents\",\"cachedResultName\":\"documents\"}},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":1},{\"id\":\"b3ceb557-53c6-4d19-ac97-c999ba87c7f5\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1120,1160],\"parameters\":{\"height\":89.3775420487804,\"content\":\"### Replace Storage name, database ID and credentials.\"},\"typeVersion\":1},{\"id\":\"a81fe332-86ea-46aa-b140-ee5745f0b0e0\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[760,1160],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"44070cd1-0f4d-48ea-8ce0-8d59f94133e7\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3260,1500],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"3fed931d-69de-4c1b-a951-5e49c683f551\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1620,1160],\"parameters\":{\"height\":89.3775420487804,\"content\":\"### Replace Storage name, database ID and credentials.\"},\"typeVersion\":1},{\"id\":\"d462978c-7ea3-4b92-a940-64756377c461\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3220,1940],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"6f0a219d-4258-4982-b912-784a850ef308\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2080,800],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"469b3caf-c9a8-4f8b-a745-c672e2b1089f\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[560,40],\"parameters\":{\"color\":7,\"width\":636.2128494576581,\"height\":497.1532689930921,\"content\":\"![5min Logo](https://cflobdhpqwnoisuctsoc.supabase.co/storage/v1/object/public/my_storage/banner.png)\\n## AI Agent To Chat With Files In Supabase Storage\\n**Made by [Mark Shcherbakov](https://www.linkedin.com/in/marklowcoding/) from community [5minAI](https://www.skool.com/5minai-2861)**\\n\\nManually retrieving and analyzing specific information from large document repositories is time-consuming and inefficient. This workflow automates the process by vectorizing documents and enabling AI-powered interactions, making it easy to query and retrieve context-based information from uploaded files.\\n\\nThe workflow integrates Supabase with an AI-powered chatbot to process, store, and query text and PDF files. The steps include:\\n- Fetching and comparing files to avoid duplicate processing.\\n- Handling file downloads and extracting content based on the file type.\\n- Converting documents into vectorized data for contextual information retrieval.\\n- Storing and querying vectorized data from a Supabase vector store.\\n\\n\"},\"typeVersion\":1},{\"id\":\"cb6664f2-0a05-4abb-818d-d72536b57bac\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1360,40],\"parameters\":{\"color\":5,\"width\":1112,\"height\":890,\"content\":\"## Scenario 2 - AI agent\"},\"typeVersion\":1},{\"id\":\"a825794d-e7f3-41ba-a113-8503ebaf2be7\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[540,1000],\"parameters\":{\"color\":5,\"width\":3285,\"height\":1139,\"content\":\"## Scenario 1 - Flow for adding new files from Supabase storage\"},\"typeVersion\":1},{\"id\":\"1d44ef3b-b1d9-481c-8078-2f0d8d586247\",\"name\":\"AI Agent1\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[1960,260],\"parameters\":{\"text\":\"={{ $('Merge').item.json.message }}\",\"options\":{\"systemMessage\":\"You are a helpful assistant.\\n\\nIMPORTANT Always use knowledge base to respond users.\",\"passthroughBinaryImages\":false},\"promptType\":\"define\"},\"typeVersion\":1.8},{\"id\":\"d1da58a8-e6c0-4a6d-aa53-88c223a97f0a\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1880,480],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"SphXAX7rlwRLkiox\",\"name\":\"Test club key\"}},\"typeVersion\":1.2},{\"id\":\"acb2de9b-a9fa-4934-9759-b84b067dc26a\",\"name\":\"Simple Memory\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[2020,480],\"parameters\":{\"sessionKey\":\"={{ $('Merge').item.json.session_id }}\",\"sessionIdType\":\"customKey\"},\"typeVersion\":1.3},{\"id\":\"4d91a4e9-e381-485a-847e-50b5dcc43f6b\",\"name\":\"Embeddings OpenAI1\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[2160,660],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"SphXAX7rlwRLkiox\",\"name\":\"Test club key\"}},\"typeVersion\":1.2},{\"id\":\"19b5a9a8-7407-4a1c-822f-3000b67da99b\",\"name\":\"Supabase Vector Store\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"position\":[2160,500],\"parameters\":{\"mode\":\"retrieve-as-tool\",\"options\":{},\"toolName\":\"knowledge_base\",\"tableName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"documents\",\"cachedResultName\":\"documents\"},\"toolDescription\":\"Gather facts from knowledge base to respond user.\"},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":1.1},{\"id\":\"0b48a55c-9b47-4913-9aec-264d3932c533\",\"name\":\"File Created\",\"type\":\"n8n-nodes-base.googleDriveTrigger\",\"position\":[600,2480],\"parameters\":{\"event\":\"fileCreated\",\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]},\"triggerOn\":\"specificFolder\",\"folderToWatch\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\"cachedResultUrl\":\"https://drive.google.com/drive/folders/1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\"cachedResultName\":\"Case - dentist\"}},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"1Irxryx1yQ3upU2i\",\"name\":\"Google Drive account\"}},\"typeVersion\":1},{\"id\":\"fd7a9260-7d85-4129-bf2d-f7700781091b\",\"name\":\"Download File\",\"type\":\"n8n-nodes-base.googleDrive\",\"position\":[1200,2580],\"parameters\":{\"fileId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Set File ID').last().json.file_id }}\"},\"options\":{\"googleFileConversion\":{\"conversion\":{\"docsToFormat\":\"application/pdf\",\"sheetsToFormat\":\"application/pdf\",\"slidesToFormat\":\"application/pdf\",\"drawingsToFormat\":\"application/pdf\"}}},\"operation\":\"download\"},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"1Irxryx1yQ3upU2i\",\"name\":\"Google Drive account\"}},\"executeOnce\":true,\"typeVersion\":3},{\"id\":\"e17a7bc1-6483-439b-acb0-2b13f66466e5\",\"name\":\"File Updated\",\"type\":\"n8n-nodes-base.googleDriveTrigger\",\"position\":[620,2660],\"parameters\":{\"event\":\"fileUpdated\",\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]},\"triggerOn\":\"specificFolder\",\"folderToWatch\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\"cachedResultUrl\":\"https://drive.google.com/drive/folders/1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\"cachedResultName\":\"Case - dentist\"}},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"1Irxryx1yQ3upU2i\",\"name\":\"Google Drive account\"}},\"typeVersion\":1},{\"id\":\"b0e5b639-cf0e-4289-8ce7-96e6fd1e831f\",\"name\":\"Delete Old Doc Rows\",\"type\":\"n8n-nodes-base.supabase\",\"position\":[1020,2580],\"parameters\":{\"tableId\":\"documents\",\"operation\":\"delete\",\"filterType\":\"string\",\"filterString\":\"=metadata->>drive_file_id=like.*{{ $json.file_id }}*\"},\"credentials\":{\"supabaseApi\":{\"id\":\"QBhcokohbJHfQZ9A\",\"name\":\"Supabase club\"}},\"typeVersion\":1,\"alwaysOutputData\":true},{\"id\":\"c583b665-b756-4b8c-8150-34f559df9007\",\"name\":\"Set File ID\",\"type\":\"n8n-nodes-base.set\",\"position\":[860,2580],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"10646eae-ae46-4327-a4dc-9987c2d76173\",\"name\":\"file_id\",\"type\":\"string\",\"value\":\"={{ $json.id }}\"},{\"id\":\"7d0b3a5e-9dfa-46d3-bf16-f6fc1d44f242\",\"name\":\"extension\",\"type\":\"string\",\"value\":\"={{ $json.fileExtension }}\"}]}},\"typeVersion\":3.4},{\"id\":\"558473fe-cc06-41d8-ab06-cc6c03a8c40e\",\"name\":\"Create File record1\",\"type\":\"n8n-nodes-base.supabase\",\"position\":[2380,2780],\"parameters\":{\"tableId\":\"files\",\"fieldsUi\":{\"fieldValues\":[{\"fieldId\":\"name\",\"fieldValue\":\"={{ $('Download File').item.binary.data.fileName }}\"},{\"fieldId\":\"google_drive_id\",\"fieldValue\":\"={{ $('Set File ID').item.json.file_id }}\"}]}},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":1},{\"id\":\"87e490c4-f9cb-4821-a234-a9c9d2c93836\",\"name\":\"Default Data Loader1\",\"type\":\"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\"position\":[2640,2980],\"parameters\":{\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"=file_id\",\"value\":\"={{ $json.id }}\"},{\"name\":\"drive_file_id\",\"value\":\"={{ $('Set File ID').item.json.file_id }}\"}]}},\"jsonData\":\"={{ $('Set Text3').item.json.text }}\",\"jsonMode\":\"expressionData\"},\"typeVersion\":1},{\"id\":\"373efd3c-f7dd-4efc-a268-ed05d8b2e309\",\"name\":\"Embeddings OpenAI3\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[2480,2960],\"parameters\":{\"model\":\"text-embedding-3-small\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"fLfRtaXbR0EVD0pl\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"17daf2dd-1d4c-498e-8404-7cc371f81894\",\"name\":\"Recursive Character Text Splitter1\",\"type\":\"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\"position\":[2660,3180],\"parameters\":{\"options\":{},\"chunkSize\":500,\"chunkOverlap\":200},\"typeVersion\":1},{\"id\":\"afcfc728-9798-4703-998d-edc535eb859e\",\"name\":\"Insert into Supabase Vectorstore1\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"position\":[2580,2780],\"parameters\":{\"mode\":\"insert\",\"options\":{\"queryName\":\"match_documents\"},\"tableName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"documents\",\"cachedResultName\":\"documents\"}},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account info@ Demo\"}},\"typeVersion\":1},{\"id\":\"78e7d15c-5797-488c-b869-bb887878e930\",\"name\":\"Sticky Note11\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[540,2240],\"parameters\":{\"color\":5,\"width\":2465,\"height\":1139,\"content\":\"## Scenario 3 - Flow for adding new files from Supabase storage\"},\"typeVersion\":1},{\"id\":\"f572511d-6374-4b0b-8907-9f6c82179feb\",\"name\":\"Edit Fields\",\"type\":\"n8n-nodes-base.set\",\"position\":[1600,300],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"ad3055e5-41eb-4e00-9f55-dbcde47a03c7\",\"name\":\"session_id\",\"type\":\"string\",\"value\":\"={{   $('When chat message received').item.json.sessionId }}\"},{\"id\":\"56126e31-5fe0-4a9c-b9c9-d62fcb8bd469\",\"name\":\"message\",\"type\":\"string\",\"value\":\"={{   $('When chat message received').item.json.chatInput }}\"}]}},\"typeVersion\":3.4},{\"id\":\"be2de117-410c-49c2-b95c-45b4a0e036d6\",\"name\":\"Edit Fields1\",\"type\":\"n8n-nodes-base.set\",\"position\":[1600,140],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"5e5fbeb0-d866-40fe-8c1b-66b946bd1cec\",\"name\":\"session_id\",\"type\":\"string\",\"value\":\"={{ $('Webhook').item.json.body.session_id }}\"},{\"id\":\"28ec27a5-f814-435c-a5bf-df92160eee3e\",\"name\":\"message\",\"type\":\"string\",\"value\":\"={{ $('Webhook').item.json.body.message }}\"}]}},\"typeVersion\":3.4},{\"id\":\"ce8790a1-55a5-4583-8301-03bbde363ee2\",\"name\":\"Upload File\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2040,1280],\"parameters\":{\"url\":\"https://api.cloud.llamaindex.ai/api/parsing/upload\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"contentType\":\"multipart-form-data\",\"sendHeaders\":true,\"authentication\":\"genericCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"file\",\"parameterType\":\"formBinaryData\",\"inputDataFieldName\":\"data\"},{\"name\":\"do_not_cache\",\"value\":\"=true\"}]},\"genericAuthType\":\"httpHeaderAuth\",\"headerParameters\":{\"parameters\":[{\"name\":\"accept\",\"value\":\"application/json\"}]}},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"AkhbJSroTy15x6o9\",\"name\":\"Llama parse bqman\"}},\"typeVersion\":4.2},{\"id\":\"10b8cf52-4301-40a2-a27d-9952f1d3bcda\",\"name\":\"Get Processing Status\",\"type\":\"n8n-nodes-base.httpRequest\",\"onError\":\"continueErrorOutput\",\"position\":[2240,1280],\"parameters\":{\"url\":\"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}\",\"options\":{},\"sendHeaders\":true,\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"headerParameters\":{\"parameters\":[{\"name\":\"accept\",\"value\":\"application/json\"}]}},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"AkhbJSroTy15x6o9\",\"name\":\"Llama parse bqman\"}},\"typeVersion\":4.2},{\"id\":\"c0fc7854-1d04-492d-9541-389356333efd\",\"name\":\"Wait to stay within service limits\",\"type\":\"n8n-nodes-base.wait\",\"position\":[2660,1040],\"webhookId\":\"17a96ed6-b5ff-47bb-a8a2-39c1eb40185a\",\"parameters\":{\"amount\":7},\"typeVersion\":1.1},{\"id\":\"971b40d2-a320-4815-9ccc-27de52b58bbd\",\"name\":\"Is Job Ready?\",\"type\":\"n8n-nodes-base.switch\",\"position\":[2420,1280],\"parameters\":{\"rules\":{\"values\":[{\"outputKey\":\"PENDING\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"0fa97d86-432a-409a-917e-5f1a002b1ab9\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"PENDING\"}]},\"renameOutput\":true},{\"outputKey\":\"ERROR\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"e6058aa0-a3e2-4ce3-9bed-6ff41a5be052\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"ERROR\"}]},\"renameOutput\":true},{\"outputKey\":\"CANCELED\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"ceb6338f-4261-40ac-be11-91f61c7302ba\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"CANCELED\"}]},\"renameOutput\":true},{\"outputKey\":\"SUCCESS\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"300fce8c-b19a-4d0c-86e8-f62853c70ce2\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"SUCCESS\"}]},\"renameOutput\":true}]},\"options\":{\"allMatchingOutputs\":true}},\"typeVersion\":3},{\"id\":\"c8f65cc5-e67a-47ae-b43a-fc065fb4900e\",\"name\":\"Stop and Error\",\"type\":\"n8n-nodes-base.stopAndError\",\"position\":[2660,1300],\"parameters\":{\"errorMessage\":\"Problem with Llamaparser. Error during parsing.\"},\"typeVersion\":1},{\"id\":\"90658f0a-7236-493d-8dd0-fdad64196753\",\"name\":\"Get Parsed Data\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2660,1480],\"parameters\":{\"url\":\"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}/result/markdown\",\"options\":{\"redirect\":{\"redirect\":{}}},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\"},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"AkhbJSroTy15x6o9\",\"name\":\"Llama parse bqman\"}},\"typeVersion\":4.2},{\"id\":\"810aad96-7677-4c27-b3b2-25106b70083a\",\"name\":\"Sticky Note12\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2060,1460],\"parameters\":{\"width\":280,\"height\":80,\"content\":\"### Add Llamaparse Header auth\\nAuthorization: Bearer <api_key>\"},\"typeVersion\":1},{\"id\":\"a0fd62b8-219e-4eb7-b274-1344b0042fac\",\"name\":\"Merge\",\"type\":\"n8n-nodes-base.merge\",\"position\":[1800,260],\"parameters\":{},\"typeVersion\":3.1},{\"id\":\"e5356266-5e4a-41a2-8151-95f994435560\",\"name\":\"If1\",\"type\":\"n8n-nodes-base.if\",\"position\":[1820,1280],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"f05d708d-f36e-4c6d-8753-81a61ae42546\",\"operator\":{\"type\":\"string\",\"operation\":\"notExists\",\"singleValue\":true},\"leftValue\":\"={{ $json.data }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"c04fa3f9-74c6-4c7c-ae2a-46a797db0e55\",\"name\":\"Set Text\",\"type\":\"n8n-nodes-base.set\",\"position\":[2060,1600],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"e9bbecd9-3d40-4a6a-9401-94daab15cde0\",\"name\":\"text\",\"type\":\"string\",\"value\":\"={{ $('If1').item.json.data }}\"}]}},\"typeVersion\":3.4},{\"id\":\"2f41ef18-6229-4d3c-9a3c-8b02ec3c60b2\",\"name\":\"Set Text1\",\"type\":\"n8n-nodes-base.set\",\"position\":[2840,1480],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"e9bbecd9-3d40-4a6a-9401-94daab15cde0\",\"name\":\"text\",\"type\":\"string\",\"value\":\"={{ $('Get Parsed Data').item.json.markdown }}\"}]}},\"typeVersion\":3.4},{\"id\":\"9c92b25b-7762-4465-878f-6568073ba521\",\"name\":\"Merge Text\",\"type\":\"n8n-nodes-base.merge\",\"position\":[3060,1620],\"parameters\":{},\"typeVersion\":3.1},{\"id\":\"4a523ad6-d74d-4207-8347-facc7f313fdd\",\"name\":\"Upload File1\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1380,2580],\"parameters\":{\"url\":\"https://api.cloud.llamaindex.ai/api/parsing/upload\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"contentType\":\"multipart-form-data\",\"sendHeaders\":true,\"authentication\":\"genericCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"file\",\"parameterType\":\"formBinaryData\",\"inputDataFieldName\":\"data\"},{\"name\":\"do_not_cache\",\"value\":\"=true\"}]},\"genericAuthType\":\"httpHeaderAuth\",\"headerParameters\":{\"parameters\":[{\"name\":\"accept\",\"value\":\"application/json\"}]}},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"AkhbJSroTy15x6o9\",\"name\":\"Llama parse bqman\"}},\"typeVersion\":4.2},{\"id\":\"c0a43e5e-ec2b-49f5-bbc0-cef914c68c4c\",\"name\":\"Get Processing Status1\",\"type\":\"n8n-nodes-base.httpRequest\",\"onError\":\"continueErrorOutput\",\"position\":[1580,2580],\"parameters\":{\"url\":\"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}\",\"options\":{},\"sendHeaders\":true,\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"headerParameters\":{\"parameters\":[{\"name\":\"accept\",\"value\":\"application/json\"}]}},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"AkhbJSroTy15x6o9\",\"name\":\"Llama parse bqman\"}},\"typeVersion\":4.2},{\"id\":\"68cc70a4-dba0-4ec9-8506-88bb20b37e87\",\"name\":\"Wait to stay within service limits1\",\"type\":\"n8n-nodes-base.wait\",\"position\":[2000,2340],\"webhookId\":\"17a96ed6-b5ff-47bb-a8a2-39c1eb40185a\",\"parameters\":{\"amount\":7},\"typeVersion\":1.1},{\"id\":\"aef3b805-166e-47a8-a81c-900f999ae045\",\"name\":\"Is Job Ready?1\",\"type\":\"n8n-nodes-base.switch\",\"position\":[1760,2580],\"parameters\":{\"rules\":{\"values\":[{\"outputKey\":\"PENDING\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"0fa97d86-432a-409a-917e-5f1a002b1ab9\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"PENDING\"}]},\"renameOutput\":true},{\"outputKey\":\"ERROR\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"e6058aa0-a3e2-4ce3-9bed-6ff41a5be052\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"ERROR\"}]},\"renameOutput\":true},{\"outputKey\":\"CANCELED\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"ceb6338f-4261-40ac-be11-91f61c7302ba\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"CANCELED\"}]},\"renameOutput\":true},{\"outputKey\":\"SUCCESS\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"300fce8c-b19a-4d0c-86e8-f62853c70ce2\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"SUCCESS\"}]},\"renameOutput\":true}]},\"options\":{\"allMatchingOutputs\":true}},\"typeVersion\":3},{\"id\":\"5233be31-2ecf-4ddd-96e2-b0fd614f535f\",\"name\":\"Stop and Error1\",\"type\":\"n8n-nodes-base.stopAndError\",\"position\":[2000,2600],\"parameters\":{\"errorMessage\":\"Problem with Llamaparser. Error during parsing.\"},\"typeVersion\":1},{\"id\":\"09283faa-4ab9-4d59-a610-3491d7f2daf8\",\"name\":\"Get Parsed Data1\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2000,2780],\"parameters\":{\"url\":\"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}/result/markdown\",\"options\":{\"redirect\":{\"redirect\":{}}},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\"},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"AkhbJSroTy15x6o9\",\"name\":\"Llama parse bqman\"}},\"typeVersion\":4.2},{\"id\":\"5ef6959d-1eb4-49cd-9b19-3b0e1aaa0eb7\",\"name\":\"Sticky Note13\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1400,2760],\"parameters\":{\"width\":280,\"height\":80,\"content\":\"### Add Llamaparse Header auth\\nAuthorization: Bearer <api_key>\"},\"typeVersion\":1},{\"id\":\"18fd1d0f-664e-4584-8154-794ca8aad768\",\"name\":\"Set Text3\",\"type\":\"n8n-nodes-base.set\",\"position\":[2180,2780],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"e9bbecd9-3d40-4a6a-9401-94daab15cde0\",\"name\":\"text\",\"type\":\"string\",\"value\":\"={{ $('Get Parsed Data1').item.json.markdown }}\"}]}},\"typeVersion\":3.4},{\"id\":\"337b8593-8f5a-47b2-8b75-f5b3b4195fe8\",\"name\":\"Webhook\",\"type\":\"n8n-nodes-base.webhook\",\"position\":[1420,140],\"webhookId\":\"05979e87-19bc-4e8b-adbb-7e04808f8b21\",\"parameters\":{\"path\":\"05979e87-19bc-4e8b-adbb-7e04808f8b21\",\"options\":{},\"httpMethod\":\"POST\",\"responseMode\":\"lastNode\"},\"typeVersion\":2},{\"id\":\"7911c133-f998-4efd-a9c8-9c52c8e545c4\",\"name\":\"Sticky Note14\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2380,2660],\"parameters\":{\"width\":480,\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"If\":{\"main\":[[{\"node\":\"Download\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"If1\":{\"main\":[[{\"node\":\"Upload File\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Set Text\",\"type\":\"main\",\"index\":0}]]},\"Merge\":{\"main\":[[{\"node\":\"AI Agent1\",\"type\":\"main\",\"index\":0}]]},\"Webhook\":{\"main\":[[{\"node\":\"Edit Fields1\",\"type\":\"main\",\"index\":0}]]},\"Download\":{\"main\":[[{\"node\":\"If1\",\"type\":\"main\",\"index\":0}]]},\"Set Text\":{\"main\":[[{\"node\":\"Merge Text\",\"type\":\"main\",\"index\":1}]]},\"Aggregate\":{\"main\":[[{\"node\":\"Get All files\",\"type\":\"main\",\"index\":0}]]},\"Set Text1\":{\"main\":[[{\"node\":\"Merge Text\",\"type\":\"main\",\"index\":0}]]},\"Set Text3\":{\"main\":[[{\"node\":\"Create File record1\",\"type\":\"main\",\"index\":0}]]},\"Merge Text\":{\"main\":[[{\"node\":\"Create File record2\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"Set File ID\":{\"main\":[[{\"node\":\"Delete Old Doc Rows\",\"type\":\"main\",\"index\":0}]]},\"Upload File\":{\"main\":[[{\"node\":\"Get Processing Status\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields1\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}]]},\"File Created\":{\"main\":[[{\"node\":\"Set File ID\",\"type\":\"main\",\"index\":0}]]},\"File Updated\":{\"main\":[[{\"node\":\"Set File ID\",\"type\":\"main\",\"index\":0}]]},\"Upload File1\":{\"main\":[[{\"node\":\"Get Processing Status1\",\"type\":\"main\",\"index\":0}]]},\"Download File\":{\"main\":[[{\"node\":\"Upload File1\",\"type\":\"main\",\"index\":0}]]},\"Get All Files\":{\"main\":[[{\"node\":\"Aggregate\",\"type\":\"main\",\"index\":0}]]},\"Get All files\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Is Job Ready?\":{\"main\":[[{\"node\":\"Wait to stay within service limits\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Stop and Error\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Stop and Error\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Get Parsed Data\",\"type\":\"main\",\"index\":0}]]},\"Simple Memory\":{\"ai_memory\":[[{\"node\":\"AI Agent1\",\"type\":\"ai_memory\",\"index\":0}]]},\"Is Job Ready?1\":{\"main\":[[{\"node\":\"Wait to stay within service limits1\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Stop and Error1\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Stop and Error1\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Get Parsed Data1\",\"type\":\"main\",\"index\":0}]]},\"Get Parsed Data\":{\"main\":[[{\"node\":\"Set Text1\",\"type\":\"main\",\"index\":0}]]},\"Loop Over Items\":{\"main\":[[],[{\"node\":\"If\",\"type\":\"main\",\"index\":0}]]},\"Get Parsed Data1\":{\"main\":[[{\"node\":\"Set Text3\",\"type\":\"main\",\"index\":0}]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"Insert into Supabase Vectorstore\",\"type\":\"ai_embedding\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"AI Agent1\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Embeddings OpenAI1\":{\"ai_embedding\":[[{\"node\":\"Supabase Vector Store\",\"type\":\"ai_embedding\",\"index\":0}]]},\"Embeddings OpenAI3\":{\"ai_embedding\":[[{\"node\":\"Insert into Supabase Vectorstore1\",\"type\":\"ai_embedding\",\"index\":0}]]},\"Create File record1\":{\"main\":[[{\"node\":\"Insert into Supabase Vectorstore1\",\"type\":\"main\",\"index\":0}]]},\"Create File record2\":{\"main\":[[{\"node\":\"Insert into Supabase Vectorstore\",\"type\":\"main\",\"index\":0}]]},\"Default Data Loader\":{\"ai_document\":[[{\"node\":\"Insert into Supabase Vectorstore\",\"type\":\"ai_document\",\"index\":0}]]},\"Delete Old Doc Rows\":{\"main\":[[{\"node\":\"Download File\",\"type\":\"main\",\"index\":0}]]},\"Default Data Loader1\":{\"ai_document\":[[{\"node\":\"Insert into Supabase Vectorstore1\",\"type\":\"ai_document\",\"index\":0}]]},\"Get Processing Status\":{\"main\":[[{\"node\":\"Is Job Ready?\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Stop and Error\",\"type\":\"main\",\"index\":0}]]},\"Supabase Vector Store\":{\"ai_tool\":[[{\"node\":\"AI Agent1\",\"type\":\"ai_tool\",\"index\":0}]]},\"Get Processing Status1\":{\"main\":[[{\"node\":\"Is Job Ready?1\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Stop and Error1\",\"type\":\"main\",\"index\":0}]]},\"When chat message received\":{\"main\":[[{\"node\":\"Edit Fields\",\"type\":\"main\",\"index\":0}]]},\"Insert into Supabase Vectorstore\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Recursive Character Text Splitter\":{\"ai_textSplitter\":[[{\"node\":\"Default Data Loader\",\"type\":\"ai_textSplitter\",\"index\":0}]]},\"When clicking ‘Test workflow’\":{\"main\":[[{\"node\":\"Get All Files\",\"type\":\"main\",\"index\":0}]]},\"Recursive Character Text Splitter1\":{\"ai_textSplitter\":[[{\"node\":\"Default Data Loader1\",\"type\":\"ai_textSplitter\",\"index\":0}]]},\"Wait to stay within service limits\":{\"main\":[[{\"node\":\"Get Processing Status\",\"type\":\"main\",\"index\":0}]]},\"Wait to stay within service limits1\":{\"main\":[[{\"node\":\"Get Processing Status1\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Video Guide\n\nI prepared a detailed guide that illustrates the entire process of building an AI agent using Supabase and Google Drive within N8N workflows.\n\n[![Youtube Thumbnail](https://res.cloudinary.com/de9jgixzm/image/upload/rv0bmq7vr691gfmqn3yw)](https://youtu.be/NB6LhvObiL4)\n\n[Youtube Link](https://youtu.be/NB6LhvObiL4)\n\n### Who is this for?\n\nThis workflow is designed for developers, data scientists, and business users who wish to automate document management and enable AI-powered interactions over their stored files. It's especially beneficial for scenarios where users need to process, analyze, and retrieve information from uploaded documents rapidly.\n\n### What problem does this workflow solve?\n\nManaging files across multiple platforms often involves tedious manual processes. This workflow facilitates automated file handling, making it easier for users to upload, parse, and interact with documents through an AI agent. It reduces redundancy and enhances the efficiency of data retrieval and management tasks.\n\n### What this workflow does\n\nThis workflow integrates Supabase storage with Google Drive and employs an AI agent to manage files effectively. The agent can:\n\n  * Upload files to Supabase storage and activate processes based on file changes in Google Drive.\n  * Retrieve and parse documents, converting them into a structured format for easy querying.\n  * Utilize an AI agent to answer user queries based on saved document data.\n\n\n  1. **Data Collection** : The workflow initially gathers files from Supabase storage, ensuring no duplicates are processed in the 'files' table.\n  2. **File Handling** : It processes files to be parsed based on their type, leveraging LlamaParse for effective data transformation.\n  3. **Google Drive Integration** : The workflow monitors a designated Google Drive folder to upload files automatically and refresh document records in the database with new data.\n  4. **AI Interaction** : A webhook is established to enable the AI agent to converse with users, facilitating queries and leveraging stored document knowledge.\n\n\n\n### Setup\n\n  1. **Supabase Storage Setup** :\n\n     * Create a private bucket in Supabase storage, modifying the default name in the URL.\n     * Upload your files using the provided upload options.\n  2. **Database Configuration** :\n\n     * Establish the 'file' and 'document' tables in Supabase with the necessary fields.\n     * Execute any required SQL queries for enabling vector matching features.\n  3. **N8N Workflow Logic** :\n\n     * Start with a manual trigger for the initial workflow segment or consider alternative triggers like webhooks.\n     * Replace all relevant credentials across nodes with your own to ensure seamless operation.\n  4. **File Processing and Google Drive Monitoring** :\n\n     * Set up file processing to take care of downloading and parsing files based on their types.\n     * Create triggers to monitor the designated Google Drive folder for file uploads and updates.\n  5. **Integrate AI Agent** :\n\n     * Configure the webhook for the AI agent to accept chat inputs while maintaining session context for enhanced user interactions.\n     * Utilize PostgreSQL to store user interactions and manage conversation states effectively.\n  6. **Testing and Adjustments** :\n\n     * Once everything is set up, run tests with the AI agent to validate its responses based on the documents in your database.\n     * Fine-tune the workflow and AI model as needed to achieve desired performance.\n\n\n",
  "crawled_at": "2025-05-26T06:31:15.983468",
  "readme_zh": "### 视频指南\n\n我制作了一份详细教程，完整演示了如何在N8N工作流中使用Supabase和Google Drive构建AI智能体。\n\n[![YouTube缩略图](https://res.cloudinary.com/de9jgixzm/image/upload/rv0bmq7vr691gfmqn3yw)](https://youtu.be/NB6LhvObiL4)\n\n[YouTube视频链接](https://youtu.be/NB6LhvObiL4)\n\n### 适用人群\n\n本工作流专为需要自动化文档管理、实现基于存储文件的AI智能交互的开发者、数据科学家和业务人员设计。特别适用于需要快速处理、分析并检索上传文档信息的场景。\n\n### 解决什么问题？\n\n跨平台文件管理往往涉及繁琐的手动操作。该工作流实现了自动化文件处理，使用户能通过AI智能体轻松上传、解析和交互文档，减少重复劳动并提升数据检索与管理效率。\n\n### 核心功能\n\n本工作流整合Supabase存储与Google Drive，部署AI智能体实现高效文件管理：\n\n  * 将文件上传至Supabase存储，并根据Google Drive文件变动触发流程\n  * 检索解析文档，将其转换为结构化格式便于查询\n  * 通过AI智能体基于存储文档数据回答用户问题\n\n**实现步骤**：\n1. **数据收集**：从Supabase存储获取文件，确保\"files\"表无重复处理\n2. **文件处理**：根据文件类型调用LlamaParse进行数据转换\n3. **Google Drive集成**：监控指定文件夹实现自动上传，更新数据库文档记录\n4. **AI交互**：通过Webhook实现智能体对话，支持基于文档知识的查询\n\n### 配置指南\n\n1. **Supabase存储配置**：\n   * 创建私有存储桶，修改URL中的默认名称\n   * 使用上传功能添加文件\n\n2. **数据库设置**：\n   * 在Supabase创建含必要字段的file/document表\n   * 执行SQL查询启用向量匹配功能\n\n3. **N8N工作流配置**：\n   * 初始流程使用手动触发器，也可替换为Webhook等触发方式\n   * 替换所有节点中的凭证确保正常运行\n\n4. **文件处理与监控**：\n   * 设置基于类型的文件下载解析流程\n   * 创建触发器监控Google Drive指定文件夹\n\n5. **AI智能体集成**：\n   * 配置Webhook接收聊天输入，保持会话上下文\n   * 使用PostgreSQL存储交互记录管理会话状态\n\n6. **测试优化**：\n   * 运行测试验证AI基于数据库文档的响应准确性\n   * 按需调整工作流和AI模型参数\n\n（注：视频缩略图保留原URL格式，实际部署时需替换为有效图床链接）",
  "title_zh": "Supabase存储与Google Drive中文件对话的AI代理",
  "publish_date_zh": "最后更新于2天前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"6a2a7715680b8313f7cb4676321c5baa46680adfb913072f089f2766f42e43bd\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"003915bb-a2e9-42b0-b81f-5bb5bf0c8cb4\",\n      \"name\": \"Get All files\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1180,\n        1280\n      ],\n      \"parameters\": {\n        \"url\": \"=https://<project_id>.supabase.co/storage/v1/object/list/private\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"prefix\\\": \\\"\\\",\\n  \\\"limit\\\": 100,\\n  \\\"offset\\\": 0,\\n  \\\"sortBy\\\": {\\n    \\\"column\\\": \\\"name\\\",\\n    \\\"order\\\": \\\"asc\\\"\\n  }\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"supabaseApi\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"f46e056d-8311-4951-ad38-21759fabdaf7\",\n      \"name\": \"Default Data Loader\",\n      \"type\": \"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\n      \"position\": [\n        3500,\n        1820\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"=file_id\",\n                \"value\": \"={{ $json.id }}\"\n              }\n            ]\n          }\n        },\n        \"jsonData\": \"={{ $('Merge Text').item.json.text }}\",\n        \"jsonMode\": \"expressionData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3cfdcacb-d0ef-422b-9048-a64e5f0dac66\",\n      \"name\": \"Recursive Character Text Splitter\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\n      \"position\": [\n        3520,\n        1960\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"chunkSize\": 500,\n        \"chunkOverlap\": 200\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3056ea0a-b788-43c7-a070-f40bd1ad3356\",\n      \"name\": \"Embeddings OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        3320,\n        1800\n      ],\n      \"parameters\": {\n        \"model\": \"text-embedding-3-small\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"fLfRtaXbR0EVD0pl\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e6ad8067-0468-440d-a322-2a3de8851431\",\n      \"name\": \"Create File record2\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        3260,\n        1620\n      ],\n      \"parameters\": {\n        \"tableId\": \"files\",\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"name\",\n              \"fieldValue\": \"={{ $('Loop Over Items').item.json.name }}\"\n            },\n            {\n              \"fieldId\": \"storage_id\",\n              \"fieldValue\": \"={{ $('Loop Over Items').item.json.id }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"53ac0d69-d935-48a0-8fb8-5cc8f591dbb8\",\n      \"name\": \"If\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1500,\n        1280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"9b14e306-a04d-40f7-bc5b-b8eda8d8f7f2\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ \\n    !$('Aggregate').item.json.data || \\n    !Array.isArray($('Aggregate').item.json.data) || \\n    !$('Aggregate').item.json.data.some(item => \\n        item.storage_id === $('Loop Over Items').item.json.id \\n    ) \\n}}\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"c3c0af88-9aea-4539-8948-1b69e601c27c\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEquals\"\n              },\n              \"leftValue\": \"={{ $json.name }}\",\n              \"rightValue\": \".emptyFolderPlaceholder\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"f57e857a-094f-470c-ad27-9fc29466ab0e\",\n      \"name\": \"Get All Files\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        800,\n        1280\n      ],\n      \"parameters\": {\n        \"tableId\": \"files\",\n        \"operation\": \"getAll\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"4484ca47-6879-43b7-8879-261f409014e1\",\n      \"name\": \"Download\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1660,\n        1280\n      ],\n      \"parameters\": {\n        \"url\": \"=https://<project_id>.supabase.co/storage/v1/object/private/{{ $json.name }}\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"supabaseApi\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"f81d2f91-d665-4217-8955-a308ef2b37be\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        1340,\n        1280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"batchSize\": \"=1\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"8857a553-37aa-4ac2-ac4d-e5402849cb2e\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"disabled\": true,\n      \"position\": [\n        620,\n        1280\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e967af7e-43bd-47cb-8b04-eb431a82c93b\",\n      \"name\": \"Aggregate\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        1000,\n        1280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\"\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"8abdb8f6-e31d-48cf-8189-831adf7d4889\",\n      \"name\": \"When chat message received\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        1420,\n        300\n      ],\n      \"webhookId\": \"3c40d311-7996-4ed4-b2fa-c73bea5f4cf5\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"75cf7f9e-d8f6-4a7a-b464-d152fd025188\",\n      \"name\": \"Insert into Supabase Vectorstore\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\n      \"position\": [\n        3420,\n        1620\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"options\": {\n          \"queryName\": \"match_documents\"\n        },\n        \"tableName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"documents\",\n          \"cachedResultName\": \"documents\"\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b3ceb557-53c6-4d19-ac97-c999ba87c7f5\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1120,\n        1160\n      ],\n      \"parameters\": {\n        \"height\": 89.3775420487804,\n        \"content\": \"### 替换存储名称、数据库ID和凭据。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a81fe332-86ea-46aa-b140-ee5745f0b0e0\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        760,\n        1160\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 更换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"44070cd1-0f4d-48ea-8ce0-8d59f94133e7\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        3260,\n        1500\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 替换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3fed931d-69de-4c1b-a951-5e49c683f551\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1620,\n        1160\n      ],\n      \"parameters\": {\n        \"height\": 89.3775420487804,\n        \"content\": \"### 替换存储名称、数据库ID和凭据。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d462978c-7ea3-4b92-a940-64756377c461\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        3220,\n        1940\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 替换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6f0a219d-4258-4982-b912-784a850ef308\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2080,\n        800\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 更换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"469b3caf-c9a8-4f8b-a745-c672e2b1089f\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        560,\n        40\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 636.2128494576581,\n        \"height\": 497.1532689930921,\n        \"content\": \"![5分钟Logo](https://cflobdhpqwnoisuctsoc.supabase.co/storage/v1/object/public/my_storage/banner.png)\\n## 基于Supabase存储的AI文件对话助手\\n**由[5minAI社区](https://www.skool.com/5minai-2861)的[Mark Shcherbakov](https://www.linkedin.com/in/marklowcoding/)开发**\\n\\n传统人工检索与分析海量文档库中的特定信息耗时低效。本工作流通过文档向量化与AI智能交互实现流程自动化，可轻松查询并获取上传文件中的上下文关联信息。\\n\\n该工作流将Supabase与AI聊天机器人深度集成，实现文本及PDF文件的智能处理、存储与检索。主要步骤包括：\\n- 文件抓取与重复内容比对\\n- 多格式文件下载与内容提取\\n- 文档向量化转换实现语义检索\\n- Supabase向量数据库存储与查询\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cb6664f2-0a05-4abb-818d-d72536b57bac\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1360,\n        40\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 1112,\n        \"height\": 890,\n        \"content\": \"## 场景二 - 人工智能代理\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a825794d-e7f3-41ba-a113-8503ebaf2be7\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        540,\n        1000\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 3285,\n        \"height\": 1139,\n        \"content\": \"## 场景一 - 从Supabase存储添加新文件的流程\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1d44ef3b-b1d9-481c-8078-2f0d8d586247\",\n      \"name\": \"AI Agent1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        1960,\n        260\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $('Merge').item.json.message }}\",\n        \"options\": {\n          \"systemMessage\": \"You are a helpful assistant.\\n\\nIMPORTANT Always use knowledge base to respond users.\",\n          \"passthroughBinaryImages\": false\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.8\n    },\n    {\n      \"id\": \"d1da58a8-e6c0-4a6d-aa53-88c223a97f0a\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1880,\n        480\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"SphXAX7rlwRLkiox\",\n          \"name\": \"Test club key\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"acb2de9b-a9fa-4934-9759-b84b067dc26a\",\n      \"name\": \"Simple Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        2020,\n        480\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Merge').item.json.session_id }}\",\n        \"sessionIdType\": \"customKey\"\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"4d91a4e9-e381-485a-847e-50b5dcc43f6b\",\n      \"name\": \"Embeddings OpenAI1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        2160,\n        660\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"SphXAX7rlwRLkiox\",\n          \"name\": \"Test club key\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"19b5a9a8-7407-4a1c-822f-3000b67da99b\",\n      \"name\": \"Supabase Vector Store\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\n      \"position\": [\n        2160,\n        500\n      ],\n      \"parameters\": {\n        \"mode\": \"retrieve-as-tool\",\n        \"options\": {},\n        \"toolName\": \"knowledge_base\",\n        \"tableName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"documents\",\n          \"cachedResultName\": \"documents\"\n        },\n        \"toolDescription\": \"Gather facts from knowledge base to respond user.\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"0b48a55c-9b47-4913-9aec-264d3932c533\",\n      \"name\": \"File Created\",\n      \"type\": \"n8n-nodes-base.googleDriveTrigger\",\n      \"position\": [\n        600,\n        2480\n      ],\n      \"parameters\": {\n        \"event\": \"fileCreated\",\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        },\n        \"triggerOn\": \"specificFolder\",\n        \"folderToWatch\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/folders/1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\n          \"cachedResultName\": \"Case - dentist\"\n        }\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"1Irxryx1yQ3upU2i\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fd7a9260-7d85-4129-bf2d-f7700781091b\",\n      \"name\": \"Download File\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        1200,\n        2580\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Set File ID').last().json.file_id }}\"\n        },\n        \"options\": {\n          \"googleFileConversion\": {\n            \"conversion\": {\n              \"docsToFormat\": \"application/pdf\",\n              \"sheetsToFormat\": \"application/pdf\",\n              \"slidesToFormat\": \"application/pdf\",\n              \"drawingsToFormat\": \"application/pdf\"\n            }\n          }\n        },\n        \"operation\": \"download\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"1Irxryx1yQ3upU2i\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"e17a7bc1-6483-439b-acb0-2b13f66466e5\",\n      \"name\": \"File Updated\",\n      \"type\": \"n8n-nodes-base.googleDriveTrigger\",\n      \"position\": [\n        620,\n        2660\n      ],\n      \"parameters\": {\n        \"event\": \"fileUpdated\",\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        },\n        \"triggerOn\": \"specificFolder\",\n        \"folderToWatch\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/folders/1rFIHlWMlbt0vAh1CWjcmNOmJYk_8jUIb\",\n          \"cachedResultName\": \"Case - dentist\"\n        }\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"1Irxryx1yQ3upU2i\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b0e5b639-cf0e-4289-8ce7-96e6fd1e831f\",\n      \"name\": \"Delete Old Doc Rows\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        1020,\n        2580\n      ],\n      \"parameters\": {\n        \"tableId\": \"documents\",\n        \"operation\": \"delete\",\n        \"filterType\": \"string\",\n        \"filterString\": \"=metadata->>drive_file_id=like.*{{ $json.file_id }}*\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"QBhcokohbJHfQZ9A\",\n          \"name\": \"Supabase club\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"c583b665-b756-4b8c-8150-34f559df9007\",\n      \"name\": \"Set File ID\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        860,\n        2580\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"10646eae-ae46-4327-a4dc-9987c2d76173\",\n              \"name\": \"file_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.id }}\"\n            },\n            {\n              \"id\": \"7d0b3a5e-9dfa-46d3-bf16-f6fc1d44f242\",\n              \"name\": \"extension\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.fileExtension }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"558473fe-cc06-41d8-ab06-cc6c03a8c40e\",\n      \"name\": \"Create File record1\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        2380,\n        2780\n      ],\n      \"parameters\": {\n        \"tableId\": \"files\",\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"name\",\n              \"fieldValue\": \"={{ $('Download File').item.binary.data.fileName }}\"\n            },\n            {\n              \"fieldId\": \"google_drive_id\",\n              \"fieldValue\": \"={{ $('Set File ID').item.json.file_id }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"87e490c4-f9cb-4821-a234-a9c9d2c93836\",\n      \"name\": \"Default Data Loader1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\n      \"position\": [\n        2640,\n        2980\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"=file_id\",\n                \"value\": \"={{ $json.id }}\"\n              },\n              {\n                \"name\": \"drive_file_id\",\n                \"value\": \"={{ $('Set File ID').item.json.file_id }}\"\n              }\n            ]\n          }\n        },\n        \"jsonData\": \"={{ $('Set Text3').item.json.text }}\",\n        \"jsonMode\": \"expressionData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"373efd3c-f7dd-4efc-a268-ed05d8b2e309\",\n      \"name\": \"Embeddings OpenAI3\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        2480,\n        2960\n      ],\n      \"parameters\": {\n        \"model\": \"text-embedding-3-small\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"fLfRtaXbR0EVD0pl\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"17daf2dd-1d4c-498e-8404-7cc371f81894\",\n      \"name\": \"Recursive Character Text Splitter1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\n      \"position\": [\n        2660,\n        3180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"chunkSize\": 500,\n        \"chunkOverlap\": 200\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"afcfc728-9798-4703-998d-edc535eb859e\",\n      \"name\": \"Insert into Supabase Vectorstore1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\n      \"position\": [\n        2580,\n        2780\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"options\": {\n          \"queryName\": \"match_documents\"\n        },\n        \"tableName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"documents\",\n          \"cachedResultName\": \"documents\"\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account info@ Demo\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"78e7d15c-5797-488c-b869-bb887878e930\",\n      \"name\": \"Sticky Note11\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        540,\n        2240\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 2465,\n        \"height\": 1139,\n        \"content\": \"## 场景三 - 从Supabase存储添加新文件的流程\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f572511d-6374-4b0b-8907-9f6c82179feb\",\n      \"name\": \"Edit Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1600,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"ad3055e5-41eb-4e00-9f55-dbcde47a03c7\",\n              \"name\": \"session_id\",\n              \"type\": \"string\",\n              \"value\": \"={{   $('When chat message received').item.json.sessionId }}\"\n            },\n            {\n              \"id\": \"56126e31-5fe0-4a9c-b9c9-d62fcb8bd469\",\n              \"name\": \"message\",\n              \"type\": \"string\",\n              \"value\": \"={{   $('When chat message received').item.json.chatInput }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"be2de117-410c-49c2-b95c-45b4a0e036d6\",\n      \"name\": \"Edit Fields1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1600,\n        140\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"5e5fbeb0-d866-40fe-8c1b-66b946bd1cec\",\n              \"name\": \"session_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Webhook').item.json.body.session_id }}\"\n            },\n            {\n              \"id\": \"28ec27a5-f814-435c-a5bf-df92160eee3e\",\n              \"name\": \"message\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Webhook').item.json.body.message }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"ce8790a1-55a5-4583-8301-03bbde363ee2\",\n      \"name\": \"Upload File\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2040,\n        1280\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cloud.llamaindex.ai/api/parsing/upload\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"contentType\": \"multipart-form-data\",\n        \"sendHeaders\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"file\",\n              \"parameterType\": \"formBinaryData\",\n              \"inputDataFieldName\": \"data\"\n            },\n            {\n              \"name\": \"do_not_cache\",\n              \"value\": \"=true\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"accept\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"AkhbJSroTy15x6o9\",\n          \"name\": \"Llama parse bqman\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"10b8cf52-4301-40a2-a27d-9952f1d3bcda\",\n      \"name\": \"Get Processing Status\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        2240,\n        1280\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"accept\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"AkhbJSroTy15x6o9\",\n          \"name\": \"Llama parse bqman\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"c0fc7854-1d04-492d-9541-389356333efd\",\n      \"name\": \"Wait to stay within service limits\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        2660,\n        1040\n      ],\n      \"webhookId\": \"17a96ed6-b5ff-47bb-a8a2-39c1eb40185a\",\n      \"parameters\": {\n        \"amount\": 7\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"971b40d2-a320-4815-9ccc-27de52b58bbd\",\n      \"name\": \"Is Job Ready?\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        2420,\n        1280\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"PENDING\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"0fa97d86-432a-409a-917e-5f1a002b1ab9\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"PENDING\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"ERROR\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"e6058aa0-a3e2-4ce3-9bed-6ff41a5be052\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"ERROR\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"CANCELED\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"ceb6338f-4261-40ac-be11-91f61c7302ba\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"CANCELED\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"SUCCESS\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"300fce8c-b19a-4d0c-86e8-f62853c70ce2\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"SUCCESS\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {\n          \"allMatchingOutputs\": true\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"c8f65cc5-e67a-47ae-b43a-fc065fb4900e\",\n      \"name\": \"Stop and Error\",\n      \"type\": \"n8n-nodes-base.stopAndError\",\n      \"position\": [\n        2660,\n        1300\n      ],\n      \"parameters\": {\n        \"errorMessage\": \"Problem with Llamaparser. Error during parsing.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"90658f0a-7236-493d-8dd0-fdad64196753\",\n      \"name\": \"Get Parsed Data\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2660,\n        1480\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}/result/markdown\",\n        \"options\": {\n          \"redirect\": {\n            \"redirect\": {}\n          }\n        },\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"AkhbJSroTy15x6o9\",\n          \"name\": \"Llama parse bqman\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"810aad96-7677-4c27-b3b2-25106b70083a\",\n      \"name\": \"Sticky Note12\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2060,\n        1460\n      ],\n      \"parameters\": {\n        \"width\": 280,\n        \"height\": 80,\n        \"content\": \"### 添加Llamaparse头部认证\\nAuthorization: Bearer <api_key>\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a0fd62b8-219e-4eb7-b274-1344b0042fac\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1800,\n        260\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 3.1\n    },\n    {\n      \"id\": \"e5356266-5e4a-41a2-8151-95f994435560\",\n      \"name\": \"If1\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1820,\n        1280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"f05d708d-f36e-4c6d-8753-81a61ae42546\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notExists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.data }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"c04fa3f9-74c6-4c7c-ae2a-46a797db0e55\",\n      \"name\": \"Set Text\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2060,\n        1600\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"e9bbecd9-3d40-4a6a-9401-94daab15cde0\",\n              \"name\": \"text\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('If1').item.json.data }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"2f41ef18-6229-4d3c-9a3c-8b02ec3c60b2\",\n      \"name\": \"Set Text1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2840,\n        1480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"e9bbecd9-3d40-4a6a-9401-94daab15cde0\",\n              \"name\": \"text\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get Parsed Data').item.json.markdown }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"9c92b25b-7762-4465-878f-6568073ba521\",\n      \"name\": \"Merge Text\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        3060,\n        1620\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 3.1\n    },\n    {\n      \"id\": \"4a523ad6-d74d-4207-8347-facc7f313fdd\",\n      \"name\": \"Upload File1\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1380,\n        2580\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cloud.llamaindex.ai/api/parsing/upload\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"contentType\": \"multipart-form-data\",\n        \"sendHeaders\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"file\",\n              \"parameterType\": \"formBinaryData\",\n              \"inputDataFieldName\": \"data\"\n            },\n            {\n              \"name\": \"do_not_cache\",\n              \"value\": \"=true\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"accept\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"AkhbJSroTy15x6o9\",\n          \"name\": \"Llama parse bqman\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"c0a43e5e-ec2b-49f5-bbc0-cef914c68c4c\",\n      \"name\": \"Get Processing Status1\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1580,\n        2580\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"accept\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"AkhbJSroTy15x6o9\",\n          \"name\": \"Llama parse bqman\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"68cc70a4-dba0-4ec9-8506-88bb20b37e87\",\n      \"name\": \"Wait to stay within service limits1\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        2000,\n        2340\n      ],\n      \"webhookId\": \"17a96ed6-b5ff-47bb-a8a2-39c1eb40185a\",\n      \"parameters\": {\n        \"amount\": 7\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"aef3b805-166e-47a8-a81c-900f999ae045\",\n      \"name\": \"Is Job Ready?1\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        1760,\n        2580\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"PENDING\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"0fa97d86-432a-409a-917e-5f1a002b1ab9\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"PENDING\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"ERROR\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"e6058aa0-a3e2-4ce3-9bed-6ff41a5be052\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"ERROR\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"CANCELED\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"ceb6338f-4261-40ac-be11-91f61c7302ba\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"CANCELED\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"SUCCESS\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"300fce8c-b19a-4d0c-86e8-f62853c70ce2\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.status }}\",\n                    \"rightValue\": \"SUCCESS\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {\n          \"allMatchingOutputs\": true\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"5233be31-2ecf-4ddd-96e2-b0fd614f535f\",\n      \"name\": \"Stop and Error1\",\n      \"type\": \"n8n-nodes-base.stopAndError\",\n      \"position\": [\n        2000,\n        2600\n      ],\n      \"parameters\": {\n        \"errorMessage\": \"Problem with Llamaparser. Error during parsing.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"09283faa-4ab9-4d59-a610-3491d7f2daf8\",\n      \"name\": \"Get Parsed Data1\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2000,\n        2780\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}/result/markdown\",\n        \"options\": {\n          \"redirect\": {\n            \"redirect\": {}\n          }\n        },\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"AkhbJSroTy15x6o9\",\n          \"name\": \"Llama parse bqman\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"5ef6959d-1eb4-49cd-9b19-3b0e1aaa0eb7\",\n      \"name\": \"Sticky Note13\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1400,\n        2760\n      ],\n      \"parameters\": {\n        \"width\": 280,\n        \"height\": 80,\n        \"content\": \"### 添加Llamaparse头部认证\\nAuthorization: Bearer <api_key>\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"18fd1d0f-664e-4584-8154-794ca8aad768\",\n      \"name\": \"Set Text3\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2180,\n        2780\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"e9bbecd9-3d40-4a6a-9401-94daab15cde0\",\n              \"name\": \"text\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get Parsed Data1').item.json.markdown }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"337b8593-8f5a-47b2-8b75-f5b3b4195fe8\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        1420,\n        140\n      ],\n      \"webhookId\": \"05979e87-19bc-4e8b-adbb-7e04808f8b21\",\n      \"parameters\": {\n        \"path\": \"05979e87-19bc-4e8b-adbb-7e04808f8b21\",\n        \"options\": {},\n        \"httpMethod\": \"POST\",\n        \"responseMode\": \"lastNode\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"7911c133-f998-4efd-a9c8-9c52c8e545c4\",\n      \"name\": \"Sticky Note14\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2380,\n        2660\n      ],\n      \"parameters\": {\n        \"width\": 480,\n        \"height\": 80,\n        \"content\": \"### 更换凭据\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set Text\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Text\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Text\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Aggregate\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get All files\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Text1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Text\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Text3\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create File record1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge Text\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create File record2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Set File ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Delete Old Doc Rows\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Processing Status\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"File Created\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set File ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"File Updated\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set File ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload File1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Processing Status1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload File1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get All Files\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Aggregate\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get All files\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is Job Ready?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait to stay within service limits\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get Parsed Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Simple Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"AI Agent1\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is Job Ready?1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait to stay within service limits1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get Parsed Data1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Parsed Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Text1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Parsed Data1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Text3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"AI Agent1\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI1\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Supabase Vector Store\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI3\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore1\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create File record1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create File record2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Default Data Loader\": {\n      \"ai_document\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore\",\n            \"type\": \"ai_document\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Delete Old Doc Rows\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Default Data Loader1\": {\n      \"ai_document\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore1\",\n            \"type\": \"ai_document\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Processing Status\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Job Ready?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Supabase Vector Store\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Processing Status1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Job Ready?1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When chat message received\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Insert into Supabase Vectorstore\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Recursive Character Text Splitter\": {\n      \"ai_textSplitter\": [\n        [\n          {\n            \"node\": \"Default Data Loader\",\n            \"type\": \"ai_textSplitter\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get All Files\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Recursive Character Text Splitter1\": {\n      \"ai_textSplitter\": [\n        [\n          {\n            \"node\": \"Default Data Loader1\",\n            \"type\": \"ai_textSplitter\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait to stay within service limits\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Processing Status\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait to stay within service limits1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Processing Status1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
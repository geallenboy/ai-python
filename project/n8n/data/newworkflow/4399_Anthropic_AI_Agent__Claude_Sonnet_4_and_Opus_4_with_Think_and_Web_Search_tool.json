{
  "url": "https://n8n.io/workflows/4399-anthropic-ai-agent-claude-sonnet-4-and-opus-4-with-think-and-web-search-tool/",
  "title": "Anthropic AI Agent: Claude Sonnet 4 and Opus 4 with Think and Web Search tool",
  "author": "Davide",
  "publish_date": "Last update a day ago",
  "publish_date_absolute": "",
  "categories": [
    {
      "name": "Engineering"
    },
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"id\":\"qjLD1os0l5ISHRFO\",\"meta\":{\"instanceId\":\"a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462\",\"templateCredsSetupCompleted\":true},\"name\":\"Agent AI Anthropic Opus 4 and Sonnet 4\",\"tags\":[],\"nodes\":[{\"id\":\"4f01cd9b-16b6-4b6a-a55b-64531e867dcc\",\"name\":\"When chat message received\",\"type\":\"@n8n/n8n-nodes-langchain.chatTrigger\",\"position\":[20,60],\"webhookId\":\"a0032740-26d8-491b-93f9-2250906d0e17\",\"parameters\":{\"options\":{}},\"typeVersion\":1.1},{\"id\":\"c0a5e6b1-9c43-4f92-884e-95b1e91ff54a\",\"name\":\"Structured Output Parser\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[420,280],\"parameters\":{\"schemaType\":\"manual\",\"inputSchema\":\"{\\n\\t\\\"type\\\": \\\"object\\\",\\n\\t\\\"properties\\\": {\\n\\t\\t\\\"prompt\\\": {\\n\\t\\t\\t\\\"type\\\": \\\"string\\\"\\n\\t\\t},\\n\\t\\t\\\"model\\\": {\\n\\t\\t\\t\\\"type\\\": \\\"string\\\"\\n\\t\\t}\\n\\t}\\n}\"},\"typeVersion\":1.2},{\"id\":\"e46a6a64-8875-44f0-830e-febebaa10dd7\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[20,-180],\"parameters\":{\"width\":840,\"height\":180,\"content\":\"## Dynamic Model Selector for Optimal AI Responses\\n\\nThe **New Anthropic Agent Decisioner** is a dynamic, AI-powered routing system that automatically selects the most appropriate large language model (Anthropic Sonnet 4 or Opus 4) to respond to a user's query based on the query’s content and purpose.\\n\\nThis workflow ensures **dynamic, optimized AI responses** by intelligently routing queries to the best-suited model.\"},\"typeVersion\":1},{\"id\":\"0f4208aa-c4f5-44aa-ba43-4c3143751a79\",\"name\":\"AI Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[600,60],\"parameters\":{\"text\":\"={{ $json.output.prompt }}\",\"options\":{\"systemMessage\":\"=You have access to a web_search tool that allows you to browse the internet for up-to-date information. Here's how you should operate:\\n\\n1. Website Information:\\nFamiliarize yourself with this information about the website you're assisting. Use this as context for user interactions.\\n\\n2. Web Search Tool:\\nYou have access to a web_search tool that can browse the internet. To use it, write the variable {web_search_question}. The tool will return relevant search results. Set the variable {model} to {{ $json.output.model }}.\\n\\n3. Handling User Queries:\\nWhen a user asks a question, follow these steps:\\na) Analyze the query to determine if it's related to the website or requires external information.\\nb) If the query is about the website, use the provided website information to answer.\\nc) If external information is needed, use the web_search tool to find relevant data.\\n\\n4. Using web_search:\\n- Use web_search for factual, current information that isn't provided in the website info.\\n- Formulate clear, concise search queries.\\n- If the first search doesn't yield useful results, refine your query and search again.\\n- Limit searches to a maximum of three per user query to maintain efficiency.\\n\\n5. Using Think:\\n- Using Think tool to think about something. It will not obtain new information or change the database, but just append the thought to the log. Use it when complex reasoning or some cache memory is needed.\\n\\n6. Formulating Responses:\\n- Begin with information from the website if relevant.\\n- Incorporate web search results to provide up-to-date, accurate information.\\n- Summarize findings concisely and coherently.\\n- If you're unsure or can't find reliable information, be honest about limitations.\\n\\n7. Ethical Considerations:\\n- Respect user privacy. Don't ask for or store personal information.\\n- Provide factual information. Avoid speculation or unverified claims.\\n- If asked about controversial topics, strive for a balanced, neutral response.\\n- Don't engage in or encourage illegal activities.\\n\\n8. Output Format:\\nDo not include your thought process, web searches, or any other tags in the final output.\\n\"},\"promptType\":\"define\"},\"typeVersion\":1.9},{\"id\":\"0e08600f-f35c-408a-9b8a-f886aeea37d6\",\"name\":\"Think\",\"type\":\"@n8n/n8n-nodes-langchain.toolThink\",\"position\":[800,280],\"parameters\":{},\"typeVersion\":1},{\"id\":\"5adf09be-e278-49f0-bb66-d7e3d265b120\",\"name\":\"Calculator\",\"type\":\"@n8n/n8n-nodes-langchain.toolCalculator\",\"position\":[900,280],\"parameters\":{},\"typeVersion\":1},{\"id\":\"d5fa04bf-e40b-41d7-9d48-c71cd7ced93f\",\"name\":\"Anthropic Routing Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[240,60],\"parameters\":{\"options\":{\"systemMessage\":\"=You are a **Routing Agent**.\\n\\nYour task is to analyze user queries and determine the most appropriate model to handle each specific use case.\\n\\n## Available Models\\n\\nYou have access to the following models:\\n\\n1. **claude-sonnet-4-20250514**\\n2. **claude-opus-4-20250514**\\n\\n## Model Strengths\\n\\n### 1. claude-sonnet-4-20250514\\n- Standard decision-making tasks\\n- Real-time workflow routing\\n- Data validation and processing\\n- Pattern recognition in structured data\\n- Routine business logic evaluation\\n\\n### 2. claude-sonnet-4-20250514\\n- Complex multi-factor decision scenarios\\n- Advanced data analysis requiring deep reasoning\\n- Critical business decisions with high impact\\n- Complex pattern recognition in unstructured data\\n- Strategic workflow optimization\\n\\n## Output Format\\n\\nYour output must always be a valid JSON object in the following format:\\n\\n```json\\n{\\n  \\\"prompt\\\": \\\"user query goes here\\\",\\n  \\\"model\\\": \\\"selected-model-name\\\"\\n}\\n```\\n\\n- The **\\\"prompt\\\"** field should contain the exact query to be sent to the selected model.\\n- The **\\\"model\\\"** field should contain the model name (one of: claude-sonnet-4-20250514, claude-opus-4-20250514).\\n\\n**Important:** Only return the JSON object. Do not include any explanations or additional text.\"},\"hasOutputParser\":true},\"typeVersion\":1.9},{\"id\":\"0f358356-37d4-4693-a694-382a8bc1b20f\",\"name\":\"Sonnet 4 or Opus 4\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatAnthropic\",\"position\":[600,280],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $json.output.model }}\"},\"options\":{}},\"credentials\":{\"anthropicApi\":{\"id\":\"NNTZAD0Gmf7lcniq\",\"name\":\"Anthropic account\"}},\"typeVersion\":1.3},{\"id\":\"c92104a6-9aa4-4a55-84b1-484df25f83ac\",\"name\":\"Sonnet 3.7\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatAnthropic\",\"position\":[220,280],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"claude-3-7-sonnet-20250219\",\"cachedResultName\":\"Claude Sonnet 3.7\"},\"options\":{\"maxTokensToSample\":1024}},\"credentials\":{\"anthropicApi\":{\"id\":\"NNTZAD0Gmf7lcniq\",\"name\":\"Anthropic account\"}},\"typeVersion\":1.3},{\"id\":\"513642ef-b4d6-46fc-8542-319dd54271f8\",\"name\":\"Simple Memory1\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[720,280],\"parameters\":{\"sessionKey\":\"={{ $('When chat message received').item.json.sessionId }}\",\"sessionIdType\":\"customKey\"},\"typeVersion\":1.3},{\"id\":\"6c81dcd9-7faf-4b34-8e78-a471de80fa1e\",\"name\":\"web_search\",\"type\":\"n8n-nodes-base.httpRequestTool\",\"position\":[1020,280],\"parameters\":{\"url\":\"https://api.anthropic.com/v1/messages\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('JSON', `{\\n  \\\"model\\\": \\\"{model}\\\",\\n  \\\"max_tokens\\\": 1024,\\n  \\\"messages\\\": [\\n    {\\n      \\\"role\\\": \\\"user\\\",\\n      \\\"content\\\": \\\"{web_search_question}\\\"\\n    }\\n  ],\\n  \\\"tools\\\": [\\n    {\\n      \\\"type\\\": \\\"web_search_20250305\\\",\\n      \\\"name\\\": \\\"web_search\\\",\\n      \\\"max_uses\\\": 5\\n    }\\n  ]\\n}\\n`, 'json') }}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"toolDescription\":\"Use this tool to search on the web\",\"headerParameters\":{\"parameters\":[{\"name\":\"anthropic-version\",\"value\":\"=2023-06-01\"},{\"name\":\"content-type\",\"value\":\"application/json\"}]},\"nodeCredentialType\":\"anthropicApi\"},\"credentials\":{\"anthropicApi\":{\"id\":\"NNTZAD0Gmf7lcniq\",\"name\":\"Anthropic account\"}},\"typeVersion\":4.2}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"c0947a41-be77-4ac0-89e2-eb8cf04b7c48\",\"connections\":{\"Think\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Calculator\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Sonnet 3.7\":{\"ai_languageModel\":[[{\"node\":\"Anthropic Routing Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"web_search\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Simple Memory1\":{\"ai_memory\":[[{\"node\":\"AI Agent\",\"type\":\"ai_memory\",\"index\":0}]]},\"Sonnet 4 or Opus 4\":{\"ai_languageModel\":[[{\"node\":\"AI Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Anthropic Routing Agent\":{\"main\":[[{\"node\":\"AI Agent\",\"type\":\"main\",\"index\":0}]]},\"Structured Output Parser\":{\"ai_outputParser\":[[{\"node\":\"Anthropic Routing Agent\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"When chat message received\":{\"main\":[[{\"node\":\"Anthropic Routing Agent\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow dynamically chooses between two new powerful Anthropic models — **Claude Opus 4** and **Claude Sonnet 4** — to handle user queries, based on their complexity and nature, maintaining scalability and context awareness with Anthropic **web search function** and **Think** tool.\n\n* * *\n\n### **Key Advantages**\n\n  1. **🔁 Dynamic Model Selection**\n\n     * Automatically routes each user query to either **Claude Sonnet 4** (for routine tasks) or **Claude Opus 4** (for complex reasoning), ensuring optimal performance and cost-efficiency.\n  2. **🧠 AI Agent with Tool Use**\n\n     * The AI agent can utilize a **web search tool** to retrieve up-to-date information and a **Think tool** for complex reasoning processes — improving response quality.\n  3. **📎 Memory Integration**\n\n     * Uses session-based **memory** to maintain conversational context, making interactions more coherent and human-like.\n  4. **🧮 Built-in Calculation Tool**\n\n     * Handles numeric queries using an integrated **calculator tool** , reducing the need for external processing.\n  5. **📤 Structured Output Parser**\n\n     * Ensures outputs are always well-structured and formatted in JSON, which improves consistency and downstream integrations.\n  6. **🌐 Web Search Capability**\n\n     * Supports real-time information retrieval for current events, statistics, or details not available in the AI’s base knowledge.\n\n\n\n* * *\n\n### Components Overview\n\n  * **Trigger** : Listens for new chat messages.\n\n  * **Routing Agent** : Analyzes the message and returns the best model to use.\n\n  * **AI Agent** : Handles the conversation, decides when to use tools.\n\n  * **Tools** :\n\n    * `web_search` for internet queries\n    * `Think` for reasoning\n    * `Calculator` for math tasks\n  * **Models Used** :\n\n    * `claude-sonnet-4-20250514`: Optimized for general and business logic tasks.\n    * `claude-opus-4-20250514`: Best for deep, strategic, and analytical queries.\n\n\n\n* * *\n\n### **How It Works**\n\n  1. **Dynamic Model Selection**\n\n     * The workflow begins when a chat message is received. The **Anthropic Routing Agent** analyzes the user's query to determine the most suitable model (either **Claude Sonnet 4** or **Claude Opus 4**) based on the query's complexity and requirements.\n     * The routing agent uses predefined criteria to decide: \n       * **Claude Sonnet 4** : Best for standard tasks like real-time workflow routing, data validation, and routine business logic.\n       * **Claude Opus 4** : Reserved for complex scenarios requiring deep reasoning, advanced analysis, or high-impact decisions.\n  2. **Query Processing and Response Generation**\n\n     * The selected model processes the query, leveraging tools like **web_search** for real-time information retrieval, **Think** for internal reasoning, and **Calculator** for numerical tasks.\n     * The **AI Agent** coordinates these tools, ensuring the response is accurate and context-aware. A **Simple Memory** node retains session context for coherent multi-turn conversations.\n     * The final response is formatted and returned to the user without intermediate steps or metadata.\n\n\n\n* * *\n\n### **Set Up Steps**\n\n  1. **Node Configuration**\n\n     * **Trigger** : Configure the _\"When chat message received\"_ node to handle incoming user queries.\n     * **Routing Agent** : Set up the _\"Anthropic Routing Agent\"_ with the system message defining model selection logic. Ensure it outputs a JSON object with `prompt` and `model` fields.\n     * **AI Model Nodes** : Link the _\"Sonnet 4 or Opus 4\"_ node to dynamically use the selected model. The _\"Sonnet 3.7\"_ node powers the routing agent itself.\n  2. **Tool Integration**\n\n     * Attach the _\"web_search\"_ HTTP tool to enable internet searches, ensuring the API endpoint and headers (e.g., `anthropic-version`) are correctly configured.\n     * Connect auxiliary tools (_Think_ , _Calculator_) to the _\"AI Agent\"_ for extended functionality.\n     * Add the _\"Simple Memory\"_ node to maintain conversation history.\n  3. **Credentials**\n\n     * Provide an **Anthropic API key** to all nodes requiring authentication (e.g., model nodes, web search).\n  4. **Testing**\n\n     * Activate the workflow and test with sample queries to verify: \n       * Correct model selection (e.g., Sonnet for simple queries, Opus for complex ones).\n       * Proper tool usage (e.g., web searches trigger when needed).\n       * Memory retention across chat turns.\n  5. **Deployment**\n\n     * Once validated, set the workflow to **active** for live interactions.\n\n\n\n* * *\n\n### **Need help customizing?**\n\n[Contact me](mailto:info@n3w.it) for consulting and support or add me on [Linkedin](https://www.linkedin.com/in/davideboizza/).\n",
  "crawled_at": "2025-05-27T23:17:55.230531",
  "readme_zh": "该工作流动态选择Anthropic两大新模型——**Claude Opus 4**与**Claude Sonnet 4**——根据查询复杂度智能分配任务，通过**网页搜索功能**和**思考工具**保持扩展性与上下文感知。\n\n* * *\n\n### **核心优势**\n\n  1. **🔁 动态模型选择**\n\n     * 自动将常规任务路由至**Claude Sonnet 4**，复杂推理任务分配至**Claude Opus 4**，实现性能与成本最优解\n  2. **🧠 智能工具调用**\n\n     * 通过**网页搜索工具**获取实时信息，运用**思考工具**处理复杂推理，显著提升响应质量\n  3. **📎 记忆集成**\n\n     * 基于会话的**记忆模块**维持对话上下文，使交互更连贯拟人\n  4. **🧮 内置计算工具**\n\n     * 集成**计算器工具**处理数值查询，减少外部处理依赖\n  5. **📤 结构化输出解析**\n\n     * 确保输出始终为格式规范的JSON，提升一致性与下游集成便利性\n  6. **🌐 实时网络检索**\n\n     * 支持获取时事新闻、统计数据等超出AI基础知识库的最新信息",
  "title_zh": "Anthropic AI智能体：Claude Sonnet 4与Opus 4（搭载思考与网络搜索工具）",
  "publish_date_zh": "最后一次更新于一天前",
  "workflow_json_zh": "{\n  \"id\": \"qjLD1os0l5ISHRFO\",\n  \"meta\": {\n    \"instanceId\": \"a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Agent AI Anthropic Opus 4 and Sonnet 4\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"4f01cd9b-16b6-4b6a-a55b-64531e867dcc\",\n      \"name\": \"When chat message received\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        20,\n        60\n      ],\n      \"webhookId\": \"a0032740-26d8-491b-93f9-2250906d0e17\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"c0a5e6b1-9c43-4f92-884e-95b1e91ff54a\",\n      \"name\": \"Structured Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        420,\n        280\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n\\t\\\"type\\\": \\\"object\\\",\\n\\t\\\"properties\\\": {\\n\\t\\t\\\"prompt\\\": {\\n\\t\\t\\t\\\"type\\\": \\\"string\\\"\\n\\t\\t},\\n\\t\\t\\\"model\\\": {\\n\\t\\t\\t\\\"type\\\": \\\"string\\\"\\n\\t\\t}\\n\\t}\\n}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"e46a6a64-8875-44f0-830e-febebaa10dd7\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        20,\n        -180\n      ],\n      \"parameters\": {\n        \"width\": 840,\n        \"height\": 180,\n        \"content\": \"## 动态模型选择器：获取最优AI响应\\n\\n**新型Anthropic智能决策器**是一套动态AI路由系统，能够根据查询内容与意图，自动选择最适配的大语言模型（Anthropic Sonnet 4或Opus 4）生成响应。\\n\\n该工作流通过智能查询路由机制，确保每次都能获得**动态优化的AI响应**。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0f4208aa-c4f5-44aa-ba43-4c3143751a79\",\n      \"name\": \"AI Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        600,\n        60\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $json.output.prompt }}\",\n        \"options\": {\n          \"systemMessage\": \"=You have access to a web_search tool that allows you to browse the internet for up-to-date information. Here's how you should operate:\\n\\n1. Website Information:\\nFamiliarize yourself with this information about the website you're assisting. Use this as context for user interactions.\\n\\n2. Web Search Tool:\\nYou have access to a web_search tool that can browse the internet. To use it, write the variable {web_search_question}. The tool will return relevant search results. Set the variable {model} to {{ $json.output.model }}.\\n\\n3. Handling User Queries:\\nWhen a user asks a question, follow these steps:\\na) Analyze the query to determine if it's related to the website or requires external information.\\nb) If the query is about the website, use the provided website information to answer.\\nc) If external information is needed, use the web_search tool to find relevant data.\\n\\n4. Using web_search:\\n- Use web_search for factual, current information that isn't provided in the website info.\\n- Formulate clear, concise search queries.\\n- If the first search doesn't yield useful results, refine your query and search again.\\n- Limit searches to a maximum of three per user query to maintain efficiency.\\n\\n5. Using Think:\\n- Using Think tool to think about something. It will not obtain new information or change the database, but just append the thought to the log. Use it when complex reasoning or some cache memory is needed.\\n\\n6. Formulating Responses:\\n- Begin with information from the website if relevant.\\n- Incorporate web search results to provide up-to-date, accurate information.\\n- Summarize findings concisely and coherently.\\n- If you're unsure or can't find reliable information, be honest about limitations.\\n\\n7. Ethical Considerations:\\n- Respect user privacy. Don't ask for or store personal information.\\n- Provide factual information. Avoid speculation or unverified claims.\\n- If asked about controversial topics, strive for a balanced, neutral response.\\n- Don't engage in or encourage illegal activities.\\n\\n8. Output Format:\\nDo not include your thought process, web searches, or any other tags in the final output.\\n\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.9\n    },\n    {\n      \"id\": \"0e08600f-f35c-408a-9b8a-f886aeea37d6\",\n      \"name\": \"Think\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolThink\",\n      \"position\": [\n        800,\n        280\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5adf09be-e278-49f0-bb66-d7e3d265b120\",\n      \"name\": \"Calculator\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolCalculator\",\n      \"position\": [\n        900,\n        280\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d5fa04bf-e40b-41d7-9d48-c71cd7ced93f\",\n      \"name\": \"Anthropic Routing Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        240,\n        60\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"systemMessage\": \"=You are a **Routing Agent**.\\n\\nYour task is to analyze user queries and determine the most appropriate model to handle each specific use case.\\n\\n## Available Models\\n\\nYou have access to the following models:\\n\\n1. **claude-sonnet-4-20250514**\\n2. **claude-opus-4-20250514**\\n\\n## Model Strengths\\n\\n### 1. claude-sonnet-4-20250514\\n- Standard decision-making tasks\\n- Real-time workflow routing\\n- Data validation and processing\\n- Pattern recognition in structured data\\n- Routine business logic evaluation\\n\\n### 2. claude-sonnet-4-20250514\\n- Complex multi-factor decision scenarios\\n- Advanced data analysis requiring deep reasoning\\n- Critical business decisions with high impact\\n- Complex pattern recognition in unstructured data\\n- Strategic workflow optimization\\n\\n## Output Format\\n\\nYour output must always be a valid JSON object in the following format:\\n\\n```json\\n{\\n  \\\"prompt\\\": \\\"user query goes here\\\",\\n  \\\"model\\\": \\\"selected-model-name\\\"\\n}\\n```\\n\\n- The **\\\"prompt\\\"** field should contain the exact query to be sent to the selected model.\\n- The **\\\"model\\\"** field should contain the model name (one of: claude-sonnet-4-20250514, claude-opus-4-20250514).\\n\\n**Important:** Only return the JSON object. Do not include any explanations or additional text.\"\n        },\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.9\n    },\n    {\n      \"id\": \"0f358356-37d4-4693-a694-382a8bc1b20f\",\n      \"name\": \"Sonnet 4 or Opus 4\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatAnthropic\",\n      \"position\": [\n        600,\n        280\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.output.model }}\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"anthropicApi\": {\n          \"id\": \"NNTZAD0Gmf7lcniq\",\n          \"name\": \"Anthropic account\"\n        }\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"c92104a6-9aa4-4a55-84b1-484df25f83ac\",\n      \"name\": \"Sonnet 3.7\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatAnthropic\",\n      \"position\": [\n        220,\n        280\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"claude-3-7-sonnet-20250219\",\n          \"cachedResultName\": \"Claude Sonnet 3.7\"\n        },\n        \"options\": {\n          \"maxTokensToSample\": 1024\n        }\n      },\n      \"credentials\": {\n        \"anthropicApi\": {\n          \"id\": \"NNTZAD0Gmf7lcniq\",\n          \"name\": \"Anthropic account\"\n        }\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"513642ef-b4d6-46fc-8542-319dd54271f8\",\n      \"name\": \"Simple Memory1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        720,\n        280\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('When chat message received').item.json.sessionId }}\",\n        \"sessionIdType\": \"customKey\"\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"6c81dcd9-7faf-4b34-8e78-a471de80fa1e\",\n      \"name\": \"web_search\",\n      \"type\": \"n8n-nodes-base.httpRequestTool\",\n      \"position\": [\n        1020,\n        280\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.anthropic.com/v1/messages\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('JSON', `{\\n  \\\"model\\\": \\\"{model}\\\",\\n  \\\"max_tokens\\\": 1024,\\n  \\\"messages\\\": [\\n    {\\n      \\\"role\\\": \\\"user\\\",\\n      \\\"content\\\": \\\"{web_search_question}\\\"\\n    }\\n  ],\\n  \\\"tools\\\": [\\n    {\\n      \\\"type\\\": \\\"web_search_20250305\\\",\\n      \\\"name\\\": \\\"web_search\\\",\\n      \\\"max_uses\\\": 5\\n    }\\n  ]\\n}\\n`, 'json') }}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"toolDescription\": \"Use this tool to search on the web\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"anthropic-version\",\n              \"value\": \"=2023-06-01\"\n            },\n            {\n              \"name\": \"content-type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"anthropicApi\"\n      },\n      \"credentials\": {\n        \"anthropicApi\": {\n          \"id\": \"NNTZAD0Gmf7lcniq\",\n          \"name\": \"Anthropic account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"c0947a41-be77-4ac0-89e2-eb8cf04b7c48\",\n  \"connections\": {\n    \"Think\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Calculator\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Sonnet 3.7\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Anthropic Routing Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"web_search\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Simple Memory1\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Sonnet 4 or Opus 4\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Anthropic Routing Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Anthropic Routing Agent\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When chat message received\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Anthropic Routing Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
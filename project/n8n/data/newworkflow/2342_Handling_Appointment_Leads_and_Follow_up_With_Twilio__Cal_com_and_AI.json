{
  "url": "https://n8n.io/workflows/2342-handling-appointment-leads-and-follow-up-with-twilio-calcom-and-ai/",
  "title": "Handling Appointment Leads and Follow-up With Twilio, Cal.com and AI",
  "author": "Jimleuk",
  "publish_date": "Last update 7 months ago",
  "publish_date_absolute": "2024-10-25",
  "categories": [
    {
      "name": "Sales"
    },
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\"},\"nodes\":[{\"id\":\"f55b3110-f960-4d89-afba-d47bc58102eb\",\"name\":\"Twilio Trigger\",\"type\":\"n8n-nodes-base.twilioTrigger\",\"position\":[100,180],\"webhookId\":\"bfc8f587-8183-46f8-9e76-3576caddf8c0\",\"parameters\":{\"updates\":[\"com.twilio.messaging.inbound-message.received\"]},\"credentials\":{\"twilioApi\":{\"id\":\"TJv4H4lXxPCLZT50\",\"name\":\"Twilio account\"}},\"typeVersion\":1},{\"id\":\"8472f5b0-329f-45ac-b35f-c42558daa7c7\",\"name\":\"OpenAI Chat Model1\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1140,1360],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"4b3e8a26-c808-46e5-bbcf-2e1279989a0b\",\"name\":\"Find Follow-Up Candidates\",\"type\":\"n8n-nodes-base.airtable\",\"position\":[720,1240],\"parameters\":{\"base\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"appO2nHiT9XPuGrjN\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN\",\"cachedResultName\":\"Twilio-Scheduling-Agent\"},\"table\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"tblokH7uw63RpIlQ0\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\"cachedResultName\":\"Lead Tracker\"},\"options\":{},\"operation\":\"search\",\"filterByFormula\":\"=AND(\\n  {appointment_id} = '',\\n  {status} != 'STOP',\\n  {followup_count} < 3,\\n  DATETIME_DIFF(TODAY(), {last_followup_at}, 'days') >= 3\\n)\"},\"credentials\":{\"airtableTokenApi\":{\"id\":\"Und0frCQ6SNVX3VV\",\"name\":\"Airtable Personal Access Token account\"}},\"typeVersion\":2.1},{\"id\":\"04dc979c-ad36-4e57-93d4-905929fe1af0\",\"name\":\"Send Follow Up Message\",\"type\":\"n8n-nodes-base.twilio\",\"position\":[1880,1240],\"parameters\":{\"to\":\"={{ $('Find Follow-Up Candidates').item.json.session_id }}\",\"from\":\"={{ $('Find Follow-Up Candidates').item.json.twilio_service_number }}\",\"message\":\"={{ $('Generate Follow Up Message').item.json.text }}\\nReply STOP to stop recieving these messages.\",\"options\":{}},\"credentials\":{\"twilioApi\":{\"id\":\"TJv4H4lXxPCLZT50\",\"name\":\"Twilio account\"}},\"typeVersion\":1},{\"id\":\"55e222af-fb59-4ffd-9661-350b1972e802\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[570,943],\"parameters\":{\"color\":7,\"width\":408.6631332343324,\"height\":515.2449997772154,\"content\":\"## Step 6. Filter Open Enquiries from Airtable\\n\\n### 💡Criteria For Follow Up Candidates\\n* No Scheduled Appointment\\n* No Request to STOP\\n* No Previous Follow-up in Past 3 days\\n* Follow-up is less than 3 times\"},\"typeVersion\":1},{\"id\":\"50d0c632-233b-4b31-b396-3fa603aecd03\",\"name\":\"Update Follow-Up Count and Date\",\"type\":\"n8n-nodes-base.airtable\",\"position\":[1700,1240],\"parameters\":{\"base\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"appO2nHiT9XPuGrjN\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN\",\"cachedResultName\":\"Twilio-Scheduling-Agent\"},\"table\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"tblokH7uw63RpIlQ0\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\"cachedResultName\":\"Lead Tracker\"},\"columns\":{\"value\":{\"session_id\":\"={{ $('Find Follow-Up Candidates').item.json.session_id }}\",\"followup_count\":\"={{ ($('Find Follow-Up Candidates').item.json.followup_count ?? 0) + 1 }}\",\"last_followup_at\":\"={{ $now.toISO() }}\"},\"schema\":[{\"id\":\"id\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":true,\"required\":false,\"displayName\":\"id\",\"defaultMatch\":true},{\"id\":\"session_id\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"session_id\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"status\",\"type\":\"options\",\"display\":true,\"options\":[{\"name\":\"ACTIVE\",\"value\":\"ACTIVE\"},{\"name\":\"STOP\",\"value\":\"STOP\"}],\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"status\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"customer_name\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"customer_name\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"customer_summary\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"customer_summary\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"chat_messages\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"chat_messages\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"scheduled_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"scheduled_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"appointment_id\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"appointment_id\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"last_message_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"last_message_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"last_followup_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"last_followup_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"followup_count\",\"type\":\"number\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"followup_count\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"assignee\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"assignee\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[\"session_id\"]},\"options\":{},\"operation\":\"update\"},\"credentials\":{\"airtableTokenApi\":{\"id\":\"Und0frCQ6SNVX3VV\",\"name\":\"Airtable Personal Access Token account\"}},\"typeVersion\":2.1},{\"id\":\"e1331352-c3da-4586-9d64-4be4dab49748\",\"name\":\"Create/Update Session\",\"type\":\"n8n-nodes-base.airtable\",\"position\":[2240,269],\"parameters\":{\"base\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"appO2nHiT9XPuGrjN\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN\",\"cachedResultName\":\"Twilio-Scheduling-Agent\"},\"table\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"tblokH7uw63RpIlQ0\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\"cachedResultName\":\"Lead Tracker\"},\"columns\":{\"value\":{\"session_id\":\"={{ $('Twilio Trigger').item.json.From }}\",\"scheduled_at\":\"={{\\n$('Appointment Scheduling Agent').item.json.output.has_appointment_scheduled\\n  ? $('Appointment Scheduling Agent').item.json.output.appointment.scheduled_at\\n  : (\\n    $('Get Existing Chat Session').item.json.isNotEmpty()\\n    ? $('Get Existing Chat Session').item.json.scheduled_at\\n    : $now.toISO()\\n  )\\n}}\",\"chat_messages\":\"={{\\nJSON.stringify(\\n  ($('Get Existing Chat Session').item.json.chat_messages ? JSON.parse($('Get Existing Chat Session').item.json.chat_messages) : [])\\n  .concat(\\n    { \\\"role\\\": \\\"human\\\", \\\"message\\\": $('Twilio Trigger').item.json.Body },\\n    { \\\"role\\\": \\\"assistant\\\", \\\"message\\\": $('Appointment Scheduling Agent').item.json.output.reply }\\n  )\\n)\\n}}\",\"customer_name\":\"={{\\n  !$('Get Existing Chat Session').item.json.customer_name &&\\n  $('Appointment Scheduling Agent').item.json.output.customer_name\\n    ? $('Appointment Scheduling Agent').item.json.output.customer_name\\n    : ($('Get Existing Chat Session').item.json.customer_name ?? '')\\n}}\",\"appointment_id\":\"={{\\n$('Appointment Scheduling Agent').item.json.output.has_appointment_scheduled\\n  ? $('Appointment Scheduling Agent').item.json.output.appointment.appointment_id\\n  : (\\n    $('Get Existing Chat Session').item.json.isNotEmpty()\\n    ? $('Get Existing Chat Session').item.json.appointment_id\\n    : ''\\n  )\\n}}\",\"followup_count\":\"={{\\n  !$('Get Existing Chat Session').item.json.followup_count\\n  ? 0\\n  : $('Get Existing Chat Session').item.json.followup_count\\n}}\",\"last_message_at\":\"={{ $now.toISO() }}\",\"customer_summary\":\"={{\\n  !$('Get Existing Chat Session').item.json.appointment_id\\n  && $('Appointment Scheduling Agent').item.json.output.has_appointment_scheduled\\n    ? $json.output.enquiry_summary\\n    : $('Get Existing Chat Session').item.json.customer_summary\\n}}\",\"last_followup_at\":\"={{\\n  !$('Get Existing Chat Session').item.json.last_followup_at\\n  ? $now.toISO()\\n  : $('Get Existing Chat Session').item.json.last_followup_at\\n}}\",\"twilio_service_number\":\"={{ $('Twilio Trigger').item.json.To }}\"},\"schema\":[{\"id\":\"id\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":true,\"required\":false,\"displayName\":\"id\",\"defaultMatch\":true},{\"id\":\"session_id\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"session_id\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"status\",\"type\":\"options\",\"display\":true,\"options\":[{\"name\":\"ACTIVE\",\"value\":\"ACTIVE\"},{\"name\":\"STOP\",\"value\":\"STOP\"}],\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"status\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"customer_name\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"customer_name\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"customer_summary\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"customer_summary\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"chat_messages\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"chat_messages\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"scheduled_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"scheduled_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"appointment_id\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"appointment_id\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"last_message_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"last_message_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"last_followup_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"last_followup_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"followup_count\",\"type\":\"number\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"followup_count\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"assignee\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"assignee\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"twilio_service_number\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"twilio_service_number\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[\"session_id\"]},\"options\":{},\"operation\":\"update\"},\"credentials\":{\"airtableTokenApi\":{\"id\":\"Und0frCQ6SNVX3VV\",\"name\":\"Airtable Personal Access Token account\"}},\"typeVersion\":2.1},{\"id\":\"de8eaa46-2fe8-4afd-a400-9c528f578d24\",\"name\":\"Get Existing Chat Session\",\"type\":\"n8n-nodes-base.airtable\",\"position\":[740,240],\"parameters\":{\"base\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"appO2nHiT9XPuGrjN\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN\",\"cachedResultName\":\"Twilio-Scheduling-Agent\"},\"limit\":1,\"table\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"tblokH7uw63RpIlQ0\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\"cachedResultName\":\"Lead Tracker\"},\"options\":{},\"operation\":\"search\",\"returnAll\":false,\"filterByFormula\":\"={session_id}=\\\"{{ $('Twilio Trigger').item.json.From }}\\\"\"},\"credentials\":{\"airtableTokenApi\":{\"id\":\"Und0frCQ6SNVX3VV\",\"name\":\"Airtable Personal Access Token account\"}},\"typeVersion\":2.1,\"alwaysOutputData\":true},{\"id\":\"16aabbf0-fdf7-4940-a3a3-962e0b877299\",\"name\":\"Every 24hrs\",\"type\":\"n8n-nodes-base.scheduleTrigger\",\"position\":[220,1160],\"parameters\":{\"rule\":{\"interval\":[{}]}},\"typeVersion\":1.2},{\"id\":\"9471b840-3a59-491d-a309-180d5a69fb7e\",\"name\":\"Send Reply\",\"type\":\"n8n-nodes-base.twilio\",\"position\":[2420,269],\"parameters\":{\"to\":\"={{ $('Twilio Trigger').item.json.From }}\",\"from\":\"={{ $('Twilio Trigger').item.json.To }}\",\"message\":\"={{ $('Appointment Scheduling Agent').item.json.output.reply }}\",\"options\":{}},\"credentials\":{\"twilioApi\":{\"id\":\"TJv4H4lXxPCLZT50\",\"name\":\"Twilio account\"}},\"typeVersion\":1},{\"id\":\"601aa9ea-f3f4-49bd-a391-84e32c47f7ba\",\"name\":\"Send Confirmation\",\"type\":\"n8n-nodes-base.twilio\",\"position\":[900,-280],\"parameters\":{\"to\":\"={{ $('Twilio Trigger').item.json.From }}\",\"from\":\"={{ $('Twilio Trigger').item.json.To }}\",\"message\":\"Thank you. You won't receive any more messages from us!\",\"options\":{}},\"credentials\":{\"twilioApi\":{\"id\":\"TJv4H4lXxPCLZT50\",\"name\":\"Twilio account\"}},\"typeVersion\":1},{\"id\":\"a8b9fffe-f814-4cb4-9e1a-bf7eb57e7afd\",\"name\":\"User Request STOP\",\"type\":\"n8n-nodes-base.airtable\",\"position\":[660,-280],\"parameters\":{\"base\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"appO2nHiT9XPuGrjN\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN\",\"cachedResultName\":\"Twilio-Scheduling-Agent\"},\"table\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"tblokH7uw63RpIlQ0\",\"cachedResultUrl\":\"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\"cachedResultName\":\"Lead Tracker\"},\"columns\":{\"value\":{\"status\":\"STOP\",\"session_id\":\"={{ $('Twilio Trigger').item.json.From }}\"},\"schema\":[{\"id\":\"id\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":true,\"required\":false,\"displayName\":\"id\",\"defaultMatch\":true},{\"id\":\"session_id\",\"type\":\"string\",\"display\":true,\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"session_id\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"status\",\"type\":\"options\",\"display\":true,\"options\":[{\"name\":\"ACTIVE\",\"value\":\"ACTIVE\"},{\"name\":\"STOP\",\"value\":\"STOP\"}],\"removed\":false,\"readOnly\":false,\"required\":false,\"displayName\":\"status\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"chat_messages\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"chat_messages\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"scheduled_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"scheduled_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"last_message_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"last_message_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"last_followup_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"last_followup_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"followup_count\",\"type\":\"number\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"followup_count\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"assignee\",\"type\":\"string\",\"display\":true,\"removed\":true,\"readOnly\":false,\"required\":false,\"displayName\":\"assignee\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[\"session_id\"]},\"options\":{},\"operation\":\"update\"},\"credentials\":{\"airtableTokenApi\":{\"id\":\"Und0frCQ6SNVX3VV\",\"name\":\"Airtable Personal Access Token account\"}},\"typeVersion\":2.1},{\"id\":\"3e7797f0-5449-404c-bac9-e0019223cea8\",\"name\":\"Check For Command  Words\",\"type\":\"n8n-nodes-base.switch\",\"position\":[295,180],\"parameters\":{\"rules\":{\"values\":[{\"outputKey\":\"STOP\",\"conditions\":{\"options\":{\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"operator\":{\"type\":\"string\",\"operation\":\"contains\"},\"leftValue\":\"={{ $json.Body }}\",\"rightValue\":\"STOP\"}]},\"renameOutput\":true}]},\"options\":{\"fallbackOutput\":\"extra\"}},\"typeVersion\":3},{\"id\":\"e636ebb5-16c6-43ef-9fee-fe2b9a8c95a9\",\"name\":\"Structured Output Parser\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[1960,560],\"parameters\":{\"jsonSchemaExample\":\"{\\n    \\\"reply\\\": \\\"\\\",\\n    \\\"customer_name\\\": \\\"\\\",\\n    \\\"enquiry_summary\\\": \\\"\\\",\\n\\t\\\"has_appointment_scheduled\\\": false,\\n    \\\"appointment\\\": {\\n      \\\"appointment_id\\\": \\\"\\\",\\n      \\\"scheduled_at\\\": \\\"\\\"\\n    }\\n}\"},\"typeVersion\":1.2},{\"id\":\"3469740d-bd2f-4d34-a86b-59b088917d74\",\"name\":\"Auto-fixing Output Parser\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserAutofixing\",\"position\":[1820,440],\"parameters\":{},\"typeVersion\":1},{\"id\":\"fc0adfdf-724c-45d2-84f6-cb2b43254cc0\",\"name\":\"OpenAI Chat Model2\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1840,560],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"0e0d8236-0f10-4f8f-88c1-bba2ef084e90\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1080,-50.317404874203476],\"parameters\":{\"color\":7,\"width\":1011.8938194478603,\"height\":917.533068142247,\"content\":\"## Step 3. Appointment Scheduling With AI\\n[Learn about using AI Agents](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent)\\n\\nUsing an AI Agent is a powerful way to simplify and enhance workflows using the latest in AI technology. Our appointment scheduling agent is equipped to converse with the customer and all the necessary tools to schedule, re-schedule and cancel appointments.\\n\\nUsing the **HTTP Tool** node, it's easy to connect to third party API services to perform actions. In this workflow, we're calling the Cal.com API to handle scheduling events.\"},\"typeVersion\":1},{\"id\":\"380b437e-fa29-4ebb-bebd-1984d371bc93\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[549.8696404310444,-49.46972087742148],\"parameters\":{\"color\":7,\"width\":504.0066355303578,\"height\":557.8466102697549,\"content\":\"## Step 2. Check for Existing Chat History\\n[Read more about using Airtable](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.airtable)\\n\\nWe're using Airtable for customer session management and to capture chat history. Airtable is an ideal choice because it acts as a persistent database with a flexible API which could prove essential for further extension.\\n\\nWe'll pull any previous chat history and pass this to our agent to continue the conversation.\"},\"typeVersion\":1},{\"id\":\"f89762f5-8520-4af6-987d-a71381c603e3\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[0,-52.79744987055557],\"parameters\":{\"color\":7,\"width\":523.6927529886705,\"height\":479.4432905734608,\"content\":\"## Step 1. Wait For Customer SMS\\n[Read more about Twilio trigger](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.twiliotrigger)\\n\\nFor this workflow, we'll use the twilio SMS trigger to receive enquiries from customers looking to book a PC or laptop repair.\\n\\nSince we'll be working with SMS, we'll have a check to see if the customer wishes to STOP any further follow-up messages. This is an optional step that we'll get to later.\"},\"typeVersion\":1},{\"id\":\"de525648-ef11-4b48-85ea-c6e5463c87cf\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[540,-450.0217713292123],\"parameters\":{\"color\":7,\"width\":563.7797724327219,\"height\":358.6710117357418,\"content\":\"## Step 9. Cancelling Follow-Up Messages \\n\\nIf the customer messages the bot with the word STOP, we'll update our customer record in Airtable which will prevent further follow-ups from being trigger. A confirmation message is sent after to the customer.\"},\"typeVersion\":1},{\"id\":\"028e4253-d1e6-4cf8-b181-ba27b03fa66e\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2120,-40],\"parameters\":{\"color\":7,\"width\":521.5259177258192,\"height\":558.7093446159199,\"content\":\"## Step 4. Updating Airtable and Responding to the Customer \\n[Read more about using Twilio](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.twilio)\\n\\nOnce the agent formulates a response, we can update our appointment table accordingly ensuring the conversation at any stage is captured.\\n\\nIf no appointment is scheduled, we can move onto the second half of this workflow which covers following up with prospective customers and their enquiries.\"},\"typeVersion\":1},{\"id\":\"f321ded9-c5d3-418d-bf1c-e29bf9845098\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[20,940],\"parameters\":{\"color\":7,\"width\":509.931737588259,\"height\":433.74984757777247,\"content\":\"## Step 5. Following Up With Open Enquiries\\n[Read more about using scheduled trigger](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.scheduletrigger)\\n\\nThe second half of this workflow deals with identifying customers who have engaged our chatbot but have not yet confirmed an appointment. We intend to send a follow-up message asking if the enquiry is still valid and encourage an appointment to be made with the customer.\"},\"typeVersion\":1},{\"id\":\"4485e39a-3e84-49ee-9d3f-a271a98a330a\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1000,940],\"parameters\":{\"color\":7,\"width\":567.1169284476533,\"height\":601.5572296901626,\"content\":\"## Step 7. Generating a Follow-Up Message\\n[Read more about Basic LLM Chain](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm)\\n\\nWith our session and chat history retrieved from Airtable, we can simple ask our AI to generate a nicely worded follow-up message to re-engage the customer.\\n\\nWhere the logic is linear, the Basic LLM chain is suitable for many workflows. An agent is not always required!\"},\"typeVersion\":1},{\"id\":\"f2d66e44-cf18-4e8f-80d5-e8d03e10e5ff\",\"name\":\"Generate Follow Up Message\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[1140,1200],\"parameters\":{\"text\":\"=\",\"messages\":{\"messageValues\":[{\"message\":\"=You are an appointment scheduling assistant for PC and Laptop Repairs for a company called \\\"PC Parts Ltd\\\". You shall refer to yourself as the \\\"service team\\\". You had a conversation with a customer on {{ $json.last_message_at }} but the enquiry did not end with an appointment being scheduled.\\n{{ $json.last_followup_at ? `You last sent a follow-up message on ${$json.last_followup_at}` : '' }}.\\n\\nYou task is to ask if the prospective customer would like to continue with the enquiry using the following information gather to construct a relevant follow-up message. Try to entice the user to continue the conversation and ultimately schedule an appointment.\\n\\n## About the customer\\nname: {{ $json.customer_name ?? '<unknown>' }}\\nenquiry summary: {{ $json.customer_summary ?? '<uknown>' }}\\n\\n# Existing conversation\\nHere are the chat logs of the existing conversation:\\n{{ $json.chat_messages }}\"}]},\"promptType\":\"define\"},\"typeVersion\":1.4},{\"id\":\"0b93a300-b9ab-4c28-8ac0-fddc49247b74\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1600,940],\"parameters\":{\"color\":7,\"width\":496.0833287715134,\"height\":526.084030034264,\"content\":\"## Step 8. Update Follow-Up Properties and Send Message\\n[Read more about using Twilio](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.twilio/)\\n\\nFinally, we'll update our follow-up activity as part of the customer record in Airtable. Keeping track of the number of times we follow-up helps prevent spamming the customer unnecessarily.\\n\\nThe follow-up message is sent via Twilio and includes instruction to disable further follow-up messages using the keyword STOP.\"},\"typeVersion\":1},{\"id\":\"0e022485-9504-416a-8632-edd65df29bf4\",\"name\":\"Sticky Note9\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-480,-80],\"parameters\":{\"width\":437.0019498737189,\"height\":511.67220311821393,\"content\":\"## Try It Out!\\n\\n### This workflow implements an appointment scheduling chatbot which is powered by an AI tools agent.\\n* Workflow is triggered by Customer enquires sent via SMS\\n* Customer session management and chat history are captured in Airtable to enable the SMS conversation.\\n* An AI Agent is equipped to answer any questions as well as schedule, re-schedule and cancel appointments on behalf of the customer.\\n* The agent's reply is sent back to the customer via SMS.\\n* Additional a follow-up system is implemented to re-engage customers who haven't scheduled an appointment.\\n\\n \\n### Need Help?\\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\\n\\nHappy Hacking!\"},\"typeVersion\":1},{\"id\":\"04681629-0221-47fe-b992-0d5791995523\",\"name\":\"OpenAI Chat Model3\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1120,420],\"parameters\":{\"model\":\"gpt-4o-mini\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"7633e3b0-daf3-495d-bcd7-ce0db24a73b9\",\"name\":\"Get Availability\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1260,440],\"parameters\":{\"url\":\"https://api.cal.com/v2/slots/available\",\"sendQuery\":true,\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"parametersQuery\":{\"values\":[{\"name\":\"eventTypeId\",\"value\":\"={{ 648297 }}\",\"valueProvider\":\"fieldValue\"},{\"name\":\"startTime\",\"value\":\"{startTime}\",\"valueProvider\":\"fieldValue\"},{\"name\":\"endTime\",\"value\":\"{endTime}\",\"valueProvider\":\"fieldValue\"}]},\"toolDescription\":\"Call this tool to get the appointment availability. Dates can be variable but times are fixed - startTime must always be 9am and endTime must be 7pm. Strictly use ISO format for dates eg. \\\"2024-01-01T09:00:00-00:00\\\". Input schema example: ```{ \\\"startTime\\\": \\\"...\\\", \\\"endTime\\\": \\\"...\\\"}```\",\"placeholderDefinitions\":{\"values\":[{\"name\":\"startTime\",\"type\":\"string\",\"description\":\"start of daterange in ISO format. eg. 2024-01-01T09:00:00-00:00\"},{\"name\":\"endTime\",\"type\":\"string\",\"description\":\"end of daterange in ISO format. eg. 2024-01-01T09:00:00-00:00\"}]}},\"credentials\":{\"calApi\":{\"id\":\"GPSKPrBhO3Pq6KVF\",\"name\":\"Cal account\"},\"httpHeaderAuth\":{\"id\":\"X2Vr2TQSBcOsOMst\",\"name\":\"Cal.com API v2\"}},\"typeVersion\":1},{\"id\":\"0f814d08-218e-492e-b1f8-63985d583e80\",\"name\":\"Get Existing Booking\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1560,440],\"parameters\":{\"url\":\"https://api.cal.com/v2/bookings/{bookingUid}\",\"sendHeaders\":true,\"authentication\":\"predefinedCredentialType\",\"toolDescription\":\"Call this tool to get an existing booking using a booking \\\"uid\\\".\",\"parametersHeaders\":{\"values\":[{\"name\":\"cal-api-version\",\"value\":\"2024-08-13\",\"valueProvider\":\"fieldValue\"}]},\"nodeCredentialType\":\"calApi\",\"placeholderDefinitions\":{\"values\":[{\"name\":\"bookingUid\",\"type\":\"string\",\"description\":\"the uid of the booking (note: this is not the same as the id of the booking)\"}]}},\"credentials\":{\"calApi\":{\"id\":\"GPSKPrBhO3Pq6KVF\",\"name\":\"Cal account\"}},\"typeVersion\":1},{\"id\":\"36a5a2a7-bb78-4091-8b25-5e9f49628542\",\"name\":\"Find Existing Booking\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1700,440],\"parameters\":{\"url\":\"https://api.cal.com/v2/bookings\",\"jsonQuery\":\"{\\n  \\\"status\\\": \\\"upcoming\\\",\\n  \\\"attendeeEmail\\\": \\\"{attendee_email}\\\",\\n  \\\"afterStart\\\": \\\"{date}\\\"\\n}\",\"sendQuery\":true,\"sendHeaders\":true,\"specifyQuery\":\"json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"toolDescription\":\"Call this tool to search for an existing bookings with the user's email address and date. Use the \\\"uid\\\" field in the results as the primary booking identifier, ignore the \\\"id\\\" field.\",\"parametersHeaders\":{\"values\":[{\"name\":\"cal-api-version\",\"value\":\"2024-08-13\",\"valueProvider\":\"fieldValue\"}]},\"placeholderDefinitions\":{\"values\":[{\"name\":\"attendee_email\",\"type\":\"string\",\"description\":\"email address of attendee\"},{\"name\":\"date\",\"description\":\"Filter bookings with start after this date string. The time is always fixed at 9am.\"}]}},\"credentials\":{\"calApi\":{\"id\":\"GPSKPrBhO3Pq6KVF\",\"name\":\"Cal account\"},\"httpHeaderAuth\":{\"id\":\"X2Vr2TQSBcOsOMst\",\"name\":\"Cal.com API v2\"}},\"typeVersion\":1},{\"id\":\"88ee279d-ed85-4dc6-b42a-5e1e50f3d708\",\"name\":\"Reschedule Booking\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1560,620],\"parameters\":{\"url\":\"https://api.cal.com/v2/bookings/{bookingUid}/reschedule\",\"method\":\"POST\",\"jsonBody\":\"{\\n  \\\"start\\\": \\\"{start}\\\",\\n  \\\"reschedulingReason\\\": \\\"{reschedulingReason}\\\"\\n}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"toolDescription\":\"Call this tool to reschedule a user's booking using a booking \\\"uid\\\".\",\"parametersHeaders\":{\"values\":[{\"name\":\"cal-api-version\",\"value\":\"2024-08-13\",\"valueProvider\":\"fieldValue\"}]},\"placeholderDefinitions\":{\"values\":[{\"name\":\"bookingUid\",\"type\":\"string\",\"description\":\"the uid of the booking. Note this is not the same as the id of the booking.\"},{\"name\":\"start\",\"type\":\"string\",\"description\":\"start datetime of the appointment, for example: \\\"2024-05-30T12:00:00.000Z\\\"\"},{\"name\":\"reschedulingReason\",\"type\":\"string\",\"description\":\"Reason for rescheduling the booking. If not given, value is \\\"Declined to give reason.\\\"\"}]}},\"credentials\":{\"calApi\":{\"id\":\"GPSKPrBhO3Pq6KVF\",\"name\":\"Cal account\"},\"httpHeaderAuth\":{\"id\":\"X2Vr2TQSBcOsOMst\",\"name\":\"Cal.com API v2\"}},\"typeVersion\":1},{\"id\":\"ee30c793-d8f4-4e49-9bd1-70e5ac109b68\",\"name\":\"Cancel Booking\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1700,620],\"parameters\":{\"url\":\"https://api.cal.com/v2/bookings/{bookingUid}/cancel\",\"method\":\"POST\",\"jsonBody\":\"{\\n  \\\"cancellationReason\\\": \\\"{cancellationReason}\\\"\\n}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"toolDescription\":\"Call this tool to cancel a user's existing booking using a booking \\\"uid\\\".\",\"parametersHeaders\":{\"values\":[{\"name\":\"cal-api-version\",\"value\":\"2024-08-13\",\"valueProvider\":\"fieldValue\"}]},\"placeholderDefinitions\":{\"values\":[{\"name\":\"bookingUid\",\"type\":\"string\",\"description\":\"the uid of the booking. Note this is not the same as the id of the booking.\"},{\"name\":\"cancellationReason\",\"type\":\"string\",\"description\":\"Reason for cancelling the appointment\"}]}},\"credentials\":{\"calApi\":{\"id\":\"GPSKPrBhO3Pq6KVF\",\"name\":\"Cal account\"},\"httpHeaderAuth\":{\"id\":\"X2Vr2TQSBcOsOMst\",\"name\":\"Cal.com API v2\"}},\"typeVersion\":1},{\"id\":\"d90aa957-30d7-4b29-93b9-acdc86f1cb17\",\"name\":\"Create a Booking\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1400,440],\"parameters\":{\"url\":\"https://api.cal.com/v2/bookings\",\"method\":\"POST\",\"jsonBody\":\"{\\n  \\\"eventTypeId\\\": 648297,\\n  \\\"start\\\": \\\"{start}\\\",\\n  \\\"attendee\\\": {\\n     \\\"name\\\": \\\"{attendee_name}\\\",\\n     \\\"email\\\": \\\"{attendee_email}\\\",\\n     \\\"timeZone\\\": \\\"{attendee_timezone}\\\"\\n  },\\n  \\\"bookingFieldsResponses\\\": {\\n    \\\"title\\\": \\\"{summary_of_enquiry}\\\"\\n  }\\n}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"toolDescription\":\"Call this tool to create a booking. Strictly use ISO format for dates eg. \\\"2024-01-01T09:00:00-00:00\\\" for API compatibility.\",\"parametersHeaders\":{\"values\":[{\"name\":\"Content-Type\",\"value\":\"application/json\",\"valueProvider\":\"fieldValue\"},{\"name\":\"cal-api-version\",\"value\":\"2024-08-13\",\"valueProvider\":\"fieldValue\"}]},\"placeholderDefinitions\":{\"values\":[{\"name\":\"start\",\"type\":\"string\",\"description\":\"The start time of the booking in ISO format. eg. \\\"2024-01-01T09:00:00Z\\\"\"},{\"name\":\"attendee_name\",\"type\":\"string\",\"description\":\"Name of the attendee\"},{\"name\":\"attendee_email\",\"type\":\"string\",\"description\":\"email of the attendee\"},{\"name\":\"attendee_timezone\",\"type\":\"string\",\"description\":\"If timezone is unknown, assume Europe/London.\"},{\"name\":\"summary_of_enquiry\",\"type\":\"string\",\"description\":\"short summary of the enquiry or purpose of the meeting\"}]}},\"credentials\":{\"calApi\":{\"id\":\"GPSKPrBhO3Pq6KVF\",\"name\":\"Cal account\"},\"httpHeaderAuth\":{\"id\":\"X2Vr2TQSBcOsOMst\",\"name\":\"Cal.com API v2\"}},\"typeVersion\":1},{\"id\":\"dfcf00ca-8fe1-4517-b64f-fbb4606ab221\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[928.7527821891895,600],\"parameters\":{\"color\":7,\"width\":261.1134437946252,\"height\":168.99242033383513,\"content\":\"![alt](https://upload.wikimedia.org/wikipedia/commons/a/a5/Cal.com%2C_Inc._Logo.svg#100x80)\\nYou'll need to set a custom Header Auth Credential for Cal.com API v2. See the following doc for more info: https://cal.com/docs/api-reference/v2/introduction\"},\"typeVersion\":1},{\"id\":\"e743b324-ead2-47f8-87c9-2eb969305d4e\",\"name\":\"Sticky Note12\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1220,420],\"parameters\":{\"width\":301.851426117099,\"height\":360.9218237282627,\"content\":\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### 🚨 Change EventTypeID Here!\\n* EventTypeID must be a number.\\n* Your event type dictates the allowed duration of the booking.\\n* If Event Type set to 30mins and the agent attempts to book 60mins, this will fail so make sure the agent knows how long to set the booking for!\"},\"typeVersion\":1},{\"id\":\"f087e1a4-fffb-44da-afd6-a6277aef84b5\",\"name\":\"Appointment Scheduling Agent1\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[1220,200],\"parameters\":{\"options\":{\"systemMessage\":\"=You are an appointment scheduling helper for a company called \\\"PC Parts Ltd\\\". Customers will message you enquirying for PC or laptop repairs and your job is to schedule a repair session for the user.This role is strictly to help schedule appointments so:\\n* you may answer questions relating to the company, \\\"PC Parts Ltd\\\".\\n* you may not answer questions relating to competitors of \\\"PC Parts Ltd\\\".\\n* you may answer questions relating to general PC or laptop repair from a non-technical perspective.\\n* you may not help to customer diagnose or assist in troubleshoot or debugging thei r PC or laptop issues. If the customer does ask, defer them to book an appointment where a suitable professional from PC Parts Ltd can help.\\n* If an appointment is scheduled for the user then the conversation is completed and you should not continue to ask the user to schedule an appointment.\\n* If an appointment is scheduled for the user, the user may ask for the following actions: ask about details of the existing appointment, reschedule the existing appointment or cancel an existing appointment.\\n* If an appointment is scheduled for the user, the user cannot schedule another appointment until the existing appointment is cancelled.\\n\\n## About the company\\nPC Parts Ltd is based in London, UK. They offer to repair low-end to high-end PC and Laptop consumer and small business machines. They also offer custom built machines such as for gaming. There is currently a summer sale going on for 20% selected machines for repairs. The company does not repair other electronic devices such as phones, tablets or monitors.\\n\\n## About the appointments\\nAlways start your conversation by politely asking if the user wants to book a new appointment or enquire about an existing one. The date and time now is {{ $now.toISO() }}. All dates should be given in the ISO format. Each appointment should have a start and end date and time relative to today's date in the future and should be scheduled for 30 minutes.\\n\\n## To book an appointment\\n* Before booking an appointment, ask if the user has an existing appointment.\\n* Ensure you have the user's email address, full name and proposed date, preferred start time before booking an appointment.\\n* Always check the calendar availability of the user's proposed date and time. If there is no availability, suggest the next available appointment slot.\\n* If the appointment booking is successful, notify the user that an email confirmation will be sent to their provided email address.\\n* If the appointment booking is unsuccessful, notify the user that you are unable to complete their request at the moment and to try again later.\\n\\n## To find an existing appointment\\n* Ask the user for their email address and the date of the existing booking\\n* Use the user's email and date to search for the existing booking.\\n* If the user's email and date do not match the results or no results are returned, then the existing booking is not found.\\n* If the existing booking is not found, notify the user and suggest a new booking should be made.\\n* When the existing booking is found, ensure you tell them the booking's UID field.\\n\\n# To reschedule or cancel an existing appointment\\n* First find the existing appointment so that you may obtain the existing appointment's booking UID.\\n* Display this booking UID to the user.\\n* Use this booking UID to reschedule or cancel an existing appointment.\\n* If an existing appointment ID is not found or given, then notify the user that it is not possible to complete their request at this time and they should contact via email.\\n* when user wants to cancel an appointment, ask for a reason for the cancellation and suggest rescheduling as an alternative. Confirm with user before cancelling an appointment.\\n\\n## About the user\\n* The customer's session_id is \\\"{{ $('Twilio Trigger').item.json.From }}\\\"\\n{{\\n$json.chat_messages \\n  ? '* This is a returning prospective customer.' \\n  : '* This is a new customer. Ask for the details of their enquiry.'\\n}}\\n{{\\n$json.appointment_id \\n  ? `* The customer has already scheduled an appointment at ${$json.scheduled_at} and their appointment_id is ${$json.appointment_id}`\\n  : '* This customer has not scheduled an appointment yet.'\\n}}\\n\\n## Existing Conversation\\n{{\\n$json.chat_messages\\n  ? 'Here are the existing chat logs and should be used as context to continue the conversation:\\\\n```\\\\n' + JSON.parse($json.chat_messages).map(item => `${item.role}: ${item.message.replaceAll('\\\\n', ' ')}`).join('\\\\n') + '\\\\n```'\\n  : '* There is no existing conversation so far.'\\n}}\\n\"},\"hasOutputParser\":true},\"typeVersion\":1.6}],\"pinData\":{},\"connections\":{\"Every 24hrs\":{\"main\":[[{\"node\":\"Find Follow-Up Candidates\",\"type\":\"main\",\"index\":0}]]},\"Cancel Booking\":{\"ai_tool\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_tool\",\"index\":0}]]},\"Twilio Trigger\":{\"main\":[[{\"node\":\"Check For Command  Words\",\"type\":\"main\",\"index\":0}]]},\"Create a Booking\":{\"ai_tool\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_tool\",\"index\":0}]]},\"Get Availability\":{\"ai_tool\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_tool\",\"index\":0}]]},\"User Request STOP\":{\"main\":[[{\"node\":\"Send Confirmation\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model1\":{\"ai_languageModel\":[[{\"node\":\"Generate Follow Up Message\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"OpenAI Chat Model2\":{\"ai_languageModel\":[[{\"node\":\"Auto-fixing Output Parser\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"OpenAI Chat Model3\":{\"ai_languageModel\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Reschedule Booking\":{\"ai_tool\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_tool\",\"index\":0}]]},\"Get Existing Booking\":{\"ai_tool\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_tool\",\"index\":0}]]},\"Create/Update Session\":{\"main\":[[{\"node\":\"Send Reply\",\"type\":\"main\",\"index\":0}]]},\"Find Existing Booking\":{\"ai_tool\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_tool\",\"index\":0}]]},\"Check For Command  Words\":{\"main\":[[{\"node\":\"User Request STOP\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Get Existing Chat Session\",\"type\":\"main\",\"index\":0}]]},\"Structured Output Parser\":{\"ai_outputParser\":[[{\"node\":\"Auto-fixing Output Parser\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"Auto-fixing Output Parser\":{\"ai_outputParser\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"Find Follow-Up Candidates\":{\"main\":[[{\"node\":\"Generate Follow Up Message\",\"type\":\"main\",\"index\":0}]]},\"Get Existing Chat Session\":{\"main\":[[{\"node\":\"Appointment Scheduling Agent1\",\"type\":\"main\",\"index\":0}]]},\"Generate Follow Up Message\":{\"main\":[[{\"node\":\"Update Follow-Up Count and Date\",\"type\":\"main\",\"index\":0}]]},\"Appointment Scheduling Agent1\":{\"main\":[[{\"node\":\"Create/Update Session\",\"type\":\"main\",\"index\":0}]]},\"Update Follow-Up Count and Date\":{\"main\":[[{\"node\":\"Send Follow Up Message\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This n8n workflow builds an appointment scheduling AI agent which can\n\n  * Take enquiries from prospective customers and help them book an appointment by checking appointment availability\n  * Where no appointment is booked, the Agent is able to send follow-up messages to re-engage leads.\n  * After an appointment is booked, the agent is able reschedule or even cancel the booking for the user without human intervention.\n\n\n\nFor small outfits, this workflow could contribute the necessary \"man-power\" required to increase business sales.\n\nThe sample Airtable can be found here: <https://airtable.com/appO2nHiT9XPuGrjN/shroSFT2yjf87XAox>\n\n**2024-10-22** Updated to [Cal.com](http://Cal.com) API v2.\n\n## How it works\n\n  * The customer sends an enquiry via SMS to trigger our workflow. For this trigger, we'll use a Twilio webhook.\n  * The prospective or existing customer's number is logged in an Airtable Base which we'll be using to track all our enquries.\n  * Next, the message is sent to our AI Agent who can reply to the user and decide if an appointment booking can be made. The reply is made via SMS using Twilio.\n  * A scheduled trigger which runs every day, checks our chat logs for a list of prospective customers who have yet to book an appointment but still show interest.\n  * This list is sent to our AI Agent to formulate a personalised follow-up message to each lead and ask them if they want to continue with the booking.\n  * The follow-up interaction is logged so as to not to send too many messages to the customer.\n\n\n\n## Requirements\n\n  * A Twilio account to receive customer messages.\n  * An Airtable account and Base to use as our datastore for enquiries.\n  * [Cal.com](http://Cal.com) account to use as our scheduling service.\n  * OpenAI account for our AI model.\n\n\n\n## Customising this workflow\n\nNot using Airtable? Swap this out for your CRM of choice such as hubspot or your own service.\n\nNot using [Cal.com](http://Cal.com)? Swap this out for API-enabled services such as Acuity Scheduling or your own service.\n",
  "crawled_at": "2025-05-25T23:33:17.513879",
  "readme_zh": "该n8n工作流构建了一个智能预约调度助手，能够：\n\n* 接收潜在客户咨询，通过查询预约空档协助完成预约\n* 若未成功预约，可自动发送跟进信息重新激活潜在客户\n* 预约成立后，可无需人工干预完成改期或取消操作\n\n对于小型机构，此工作流能有效补充人力缺口，助力业务增长。\n\n示例Airtable模板见此：<https://airtable.com/appO2nHiT9XPuGrjN/shroSFT2yjf87XAox>\n\n**2024-10-22** 已升级至[Cal.com](http://Cal.com) API v2版本\n\n## 运作原理\n\n* 客户通过短信发起咨询（使用Twilio webhook触发）\n* 潜在/现有客户号码将记录在Airtable数据库中用于追踪\n* 消息传递至AI助手进行智能回复，并判断是否可预约（通过Twilio短信回复）\n* 每日定时触发器检查未预约但仍有兴趣的潜在客户名单\n* AI助手生成个性化跟进信息，询问是否继续预约流程\n* 所有跟进记录均会留存，避免对客户过度推送\n\n## 环境要求\n\n* Twilio账户（用于接收客户消息）\n* Airtable账户及数据库（用于存储咨询记录）\n* [Cal.com](http://Cal.com)账户（提供预约服务）\n* OpenAI账户（AI模型支持）\n\n## 自定义方案\n\n不使用Airtable？可替换为HubSpot等CRM系统或自建服务。\n\n不使用[Cal.com](http://Cal.com)？可替换为Acuity Scheduling等支持API的调度服务或自建系统。",
  "title_zh": "利用Twilio、Cal.com和AI处理预约线索与跟进",
  "publish_date_zh": "最后更新于6个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"f55b3110-f960-4d89-afba-d47bc58102eb\",\n      \"name\": \"Twilio Trigger\",\n      \"type\": \"n8n-nodes-base.twilioTrigger\",\n      \"position\": [\n        100,\n        180\n      ],\n      \"webhookId\": \"bfc8f587-8183-46f8-9e76-3576caddf8c0\",\n      \"parameters\": {\n        \"updates\": [\n          \"com.twilio.messaging.inbound-message.received\"\n        ]\n      },\n      \"credentials\": {\n        \"twilioApi\": {\n          \"id\": \"TJv4H4lXxPCLZT50\",\n          \"name\": \"Twilio account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8472f5b0-329f-45ac-b35f-c42558daa7c7\",\n      \"name\": \"OpenAI Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1140,\n        1360\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4b3e8a26-c808-46e5-bbcf-2e1279989a0b\",\n      \"name\": \"Find Follow-Up Candidates\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        720,\n        1240\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"appO2nHiT9XPuGrjN\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN\",\n          \"cachedResultName\": \"Twilio-Scheduling-Agent\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblokH7uw63RpIlQ0\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\n          \"cachedResultName\": \"Lead Tracker\"\n        },\n        \"options\": {},\n        \"operation\": \"search\",\n        \"filterByFormula\": \"=AND(\\n  {appointment_id} = '',\\n  {status} != 'STOP',\\n  {followup_count} < 3,\\n  DATETIME_DIFF(TODAY(), {last_followup_at}, 'days') >= 3\\n)\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"Und0frCQ6SNVX3VV\",\n          \"name\": \"Airtable Personal Access Token account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"04dc979c-ad36-4e57-93d4-905929fe1af0\",\n      \"name\": \"Send Follow Up Message\",\n      \"type\": \"n8n-nodes-base.twilio\",\n      \"position\": [\n        1880,\n        1240\n      ],\n      \"parameters\": {\n        \"to\": \"={{ $('Find Follow-Up Candidates').item.json.session_id }}\",\n        \"from\": \"={{ $('Find Follow-Up Candidates').item.json.twilio_service_number }}\",\n        \"message\": \"={{ $('Generate Follow Up Message').item.json.text }}\\nReply STOP to stop recieving these messages.\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"twilioApi\": {\n          \"id\": \"TJv4H4lXxPCLZT50\",\n          \"name\": \"Twilio account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"55e222af-fb59-4ffd-9661-350b1972e802\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        570,\n        943\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 408.6631332343324,\n        \"height\": 515.2449997772154,\n        \"content\": \"## 步骤6. 从Airtable筛选开放询盘\\n\\n### 💡跟进候选人的标准\\n* 未预约会议\\n* 未要求停止联系\\n* 过去3天内无跟进记录\\n* 跟进次数少于3次\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"50d0c632-233b-4b31-b396-3fa603aecd03\",\n      \"name\": \"Update Follow-Up Count and Date\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        1700,\n        1240\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"appO2nHiT9XPuGrjN\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN\",\n          \"cachedResultName\": \"Twilio-Scheduling-Agent\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblokH7uw63RpIlQ0\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\n          \"cachedResultName\": \"Lead Tracker\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"session_id\": \"={{ $('Find Follow-Up Candidates').item.json.session_id }}\",\n            \"followup_count\": \"={{ ($('Find Follow-Up Candidates').item.json.followup_count ?? 0) + 1 }}\",\n            \"last_followup_at\": \"={{ $now.toISO() }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": true,\n              \"required\": false,\n              \"displayName\": \"id\",\n              \"defaultMatch\": true\n            },\n            {\n              \"id\": \"session_id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"session_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"options\",\n              \"display\": true,\n              \"options\": [\n                {\n                  \"name\": \"ACTIVE\",\n                  \"value\": \"ACTIVE\"\n                },\n                {\n                  \"name\": \"STOP\",\n                  \"value\": \"STOP\"\n                }\n              ],\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"customer_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"customer_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"customer_summary\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"customer_summary\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"chat_messages\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"chat_messages\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"scheduled_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"scheduled_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"appointment_id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"appointment_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_message_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"last_message_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_followup_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"last_followup_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"followup_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"followup_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"assignee\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"assignee\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"session_id\"\n          ]\n        },\n        \"options\": {},\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"Und0frCQ6SNVX3VV\",\n          \"name\": \"Airtable Personal Access Token account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"e1331352-c3da-4586-9d64-4be4dab49748\",\n      \"name\": \"Create/Update Session\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        2240,\n        269\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"appO2nHiT9XPuGrjN\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN\",\n          \"cachedResultName\": \"Twilio-Scheduling-Agent\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblokH7uw63RpIlQ0\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\n          \"cachedResultName\": \"Lead Tracker\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"session_id\": \"={{ $('Twilio Trigger').item.json.From }}\",\n            \"scheduled_at\": \"={{\\n$('Appointment Scheduling Agent').item.json.output.has_appointment_scheduled\\n  ? $('Appointment Scheduling Agent').item.json.output.appointment.scheduled_at\\n  : (\\n    $('Get Existing Chat Session').item.json.isNotEmpty()\\n    ? $('Get Existing Chat Session').item.json.scheduled_at\\n    : $now.toISO()\\n  )\\n}}\",\n            \"chat_messages\": \"={{\\nJSON.stringify(\\n  ($('Get Existing Chat Session').item.json.chat_messages ? JSON.parse($('Get Existing Chat Session').item.json.chat_messages) : [])\\n  .concat(\\n    { \\\"role\\\": \\\"human\\\", \\\"message\\\": $('Twilio Trigger').item.json.Body },\\n    { \\\"role\\\": \\\"assistant\\\", \\\"message\\\": $('Appointment Scheduling Agent').item.json.output.reply }\\n  )\\n)\\n}}\",\n            \"customer_name\": \"={{\\n  !$('Get Existing Chat Session').item.json.customer_name &&\\n  $('Appointment Scheduling Agent').item.json.output.customer_name\\n    ? $('Appointment Scheduling Agent').item.json.output.customer_name\\n    : ($('Get Existing Chat Session').item.json.customer_name ?? '')\\n}}\",\n            \"appointment_id\": \"={{\\n$('Appointment Scheduling Agent').item.json.output.has_appointment_scheduled\\n  ? $('Appointment Scheduling Agent').item.json.output.appointment.appointment_id\\n  : (\\n    $('Get Existing Chat Session').item.json.isNotEmpty()\\n    ? $('Get Existing Chat Session').item.json.appointment_id\\n    : ''\\n  )\\n}}\",\n            \"followup_count\": \"={{\\n  !$('Get Existing Chat Session').item.json.followup_count\\n  ? 0\\n  : $('Get Existing Chat Session').item.json.followup_count\\n}}\",\n            \"last_message_at\": \"={{ $now.toISO() }}\",\n            \"customer_summary\": \"={{\\n  !$('Get Existing Chat Session').item.json.appointment_id\\n  && $('Appointment Scheduling Agent').item.json.output.has_appointment_scheduled\\n    ? $json.output.enquiry_summary\\n    : $('Get Existing Chat Session').item.json.customer_summary\\n}}\",\n            \"last_followup_at\": \"={{\\n  !$('Get Existing Chat Session').item.json.last_followup_at\\n  ? $now.toISO()\\n  : $('Get Existing Chat Session').item.json.last_followup_at\\n}}\",\n            \"twilio_service_number\": \"={{ $('Twilio Trigger').item.json.To }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": true,\n              \"required\": false,\n              \"displayName\": \"id\",\n              \"defaultMatch\": true\n            },\n            {\n              \"id\": \"session_id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"session_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"options\",\n              \"display\": true,\n              \"options\": [\n                {\n                  \"name\": \"ACTIVE\",\n                  \"value\": \"ACTIVE\"\n                },\n                {\n                  \"name\": \"STOP\",\n                  \"value\": \"STOP\"\n                }\n              ],\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"customer_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"customer_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"customer_summary\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"customer_summary\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"chat_messages\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"chat_messages\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"scheduled_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"scheduled_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"appointment_id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"appointment_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_message_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"last_message_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_followup_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"last_followup_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"followup_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"followup_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"assignee\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"assignee\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"twilio_service_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"twilio_service_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"session_id\"\n          ]\n        },\n        \"options\": {},\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"Und0frCQ6SNVX3VV\",\n          \"name\": \"Airtable Personal Access Token account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"de8eaa46-2fe8-4afd-a400-9c528f578d24\",\n      \"name\": \"Get Existing Chat Session\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        740,\n        240\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"appO2nHiT9XPuGrjN\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN\",\n          \"cachedResultName\": \"Twilio-Scheduling-Agent\"\n        },\n        \"limit\": 1,\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblokH7uw63RpIlQ0\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\n          \"cachedResultName\": \"Lead Tracker\"\n        },\n        \"options\": {},\n        \"operation\": \"search\",\n        \"returnAll\": false,\n        \"filterByFormula\": \"={session_id}=\\\"{{ $('Twilio Trigger').item.json.From }}\\\"\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"Und0frCQ6SNVX3VV\",\n          \"name\": \"Airtable Personal Access Token account\"\n        }\n      },\n      \"typeVersion\": 2.1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"16aabbf0-fdf7-4940-a3a3-962e0b877299\",\n      \"name\": \"Every 24hrs\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        220,\n        1160\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"9471b840-3a59-491d-a309-180d5a69fb7e\",\n      \"name\": \"Send Reply\",\n      \"type\": \"n8n-nodes-base.twilio\",\n      \"position\": [\n        2420,\n        269\n      ],\n      \"parameters\": {\n        \"to\": \"={{ $('Twilio Trigger').item.json.From }}\",\n        \"from\": \"={{ $('Twilio Trigger').item.json.To }}\",\n        \"message\": \"={{ $('Appointment Scheduling Agent').item.json.output.reply }}\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"twilioApi\": {\n          \"id\": \"TJv4H4lXxPCLZT50\",\n          \"name\": \"Twilio account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"601aa9ea-f3f4-49bd-a391-84e32c47f7ba\",\n      \"name\": \"Send Confirmation\",\n      \"type\": \"n8n-nodes-base.twilio\",\n      \"position\": [\n        900,\n        -280\n      ],\n      \"parameters\": {\n        \"to\": \"={{ $('Twilio Trigger').item.json.From }}\",\n        \"from\": \"={{ $('Twilio Trigger').item.json.To }}\",\n        \"message\": \"Thank you. You won't receive any more messages from us!\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"twilioApi\": {\n          \"id\": \"TJv4H4lXxPCLZT50\",\n          \"name\": \"Twilio account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a8b9fffe-f814-4cb4-9e1a-bf7eb57e7afd\",\n      \"name\": \"User Request STOP\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        660,\n        -280\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"appO2nHiT9XPuGrjN\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN\",\n          \"cachedResultName\": \"Twilio-Scheduling-Agent\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblokH7uw63RpIlQ0\",\n          \"cachedResultUrl\": \"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0\",\n          \"cachedResultName\": \"Lead Tracker\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"status\": \"STOP\",\n            \"session_id\": \"={{ $('Twilio Trigger').item.json.From }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": true,\n              \"required\": false,\n              \"displayName\": \"id\",\n              \"defaultMatch\": true\n            },\n            {\n              \"id\": \"session_id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"session_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"options\",\n              \"display\": true,\n              \"options\": [\n                {\n                  \"name\": \"ACTIVE\",\n                  \"value\": \"ACTIVE\"\n                },\n                {\n                  \"name\": \"STOP\",\n                  \"value\": \"STOP\"\n                }\n              ],\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"chat_messages\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"chat_messages\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"scheduled_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"scheduled_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_message_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"last_message_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_followup_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"last_followup_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"followup_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"followup_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"assignee\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"assignee\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"session_id\"\n          ]\n        },\n        \"options\": {},\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"Und0frCQ6SNVX3VV\",\n          \"name\": \"Airtable Personal Access Token account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"3e7797f0-5449-404c-bac9-e0019223cea8\",\n      \"name\": \"Check For Command  Words\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        295,\n        180\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"STOP\",\n              \"conditions\": {\n                \"options\": {\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"contains\"\n                    },\n                    \"leftValue\": \"={{ $json.Body }}\",\n                    \"rightValue\": \"STOP\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {\n          \"fallbackOutput\": \"extra\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"e636ebb5-16c6-43ef-9fee-fe2b9a8c95a9\",\n      \"name\": \"Structured Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        1960,\n        560\n      ],\n      \"parameters\": {\n        \"jsonSchemaExample\": \"{\\n    \\\"reply\\\": \\\"\\\",\\n    \\\"customer_name\\\": \\\"\\\",\\n    \\\"enquiry_summary\\\": \\\"\\\",\\n\\t\\\"has_appointment_scheduled\\\": false,\\n    \\\"appointment\\\": {\\n      \\\"appointment_id\\\": \\\"\\\",\\n      \\\"scheduled_at\\\": \\\"\\\"\\n    }\\n}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"3469740d-bd2f-4d34-a86b-59b088917d74\",\n      \"name\": \"Auto-fixing Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserAutofixing\",\n      \"position\": [\n        1820,\n        440\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fc0adfdf-724c-45d2-84f6-cb2b43254cc0\",\n      \"name\": \"OpenAI Chat Model2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1840,\n        560\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0e0d8236-0f10-4f8f-88c1-bba2ef084e90\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1080,\n        -50.317404874203476\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1011.8938194478603,\n        \"height\": 917.533068142247,\n        \"content\": \"## 第三步：利用AI实现预约安排\\n[了解AI智能体使用](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent)\\n\\n通过AI智能体可运用前沿人工智能技术，显著简化和优化工作流程。我们的预约安排智能体具备与客户对话的能力，并集成全套工具实现预约、改期及取消操作。\\n\\n借助**HTTP工具**节点，可轻松对接第三方API服务执行操作。本工作流中，我们调用Cal.com的API来处理日程安排事务。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"380b437e-fa29-4ebb-bebd-1984d371bc93\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        549.8696404310444,\n        -49.46972087742148\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 504.0066355303578,\n        \"height\": 557.8466102697549,\n        \"content\": \"## 第二步：检查现有对话记录\\n[详细了解Airtable使用](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.airtable)\\n\\n我们采用Airtable进行客户会话管理和对话记录存储。该工具因其具备持久化数据库特性及灵活的API接口而成为理想选择，这对未来功能扩展至关重要。\\n\\n系统将提取所有历史对话记录，并传递给智能代理以延续会话。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f89762f5-8520-4af6-987d-a71381c603e3\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        0,\n        -52.79744987055557\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 523.6927529886705,\n        \"height\": 479.4432905734608,\n        \"content\": \"## 第一步：等待客户短信\\n[详细了解Twilio触发器](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.twiliotrigger)\\n\\n在本流程中，我们将使用Twilio短信触发器接收客户咨询电脑或笔记本维修的请求。\\n\\n由于涉及短信交互，我们会设置检查机制确认客户是否希望停止接收后续跟进消息。此为可选步骤，后续将具体说明。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"de525648-ef11-4b48-85ea-c6e5463c87cf\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        540,\n        -450.0217713292123\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 563.7797724327219,\n        \"height\": 358.6710117357418,\n        \"content\": \"## 步骤9. 取消后续跟进消息\\n\\n当客户向机器人发送\\\"STOP\\\"时，我们将在Airtable中更新客户记录，从而阻止触发进一步的跟进。随后会向客户发送一条确认消息。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"028e4253-d1e6-4cf8-b181-ba27b03fa66e\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2120,\n        -40\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 521.5259177258192,\n        \"height\": 558.7093446159199,\n        \"content\": \"## 第四步：更新Airtable并回复客户  \\n[详细了解Twilio的使用方法](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.twilio)  \\n\\n当客服人员拟定回复后，我们可以相应更新预约表格，确保记录每个阶段的对话内容。  \\n\\n若未安排预约，则进入工作流后半部分——跟进潜在客户及其咨询需求。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f321ded9-c5d3-418d-bf1c-e29bf9845098\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        20,\n        940\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 509.931737588259,\n        \"height\": 433.74984757777247,\n        \"content\": \"## 第五步：跟进未完成的咨询\\n[详细了解如何使用计划触发器](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.scheduletrigger)\\n\\n该工作流程的后半部分旨在识别那些已与我们的聊天机器人互动但尚未确认预约的客户。我们计划发送一条跟进消息，询问咨询是否仍然有效，并鼓励客户进行预约。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4485e39a-3e84-49ee-9d3f-a271a98a330a\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1000,\n        940\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 567.1169284476533,\n        \"height\": 601.5572296901626,\n        \"content\": \"## 第七步：生成跟进消息\\n[了解更多基础LLM链](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm)\\n\\n当我们从Airtable中获取到会话记录和聊天历史后，只需让AI生成一封措辞得体的跟进消息，即可重新与客户建立联系。\\n\\n在逻辑线性的情况下，基础LLM链适用于多数工作流程。并非所有场景都需要使用代理！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f2d66e44-cf18-4e8f-80d5-e8d03e10e5ff\",\n      \"name\": \"Generate Follow Up Message\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        1140,\n        1200\n      ],\n      \"parameters\": {\n        \"text\": \"=\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"=You are an appointment scheduling assistant for PC and Laptop Repairs for a company called \\\"PC Parts Ltd\\\". You shall refer to yourself as the \\\"service team\\\". You had a conversation with a customer on {{ $json.last_message_at }} but the enquiry did not end with an appointment being scheduled.\\n{{ $json.last_followup_at ? `You last sent a follow-up message on ${$json.last_followup_at}` : '' }}.\\n\\nYou task is to ask if the prospective customer would like to continue with the enquiry using the following information gather to construct a relevant follow-up message. Try to entice the user to continue the conversation and ultimately schedule an appointment.\\n\\n## About the customer\\nname: {{ $json.customer_name ?? '<unknown>' }}\\nenquiry summary: {{ $json.customer_summary ?? '<uknown>' }}\\n\\n# Existing conversation\\nHere are the chat logs of the existing conversation:\\n{{ $json.chat_messages }}\"\n            }\n          ]\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.4\n    },\n    {\n      \"id\": \"0b93a300-b9ab-4c28-8ac0-fddc49247b74\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1600,\n        940\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 496.0833287715134,\n        \"height\": 526.084030034264,\n        \"content\": \"## 步骤8：更新跟进属性并发送消息\\n[详细了解如何使用Twilio](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.twilio/)\\n\\n最后，我们将更新Airtable客户记录中的跟进活动。记录跟进次数有助于避免不必要地骚扰客户。\\n\\n通过Twilio发送的跟进消息包含使用关键词STOP停止接收后续消息的指引。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0e022485-9504-416a-8632-edd65df29bf4\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -480,\n        -80\n      ],\n      \"parameters\": {\n        \"width\": 437.0019498737189,\n        \"height\": 511.67220311821393,\n        \"content\": \"## 试试看吧！\\n\\n### 本工作流实现了一个由AI工具代理驱动的预约安排聊天机器人\\n* 工作流由客户通过短信发送的咨询触发  \\n* 客户会话管理和聊天记录存储在Airtable中，以实现短信对话功能  \\n* AI助手可解答各类问题，并代表客户安排、改期或取消预约  \\n* 助手的回复会通过短信发送给客户  \\n* 还实现了跟进系统，可重新联系未预约的客户  \\n\\n### 需要帮助？\\n加入[Discord](https://discord.com/invite/XPKeKXeB7d)或在[论坛](https://community.n8n.io/)提问！\\n\\n祝您玩得愉快！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"04681629-0221-47fe-b992-0d5791995523\",\n      \"name\": \"OpenAI Chat Model3\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1120,\n        420\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4o-mini\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7633e3b0-daf3-495d-bcd7-ce0db24a73b9\",\n      \"name\": \"Get Availability\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1260,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cal.com/v2/slots/available\",\n        \"sendQuery\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"parametersQuery\": {\n          \"values\": [\n            {\n              \"name\": \"eventTypeId\",\n              \"value\": \"={{ 648297 }}\",\n              \"valueProvider\": \"fieldValue\"\n            },\n            {\n              \"name\": \"startTime\",\n              \"value\": \"{startTime}\",\n              \"valueProvider\": \"fieldValue\"\n            },\n            {\n              \"name\": \"endTime\",\n              \"value\": \"{endTime}\",\n              \"valueProvider\": \"fieldValue\"\n            }\n          ]\n        },\n        \"toolDescription\": \"Call this tool to get the appointment availability. Dates can be variable but times are fixed - startTime must always be 9am and endTime must be 7pm. Strictly use ISO format for dates eg. \\\"2024-01-01T09:00:00-00:00\\\". Input schema example: ```{ \\\"startTime\\\": \\\"...\\\", \\\"endTime\\\": \\\"...\\\"}```\",\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"startTime\",\n              \"type\": \"string\",\n              \"description\": \"start of daterange in ISO format. eg. 2024-01-01T09:00:00-00:00\"\n            },\n            {\n              \"name\": \"endTime\",\n              \"type\": \"string\",\n              \"description\": \"end of daterange in ISO format. eg. 2024-01-01T09:00:00-00:00\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"calApi\": {\n          \"id\": \"GPSKPrBhO3Pq6KVF\",\n          \"name\": \"Cal account\"\n        },\n        \"httpHeaderAuth\": {\n          \"id\": \"X2Vr2TQSBcOsOMst\",\n          \"name\": \"Cal.com API v2\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0f814d08-218e-492e-b1f8-63985d583e80\",\n      \"name\": \"Get Existing Booking\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1560,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cal.com/v2/bookings/{bookingUid}\",\n        \"sendHeaders\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"toolDescription\": \"Call this tool to get an existing booking using a booking \\\"uid\\\".\",\n        \"parametersHeaders\": {\n          \"values\": [\n            {\n              \"name\": \"cal-api-version\",\n              \"value\": \"2024-08-13\",\n              \"valueProvider\": \"fieldValue\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"calApi\",\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"bookingUid\",\n              \"type\": \"string\",\n              \"description\": \"the uid of the booking (note: this is not the same as the id of the booking)\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"calApi\": {\n          \"id\": \"GPSKPrBhO3Pq6KVF\",\n          \"name\": \"Cal account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"36a5a2a7-bb78-4091-8b25-5e9f49628542\",\n      \"name\": \"Find Existing Booking\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1700,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cal.com/v2/bookings\",\n        \"jsonQuery\": \"{\\n  \\\"status\\\": \\\"upcoming\\\",\\n  \\\"attendeeEmail\\\": \\\"{attendee_email}\\\",\\n  \\\"afterStart\\\": \\\"{date}\\\"\\n}\",\n        \"sendQuery\": true,\n        \"sendHeaders\": true,\n        \"specifyQuery\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"toolDescription\": \"Call this tool to search for an existing bookings with the user's email address and date. Use the \\\"uid\\\" field in the results as the primary booking identifier, ignore the \\\"id\\\" field.\",\n        \"parametersHeaders\": {\n          \"values\": [\n            {\n              \"name\": \"cal-api-version\",\n              \"value\": \"2024-08-13\",\n              \"valueProvider\": \"fieldValue\"\n            }\n          ]\n        },\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"attendee_email\",\n              \"type\": \"string\",\n              \"description\": \"email address of attendee\"\n            },\n            {\n              \"name\": \"date\",\n              \"description\": \"Filter bookings with start after this date string. The time is always fixed at 9am.\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"calApi\": {\n          \"id\": \"GPSKPrBhO3Pq6KVF\",\n          \"name\": \"Cal account\"\n        },\n        \"httpHeaderAuth\": {\n          \"id\": \"X2Vr2TQSBcOsOMst\",\n          \"name\": \"Cal.com API v2\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"88ee279d-ed85-4dc6-b42a-5e1e50f3d708\",\n      \"name\": \"Reschedule Booking\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1560,\n        620\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cal.com/v2/bookings/{bookingUid}/reschedule\",\n        \"method\": \"POST\",\n        \"jsonBody\": \"{\\n  \\\"start\\\": \\\"{start}\\\",\\n  \\\"reschedulingReason\\\": \\\"{reschedulingReason}\\\"\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"toolDescription\": \"Call this tool to reschedule a user's booking using a booking \\\"uid\\\".\",\n        \"parametersHeaders\": {\n          \"values\": [\n            {\n              \"name\": \"cal-api-version\",\n              \"value\": \"2024-08-13\",\n              \"valueProvider\": \"fieldValue\"\n            }\n          ]\n        },\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"bookingUid\",\n              \"type\": \"string\",\n              \"description\": \"the uid of the booking. Note this is not the same as the id of the booking.\"\n            },\n            {\n              \"name\": \"start\",\n              \"type\": \"string\",\n              \"description\": \"start datetime of the appointment, for example: \\\"2024-05-30T12:00:00.000Z\\\"\"\n            },\n            {\n              \"name\": \"reschedulingReason\",\n              \"type\": \"string\",\n              \"description\": \"Reason for rescheduling the booking. If not given, value is \\\"Declined to give reason.\\\"\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"calApi\": {\n          \"id\": \"GPSKPrBhO3Pq6KVF\",\n          \"name\": \"Cal account\"\n        },\n        \"httpHeaderAuth\": {\n          \"id\": \"X2Vr2TQSBcOsOMst\",\n          \"name\": \"Cal.com API v2\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ee30c793-d8f4-4e49-9bd1-70e5ac109b68\",\n      \"name\": \"Cancel Booking\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1700,\n        620\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cal.com/v2/bookings/{bookingUid}/cancel\",\n        \"method\": \"POST\",\n        \"jsonBody\": \"{\\n  \\\"cancellationReason\\\": \\\"{cancellationReason}\\\"\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"toolDescription\": \"Call this tool to cancel a user's existing booking using a booking \\\"uid\\\".\",\n        \"parametersHeaders\": {\n          \"values\": [\n            {\n              \"name\": \"cal-api-version\",\n              \"value\": \"2024-08-13\",\n              \"valueProvider\": \"fieldValue\"\n            }\n          ]\n        },\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"bookingUid\",\n              \"type\": \"string\",\n              \"description\": \"the uid of the booking. Note this is not the same as the id of the booking.\"\n            },\n            {\n              \"name\": \"cancellationReason\",\n              \"type\": \"string\",\n              \"description\": \"Reason for cancelling the appointment\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"calApi\": {\n          \"id\": \"GPSKPrBhO3Pq6KVF\",\n          \"name\": \"Cal account\"\n        },\n        \"httpHeaderAuth\": {\n          \"id\": \"X2Vr2TQSBcOsOMst\",\n          \"name\": \"Cal.com API v2\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d90aa957-30d7-4b29-93b9-acdc86f1cb17\",\n      \"name\": \"Create a Booking\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1400,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.cal.com/v2/bookings\",\n        \"method\": \"POST\",\n        \"jsonBody\": \"{\\n  \\\"eventTypeId\\\": 648297,\\n  \\\"start\\\": \\\"{start}\\\",\\n  \\\"attendee\\\": {\\n     \\\"name\\\": \\\"{attendee_name}\\\",\\n     \\\"email\\\": \\\"{attendee_email}\\\",\\n     \\\"timeZone\\\": \\\"{attendee_timezone}\\\"\\n  },\\n  \\\"bookingFieldsResponses\\\": {\\n    \\\"title\\\": \\\"{summary_of_enquiry}\\\"\\n  }\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"toolDescription\": \"Call this tool to create a booking. Strictly use ISO format for dates eg. \\\"2024-01-01T09:00:00-00:00\\\" for API compatibility.\",\n        \"parametersHeaders\": {\n          \"values\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\",\n              \"valueProvider\": \"fieldValue\"\n            },\n            {\n              \"name\": \"cal-api-version\",\n              \"value\": \"2024-08-13\",\n              \"valueProvider\": \"fieldValue\"\n            }\n          ]\n        },\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"start\",\n              \"type\": \"string\",\n              \"description\": \"The start time of the booking in ISO format. eg. \\\"2024-01-01T09:00:00Z\\\"\"\n            },\n            {\n              \"name\": \"attendee_name\",\n              \"type\": \"string\",\n              \"description\": \"Name of the attendee\"\n            },\n            {\n              \"name\": \"attendee_email\",\n              \"type\": \"string\",\n              \"description\": \"email of the attendee\"\n            },\n            {\n              \"name\": \"attendee_timezone\",\n              \"type\": \"string\",\n              \"description\": \"If timezone is unknown, assume Europe/London.\"\n            },\n            {\n              \"name\": \"summary_of_enquiry\",\n              \"type\": \"string\",\n              \"description\": \"short summary of the enquiry or purpose of the meeting\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"calApi\": {\n          \"id\": \"GPSKPrBhO3Pq6KVF\",\n          \"name\": \"Cal account\"\n        },\n        \"httpHeaderAuth\": {\n          \"id\": \"X2Vr2TQSBcOsOMst\",\n          \"name\": \"Cal.com API v2\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"dfcf00ca-8fe1-4517-b64f-fbb4606ab221\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        928.7527821891895,\n        600\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 261.1134437946252,\n        \"height\": 168.99242033383513,\n        \"content\": \"![alt](https://upload.wikimedia.org/wikipedia/commons/a/a5/Cal.com%2C_Inc._Logo.svg#100x80)\\n您需要为Cal.com API v2设置自定义Header Auth凭证。更多信息请参阅以下文档：https://cal.com/docs/api-reference/v2/introduction\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e743b324-ead2-47f8-87c9-2eb969305d4e\",\n      \"name\": \"Sticky Note12\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1220,\n        420\n      ],\n      \"parameters\": {\n        \"width\": 301.851426117099,\n        \"height\": 360.9218237282627,\n        \"content\": \"### 🚨 在此更改EventTypeID！\\n* EventTypeID必须为数字。\\n* 您设置的活动类型决定了允许的预约时长。\\n* 如果活动类型设为30分钟，而客服尝试预约60分钟，操作将会失败，因此请确保客服知晓应设置的预约时长！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f087e1a4-fffb-44da-afd6-a6277aef84b5\",\n      \"name\": \"Appointment Scheduling Agent1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        1220,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"systemMessage\": \"=You are an appointment scheduling helper for a company called \\\"PC Parts Ltd\\\". Customers will message you enquirying for PC or laptop repairs and your job is to schedule a repair session for the user.This role is strictly to help schedule appointments so:\\n* you may answer questions relating to the company, \\\"PC Parts Ltd\\\".\\n* you may not answer questions relating to competitors of \\\"PC Parts Ltd\\\".\\n* you may answer questions relating to general PC or laptop repair from a non-technical perspective.\\n* you may not help to customer diagnose or assist in troubleshoot or debugging thei r PC or laptop issues. If the customer does ask, defer them to book an appointment where a suitable professional from PC Parts Ltd can help.\\n* If an appointment is scheduled for the user then the conversation is completed and you should not continue to ask the user to schedule an appointment.\\n* If an appointment is scheduled for the user, the user may ask for the following actions: ask about details of the existing appointment, reschedule the existing appointment or cancel an existing appointment.\\n* If an appointment is scheduled for the user, the user cannot schedule another appointment until the existing appointment is cancelled.\\n\\n## About the company\\nPC Parts Ltd is based in London, UK. They offer to repair low-end to high-end PC and Laptop consumer and small business machines. They also offer custom built machines such as for gaming. There is currently a summer sale going on for 20% selected machines for repairs. The company does not repair other electronic devices such as phones, tablets or monitors.\\n\\n## About the appointments\\nAlways start your conversation by politely asking if the user wants to book a new appointment or enquire about an existing one. The date and time now is {{ $now.toISO() }}. All dates should be given in the ISO format. Each appointment should have a start and end date and time relative to today's date in the future and should be scheduled for 30 minutes.\\n\\n## To book an appointment\\n* Before booking an appointment, ask if the user has an existing appointment.\\n* Ensure you have the user's email address, full name and proposed date, preferred start time before booking an appointment.\\n* Always check the calendar availability of the user's proposed date and time. If there is no availability, suggest the next available appointment slot.\\n* If the appointment booking is successful, notify the user that an email confirmation will be sent to their provided email address.\\n* If the appointment booking is unsuccessful, notify the user that you are unable to complete their request at the moment and to try again later.\\n\\n## To find an existing appointment\\n* Ask the user for their email address and the date of the existing booking\\n* Use the user's email and date to search for the existing booking.\\n* If the user's email and date do not match the results or no results are returned, then the existing booking is not found.\\n* If the existing booking is not found, notify the user and suggest a new booking should be made.\\n* When the existing booking is found, ensure you tell them the booking's UID field.\\n\\n# To reschedule or cancel an existing appointment\\n* First find the existing appointment so that you may obtain the existing appointment's booking UID.\\n* Display this booking UID to the user.\\n* Use this booking UID to reschedule or cancel an existing appointment.\\n* If an existing appointment ID is not found or given, then notify the user that it is not possible to complete their request at this time and they should contact via email.\\n* when user wants to cancel an appointment, ask for a reason for the cancellation and suggest rescheduling as an alternative. Confirm with user before cancelling an appointment.\\n\\n## About the user\\n* The customer's session_id is \\\"{{ $('Twilio Trigger').item.json.From }}\\\"\\n{{\\n$json.chat_messages \\n  ? '* This is a returning prospective customer.' \\n  : '* This is a new customer. Ask for the details of their enquiry.'\\n}}\\n{{\\n$json.appointment_id \\n  ? `* The customer has already scheduled an appointment at ${$json.scheduled_at} and their appointment_id is ${$json.appointment_id}`\\n  : '* This customer has not scheduled an appointment yet.'\\n}}\\n\\n## Existing Conversation\\n{{\\n$json.chat_messages\\n  ? 'Here are the existing chat logs and should be used as context to continue the conversation:\\\\n```\\\\n' + JSON.parse($json.chat_messages).map(item => `${item.role}: ${item.message.replaceAll('\\\\n', ' ')}`).join('\\\\n') + '\\\\n```'\\n  : '* There is no existing conversation so far.'\\n}}\\n\"\n        },\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.6\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Every 24hrs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Find Follow-Up Candidates\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Cancel Booking\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Twilio Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check For Command  Words\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create a Booking\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Availability\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"User Request STOP\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Confirmation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Generate Follow Up Message\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model2\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Auto-fixing Output Parser\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model3\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Reschedule Booking\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Existing Booking\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create/Update Session\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Reply\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find Existing Booking\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check For Command  Words\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"User Request STOP\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get Existing Chat Session\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Auto-fixing Output Parser\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Auto-fixing Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find Follow-Up Candidates\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Follow Up Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Existing Chat Session\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Appointment Scheduling Agent1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Generate Follow Up Message\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Follow-Up Count and Date\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Appointment Scheduling Agent1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create/Update Session\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update Follow-Up Count and Date\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Follow Up Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
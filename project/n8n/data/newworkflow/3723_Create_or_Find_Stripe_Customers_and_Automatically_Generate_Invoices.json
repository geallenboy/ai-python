{
  "url": "https://n8n.io/workflows/3723-create-or-find-stripe-customers-and-automatically-generate-invoices/",
  "title": "Create or Find Stripe Customers and Automatically Generate Invoices",
  "author": "Audun",
  "publish_date": "Last update a month ago",
  "publish_date_absolute": "",
  "categories": [
    {
      "name": "Finance"
    },
    {
      "name": "IT Ops"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"568298fde06d3db80a2eea77fe5bf45f0c7bb898dea20b769944e9ac7c6c5a80\"},\"nodes\":[{\"id\":\"6f5abd7f-51a7-488f-9fdc-0dc7b9b94b45\",\"name\":\"Get Stripe Customer\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-460,100],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"3e000064-f370-4229-a46c-eb93ab34cfae\",\"name\":\"Customer exists?\",\"type\":\"n8n-nodes-base.if\",\"position\":[-260,100],\"parameters\":{},\"typeVersion\":2.2},{\"id\":\"82014597-3859-4762-a9b3-10e1e9d9aeda\",\"name\":\"Create customer\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[0,200],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"0f95b863-e1f7-4732-9e9d-3e3c2deae76b\",\"name\":\"Create invoice\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[280,100],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"abcdc761-c7d2-4eaf-8cbd-c4fe80cc47ad\",\"name\":\"Finalize invoice\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[700,100],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"a90c9731-8fea-4037-a6c4-04bc52ad4eac\",\"name\":\"When clicking ‘Test workflow’\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[-860,100],\"parameters\":{},\"typeVersion\":1},{\"id\":\"5a3478f0-a0d3-493f-9420-126cbcde535d\",\"name\":\"Set invoice data\",\"type\":\"n8n-nodes-base.set\",\"position\":[-660,100],\"parameters\":{},\"typeVersion\":3.4},{\"id\":\"eb49ed91-bd3b-4752-8932-327457c6ae72\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1480,-40],\"parameters\":{\"content\":\"\"},\"typeVersion\":1},{\"id\":\"923b2c54-eeb8-4605-b0fd-fc24939f11ff\",\"name\":\"Set customer id\",\"type\":\"n8n-nodes-base.set\",\"position\":[0,0],\"parameters\":{},\"typeVersion\":3.4},{\"id\":\"250a7a35-2079-45fc-b192-dd8a012bbb97\",\"name\":\"Add item to invoice\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[500,100],\"parameters\":{},\"typeVersion\":4.2}],\"pinData\":{},\"connections\":{\"Create invoice\":{\"main\":[[{\"node\":\"Add item to invoice\",\"type\":\"main\",\"index\":0}]]},\"Create customer\":{\"main\":[[{\"node\":\"Create invoice\",\"type\":\"main\",\"index\":0}]]},\"Set customer id\":{\"main\":[[{\"node\":\"Create invoice\",\"type\":\"main\",\"index\":0}]]},\"Customer exists?\":{\"main\":[[{\"node\":\"Set customer id\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Create customer\",\"type\":\"main\",\"index\":0}]]},\"Set invoice data\":{\"main\":[[{\"node\":\"Get Stripe Customer\",\"type\":\"main\",\"index\":0}]]},\"Add item to invoice\":{\"main\":[[{\"node\":\"Finalize invoice\",\"type\":\"main\",\"index\":0}]]},\"Get Stripe Customer\":{\"main\":[[{\"node\":\"Customer exists?\",\"type\":\"main\",\"index\":0}]]},\"When clicking ‘Test workflow’\":{\"main\":[[{\"node\":\"Set invoice data\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "Save hours of manual billing work with this Stripe automation workflow!  \nDesigned for entrepreneurs, SaaS founders, and online business owners, this template checks if a customer already exists in Stripe based on their email. If no customer is found, it automatically creates a new one, generates a draft invoice, adds a product line item using a Stripe Price ID, and finalizes the invoice — making it ready for payment.  \nThis workflow helps ensure clean customer data and efficient billing without manual input.\n\n### How it works\n\n  * Search Stripe for an existing customer based on the provided email address.\n  * If no customer is found, create a new one in Stripe automatically.\n  * Generate a draft invoice associated with the customer.\n  * Add a line item to the invoice using a Stripe Price ID.\n  * Finalize the invoice to make it ready to send or collect payment.\n\n\n\n### Set up steps\n\n  1. **Stripe account setup** :\n\n     * Ensure you have a valid Stripe account.\n     * Create a **restricted Stripe API key** with permissions to `read` and `write` Customers, Invoices, and Invoice Items.\n  2. **Connect Stripe to n8n** :\n\n     * Set up an HTTP Basic Auth credential in n8n using your Stripe secret API key.\n     * No username is needed; the API key goes into the password field.\n  3. **Customize dynamic data** :\n\n     * Replace the sample email (`test@example.com`) with your real dynamic customer email input.\n     * Replace the example Price ID (`price_fromStripeDashboard`) with your actual product Price ID from the Stripe dashboard.\n  4. **Test your workflow** :\n\n     * Manually trigger the workflow inside n8n to ensure customers and invoices are being created correctly.\n     * Check your Stripe dashboard to confirm that new customers and invoices appear as expected.\n  5. **Deploy to production** :\n\n     * Integrate this workflow with a real trigger (e.g., webhook, form submission) to automate the process live.\n\n\n\n### Troubleshooting\n\n  * **Invalid API Key** :  \nDouble-check that your Stripe API key is active and has the necessary permissions. Test it by making a simple API call manually if needed.\n\n  * **Invoice Creation Fails** :  \nMake sure you are using a valid `Price ID` from Stripe. The price must be active and available for the correct product.\n\n  * **Customer Not Found Error** :  \nIf the search fails due to formatting issues, ensure emails are valid and the query syntax matches Stripe's customer search format.\n\n  * **Authentication Errors** :  \nIf authentication fails, ensure you have selected **HTTP Basic Auth** in the HTTP Request nodes and left the username field empty.\n\n\n\n\n### Stripe prerequisites\n\n  * You must have at least one active Price object created in your Stripe dashboard.\n  * Your Stripe account must be live or have access to test mode if you're working in development.\n  * Ensure your account has API access enabled for Customers, Invoices, and Products.\n\n\n",
  "crawled_at": "2025-05-26T05:25:17.121810",
  "readme_zh": "Save hours of manual billing work with this Stripe automation workflow!  \nDesigned for entrepreneurs, SaaS founders, and online business owners, this template checks if a customer already exists in Stripe based on their email. If no customer is found, it automatically creates a new one, generates a draft invoice, adds a product line item using a Stripe Price ID, and finalizes the invoice — making it ready for payment.  \nThis workflow helps ensure clean customer data and efficient billing without manual input.\n\n### How it works\n\n  * Search Stripe for an existing customer based on the provided email address.\n  * If no customer is found, create a new one in Stripe automatically.\n  * Generate a draft invoice associated with the customer.\n  * Add a line item to the invoice using a Stripe Price ID.\n  * Finalize the invoice to make it ready to send or collect payment.\n\n\n\n### Set up steps\n\n  1. **Stripe account setup** :\n\n     * Ensure you have a valid Stripe account.\n     * Create a **restricted Stripe API key** with permissions to `read` and `write` Customers, Invoices, and Invoice Items.\n  2. **Connect Stripe to n8n** :\n\n     * Set up an HTTP Basic Auth credential in n8n using your Stripe secret API key.\n     * No username is needed; the API key goes into the password field.\n  3. **Customize dynamic data** :\n\n     * Replace the sample email (`test@example.com`) with your real dynamic customer email input.\n     * Replace the example Price ID (`price_fromStripeDashboard`) with your actual product Price ID from the Stripe dashboard.\n  4. **Test your workflow** :\n\n     * Manually trigger the workflow inside n8n to ensure customers and invoices are being created correctly.\n     * Check your Stripe dashboard to confirm that new customers and invoices appear as expected.\n  5. **Deploy to production** :\n\n     * Integrate this workflow with a real trigger (e.g., webhook, form submission) to automate the process live.\n\n\n\n### Troubleshooting\n\n  * **Invalid API Key** :  \nDouble-check that your Stripe API key is active and has the necessary permissions. Test it by making a simple API call manually if needed.\n\n  * **Invoice Creation Fails** :  \nMake sure you are using a valid `Price ID` from Stripe. The price must be active and available for the correct product.\n\n  * **Customer Not Found Error** :  \nIf the search fails due to formatting issues, ensure emails are valid and the query syntax matches Stripe's customer search format.\n\n  * **Authentication Errors** :  \nIf authentication fails, ensure you have selected **HTTP Basic Auth** in the HTTP Request nodes and left the username field empty.\n\n\n\n\n### Stripe prerequisites\n\n  * You must have at least one active Price object created in your Stripe dashboard.\n  * Your Stripe account must be live or have access to test mode if you're working in development.\n  * Ensure your account has API access enabled for Customers, Invoices, and Products.\n\n\n",
  "title_zh": "创建或查找Stripe客户并自动生成发票",
  "publish_date_zh": "上次更新于8天前",
  "workflow_json_zh": "{\"meta\":{\"instanceId\":\"568298fde06d3db80a2eea77fe5bf45f0c7bb898dea20b769944e9ac7c6c5a80\"},\"nodes\":[{\"id\":\"6f5abd7f-51a7-488f-9fdc-0dc7b9b94b45\",\"name\":\"Get Stripe Customer\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-460,100],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"3e000064-f370-4229-a46c-eb93ab34cfae\",\"name\":\"Customer exists?\",\"type\":\"n8n-nodes-base.if\",\"position\":[-260,100],\"parameters\":{},\"typeVersion\":2.2},{\"id\":\"82014597-3859-4762-a9b3-10e1e9d9aeda\",\"name\":\"Create customer\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[0,200],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"0f95b863-e1f7-4732-9e9d-3e3c2deae76b\",\"name\":\"Create invoice\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[280,100],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"abcdc761-c7d2-4eaf-8cbd-c4fe80cc47ad\",\"name\":\"Finalize invoice\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[700,100],\"parameters\":{},\"typeVersion\":4.2},{\"id\":\"a90c9731-8fea-4037-a6c4-04bc52ad4eac\",\"name\":\"When clicking ‘Test workflow’\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[-860,100],\"parameters\":{},\"typeVersion\":1},{\"id\":\"5a3478f0-a0d3-493f-9420-126cbcde535d\",\"name\":\"Set invoice data\",\"type\":\"n8n-nodes-base.set\",\"position\":[-660,100],\"parameters\":{},\"typeVersion\":3.4},{\"id\":\"eb49ed91-bd3b-4752-8932-327457c6ae72\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1480,-40],\"parameters\":{\"content\":\"\"},\"typeVersion\":1},{\"id\":\"923b2c54-eeb8-4605-b0fd-fc24939f11ff\",\"name\":\"Set customer id\",\"type\":\"n8n-nodes-base.set\",\"position\":[0,0],\"parameters\":{},\"typeVersion\":3.4},{\"id\":\"250a7a35-2079-45fc-b192-dd8a012bbb97\",\"name\":\"Add item to invoice\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[500,100],\"parameters\":{},\"typeVersion\":4.2}],\"pinData\":{},\"connections\":{\"Create invoice\":{\"main\":[[{\"node\":\"Add item to invoice\",\"type\":\"main\",\"index\":0}]]},\"Create customer\":{\"main\":[[{\"node\":\"Create invoice\",\"type\":\"main\",\"index\":0}]]},\"Set customer id\":{\"main\":[[{\"node\":\"Create invoice\",\"type\":\"main\",\"index\":0}]]},\"Customer exists?\":{\"main\":[[{\"node\":\"Set customer id\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Create customer\",\"type\":\"main\",\"index\":0}]]},\"Set invoice data\":{\"main\":[[{\"node\":\"Get Stripe Customer\",\"type\":\"main\",\"index\":0}]]},\"Add item to invoice\":{\"main\":[[{\"node\":\"Finalize invoice\",\"type\":\"main\",\"index\":0}]]},\"Get Stripe Customer\":{\"main\":[[{\"node\":\"Customer exists?\",\"type\":\"main\",\"index\":0}]]},\"When clicking ‘Test workflow’\":{\"main\":[[{\"node\":\"Set invoice data\",\"type\":\"main\",\"index\":0}]]}}}"
}
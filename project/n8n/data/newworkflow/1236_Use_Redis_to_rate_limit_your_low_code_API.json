{
  "url": "https://n8n.io/workflows/1236-use-redis-to-rate-limit-your-low-code-api/",
  "title": "Use Redis to rate-limit your low-code API",
  "author": "Harshil Agrawal",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-26",
  "categories": [
    {
      "name": "Engineering"
    },
    {
      "name": "IT Ops"
    }
  ],
  "workflow_json": "{\"nodes\":[{\"name\":\"Airtable\",\"type\":\"n8n-nodes-base.airtable\",\"position\":[1650,300],\"parameters\":{\"table\":\"Pokemon\",\"operation\":\"list\",\"additionalOptions\":{}},\"credentials\":{\"airtableApi\":\"Airtable Credentials @n8n\"},\"typeVersion\":1},{\"name\":\"Redis\",\"type\":\"n8n-nodes-base.redis\",\"position\":[600,600],\"parameters\":{\"key\":\"={{$json[\\\"apiKey\\\"]}}\",\"ttl\":3600,\"expire\":true,\"operation\":\"incr\"},\"credentials\":{\"redis\":\"Redis Cloud Credentials\"},\"typeVersion\":1},{\"name\":\"Redis1\",\"type\":\"n8n-nodes-base.redis\",\"position\":[1200,450],\"parameters\":{\"key\":\"={{$json[\\\"apiKey\\\"]}}\",\"operation\":\"incr\"},\"credentials\":{\"redis\":\"Redis Cloud Credentials\"},\"typeVersion\":1},{\"name\":\"Set1\",\"type\":\"n8n-nodes-base.set\",\"position\":[1600,550],\"parameters\":{\"values\":{\"string\":[{\"name\":\"message\",\"value\":\"You exceeded your limit\"}]},\"options\":{},\"keepOnlySet\":true},\"typeVersion\":1},{\"name\":\"Webhook1\",\"type\":\"n8n-nodes-base.webhook\",\"position\":[200,600],\"webhookId\":\"a3167ed7-98d2-422c-bfe2-e3ba599d19f1\",\"parameters\":{\"path\":\"a3167ed7-98d2-422c-bfe2-e3ba599d19f1\",\"options\":{},\"responseMode\":\"lastNode\",\"authentication\":\"headerAuth\"},\"credentials\":{\"httpHeaderAuth\":\"Credential Example\"},\"typeVersion\":1},{\"name\":\"Function\",\"type\":\"n8n-nodes-base.function\",\"position\":[1900,300],\"parameters\":{\"functionCode\":\" const limit = `Limit consumed: `+ $node['Redis1'].json[$node[\\\"Set2\\\"].json[\\\"apiKey\\\"]];\\n return [\\n  {\\n    json: {\\n      message:limit,\\n      body: items.map(item => {\\n        const name= item.json.fields.name\\n        const url= item.json.fields.url\\n        return {name,url}\\n      })\\n    }\\n  }\\n]\\n\"},\"typeVersion\":1},{\"name\":\"Set\",\"type\":\"n8n-nodes-base.set\",\"position\":[400,600],\"parameters\":{\"values\":{\"string\":[{\"name\":\"apiKey\",\"value\":\"={{$json[\\\"headers\\\"][\\\"x-api-key\\\"] +'-'+ new Date().getHours() +'-'+ new Date().getMinutes()}}\"}]},\"options\":{},\"keepOnlySet\":true},\"typeVersion\":1},{\"name\":\"Set2\",\"type\":\"n8n-nodes-base.set\",\"position\":[1000,450],\"parameters\":{\"values\":{\"string\":[{\"name\":\"apiKey\",\"value\":\"={{$node['Webhook1'].json[\\\"headers\\\"][\\\"x-api-key\\\"] +'-'+ new Date().getHours()}}\"}]},\"options\":{},\"keepOnlySet\":true},\"typeVersion\":1},{\"name\":\"Set3\",\"type\":\"n8n-nodes-base.set\",\"position\":[1000,700],\"parameters\":{\"values\":{\"string\":[{\"name\":\"message\",\"value\":\"You exceeded your limit\"}]},\"options\":{},\"keepOnlySet\":true},\"typeVersion\":1},{\"name\":\"Per hour\",\"type\":\"n8n-nodes-base.if\",\"position\":[1400,450],\"parameters\":{\"conditions\":{\"number\":[{\"value1\":\"={{$json[$node[\\\"Set2\\\"].json[\\\"apiKey\\\"]]}}\",\"value2\":60}],\"string\":[]}},\"typeVersion\":1},{\"name\":\"Per minute\",\"type\":\"n8n-nodes-base.if\",\"position\":[800,600],\"parameters\":{\"conditions\":{\"number\":[{\"value1\":\"={{$json[$node[\\\"Set\\\"].json[\\\"apiKey\\\"]]}}\",\"value2\":10,\"operation\":\"smallerEqual\"}]}},\"typeVersion\":1}],\"connections\":{\"Set\":{\"main\":[[{\"node\":\"Redis\",\"type\":\"main\",\"index\":0}]]},\"Set2\":{\"main\":[[{\"node\":\"Redis1\",\"type\":\"main\",\"index\":0}]]},\"Redis\":{\"main\":[[{\"node\":\"Per minute\",\"type\":\"main\",\"index\":0}]]},\"Redis1\":{\"main\":[[{\"node\":\"Per hour\",\"type\":\"main\",\"index\":0}]]},\"Airtable\":{\"main\":[[{\"node\":\"Function\",\"type\":\"main\",\"index\":0}]]},\"Per hour\":{\"main\":[[{\"node\":\"Airtable\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Set1\",\"type\":\"main\",\"index\":0}]]},\"Webhook1\":{\"main\":[[{\"node\":\"Set\",\"type\":\"main\",\"index\":0}]]},\"Per minute\":{\"main\":[[{\"node\":\"Set2\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Set3\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow demonstrates how to can use Redis to implement rate limits to your API.\n\nThe workflow uses the incoming API key to uniquely identify the user and use it as a key in Redis. Every time a request is made, the value is incremented by one, and we check for the threshold using the IF node.\n\nDuplicate the following Airtable to try out the workflow: <https://airtable.com/shraudfG9XAvqkBpF>\n",
  "crawled_at": "2025-05-26T07:41:03.750620",
  "readme_zh": "本工作流程展示了如何利用Redis为API实现速率限制功能。\n\n该流程通过传入的API密钥唯一标识用户，并将其作为Redis中的键值。每次请求时，对应数值会递增1，我们通过IF节点检查是否达到阈值限制。\n\n复制以下Airtable模板即可体验该工作流程：<https://airtable.com/shraudfG9XAvqkBpF>",
  "title_zh": "使用Redis为你的低代码API实施速率限制",
  "publish_date_zh": "最后更新于9个月前",
  "workflow_json_zh": "{\n  \"nodes\": [\n    {\n      \"name\": \"Airtable\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        1650,\n        300\n      ],\n      \"parameters\": {\n        \"table\": \"Pokemon\",\n        \"operation\": \"list\",\n        \"additionalOptions\": {}\n      },\n      \"credentials\": {\n        \"airtableApi\": \"Airtable Credentials @n8n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Redis\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        600,\n        600\n      ],\n      \"parameters\": {\n        \"key\": \"={{$json[\\\"apiKey\\\"]}}\",\n        \"ttl\": 3600,\n        \"expire\": true,\n        \"operation\": \"incr\"\n      },\n      \"credentials\": {\n        \"redis\": \"Redis Cloud Credentials\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Redis1\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        1200,\n        450\n      ],\n      \"parameters\": {\n        \"key\": \"={{$json[\\\"apiKey\\\"]}}\",\n        \"operation\": \"incr\"\n      },\n      \"credentials\": {\n        \"redis\": \"Redis Cloud Credentials\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1600,\n        550\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"message\",\n              \"value\": \"You exceeded your limit\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Webhook1\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        200,\n        600\n      ],\n      \"webhookId\": \"a3167ed7-98d2-422c-bfe2-e3ba599d19f1\",\n      \"parameters\": {\n        \"path\": \"a3167ed7-98d2-422c-bfe2-e3ba599d19f1\",\n        \"options\": {},\n        \"responseMode\": \"lastNode\",\n        \"authentication\": \"headerAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": \"Credential Example\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Function\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1900,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \" const limit = `Limit consumed: `+ $node['Redis1'].json[$node[\\\"Set2\\\"].json[\\\"apiKey\\\"]];\\n return [\\n  {\\n    json: {\\n      message:limit,\\n      body: items.map(item => {\\n        const name= item.json.fields.name\\n        const url= item.json.fields.url\\n        return {name,url}\\n      })\\n    }\\n  }\\n]\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        400,\n        600\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"apiKey\",\n              \"value\": \"={{$json[\\\"headers\\\"][\\\"x-api-key\\\"] +'-'+ new Date().getHours() +'-'+ new Date().getMinutes()}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set2\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1000,\n        450\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"apiKey\",\n              \"value\": \"={{$node['Webhook1'].json[\\\"headers\\\"][\\\"x-api-key\\\"] +'-'+ new Date().getHours()}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set3\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1000,\n        700\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"message\",\n              \"value\": \"You exceeded your limit\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Per hour\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1400,\n        450\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{$json[$node[\\\"Set2\\\"].json[\\\"apiKey\\\"]]}}\",\n              \"value2\": 60\n            }\n          ],\n          \"string\": []\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Per minute\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        800,\n        600\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{$json[$node[\\\"Set\\\"].json[\\\"apiKey\\\"]]}}\",\n              \"value2\": 10,\n              \"operation\": \"smallerEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Set\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Redis\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Redis1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Redis\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Per minute\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Redis1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Per hour\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Airtable\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Function\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Per hour\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Airtable\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Per minute\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
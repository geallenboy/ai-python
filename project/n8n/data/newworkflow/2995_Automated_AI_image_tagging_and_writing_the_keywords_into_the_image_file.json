{
  "url": "https://n8n.io/workflows/2995-automated-ai-image-tagging-and-writing-the-keywords-into-the-image-file/",
  "title": "Automated AI image tagging and writing the keywords into the image file",
  "author": "Friedemann Schuetz",
  "publish_date": "Last update 3 months ago",
  "publish_date_absolute": "2025-02-26",
  "categories": [
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"id\":\"XbawQw3cvClu2wsx\",\"meta\":{\"instanceId\":\"1acdaec6c8e84424b4715cf41a9f7ec057947452db21cd2e22afbc454c8711cd\",\"templateCredsSetupCompleted\":true},\"name\":\"Automated Image Metadata Tagging\",\"tags\":[],\"nodes\":[{\"id\":\"cd1dba71-345b-45ae-8110-4fb57291f363\",\"name\":\"Extract from File\",\"type\":\"n8n-nodes-base.extractFromFile\",\"position\":[260,180],\"parameters\":{\"options\":{},\"operation\":\"binaryToPropery\"},\"typeVersion\":1},{\"id\":\"7973b64e-ae92-44c9-aa8e-002c32c25def\",\"name\":\"Convert to File\",\"type\":\"n8n-nodes-base.convertToFile\",\"position\":[920,80],\"parameters\":{\"options\":{},\"operation\":\"toBinary\",\"sourceProperty\":\"data\"},\"typeVersion\":1.1},{\"id\":\"5fe13d4e-566b-459f-8830-f16829a34284\",\"name\":\"Analyze Image Content\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[260,-40],\"parameters\":{\"text\":\"=Deliver a comma seperated list describing the content of this image.\",\"modelId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"chatgpt-4o-latest\",\"cachedResultName\":\"CHATGPT-4O-LATEST\"},\"options\":{},\"resource\":\"image\",\"inputType\":\"base64\",\"operation\":\"analyze\"},\"credentials\":{\"openAiApi\":{\"id\":\"EjchNb5GBqYh0Cqn\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.8},{\"id\":\"876db6b5-6615-4e9d-8e1a-2d8220b2019f\",\"name\":\"Download Image File\",\"type\":\"n8n-nodes-base.googleDrive\",\"position\":[-20,60],\"parameters\":{\"fileId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $json.id }}\"},\"options\":{},\"operation\":\"download\"},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"s8l3OOBediUA645k\",\"name\":\"Google Drive account\"}},\"typeVersion\":3},{\"id\":\"47b32ddb-1929-4855-9131-078b562b3492\",\"name\":\"Trigger: New file added to Google Drive Folder\",\"type\":\"n8n-nodes-base.googleDriveTrigger\",\"position\":[-220,60],\"parameters\":{\"event\":\"fileCreated\",\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]},\"triggerOn\":\"specificFolder\",\"folderToWatch\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1WaIRWXcaeNViKmpW5IyQ3YGARWYdMg47\",\"cachedResultUrl\":\"https://drive.google.com/drive/folders/1WaIRWXcaeNViKmpW5IyQ3YGARWYdMg47\",\"cachedResultName\":\"EXIF\"}},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"s8l3OOBediUA645k\",\"name\":\"Google Drive account\"}},\"typeVersion\":1},{\"id\":\"85c6458a-7b2a-4eef-bf28-3b784e45f562\",\"name\":\"Write Metadata to Base64 Code\",\"type\":\"n8n-nodes-base.code\",\"position\":[720,80],\"parameters\":{\"jsCode\":\"const tags = items[0].json.content.split(', ');\\n\\nconst xmpData = `<?xpacket begin=\\\"﻿\\\" id=\\\"W5M0MpCehiHzreSzNTczkc9d\\\"?>\\n<x:xmpmeta xmlns:x=\\\"adobe:ns:meta/\\\" x:xmptk=\\\"XMP Core 5.1.2\\\">\\n    <rdf:RDF xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\">\\n        <rdf:Description rdf:about=\\\"\\\"\\n            xmlns:dc=\\\"http://purl.org/dc/elements/1.1/\\\"\\n            xmlns:xmp=\\\"http://ns.adobe.com/xap/1.0/\\\"\\n            xmlns:photoshop=\\\"http://ns.adobe.com/photoshop/1.0/\\\">\\n            <dc:creator></dc:creator>\\n            <dc:subject>\\n                <rdf:Bag>\\n                    ${tags.map(tag => `<rdf:li>${tag}</rdf:li>`).join('\\\\n                    ')}\\n                </rdf:Bag>\\n            </dc:subject>\\n            <xmp:CreateDate>${new Date().toISOString()}</xmp:CreateDate>\\n        </rdf:Description>\\n    </rdf:RDF>\\n</x:xmpmeta>\\n<?xpacket end=\\\"w\\\"?>`;\\n\\nconst xmpHeader = Buffer.from([\\n    0xFF, 0xE1,\\n    0x00, 0x00,\\n    0x68, 0x74, 0x74, 0x70, 0x3A, 0x2F, 0x2F, 0x6E, 0x73, 0x2E,\\n    0x61, 0x64, 0x6F, 0x62, 0x65, 0x2E, 0x63, 0x6F, 0x6D, 0x2F,\\n    0x78, 0x61, 0x70, 0x2F, 0x31, 0x2E, 0x30, 0x2F, 0x00\\n]);\\n\\nconst xmpBuffer = Buffer.from(xmpData, 'utf8');\\nconst imageBuffer = Buffer.from(items[0].json.data, 'base64');\\nconst length = xmpHeader.length + xmpBuffer.length - 2;\\nxmpHeader[2] = (length >> 8) & 0xFF;\\nxmpHeader[3] = length & 0xFF;\\n\\nconst newImageData = Buffer.concat([\\n    imageBuffer.slice(0, 2),\\n    xmpHeader,\\n    xmpBuffer,\\n    imageBuffer.slice(2)\\n]);\\n\\nitems[0].json.data = newImageData.toString('base64');\\n\\nreturn items;\"},\"typeVersion\":2,\"alwaysOutputData\":true},{\"id\":\"1b86cadf-9f46-4980-a923-00577bfc59f4\",\"name\":\"Update Image File\",\"type\":\"n8n-nodes-base.googleDrive\",\"position\":[1120,80],\"parameters\":{\"fileId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Download Image File').item.json.id }}\"},\"options\":{},\"operation\":\"update\",\"changeFileContent\":true,\"newUpdatedFileName\":\"={{ $('Download Image File').item.json.name }}\"},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"s8l3OOBediUA645k\",\"name\":\"Google Drive account\"}},\"typeVersion\":3},{\"id\":\"10c97623-80b1-4e96-b5c5-243ef106b2e9\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-540,240],\"parameters\":{\"width\":660,\"height\":680,\"content\":\"# Welcome to my Automated Image Metadata Tagging Workflow!\\n\\nThis workflow automatically analyzes the image content with the help of AI and writes it directly back into the image file as keywords.\\n\\n## This workflow has the following sequence:\\n\\n1. Google Drive trigger (scan for new files added in a specific folder)\\n2. Download the added image file\\n3. Analyse the content of the image and extract the file as Base64 code\\n4. Merge Metadata and Base64 Code\\n5. Code Node to write the Keywords into the Metadata (dc:subject)\\n6. Convert to file and update the original file in the Google Drive folder\\n\\n## The following accesses are required for the workflow:\\n- Google Drive: [Documentation](https://docs.n8n.io/integrations/builtin/credentials/google)\\n- AI API access (e.g. via OpenAI, Anthropic, Google or Ollama)\\n\\nYou can contact me via LinkedIn, if you have any questions: https://www.linkedin.com/in/friedemann-schuetz\"},\"typeVersion\":1},{\"id\":\"d2bb1007-018d-4c6a-a458-ff8e79b6017c\",\"name\":\"Merge Metadata and Base64 Code\",\"type\":\"n8n-nodes-base.merge\",\"position\":[520,80],\"parameters\":{\"mode\":\"combine\",\"options\":{},\"combineBy\":\"combineByPosition\"},\"typeVersion\":3}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"46b58de4-da62-43a2-bb10-fc85ffb75115\",\"connections\":{\"Convert to File\":{\"main\":[[{\"node\":\"Update Image File\",\"type\":\"main\",\"index\":0}]]},\"Extract from File\":{\"main\":[[{\"node\":\"Merge Metadata and Base64 Code\",\"type\":\"main\",\"index\":1}]]},\"Download Image File\":{\"main\":[[{\"node\":\"Analyze Image Content\",\"type\":\"main\",\"index\":0},{\"node\":\"Extract from File\",\"type\":\"main\",\"index\":0}]]},\"Analyze Image Content\":{\"main\":[[{\"node\":\"Merge Metadata and Base64 Code\",\"type\":\"main\",\"index\":0}]]},\"Write Metadata to Base64 Code\":{\"main\":[[{\"node\":\"Convert to File\",\"type\":\"main\",\"index\":0}]]},\"Merge Metadata and Base64 Code\":{\"main\":[[{\"node\":\"Write Metadata to Base64 Code\",\"type\":\"main\",\"index\":0}]]},\"Trigger: New file added to Google Drive Folder\":{\"main\":[[{\"node\":\"Download Image File\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "# Welcome to my Automated Image Metadata Tagging Workflow!\n\nThis workflow automatically analyzes the image content with the help of AI and writes it directly back into the image file as keywords.\n\n## This workflow has the following sequence:\n\n  1. Google Drive trigger (scan for new files added in a specific folder)\n  2. Download the added image file\n  3. Analyse the content of the image and extract the file as Base64 code\n  4. Merge Metadata and Base64 Code\n  5. Code Node to write the Keywords into the Metadata (dc:subject)\n  6. Convert to file and update the original file in the Google Drive folder\n\n\n\n## The following accesses are required for the workflow:\n\n  * Google Drive: [Documentation](https://docs.n8n.io/integrations/builtin/credentials/google)\n  * AI API access (e.g. via OpenAI, Anthropic, Google or Ollama)\n\n\n\nYou can contact me via LinkedIn, if you have any questions: <https://www.linkedin.com/in/friedemann-schuetz>\n",
  "crawled_at": "2025-05-26T03:26:54.781158",
  "readme_zh": "# 欢迎使用我的自动化图像元数据标记工作流！\n\n本工作流借助AI技术自动分析图像内容，并将分析结果作为关键词直接回写入图像文件。\n\n## 工作流执行流程如下：\n\n  1. Google Drive触发器（扫描特定文件夹内新增文件）\n  2. 下载新增的图像文件\n  3. 分析图像内容并提取Base64编码\n  4. 合并元数据与Base64编码\n  5. 通过代码节点将关键词写入元数据（dc:subject字段）\n  6. 转换为文件并更新GoogleDrive文件夹中的原始文件\n\n## 本工作流需要以下访问权限：\n\n  * Google Drive：[授权文档](https://docs.n8n.io/integrations/builtin/credentials/google)\n  * AI API访问权限（可通过OpenAI/Anthropic/Google或Ollama等平台获取）\n\n如有疑问，欢迎通过LinkedIn联系我：<https://www.linkedin.com/in/friedemann-schuetz>",
  "title_zh": "自动AI图像标记并将关键词写入图像文件",
  "publish_date_zh": "最后更新于2个月前",
  "workflow_json_zh": "{\n  \"id\": \"XbawQw3cvClu2wsx\",\n  \"meta\": {\n    \"instanceId\": \"1acdaec6c8e84424b4715cf41a9f7ec057947452db21cd2e22afbc454c8711cd\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Automated Image Metadata Tagging\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"cd1dba71-345b-45ae-8110-4fb57291f363\",\n      \"name\": \"Extract from File\",\n      \"type\": \"n8n-nodes-base.extractFromFile\",\n      \"position\": [\n        260,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"binaryToPropery\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7973b64e-ae92-44c9-aa8e-002c32c25def\",\n      \"name\": \"Convert to File\",\n      \"type\": \"n8n-nodes-base.convertToFile\",\n      \"position\": [\n        920,\n        80\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"toBinary\",\n        \"sourceProperty\": \"data\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"5fe13d4e-566b-459f-8830-f16829a34284\",\n      \"name\": \"Analyze Image Content\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"position\": [\n        260,\n        -40\n      ],\n      \"parameters\": {\n        \"text\": \"=Deliver a comma seperated list describing the content of this image.\",\n        \"modelId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"chatgpt-4o-latest\",\n          \"cachedResultName\": \"CHATGPT-4O-LATEST\"\n        },\n        \"options\": {},\n        \"resource\": \"image\",\n        \"inputType\": \"base64\",\n        \"operation\": \"analyze\"\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"EjchNb5GBqYh0Cqn\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.8\n    },\n    {\n      \"id\": \"876db6b5-6615-4e9d-8e1a-2d8220b2019f\",\n      \"name\": \"Download Image File\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        -20,\n        60\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.id }}\"\n        },\n        \"options\": {},\n        \"operation\": \"download\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"s8l3OOBediUA645k\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"47b32ddb-1929-4855-9131-078b562b3492\",\n      \"name\": \"Trigger: New file added to Google Drive Folder\",\n      \"type\": \"n8n-nodes-base.googleDriveTrigger\",\n      \"position\": [\n        -220,\n        60\n      ],\n      \"parameters\": {\n        \"event\": \"fileCreated\",\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        },\n        \"triggerOn\": \"specificFolder\",\n        \"folderToWatch\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1WaIRWXcaeNViKmpW5IyQ3YGARWYdMg47\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/folders/1WaIRWXcaeNViKmpW5IyQ3YGARWYdMg47\",\n          \"cachedResultName\": \"EXIF\"\n        }\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"s8l3OOBediUA645k\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"85c6458a-7b2a-4eef-bf28-3b784e45f562\",\n      \"name\": \"Write Metadata to Base64 Code\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        720,\n        80\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const tags = items[0].json.content.split(', ');\\n\\nconst xmpData = `<?xpacket begin=\\\"﻿\\\" id=\\\"W5M0MpCehiHzreSzNTczkc9d\\\"?>\\n<x:xmpmeta xmlns:x=\\\"adobe:ns:meta/\\\" x:xmptk=\\\"XMP Core 5.1.2\\\">\\n    <rdf:RDF xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\">\\n        <rdf:Description rdf:about=\\\"\\\"\\n            xmlns:dc=\\\"http://purl.org/dc/elements/1.1/\\\"\\n            xmlns:xmp=\\\"http://ns.adobe.com/xap/1.0/\\\"\\n            xmlns:photoshop=\\\"http://ns.adobe.com/photoshop/1.0/\\\">\\n            <dc:creator></dc:creator>\\n            <dc:subject>\\n                <rdf:Bag>\\n                    ${tags.map(tag => `<rdf:li>${tag}</rdf:li>`).join('\\\\n                    ')}\\n                </rdf:Bag>\\n            </dc:subject>\\n            <xmp:CreateDate>${new Date().toISOString()}</xmp:CreateDate>\\n        </rdf:Description>\\n    </rdf:RDF>\\n</x:xmpmeta>\\n<?xpacket end=\\\"w\\\"?>`;\\n\\nconst xmpHeader = Buffer.from([\\n    0xFF, 0xE1,\\n    0x00, 0x00,\\n    0x68, 0x74, 0x74, 0x70, 0x3A, 0x2F, 0x2F, 0x6E, 0x73, 0x2E,\\n    0x61, 0x64, 0x6F, 0x62, 0x65, 0x2E, 0x63, 0x6F, 0x6D, 0x2F,\\n    0x78, 0x61, 0x70, 0x2F, 0x31, 0x2E, 0x30, 0x2F, 0x00\\n]);\\n\\nconst xmpBuffer = Buffer.from(xmpData, 'utf8');\\nconst imageBuffer = Buffer.from(items[0].json.data, 'base64');\\nconst length = xmpHeader.length + xmpBuffer.length - 2;\\nxmpHeader[2] = (length >> 8) & 0xFF;\\nxmpHeader[3] = length & 0xFF;\\n\\nconst newImageData = Buffer.concat([\\n    imageBuffer.slice(0, 2),\\n    xmpHeader,\\n    xmpBuffer,\\n    imageBuffer.slice(2)\\n]);\\n\\nitems[0].json.data = newImageData.toString('base64');\\n\\nreturn items;\"\n      },\n      \"typeVersion\": 2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"1b86cadf-9f46-4980-a923-00577bfc59f4\",\n      \"name\": \"Update Image File\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        1120,\n        80\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Download Image File').item.json.id }}\"\n        },\n        \"options\": {},\n        \"operation\": \"update\",\n        \"changeFileContent\": true,\n        \"newUpdatedFileName\": \"={{ $('Download Image File').item.json.name }}\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"s8l3OOBediUA645k\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"10c97623-80b1-4e96-b5c5-243ef106b2e9\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -540,\n        240\n      ],\n      \"parameters\": {\n        \"width\": 660,\n        \"height\": 680,\n        \"content\": \"# 欢迎使用我的自动化图像元数据标记工作流！\\n\\n本工作流借助AI自动分析图像内容，并将结果作为关键词直接写回图像文件中。\\n\\n## 工作流执行顺序如下：\\n\\n1. Google Drive触发器（扫描特定文件夹内新增文件）\\n2. 下载新增的图像文件\\n3. 分析图像内容并将文件转为Base64编码\\n4. 合并元数据与Base64编码\\n5. 通过代码节点将关键词写入元数据（dc:subject字段）\\n6. 转换为文件并更新Google Drive文件夹中的原始文件\\n\\n## 本工作流需要以下访问权限：\\n- Google Drive：[授权文档](https://docs.n8n.io/integrations/builtin/credentials/google)\\n- AI API访问权限（可通过OpenAI、Anthropic、Google或Ollama等平台）\\n\\n如有任何疑问，欢迎通过LinkedIn联系我：https://www.linkedin.com/in/friedemann-schuetz\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d2bb1007-018d-4c6a-a458-ff8e79b6017c\",\n      \"name\": \"Merge Metadata and Base64 Code\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        520,\n        80\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"combineBy\": \"combineByPosition\"\n      },\n      \"typeVersion\": 3\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"46b58de4-da62-43a2-bb10-fc85ffb75115\",\n  \"connections\": {\n    \"Convert to File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Image File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract from File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Metadata and Base64 Code\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Download Image File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Analyze Image Content\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Extract from File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Analyze Image Content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Metadata and Base64 Code\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Write Metadata to Base64 Code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert to File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge Metadata and Base64 Code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Write Metadata to Base64 Code\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Trigger: New file added to Google Drive Folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download Image File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
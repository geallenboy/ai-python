{
  "url": "https://n8n.io/workflows/2045-advanced-telegram-bot-ticketing-system-livechat-user-management-broadcasting/",
  "title": "Advanced Telegram Bot, Ticketing System, LiveChat, User Management, Broadcasting",
  "author": "Nskha",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-25",
  "categories": [
    {
      "name": "Support"
    },
    {
      "name": "IT Ops"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"56d2f4e489ee5971b498fdc86622af934b4f6de5339e9825a61dbe25e604dccd\"},\"nodes\":[{\"id\":\"d2a02884-a082-4d77-8558-b819fdfd8e09\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1305,-337],\"parameters\":{\"color\":7,\"width\":629.040241216464,\"height\":1416.261500302191,\"content\":\"## Use **Config Bot** to setup your telegram details, like:\\n1- Telegram Group ID (Don't forget add bot as admin)\\n2- Telegram Channel ID (Don't forget add bot as admin)\\n3- Your telegram Bot Token. (Generate through @BotFather)\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n## Setup data & filter & route to the correct Side.\\n0- None of them - Soon - Wait V2\\n1- Chat Type (`Private`)\\n2- Chat Type (`Supergroup`)\\n3- Chat Type (`Channel`)\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n## Remember:\\n* Do not make your support group public. Every message sent in the group on various topics will be forwarded to the user's ticket.\\n* There is no need to promote your broadcasting channel; the main reason for the channel is to organize and broadcast messages.\\n* You can host a Redis database without any coding/server management skills through Coolify.io.\\n* In the next version, I will add the **edit messages** feature, where the forwarded messages will be updated with the new edited one.\\n\\n## Why use this method?\\n* If you deal with Telegram P2P, anyone can delete messages from both sides. If you run a business, then one of your clients may delete all messages, causing you to lose the history. This solution prevents people from deleting messages; every message forwarded into the support group will not be possible to delete by the sender.\\n* Team collaboration: Why share one account when you can convert the whole group into a ticketing system? With this project, you can invite all your coworkers to reply and provide support to your clients through Telegram.\\n* Integrate with third-party services? Using N8N will pave the way for integrating your Telegram users' data into a CRM. In V2, we will enable the option to force new users to share their leads before receiving support.\"},\"typeVersion\":1},{\"id\":\"c45c5efc-9c4d-4373-b267-bb13a01cb1de\",\"name\":\"New User ?\",\"type\":\"n8n-nodes-base.if\",\"position\":[-400,-140],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $json.isEmpty() }}\",\"value2\":\"true\",\"operation\":\"regex\"}]}},\"typeVersion\":1},{\"id\":\"ab015a1f-9ee3-48f6-88c2-02d43fa739bc\",\"name\":\"Format\",\"type\":\"n8n-nodes-base.code\",\"position\":[-1260,260],\"parameters\":{\"jsCode\":\"function escapeRedisJsonSyntax(value) {\\n  if (typeof value === 'string') {\\n    return value.replace(/[\\\"\\\\\\\\/]/g, '\\\\\\\\$&');\\n  }\\n  return value;\\n}\\n\\nconst outputItems = [];\\n\\nfor (let i = 0; i < items.length; i++) {\\n  const item = items[i];\\n  const escapedItem = { TG_USER_: {} };\\n\\n  for (const key in item) {\\n    const value = item[key];\\n    if (Array.isArray(value)) {\\n      escapedItem.TG_USER_[key] = [escapeRedisJsonSyntax(value[0])];\\n    } else if (typeof value === 'object') {\\n      flattenObject(value, escapedItem.TG_USER_, key);\\n    } else {\\n      escapedItem.TG_USER_[key] = escapeRedisJsonSyntax(value);\\n    }\\n  }\\n\\n  outputItems.push(escapedItem);\\n}\\n\\nfunction flattenObject(obj, result, prefix) {\\n  for (const key in obj) {\\n    const newKey = prefix ? `${prefix}_${key}` : key;\\n    const value = obj[key];\\n    if (typeof value === 'object') {\\n      if (Array.isArray(value)) {\\n        result[newKey] = [escapeRedisJsonSyntax(value[0])];\\n      } else {\\n        flattenObject(value, result, newKey);\\n      }\\n    } else {\\n      result[newKey.replace('json_message_', '').replace('json_', '')] = escapeRedisJsonSyntax(value);\\n    }\\n  }\\n}\\n\\nreturn outputItems;\\n\"},\"typeVersion\":2},{\"id\":\"18c5126d-6c3e-4b5f-989e-d6830cb73a90\",\"name\":\"Bot-Fields\",\"type\":\"n8n-nodes-base.set\",\"position\":[-1120,260],\"parameters\":{\"mode\":\"raw\",\"include\":\"selected\",\"options\":{},\"jsonOutput\":\"={{ $json.TG_USER_.removeField('BotToken').removeField('pairedItem_item').removeField('Support_Group_ID') }}\"},\"typeVersion\":3.2},{\"id\":\"0cc142e7-4fbc-4104-9529-1087a7bac68a\",\"name\":\"Create Topic (Chat Ticket)\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[80,-260],\"parameters\":{\"url\":\"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/createForumTopic?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"]}}&name={{ encodeURIComponent(('['+$('Bot-Fields').item.json.from_first_name +'] - [id:'+ $('Bot-Fields').item.json.chat_id +']'))}}&icon_color=9367192&icon_custom_emoji_id=5417915203100613993\",\"options\":{}},\"typeVersion\":4.1},{\"id\":\"e983994f-7922-49c2-8c4e-73100a030898\",\"name\":\"Save Topic ID\",\"type\":\"n8n-nodes-base.redis\",\"position\":[260,-260],\"parameters\":{\"key\":\"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\"value\":\"={\\\"message_thread_id\\\":{{ $json.result.message_thread_id }}}\",\"keyType\":\"hash\",\"operation\":\"set\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"typeVersion\":1},{\"id\":\"1f3afe0c-3ec4-431f-92b7-f06df5e1b39d\",\"name\":\"Get User Chat Topic\",\"type\":\"n8n-nodes-base.redis\",\"position\":[200,-80],\"parameters\":{\"key\":\"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\"keyType\":\"hash\",\"options\":{},\"operation\":\"get\",\"propertyName\":\"result\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"typeVersion\":1},{\"id\":\"591e1768-58c9-428e-8a0d-69ba4cce7ccc\",\"name\":\"Forward New Message\",\"type\":\"n8n-nodes-base.httpRequest\",\"onError\":\"continueErrorOutput\",\"position\":[560,-80],\"parameters\":{\"url\":\"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/forwardMessage?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"] }}&message_thread_id={{ $json[\\\"result\\\"][\\\"message_thread_id\\\"] }}&from_chat_id={{ $('Bot-Fields').item.json[\\\"chat_id\\\"] }}&message_id={{ $('Bot-Fields').item.json[\\\"message_id\\\"] }}\",\"method\":\"POST\",\"options\":{}},\"typeVersion\":4.1},{\"id\":\"fd063a6d-0caa-4f81-921d-f8fa952d7b9b\",\"name\":\"IF No Topic Created\",\"type\":\"n8n-nodes-base.if\",\"position\":[40,320],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $json.error.message }}\",\"value2\":\"thread not found\",\"operation\":\"contains\"}]}},\"typeVersion\":1},{\"id\":\"ef044803-5e2e-4e54-a10b-21ad5feadb26\",\"name\":\"ReCreate Topic (Chat Ticket)\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[220,220],\"parameters\":{\"url\":\"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/createForumTopic?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"]}}&name={{ encodeURIComponent(('['+$('Bot-Fields').item.json.from_first_name +'] - [id:'+ $('Bot-Fields').item.json.chat_id +']'))}}&icon_color=9367192&icon_custom_emoji_id=5417915203100613993\",\"options\":{}},\"typeVersion\":4.1},{\"id\":\"691398ab-b434-46d0-b3fe-046235d7cdf8\",\"name\":\"ReSave Topic ID\",\"type\":\"n8n-nodes-base.redis\",\"position\":[380,220],\"parameters\":{\"key\":\"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\"value\":\"={\\\"message_thread_id\\\":{{ $json.result.message_thread_id }}}\",\"keyType\":\"hash\",\"operation\":\"set\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"typeVersion\":1},{\"id\":\"69fc3fe2-a339-4c99-a85b-6facf41526bf\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[20,120.47661481708235],\"parameters\":{\"color\":3,\"width\":734.3067601294108,\"height\":466.5190319644644,\"content\":\"## Re Create New Topic\\n**Sometimes** in support group may the team delete or close a ticket (topic) in case of that this steps will create topic again for the user, and store the new ticket id (topic/thread ID).\"},\"typeVersion\":1},{\"id\":\"4cb855d4-a306-4bd4-b24d-ee5f6db518d4\",\"name\":\"Update User Data\",\"type\":\"n8n-nodes-base.redis\",\"position\":[-140,-80],\"parameters\":{\"key\":\"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\"value\":\"={{ $item(\\\"0\\\").$node[\\\"Bot-Fields\\\"].json }}\",\"keyType\":\"hash\",\"operation\":\"set\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"typeVersion\":1},{\"id\":\"878f0dec-ad7b-4584-b20a-dd3db634d6dd\",\"name\":\"Save User Data\",\"type\":\"n8n-nodes-base.redis\",\"position\":[-140,-260],\"parameters\":{\"key\":\"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\"value\":\"={{ $item(\\\"0\\\").$node[\\\"Bot-Fields\\\"].json }}\",\"keyType\":\"hash\",\"operation\":\"set\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"typeVersion\":1},{\"id\":\"e411b235-74bf-4f1b-9070-da1d0dc15815\",\"name\":\"Support Forum\",\"type\":\"n8n-nodes-base.if\",\"position\":[-620,240],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $('Bot-Config').item.json.message.chat.id }}\",\"value2\":\"={{ $('Bot-Config').item.json.Support_Group_ID }}\",\"operation\":\"regex\"}]}},\"typeVersion\":1},{\"id\":\"05c04455-1406-47aa-8a81-aa2ec914c502\",\"name\":\"From Ticket\",\"type\":\"n8n-nodes-base.if\",\"position\":[-420,220],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $('Bot-Fields').item.json.message_thread_id }}\",\"operation\":\"isNotEmpty\"},{\"value1\":\"={{ $('Bot-Fields').item.json.reply_to_message_is_topic_message }}\",\"value2\":\"true\",\"operation\":\"regex\"},{\"value1\":\"={{ $('Bot-Fields').item.json.is_topic_message }}\",\"value2\":\"true\",\"operation\":\"regex\"}]}},\"typeVersion\":1},{\"id\":\"71b55beb-7c93-40a1-a94b-f411d11eb713\",\"name\":\"Forward Support Reply To User\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-200,200],\"parameters\":{\"url\":\"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/forwardMessage?chat_id={{ $json[\\\"reply_to_message_forward_from_id\\\"] || $('Bot-Fields').item.json.reply_to_message_forum_topic_created_name.match(/\\\\[id:(\\\\d+)\\\\]/)[1] }}&from_chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"] }}&message_id={{ $('Bot-Fields').item.json[\\\"message_id\\\"] }}\",\"method\":\"POST\",\"options\":{}},\"typeVersion\":4.1},{\"id\":\"aa70a9f6-ac3c-4ac4-a829-ef3e35720f2f\",\"name\":\"IF Topic Created\",\"type\":\"n8n-nodes-base.if\",\"position\":[-420,440],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $json.forum_topic_created_name.isNotEmpty() }}\",\"value2\":\"true\",\"operation\":\"regex\"}]}},\"typeVersion\":1},{\"id\":\"4b1ba81a-6986-48a9-b439-cd79cfe278b7\",\"name\":\"Forward New Message to the recrated topic\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[540,220],\"parameters\":{\"url\":\"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/forwardMessage?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"] }}&message_thread_id={{ $json[\\\"result\\\"][\\\"message_thread_id\\\"] }}&from_chat_id={{ $('Bot-Fields').item.json[\\\"chat_id\\\"] }}&message_id={{ $('Bot-Fields').item.json[\\\"message_id\\\"] }}\",\"method\":\"POST\",\"options\":{}},\"typeVersion\":4.1},{\"id\":\"7eef7a26-8c59-4020-90f8-45f28e36c43f\",\"name\":\"No Operation, do nothing\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[540,420],\"parameters\":{},\"typeVersion\":1},{\"id\":\"db77035a-1256-4210-a13d-8333778fb579\",\"name\":\"Check User in Database\",\"type\":\"n8n-nodes-base.redis\",\"notes\":\"Search Key\",\"position\":[-580,-140],\"parameters\":{\"operation\":\"keys\",\"keyPattern\":\"=TG-USER-{{ $json.chat_id }}\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"notesInFlow\":true,\"typeVersion\":1},{\"id\":\"c01200b7-8aa4-4d44-a9a9-a802179f3afc\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-660,120],\"parameters\":{\"color\":5,\"width\":656,\"height\":473,\"content\":\"## Support Side\\n**This Part** is meant to forward replies that sent by support (members in the group)\"},\"typeVersion\":1},{\"id\":\"a443f847-248a-4287-8aad-737c4891b344\",\"name\":\"Send User Ticket Created Notification\",\"type\":\"n8n-nodes-base.telegram\",\"position\":[-220,420],\"parameters\":{\"text\":\"A new ticket has been created for you. Please wait while one of our support team members becomes available to reply.\",\"chatId\":\"={{ $json.forum_topic_created_name.match(/\\\\[id:(\\\\d+)\\\\]/)[1] }}\",\"additionalFields\":{\"appendAttribution\":false}},\"credentials\":{\"telegramApi\":{\"id\":\"dZzfZH7baUnF4hiH\",\"name\":\"The Live Chat Bot\"}},\"typeVersion\":1.1},{\"id\":\"2746b480-91ed-4968-809d-9eca523d290a\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-656.2527877074685,-340],\"parameters\":{\"color\":3,\"width\":1409.9137494026593,\"height\":422,\"content\":\"## User Side\\n**This Part** is meant to save user data on a RAM database which is fast, and in same time forward the message to support after creating a new ticket (Topic) dedciated for the user id in the support group.\"},\"typeVersion\":1},{\"id\":\"545d768f-a0b2-465a-a084-c43a6231d31a\",\"name\":\"Bot-Config\",\"type\":\"n8n-nodes-base.set\",\"position\":[-880,-200],\"parameters\":{\"fields\":{\"values\":[{\"name\":\"BotToken\",\"stringValue\":\"Your Bot Token here (Also add credntinals in Telegram Node)\"},{\"name\":\"Support_Group_ID\",\"stringValue\":\"Your Telegram Group here (Don't forget to give BOT admin privileges)\"},{\"name\":\"Boradcast_Channel_ID\",\"stringValue\":\"Your Telegram Channel here (Don't forget to give BOT admin privileges)\"}]},\"options\":{}},\"typeVersion\":3.2},{\"id\":\"59145dcd-51e3-4392-ad79-85601c872931\",\"name\":\"Telegram-Bot\",\"type\":\"n8n-nodes-base.telegramTrigger\",\"position\":[-1240,-200],\"webhookId\":\"d8b773ab-aee9-494b-8749-f0aa80032871\",\"parameters\":{\"updates\":[\"message\",\"channel_post\"],\"additionalFields\":{}},\"credentials\":{\"telegramApi\":{\"id\":\"dZzfZH7baUnF4hiH\",\"name\":\"The Live Chat Bot\"}},\"typeVersion\":1},{\"id\":\"14b0ac28-5be5-4878-ab57-f7361291cc8e\",\"name\":\"1st\",\"type\":\"n8n-nodes-base.switch\",\"position\":[-980,260],\"parameters\":{\"rules\":{\"rules\":[{\"output\":1,\"value2\":\"private\",\"operation\":\"regex\"},{\"output\":2,\"value2\":\"supergroup\",\"operation\":\"regex\"},{\"output\":3,\"value2\":\"channel\",\"operation\":\"regex\"}]},\"value1\":\"={{ $json.chat_type || $json.channel_post_sender_chat_type }}\",\"dataType\":\"string\",\"fallbackOutput\":0},\"typeVersion\":1},{\"id\":\"d91e0fdf-7344-4968-beac-49c2331b5170\",\"name\":\"Split In Batches1\",\"type\":\"n8n-nodes-base.splitInBatches\",\"notes\":\"Telegram Limitation 29/sec\",\"position\":[160,780],\"parameters\":{\"options\":{},\"batchSize\":29},\"notesInFlow\":true,\"typeVersion\":2},{\"id\":\"f6ce5dbb-8707-4243-9814-5bd57397e652\",\"name\":\"Wait1\",\"type\":\"n8n-nodes-base.wait\",\"position\":[560,740],\"webhookId\":\"9f87deed-d502-46d3-8c85-ce99552a0441\",\"parameters\":{\"unit\":\"seconds\",\"amount\":3},\"typeVersion\":1},{\"id\":\"640e9ca9-de7d-4dae-a15a-d0232864c877\",\"name\":\"Format Users\",\"type\":\"n8n-nodes-base.code\",\"position\":[-200,780],\"parameters\":{\"jsCode\":\"let response = items[0].json; // get the Redis response\\nlet newItems = []; // to store the new items\\n\\nfor(let key in response) {\\n    if(response.hasOwnProperty(key)) {\\n        newItems.push({\\n            json: {\\n                user: response[key]\\n            }\\n        });\\n    }\\n}\\n\\nreturn newItems;\\n\"},\"typeVersion\":1},{\"id\":\"8c330aca-3720-439e-87c6-47d914f828c3\",\"name\":\"Broadcast Channel Post into Users\",\"type\":\"n8n-nodes-base.httpRequest\",\"onError\":\"continueErrorOutput\",\"position\":[380,760],\"parameters\":{\"url\":\"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/copyMessage?chat_id={{ $('Split In Batches1').item.json[\\\"user\\\"][\\\"chat_id\\\"] }}&from_chat_id={{ $('Bot-Config').item.json[\\\"Boradcast_Channel_ID\\\"] }}&message_id={{ $('Bot-Config').item.json[\\\"channel_post\\\"][\\\"message_id\\\"] }}\",\"method\":\"POST\",\"options\":{}},\"typeVersion\":4.1},{\"id\":\"3beb15dd-6e76-4350-97c3-22f39d768497\",\"name\":\"Set Blocked Member\",\"type\":\"n8n-nodes-base.redis\",\"position\":[560,900],\"parameters\":{\"key\":\"=TG-USER-{{ $('Bot-Fields').item.json.chat_id || $('Split In Batches1').item.json.user.chat_id }}\",\"value\":\"={\\\"Blocked\\\":{{ '1' }}}\",\"keyType\":\"hash\",\"operation\":\"set\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"typeVersion\":1},{\"id\":\"03d457f1-ca11-4134-b0f9-d4d029ce141a\",\"name\":\"IF Verified Channel\",\"type\":\"n8n-nodes-base.if\",\"position\":[-558,800],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $('Bot-Config').item.json.channel_post.sender_chat.id }}\",\"value2\":\"={{ $('Bot-Config').item.json.Boradcast_Channel_ID }}\",\"operation\":\"regex\"}]}},\"typeVersion\":1},{\"id\":\"6f38d2d0-5734-4829-ab97-8aca57827646\",\"name\":\"Filter Blocked Users\",\"type\":\"n8n-nodes-base.filter\",\"position\":[-20,780],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $json.user.Blocked }}\",\"value2\":\"1\",\"operation\":\"notRegex\"}]}},\"typeVersion\":1},{\"id\":\"37ffb301-0284-493e-abed-aaff293b4a92\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-660,620],\"parameters\":{\"color\":6,\"width\":1413.320293398532,\"height\":460.58353708231465,\"content\":\"## Channel Side (Broadcasting)\\n**This Part** where the support of brand broadcasting message to all previous users who used this bot before.\"},\"typeVersion\":1},{\"id\":\"d34a0080-6db8-4d29-b6ff-b0b0bf3be8af\",\"name\":\"Retrieve all users in DB\",\"type\":\"n8n-nodes-base.redis\",\"notes\":\"Search Key\",\"position\":[-378,780],\"parameters\":{\"operation\":\"keys\",\"keyPattern\":\"=TG-USER-*\"},\"credentials\":{\"redis\":{\"id\":\"LNn51V8Wv8nlnOrK\",\"name\":\"Livegram Bot\"}},\"notesInFlow\":true,\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"1st\":{\"main\":[null,[{\"node\":\"Check User in Database\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Support Forum\",\"type\":\"main\",\"index\":0}],[{\"node\":\"IF Verified Channel\",\"type\":\"main\",\"index\":0}]]},\"Wait1\":{\"main\":[[{\"node\":\"Split In Batches1\",\"type\":\"main\",\"index\":0}]]},\"Format\":{\"main\":[[{\"node\":\"Bot-Fields\",\"type\":\"main\",\"index\":0}]]},\"Bot-Config\":{\"main\":[[{\"node\":\"Format\",\"type\":\"main\",\"index\":0}]]},\"Bot-Fields\":{\"main\":[[{\"node\":\"1st\",\"type\":\"main\",\"index\":0}]]},\"New User ?\":{\"main\":[[{\"node\":\"Save User Data\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Update User Data\",\"type\":\"main\",\"index\":0}]]},\"From Ticket\":{\"main\":[[{\"node\":\"Forward Support Reply To User\",\"type\":\"main\",\"index\":0}],[{\"node\":\"IF Topic Created\",\"type\":\"main\",\"index\":0}]]},\"Format Users\":{\"main\":[[{\"node\":\"Filter Blocked Users\",\"type\":\"main\",\"index\":0}]]},\"Telegram-Bot\":{\"main\":[[{\"node\":\"Bot-Config\",\"type\":\"main\",\"index\":0}]]},\"Save Topic ID\":{\"main\":[[{\"node\":\"Forward New Message\",\"type\":\"main\",\"index\":0}]]},\"Support Forum\":{\"main\":[[{\"node\":\"From Ticket\",\"type\":\"main\",\"index\":0}]]},\"Save User Data\":{\"main\":[[{\"node\":\"Create Topic (Chat Ticket)\",\"type\":\"main\",\"index\":0}]]},\"ReSave Topic ID\":{\"main\":[[{\"node\":\"Forward New Message to the recrated topic\",\"type\":\"main\",\"index\":0}]]},\"IF Topic Created\":{\"main\":[[{\"node\":\"Send User Ticket Created Notification\",\"type\":\"main\",\"index\":0}]]},\"Update User Data\":{\"main\":[[{\"node\":\"Get User Chat Topic\",\"type\":\"main\",\"index\":0}]]},\"Split In Batches1\":{\"main\":[[{\"node\":\"Broadcast Channel Post into Users\",\"type\":\"main\",\"index\":0}]]},\"Set Blocked Member\":{\"main\":[[{\"node\":\"Split In Batches1\",\"type\":\"main\",\"index\":0}]]},\"Forward New Message\":{\"main\":[[{\"node\":\"No Operation, do nothing\",\"type\":\"main\",\"index\":0}],[{\"node\":\"IF No Topic Created\",\"type\":\"main\",\"index\":0}]]},\"Get User Chat Topic\":{\"main\":[[{\"node\":\"Forward New Message\",\"type\":\"main\",\"index\":0}]]},\"IF No Topic Created\":{\"main\":[[{\"node\":\"ReCreate Topic (Chat Ticket)\",\"type\":\"main\",\"index\":0}],[{\"node\":\"No Operation, do nothing\",\"type\":\"main\",\"index\":0}]]},\"IF Verified Channel\":{\"main\":[[{\"node\":\"Retrieve all users in DB\",\"type\":\"main\",\"index\":0}],[{\"node\":\"No Operation, do nothing\",\"type\":\"main\",\"index\":0}]]},\"Filter Blocked Users\":{\"main\":[[{\"node\":\"Split In Batches1\",\"type\":\"main\",\"index\":0}]]},\"Check User in Database\":{\"main\":[[{\"node\":\"New User ?\",\"type\":\"main\",\"index\":0}]]},\"Retrieve all users in DB\":{\"main\":[[{\"node\":\"Format Users\",\"type\":\"main\",\"index\":0}]]},\"Create Topic (Chat Ticket)\":{\"main\":[[{\"node\":\"Save Topic ID\",\"type\":\"main\",\"index\":0}]]},\"ReCreate Topic (Chat Ticket)\":{\"main\":[[{\"node\":\"ReSave Topic ID\",\"type\":\"main\",\"index\":0}]]},\"Forward Support Reply To User\":{\"main\":[[{\"node\":\"No Operation, do nothing\",\"type\":\"main\",\"index\":0}]]},\"Broadcast Channel Post into Users\":{\"main\":[[{\"node\":\"Wait1\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Set Blocked Member\",\"type\":\"main\",\"index\":0}]]},\"Send User Ticket Created Notification\":{\"main\":[[{\"node\":\"No Operation, do nothing\",\"type\":\"main\",\"index\":0}]]},\"Forward New Message to the recrated topic\":{\"main\":[[{\"node\":\"No Operation, do nothing\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "A robust n8n workflow designed to enhance Telegram bot functionality for user management and broadcasting. It facilitates automatic support ticket creation, efficient user data storage in Redis, and a sophisticated system for message forwarding and broadcasting.\n\n![7Yscd9l4gN.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/7_Yscd9l4g_N_c0d57c4d0f.png)\n\n### How It Works\n\n  1. **Telegram Bot Setup** : Initiate the workflow with a Telegram bot configured for handling different chat types (private, supergroup, channel).\n  2. **User Data Management** : Formats and updates user data, storing it in a Redis database for efficient retrieval and management.\n  3. **Support Ticket Creation** : Automatically generates chat tickets for user messages and saves the corresponding topic IDs in Redis.\n  4. **Message Forwarding** : Forwards new messages to the appropriate chat thread, or creates a new thread if none exists.\n  5. **Support Forum Management** : Handles messages within a support forum, differentiating between various chat types and user statuses.\n  6. **Broadcasting System** : Implements a broadcasting mechanism that sends channel posts to all previous bot users, with a system to filter out blocked users.\n  7. **Blocked User Management** : Identifies and manages blocked users, preventing them from receiving broadcasted messages.\n  8. **Versatile Channel Handling** : Ensures that messages from verified channels are properly managed and broadcasted to relevant users.\n\n\n\n### Set Up Steps\n\n  * **Estimated Time** : Around 30 minutes.\n  * **Requirements** : A Telegram bot, a Redis database, and Telegram group/channel IDs are necessary.\n  * **Configuration** : Input the Telegram bot token and relevant group/channel IDs. Configure message handling and user data processing according to your needs.\n  * **Detailed Instructions** : Sticky notes within the workflow provide extensive setup information and guidance.\n\n\n\n![kes0xxJdTb.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/kes0xx_Jd_Tb_1af77e6e5f.png)\n\n### **Live Demo Workflow**\n\n**Bot** : [Telegram Bot Link (Click here)](https://TheLiveChatBot.t.me)  \n**Support Group** : [Telegram Group Link (Click here)](https://t.me/+-8BELbd0GDYxMTEx)  \n**Broadcasting Channel** : [Telegram Channel Link (Click here)](https://broadcasting_channel.t.me)\n\n**Keywords** : n8n workflow, Telegram bot, chat ticket system, Redis database, message broadcasting, user data management, support forum automation\n",
  "crawled_at": "2025-05-25T20:43:53.800578",
  "readme_zh": "一个强大的n8n工作流，专为增强Telegram机器人的用户管理与广播功能而设计。它支持自动创建支持工单、将用户数据高效存储于Redis数据库，并具备智能化的消息转发与广播系统。\n\n![7Yscd9l4gN.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/7_Yscd9l4g_N_c0d57c4d0f.png)\n\n### 运作原理\n\n1. **机器人初始化**：通过配置支持多种聊天类型（私聊/超级群组/频道）的Telegram机器人启动工作流  \n2. **用户数据管理**：格式化并更新用户数据，存储至Redis数据库实现高效检索  \n3. **工单自动化**：为用户消息自动生成聊天工单，并将对应主题ID保存至Redis  \n4. **智能消息路由**：将新消息转发至对应聊天线程，若不存在则创建新线程  \n5. **支持论坛管理**：处理支持论坛内消息，智能区分不同聊天类型和用户状态  \n6. **广播系统**：向历史用户推送频道帖子，内置屏蔽用户过滤机制  \n7. **黑名单管理**：识别并管理被屏蔽用户，确保其不会接收广播消息  \n8. **多频道适配**：对已验证频道的消息进行规范化管理和定向广播  \n\n### 部署指南\n\n* **预计耗时**：约30分钟  \n* **环境要求**：需准备Telegram机器人、Redis数据库及Telegram群组/频道ID  \n* **配置说明**：输入机器人令牌和相关ID，根据需求配置消息处理与用户数据处理规则  \n* **详细指引**：工作流内嵌便签提供完整的配置说明  \n\n![kes0xxJdTb.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/kes0xx_Jd_Tb_1af77e6e5f.png)\n\n### 实时演示\n\n**演示机器人**：[点击访问](https://TheLiveChatBot.t.me)  \n**支持群组**：[点击加入](https://t.me/+-8BELbd0GDYxMTEx)  \n**广播频道**：[点击查看](https://broadcasting_channel.t.me)  \n\n**核心标签**：n8n工作流｜Telegram机器人｜工单系统｜Redis数据库｜消息广播｜用户管理｜支持论坛自动化",
  "title_zh": "高级电报机器人、票务系统、实时聊天、用户管理、广播功能",
  "publish_date_zh": "最后更新于9个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"56d2f4e489ee5971b498fdc86622af934b4f6de5339e9825a61dbe25e604dccd\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"d2a02884-a082-4d77-8558-b819fdfd8e09\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1305,\n        -337\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 629.040241216464,\n        \"height\": 1416.261500302191,\n        \"content\": \"## 使用 **Config Bot** 配置您的Telegram信息，例如：\\n1- Telegram群组ID（别忘了将机器人设为管理员）\\n2- Telegram频道ID（别忘了将机器人设为管理员）\\n3- 您的Telegram机器人令牌（通过@BotFather生成）\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c45c5efc-9c4d-4373-b267-bb13a01cb1de\",\n      \"name\": \"New User ?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -400,\n        -140\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.isEmpty() }}\",\n              \"value2\": \"true\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ab015a1f-9ee3-48f6-88c2-02d43fa739bc\",\n      \"name\": \"Format\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -1260,\n        260\n      ],\n      \"parameters\": {\n        \"jsCode\": \"function escapeRedisJsonSyntax(value) {\\n  if (typeof value === 'string') {\\n    return value.replace(/[\\\"\\\\\\\\/]/g, '\\\\\\\\$&');\\n  }\\n  return value;\\n}\\n\\nconst outputItems = [];\\n\\nfor (let i = 0; i < items.length; i++) {\\n  const item = items[i];\\n  const escapedItem = { TG_USER_: {} };\\n\\n  for (const key in item) {\\n    const value = item[key];\\n    if (Array.isArray(value)) {\\n      escapedItem.TG_USER_[key] = [escapeRedisJsonSyntax(value[0])];\\n    } else if (typeof value === 'object') {\\n      flattenObject(value, escapedItem.TG_USER_, key);\\n    } else {\\n      escapedItem.TG_USER_[key] = escapeRedisJsonSyntax(value);\\n    }\\n  }\\n\\n  outputItems.push(escapedItem);\\n}\\n\\nfunction flattenObject(obj, result, prefix) {\\n  for (const key in obj) {\\n    const newKey = prefix ? `${prefix}_${key}` : key;\\n    const value = obj[key];\\n    if (typeof value === 'object') {\\n      if (Array.isArray(value)) {\\n        result[newKey] = [escapeRedisJsonSyntax(value[0])];\\n      } else {\\n        flattenObject(value, result, newKey);\\n      }\\n    } else {\\n      result[newKey.replace('json_message_', '').replace('json_', '')] = escapeRedisJsonSyntax(value);\\n    }\\n  }\\n}\\n\\nreturn outputItems;\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"18c5126d-6c3e-4b5f-989e-d6830cb73a90\",\n      \"name\": \"Bot-Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -1120,\n        260\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"include\": \"selected\",\n        \"options\": {},\n        \"jsonOutput\": \"={{ $json.TG_USER_.removeField('BotToken').removeField('pairedItem_item').removeField('Support_Group_ID') }}\"\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"0cc142e7-4fbc-4104-9529-1087a7bac68a\",\n      \"name\": \"Create Topic (Chat Ticket)\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        80,\n        -260\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/createForumTopic?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"]}}&name={{ encodeURIComponent(('['+$('Bot-Fields').item.json.from_first_name +'] - [id:'+ $('Bot-Fields').item.json.chat_id +']'))}}&icon_color=9367192&icon_custom_emoji_id=5417915203100613993\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"e983994f-7922-49c2-8c4e-73100a030898\",\n      \"name\": \"Save Topic ID\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        260,\n        -260\n      ],\n      \"parameters\": {\n        \"key\": \"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\n        \"value\": \"={\\\"message_thread_id\\\":{{ $json.result.message_thread_id }}}\",\n        \"keyType\": \"hash\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1f3afe0c-3ec4-431f-92b7-f06df5e1b39d\",\n      \"name\": \"Get User Chat Topic\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        200,\n        -80\n      ],\n      \"parameters\": {\n        \"key\": \"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\n        \"keyType\": \"hash\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"result\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"591e1768-58c9-428e-8a0d-69ba4cce7ccc\",\n      \"name\": \"Forward New Message\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        560,\n        -80\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/forwardMessage?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"] }}&message_thread_id={{ $json[\\\"result\\\"][\\\"message_thread_id\\\"] }}&from_chat_id={{ $('Bot-Fields').item.json[\\\"chat_id\\\"] }}&message_id={{ $('Bot-Fields').item.json[\\\"message_id\\\"] }}\",\n        \"method\": \"POST\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"fd063a6d-0caa-4f81-921d-f8fa952d7b9b\",\n      \"name\": \"IF No Topic Created\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        40,\n        320\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.error.message }}\",\n              \"value2\": \"thread not found\",\n              \"operation\": \"contains\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ef044803-5e2e-4e54-a10b-21ad5feadb26\",\n      \"name\": \"ReCreate Topic (Chat Ticket)\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        220,\n        220\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/createForumTopic?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"]}}&name={{ encodeURIComponent(('['+$('Bot-Fields').item.json.from_first_name +'] - [id:'+ $('Bot-Fields').item.json.chat_id +']'))}}&icon_color=9367192&icon_custom_emoji_id=5417915203100613993\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"691398ab-b434-46d0-b3fe-046235d7cdf8\",\n      \"name\": \"ReSave Topic ID\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        380,\n        220\n      ],\n      \"parameters\": {\n        \"key\": \"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\n        \"value\": \"={\\\"message_thread_id\\\":{{ $json.result.message_thread_id }}}\",\n        \"keyType\": \"hash\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"69fc3fe2-a339-4c99-a85b-6facf41526bf\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        20,\n        120.47661481708235\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 734.3067601294108,\n        \"height\": 466.5190319644644,\n        \"content\": \"## 重新创建新主题  \\n**有时**在支持群组中，团队可能会删除或关闭一个工单（主题）。若发生这种情况，此步骤将为用户重新创建主题，并存储新的工单ID（主题/线程ID）。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4cb855d4-a306-4bd4-b24d-ee5f6db518d4\",\n      \"name\": \"Update User Data\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        -140,\n        -80\n      ],\n      \"parameters\": {\n        \"key\": \"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\n        \"value\": \"={{ $item(\\\"0\\\").$node[\\\"Bot-Fields\\\"].json }}\",\n        \"keyType\": \"hash\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"878f0dec-ad7b-4584-b20a-dd3db634d6dd\",\n      \"name\": \"Save User Data\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        -140,\n        -260\n      ],\n      \"parameters\": {\n        \"key\": \"=TG-USER-{{ $('Bot-Fields').item.json.chat_id }}\",\n        \"value\": \"={{ $item(\\\"0\\\").$node[\\\"Bot-Fields\\\"].json }}\",\n        \"keyType\": \"hash\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e411b235-74bf-4f1b-9070-da1d0dc15815\",\n      \"name\": \"Support Forum\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -620,\n        240\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $('Bot-Config').item.json.message.chat.id }}\",\n              \"value2\": \"={{ $('Bot-Config').item.json.Support_Group_ID }}\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"05c04455-1406-47aa-8a81-aa2ec914c502\",\n      \"name\": \"From Ticket\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -420,\n        220\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $('Bot-Fields').item.json.message_thread_id }}\",\n              \"operation\": \"isNotEmpty\"\n            },\n            {\n              \"value1\": \"={{ $('Bot-Fields').item.json.reply_to_message_is_topic_message }}\",\n              \"value2\": \"true\",\n              \"operation\": \"regex\"\n            },\n            {\n              \"value1\": \"={{ $('Bot-Fields').item.json.is_topic_message }}\",\n              \"value2\": \"true\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"71b55beb-7c93-40a1-a94b-f411d11eb713\",\n      \"name\": \"Forward Support Reply To User\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -200,\n        200\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/forwardMessage?chat_id={{ $json[\\\"reply_to_message_forward_from_id\\\"] || $('Bot-Fields').item.json.reply_to_message_forum_topic_created_name.match(/\\\\[id:(\\\\d+)\\\\]/)[1] }}&from_chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"] }}&message_id={{ $('Bot-Fields').item.json[\\\"message_id\\\"] }}\",\n        \"method\": \"POST\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"aa70a9f6-ac3c-4ac4-a829-ef3e35720f2f\",\n      \"name\": \"IF Topic Created\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -420,\n        440\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.forum_topic_created_name.isNotEmpty() }}\",\n              \"value2\": \"true\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4b1ba81a-6986-48a9-b439-cd79cfe278b7\",\n      \"name\": \"Forward New Message to the recrated topic\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        540,\n        220\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/forwardMessage?chat_id={{ $('Bot-Config').item.json[\\\"Support_Group_ID\\\"] }}&message_thread_id={{ $json[\\\"result\\\"][\\\"message_thread_id\\\"] }}&from_chat_id={{ $('Bot-Fields').item.json[\\\"chat_id\\\"] }}&message_id={{ $('Bot-Fields').item.json[\\\"message_id\\\"] }}\",\n        \"method\": \"POST\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"7eef7a26-8c59-4020-90f8-45f28e36c43f\",\n      \"name\": \"No Operation, do nothing\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        540,\n        420\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"db77035a-1256-4210-a13d-8333778fb579\",\n      \"name\": \"Check User in Database\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"notes\": \"Search Key\",\n      \"position\": [\n        -580,\n        -140\n      ],\n      \"parameters\": {\n        \"operation\": \"keys\",\n        \"keyPattern\": \"=TG-USER-{{ $json.chat_id }}\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c01200b7-8aa4-4d44-a9a9-a802179f3afc\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -660,\n        120\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 656,\n        \"height\": 473,\n        \"content\": \"## 支持方\\n**此部分**用于转发由支持人员（群组成员）发送的回复。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a443f847-248a-4287-8aad-737c4891b344\",\n      \"name\": \"Send User Ticket Created Notification\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        -220,\n        420\n      ],\n      \"parameters\": {\n        \"text\": \"A new ticket has been created for you. Please wait while one of our support team members becomes available to reply.\",\n        \"chatId\": \"={{ $json.forum_topic_created_name.match(/\\\\[id:(\\\\d+)\\\\]/)[1] }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"dZzfZH7baUnF4hiH\",\n          \"name\": \"The Live Chat Bot\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"2746b480-91ed-4968-809d-9eca523d290a\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -656.2527877074685,\n        -340\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 1409.9137494026593,\n        \"height\": 422,\n        \"content\": \"## 用户端\\n**此部分**旨在将用户数据快速存储于内存数据库中，同时会在支持群组中为该用户ID创建专属工单（主题）后，将消息转发至支持团队。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"545d768f-a0b2-465a-a084-c43a6231d31a\",\n      \"name\": \"Bot-Config\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -880,\n        -200\n      ],\n      \"parameters\": {\n        \"fields\": {\n          \"values\": [\n            {\n              \"name\": \"BotToken\",\n              \"stringValue\": \"Your Bot Token here (Also add credntinals in Telegram Node)\"\n            },\n            {\n              \"name\": \"Support_Group_ID\",\n              \"stringValue\": \"Your Telegram Group here (Don't forget to give BOT admin privileges)\"\n            },\n            {\n              \"name\": \"Boradcast_Channel_ID\",\n              \"stringValue\": \"Your Telegram Channel here (Don't forget to give BOT admin privileges)\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"59145dcd-51e3-4392-ad79-85601c872931\",\n      \"name\": \"Telegram-Bot\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        -1240,\n        -200\n      ],\n      \"webhookId\": \"d8b773ab-aee9-494b-8749-f0aa80032871\",\n      \"parameters\": {\n        \"updates\": [\n          \"message\",\n          \"channel_post\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"dZzfZH7baUnF4hiH\",\n          \"name\": \"The Live Chat Bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"14b0ac28-5be5-4878-ab57-f7361291cc8e\",\n      \"name\": \"1st\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        -980,\n        260\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"rules\": [\n            {\n              \"output\": 1,\n              \"value2\": \"private\",\n              \"operation\": \"regex\"\n            },\n            {\n              \"output\": 2,\n              \"value2\": \"supergroup\",\n              \"operation\": \"regex\"\n            },\n            {\n              \"output\": 3,\n              \"value2\": \"channel\",\n              \"operation\": \"regex\"\n            }\n          ]\n        },\n        \"value1\": \"={{ $json.chat_type || $json.channel_post_sender_chat_type }}\",\n        \"dataType\": \"string\",\n        \"fallbackOutput\": 0\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d91e0fdf-7344-4968-beac-49c2331b5170\",\n      \"name\": \"Split In Batches1\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"notes\": \"Telegram Limitation 29/sec\",\n      \"position\": [\n        160,\n        780\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"batchSize\": 29\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"f6ce5dbb-8707-4243-9814-5bd57397e652\",\n      \"name\": \"Wait1\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        560,\n        740\n      ],\n      \"webhookId\": \"9f87deed-d502-46d3-8c85-ce99552a0441\",\n      \"parameters\": {\n        \"unit\": \"seconds\",\n        \"amount\": 3\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"640e9ca9-de7d-4dae-a15a-d0232864c877\",\n      \"name\": \"Format Users\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -200,\n        780\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let response = items[0].json; // get the Redis response\\nlet newItems = []; // to store the new items\\n\\nfor(let key in response) {\\n    if(response.hasOwnProperty(key)) {\\n        newItems.push({\\n            json: {\\n                user: response[key]\\n            }\\n        });\\n    }\\n}\\n\\nreturn newItems;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8c330aca-3720-439e-87c6-47d914f828c3\",\n      \"name\": \"Broadcast Channel Post into Users\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        380,\n        760\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.telegram.org/bot{{ $('Bot-Config').item.json.BotToken }}/copyMessage?chat_id={{ $('Split In Batches1').item.json[\\\"user\\\"][\\\"chat_id\\\"] }}&from_chat_id={{ $('Bot-Config').item.json[\\\"Boradcast_Channel_ID\\\"] }}&message_id={{ $('Bot-Config').item.json[\\\"channel_post\\\"][\\\"message_id\\\"] }}\",\n        \"method\": \"POST\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"3beb15dd-6e76-4350-97c3-22f39d768497\",\n      \"name\": \"Set Blocked Member\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        560,\n        900\n      ],\n      \"parameters\": {\n        \"key\": \"=TG-USER-{{ $('Bot-Fields').item.json.chat_id || $('Split In Batches1').item.json.user.chat_id }}\",\n        \"value\": \"={\\\"Blocked\\\":{{ '1' }}}\",\n        \"keyType\": \"hash\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"03d457f1-ca11-4134-b0f9-d4d029ce141a\",\n      \"name\": \"IF Verified Channel\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -558,\n        800\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $('Bot-Config').item.json.channel_post.sender_chat.id }}\",\n              \"value2\": \"={{ $('Bot-Config').item.json.Boradcast_Channel_ID }}\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6f38d2d0-5734-4829-ab97-8aca57827646\",\n      \"name\": \"Filter Blocked Users\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        -20,\n        780\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.user.Blocked }}\",\n              \"value2\": \"1\",\n              \"operation\": \"notRegex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"37ffb301-0284-493e-abed-aaff293b4a92\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -660,\n        620\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 1413.320293398532,\n        \"height\": 460.58353708231465,\n        \"content\": \"## 频道侧（广播功能）\\n**此部分** 支持向所有曾使用过此机器人的历史用户发送品牌广播信息。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d34a0080-6db8-4d29-b6ff-b0b0bf3be8af\",\n      \"name\": \"Retrieve all users in DB\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"notes\": \"Search Key\",\n      \"position\": [\n        -378,\n        780\n      ],\n      \"parameters\": {\n        \"operation\": \"keys\",\n        \"keyPattern\": \"=TG-USER-*\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"LNn51V8Wv8nlnOrK\",\n          \"name\": \"Livegram Bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"1st\": {\n      \"main\": [\n        null,\n        [\n          {\n            \"node\": \"Check User in Database\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Support Forum\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"IF Verified Channel\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split In Batches1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Format\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Bot-Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Bot-Config\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Format\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Bot-Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"1st\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"New User ?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Save User Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Update User Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"From Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Forward Support Reply To User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"IF Topic Created\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Format Users\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter Blocked Users\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram-Bot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Bot-Config\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Save Topic ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Forward New Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Support Forum\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"From Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Save User Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Topic (Chat Ticket)\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ReSave Topic ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Forward New Message to the recrated topic\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF Topic Created\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send User Ticket Created Notification\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update User Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get User Chat Topic\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split In Batches1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Broadcast Channel Post into Users\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Blocked Member\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split In Batches1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Forward New Message\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"IF No Topic Created\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get User Chat Topic\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Forward New Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF No Topic Created\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ReCreate Topic (Chat Ticket)\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF Verified Channel\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve all users in DB\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter Blocked Users\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split In Batches1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check User in Database\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"New User ?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve all users in DB\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Format Users\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Topic (Chat Ticket)\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Save Topic ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ReCreate Topic (Chat Ticket)\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ReSave Topic ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Forward Support Reply To User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Broadcast Channel Post into Users\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set Blocked Member\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send User Ticket Created Notification\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Forward New Message to the recrated topic\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
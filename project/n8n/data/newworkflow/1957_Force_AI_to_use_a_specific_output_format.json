{
  "url": "https://n8n.io/workflows/1957-force-ai-to-use-a-specific-output-format/",
  "title": "Force AI to use a specific output format",
  "author": "n8n Team",
  "publish_date": "Last update 2 months ago",
  "publish_date_absolute": "2025-03-25",
  "categories": [
    {
      "name": "Building Blocks"
    },
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"1116cae7-c7f3-424d-8b87-06ecbac0539f\",\"name\":\"When clicking \\\"Execute Workflow\\\"\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[1040,-260],\"parameters\":{},\"typeVersion\":1},{\"id\":\"c01d02c0-a41b-445e-b006-8b46ad1c437d\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2000,260],\"parameters\":{\"height\":264.69900963477494,\"content\":\"### Parser which defines the output format and which gets used to validate the output\"},\"typeVersion\":1},{\"id\":\"97f977e2-eb78-4ad9-ab21-816ff94c8f0c\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1600,260],\"parameters\":{\"height\":266.9506012398238,\"content\":\"### The LLM which gets used to try to autofix the output in case it was not valid\"},\"typeVersion\":1},{\"id\":\"5325a0d4-9422-445c-bd21-3290c2b14415\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1320,-40],\"parameters\":{\"height\":245.56048099185898,\"content\":\"### The LLM to process the original prompt\"},\"typeVersion\":1},{\"id\":\"55e78fdb-1e08-4f13-be0d-7e476aced21b\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1740,-40],\"parameters\":{\"width\":348,\"height\":253,\"content\":\"### Autofixing parser which tries to fix invalid outputs with the help of an LLM\"},\"typeVersion\":1},{\"id\":\"622183c2-9d57-4e1c-a7bd-c5320ef42668\",\"name\":\"Basic LLM Chain\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[1480,-260],\"parameters\":{\"hasOutputParser\":true},\"typeVersion\":1.5},{\"id\":\"314739fe-0ab3-40a1-b192-6e09b548b92f\",\"name\":\"Prompt\",\"type\":\"n8n-nodes-base.set\",\"position\":[1260,-260],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"6f09dac7-429c-4e8f-af32-8e0112efc8c2\",\"name\":\"chatInput\",\"type\":\"string\",\"value\":\"Return the 5 largest states by area in the USA with their 3 largest cities and their population.\"}]}},\"typeVersion\":3.4},{\"id\":\"e76f5ac7-e185-46d4-aa26-971c8fe03c76\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1400,60],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"5306e68a-cce0-4298-a50a-33727e2186c5\",\"name\":\"Auto-fixing Output Parser\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserAutofixing\",\"position\":[1800,80],\"parameters\":{\"options\":{\"prompt\":\"Instructions:\\n--------------\\n{instructions}\\n--------------\\nCompletion:\\n--------------\\n{completion}\\n--------------\\n\\nAbove, the Completion did not satisfy the constraints given in the Instructions.\\nError:\\n--------------\\n{error}\\n--------------\\n\\nPlease try again. Please only respond with an answer that satisfies the constraints laid out in the Instructions:\"}},\"typeVersion\":1},{\"id\":\"d5642767-69f6-4a09-92da-195a25a17dd1\",\"name\":\"OpenAI Chat Model1\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1680,400],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"dc708b80-8d48-40cb-9af3-692ddd566b9f\",\"name\":\"Structured Output Parser\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[2080,380],\"parameters\":{\"schemaType\":\"manual\",\"inputSchema\":\"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"state\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"cities\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"object\\\",\\n        \\\"properties\\\": {\\n          \\\"name\\\": \\\"string\\\",\\n          \\\"population\\\": \\\"number\\\"\\n        }\\n      }\\n    }\\n  }\\n}\"},\"typeVersion\":1.2}],\"pinData\":{},\"connections\":{\"Prompt\":{\"main\":[[{\"node\":\"Basic LLM Chain\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"Basic LLM Chain\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"OpenAI Chat Model1\":{\"ai_languageModel\":[[{\"node\":\"Auto-fixing Output Parser\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Structured Output Parser\":{\"ai_outputParser\":[[{\"node\":\"Auto-fixing Output Parser\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"Auto-fixing Output Parser\":{\"ai_outputParser\":[[{\"node\":\"Basic LLM Chain\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"When clicking \\\"Execute Workflow\\\"\":{\"main\":[[{\"node\":\"Prompt\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow is for anyone looking to automatically fetch, validate, and parse complex language-based queries into a structured format. Its unique capability lies in not only processing language but also fixing invalid outputs before structuring them.\n\nNote that to use this template, you need to be on n8n version 1.19.4 or later.\n",
  "crawled_at": "2025-05-25T20:25:03.762617",
  "readme_zh": "该工作流专为需要自动获取、验证并将复杂语言查询解析为结构化格式的用户设计。其独特之处在于不仅能处理语言内容，还能在结构化前自动修正无效输出。\n\n请注意：使用此模板需确保n8n版本为1.19.4或更高。",
  "title_zh": "强制AI使用特定输出格式",
  "publish_date_zh": "上次更新于一个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"1116cae7-c7f3-424d-8b87-06ecbac0539f\",\n      \"name\": \"When clicking \\\"Execute Workflow\\\"\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        1040,\n        -260\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c01d02c0-a41b-445e-b006-8b46ad1c437d\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2000,\n        260\n      ],\n      \"parameters\": {\n        \"height\": 264.69900963477494,\n        \"content\": \"### 定义输出格式并用于验证输出的解析器\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"97f977e2-eb78-4ad9-ab21-816ff94c8f0c\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1600,\n        260\n      ],\n      \"parameters\": {\n        \"height\": 266.9506012398238,\n        \"content\": \"### 用于在输出无效时尝试自动修复的大语言模型\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5325a0d4-9422-445c-bd21-3290c2b14415\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1320,\n        -40\n      ],\n      \"parameters\": {\n        \"height\": 245.56048099185898,\n        \"content\": \"### 用于处理原始提示的大语言模型\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"55e78fdb-1e08-4f13-be0d-7e476aced21b\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1740,\n        -40\n      ],\n      \"parameters\": {\n        \"width\": 348,\n        \"height\": 253,\n        \"content\": \"### 自动修复解析器，借助大型语言模型尝试修正无效输出\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"622183c2-9d57-4e1c-a7bd-c5320ef42668\",\n      \"name\": \"Basic LLM Chain\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        1480,\n        -260\n      ],\n      \"parameters\": {\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"314739fe-0ab3-40a1-b192-6e09b548b92f\",\n      \"name\": \"Prompt\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1260,\n        -260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"6f09dac7-429c-4e8f-af32-8e0112efc8c2\",\n              \"name\": \"chatInput\",\n              \"type\": \"string\",\n              \"value\": \"Return the 5 largest states by area in the USA with their 3 largest cities and their population.\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"e76f5ac7-e185-46d4-aa26-971c8fe03c76\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1400,\n        60\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"5306e68a-cce0-4298-a50a-33727e2186c5\",\n      \"name\": \"Auto-fixing Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserAutofixing\",\n      \"position\": [\n        1800,\n        80\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"prompt\": \"Instructions:\\n--------------\\n{instructions}\\n--------------\\nCompletion:\\n--------------\\n{completion}\\n--------------\\n\\nAbove, the Completion did not satisfy the constraints given in the Instructions.\\nError:\\n--------------\\n{error}\\n--------------\\n\\nPlease try again. Please only respond with an answer that satisfies the constraints laid out in the Instructions:\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d5642767-69f6-4a09-92da-195a25a17dd1\",\n      \"name\": \"OpenAI Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1680,\n        400\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"dc708b80-8d48-40cb-9af3-692ddd566b9f\",\n      \"name\": \"Structured Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        2080,\n        380\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"state\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"cities\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"object\\\",\\n        \\\"properties\\\": {\\n          \\\"name\\\": \\\"string\\\",\\n          \\\"population\\\": \\\"number\\\"\\n        }\\n      }\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1.2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Prompt\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Basic LLM Chain\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Basic LLM Chain\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Auto-fixing Output Parser\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Auto-fixing Output Parser\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Auto-fixing Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Basic LLM Chain\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking \\\"Execute Workflow\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prompt\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
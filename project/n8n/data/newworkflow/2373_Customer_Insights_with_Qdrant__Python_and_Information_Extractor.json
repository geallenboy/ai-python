{
  "url": "https://n8n.io/workflows/2373-customer-insights-with-qdrant-python-and-information-extractor/",
  "title": "Customer Insights with Qdrant, Python and Information Extractor",
  "author": "Jimleuk",
  "publish_date": "Last update 9 months ago",
  "publish_date_absolute": "2024-08-25",
  "categories": [
    {
      "name": "Sales"
    },
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\"},\"nodes\":[{\"id\":\"63501cc8-77c9-4037-9f70-da23b6d20b03\",\"name\":\"When clicking â€˜Test workflowâ€™\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[280,440],\"parameters\":{},\"typeVersion\":1},{\"id\":\"00de989c-d9e9-4b42-b5db-7097800a6017\",\"name\":\"Zip Entries\",\"type\":\"n8n-nodes-base.set\",\"position\":[1380,360],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"833a554d-2b39-4160-9348-18b17b28ce30\",\"name\":\"data\",\"type\":\"array\",\"value\":\"={{ \\n  $json.review_author.map((review_author, idx) => ({\\n    review_author,\\n    review_author_reviews_count: $json.review_author_reviews_count[idx].replace(' reviews', '').toInt(),\\n    review_country: $json.review_country[idx],\\n    review_date: $json.review_date[idx].toDate(),\\n    review_date_of_experience: $json.review_date_of_experience[idx].replace('Date of experience: ', '').toDate(),\\n    review_rating: $json.review_rating[idx].toInt(),\\n    review_text: $json.review_text[idx],\\n    review_title: $json.review_title[idx],\\n    review_url: $('Get TrustPilot Page').params.url.match(/https:\\\\/\\\\/[^/]+/) + $json.review_url[idx],\\n  }))\\n}}\"}]}},\"typeVersion\":3.4},{\"id\":\"9290e116-c001-49d5-ae4c-d91cd246f2c2\",\"name\":\"Extract Reviews\",\"type\":\"n8n-nodes-base.html\",\"position\":[1140,520],\"parameters\":{\"options\":{\"trimValues\":true},\"operation\":\"extractHtmlContent\",\"extractionValues\":{\"values\":[{\"key\":\"review_author\",\"cssSelector\":\"[data-service-review-card-paper] [data-consumer-name-typography]\",\"returnArray\":true},{\"key\":\"review_rating\",\"attribute\":\"data-service-review-rating\",\"cssSelector\":\"[data-service-review-rating]\",\"returnArray\":true,\"returnValue\":\"attribute\"},{\"key\":\"review_title\",\"cssSelector\":\"[data-service-review-title-typography]\",\"returnArray\":true},{\"key\":\"review_text\",\"cssSelector\":\"[data-service-review-text-typography]\",\"returnArray\":true},{\"key\":\"review_date_of_experience\",\"cssSelector\":\"[data-service-review-date-of-experience-typography]\",\"returnArray\":true},{\"key\":\"review_date\",\"attribute\":\"datetime\",\"cssSelector\":\"[data-service-review-date-time-ago]\",\"returnArray\":true,\"returnValue\":\"attribute\"},{\"key\":\"review_country\",\"cssSelector\":\"[data-consumer-country-typography]\",\"returnArray\":true},{\"key\":\"review_author_reviews_count\",\"cssSelector\":\"[data-consumer-reviews-count-typography]\",\"returnArray\":true},{\"key\":\"review_url\",\"attribute\":\"href\",\"cssSelector\":\"a[data-review-title-typography]\",\"returnArray\":true,\"returnValue\":\"attribute\"}]}},\"typeVersion\":1.2},{\"id\":\"4aa3e50d-fcce-48a7-8237-c12f8592f69e\",\"name\":\"Reviews to List\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[1380,520],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"data\"},\"typeVersion\":1},{\"id\":\"a6b9abf9-a17a-4f30-9f90-6183770c4933\",\"name\":\"Default Data Loader\",\"type\":\"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\"position\":[1980,520],\"parameters\":{\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"review_author\",\"value\":\"={{ $json.review_author }}\"},{\"name\":\"review_author_reviews_count\",\"value\":\"={{ $json.review_author_reviews_count }}\"},{\"name\":\"review_country\",\"value\":\"={{ $json.review_country }}\"},{\"name\":\"review_date\",\"value\":\"={{ $json.review_date }}\"},{\"name\":\"review_date_of_experience\",\"value\":\"={{ $json.review_date_of_experience }}\"},{\"name\":\"review_rating\",\"value\":\"={{ $json.review_rating }}\"},{\"name\":\"review_date_month\",\"value\":\"={{ $json.review_date.toDateTime().format('M') }}\"},{\"name\":\"review_date_year\",\"value\":\"={{ $json.review_date.toDateTime().format('yyyy') }}\"},{\"name\":\"review_date_of_experience_month\",\"value\":\"={{ $json.review_date_of_experience.toDateTime().format('M') }}\"},{\"name\":\"review_date_of_experience_year\",\"value\":\"={{ $json.review_date_of_experience.toDateTime().format('yyyy') }}\"},{\"name\":\"company_id\",\"value\":\"={{ $('Set Variables').item.json.companyId }}\"},{\"name\":\"review_url\",\"value\":\"={{ $json.review_url }}\"}]}},\"jsonData\":\"={{ $json.review_title }}\\n{{ $json.review_text }}\",\"jsonMode\":\"expressionData\"},\"typeVersion\":1},{\"id\":\"afd8907c-9a59-4dcc-94c5-2114fb2a7d5d\",\"name\":\"Recursive Character Text Splitter\",\"type\":\"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\"position\":[1980,660],\"parameters\":{\"options\":{},\"chunkSize\":4000},\"typeVersion\":1},{\"id\":\"e22d92b8-e8e9-42aa-9d02-2e70234f11ed\",\"name\":\"Embeddings OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[1860,520],\"parameters\":{\"model\":\"text-embedding-3-small\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"f0ea6b63-c96d-4b3f-8a21-d0f2dbb4efc3\",\"name\":\"Set Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[520,440],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"2e58a9fa-a14d-4a6c-8cc8-8ec947c791fb\",\"name\":\"companyId\",\"type\":\"string\",\"value\":\"www.freddiesflowers.com\"}]}},\"typeVersion\":3.4},{\"id\":\"0188986f-fbe9-4c06-892a-3cb71b52a309\",\"name\":\"Get Payload of Points\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1740,1120],\"parameters\":{\"url\":\"=http://qdrant:6333/collections/trustpilot_reviews/points\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={{\\n  {\\n    \\\"ids\\\": $json.points,\\n    \\\"with_payload\\\": true\\n  }\\n}}\",\"sendBody\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"qdrantApi\"},\"credentials\":{\"qdrantApi\":{\"id\":\"NyinAS3Pgfik66w5\",\"name\":\"QdrantApi account\"}},\"typeVersion\":4.2},{\"id\":\"5fc6e0b6-507f-4cfd-951b-be3709b86ac2\",\"name\":\"Clusters To List\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[1480,1120],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"output\"},\"typeVersion\":1},{\"id\":\"f21369b9-1dd5-4b35-a1f3-00fd67794051\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[2140,1340],\"parameters\":{\"model\":\"gpt-4o-mini\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"b0075699-6513-4781-b5de-81d1ab81dfe1\",\"name\":\"Only Clusters With 3+ points\",\"type\":\"n8n-nodes-base.filter\",\"position\":[1480,1300],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"328f806c-0792-4d90-9bee-a1e10049e78f\",\"operator\":{\"type\":\"array\",\"operation\":\"lengthGt\",\"rightType\":\"number\"},\"leftValue\":\"={{ $json.points }}\",\"rightValue\":2}]}},\"typeVersion\":2},{\"id\":\"f6a6209c-d269-4238-8e92-230df7b41df9\",\"name\":\"Set Variables1\",\"type\":\"n8n-nodes-base.set\",\"position\":[519,1220],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"2e58a9fa-a14d-4a6c-8cc8-8ec947c791fb\",\"name\":\"companyId\",\"type\":\"string\",\"value\":\"={{ $json.companyId }}\"},{\"id\":\"37cf8af2-6f0f-40b1-b822-c9bd6a620a3c\",\"name\":\"review_date_from\",\"type\":\"string\",\"value\":\"={{ $today.startOf('month').toISO() }}\"},{\"id\":\"8d72f739-f832-4c25-b62a-2ae70ad2b1e7\",\"name\":\"review_date_to\",\"type\":\"string\",\"value\":\"={{ $today.endOf('month').toISO() }}\"}]}},\"typeVersion\":3.4},{\"id\":\"85cb48b1-0ab9-4f88-88f3-82fcfb041ebe\",\"name\":\"Find Reviews\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[896,1160],\"parameters\":{\"url\":\"=http://qdrant:6333/collections/trustpilot_reviews/points/scroll\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n  \\\"limit\\\": 500,\\n  \\\"filter\\\":{\\n    \\\"must\\\": [\\n      {\\n        \\\"key\\\": \\\"metadata.company_id\\\",\\n        \\\"match\\\": { \\\"value\\\": \\\"{{ $('Set Variables1').item.json.companyId }}\\\" }\\n      },\\n      {\\n        \\\"key\\\": \\\"metadata.review_date\\\",\\n        \\\"range\\\": {\\n          \\\"gte\\\": \\\"{{ $('Set Variables1').item.json.review_date_from }}\\\",\\n          \\\"gt\\\": null,\\n          \\\"lt\\\": null,\\n          \\\"lte\\\": \\\"{{ $('Set Variables1').item.json.review_date_to }}\\\"\\n        }\\n      }\\n    ]\\n  },\\n  \\\"with_vector\\\":true\\n}\",\"sendBody\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"qdrantApi\"},\"credentials\":{\"qdrantApi\":{\"id\":\"NyinAS3Pgfik66w5\",\"name\":\"QdrantApi account\"}},\"typeVersion\":4.2},{\"id\":\"69bbd197-c78f-4dae-9300-fe23d4d49855\",\"name\":\"Prep Output For Export\",\"type\":\"n8n-nodes-base.set\",\"position\":[2720,1203],\"parameters\":{\"mode\":\"raw\",\"options\":{},\"jsonOutput\":\"={{ {\\n  ...$json.output,\\n  \\\"CompanyID\\\": $('Set Variables1').item.json.companyId,\\n  \\\"From\\\": $('Set Variables1').item.json.review_date_from,\\n  \\\"To\\\": $('Set Variables1').item.json.review_date_to,\\n  \\\"Number of Responses\\\": $('Get Payload of Points').item.json.result.length,\\n  \\\"Raw Responses\\\": $('Get Payload of Points').item.json.result.map(item =>\\n    [\\n      item.payload.metadata.review_date,\\n      item.payload.metadata.review_author,\\n      item.payload.metadata.review_rating,\\n      item.payload.content.replaceAll('\\\"', '\\\\\\\"').replaceAll('\\\\n', ' '),\\n      item.payload.metadata.review_url,\\n    ]\\n   ).join('\\\\n')\\n} }}\\n\"},\"typeVersion\":3.4},{\"id\":\"d77daa23-6acf-4daa-bf4c-33da4d05a54c\",\"name\":\"Export To Sheets\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[2940,1203],\"parameters\":{\"columns\":{\"value\":{},\"schema\":[{\"id\":\"CompanyID\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"CompanyID\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"From\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"From\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"To\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"To\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Insight\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Insight\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Sentiment\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Sentiment\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Suggested Improvements\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Suggested Improvements\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Number of Responses\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Number of Responses\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Raw Responses\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Raw Responses\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"autoMapInputData\",\"matchingColumns\":[]},\"options\":{},\"operation\":\"append\",\"sheetName\":{\"__rl\":true,\"mode\":\"name\",\"value\":\"=Sheet1\"},\"documentId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"=1wAwWCcIZod00IGtxwTbTgjIRbKHu3Yl9wYWJ8GeT2Os\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"XHvC7jIRR8A2TlUl\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.4},{\"id\":\"1f60c3a5-a47a-4313-9b29-8ea652d573f7\",\"name\":\"Clear Existing Reviews\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[760,440],\"parameters\":{\"url\":\"http://qdrant:6333/collections/trustpilot_reviews/points/delete\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n    \\\"filter\\\": {\\n        \\\"must\\\": [\\n            {\\n                \\\"key\\\": \\\"metadata.company_id\\\",\\n                \\\"match\\\": {\\n                    \\\"value\\\": \\\"{{ $('Set Variables').item.json.companyId }}\\\"\\n                }\\n            }\\n        ]\\n    }\\n}\",\"sendBody\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"qdrantApi\"},\"credentials\":{\"qdrantApi\":{\"id\":\"NyinAS3Pgfik66w5\",\"name\":\"QdrantApi account\"}},\"typeVersion\":4.2},{\"id\":\"61c3117c-757c-45dd-b9d5-1122b793be30\",\"name\":\"Trigger Insights\",\"type\":\"n8n-nodes-base.executeWorkflow\",\"position\":[2660,440],\"parameters\":{\"options\":{},\"workflowId\":\"={{ $workflow.id }}\"},\"typeVersion\":1},{\"id\":\"d3c6e81f-34bb-4be9-b869-2c219b87c4fb\",\"name\":\"Prep Values For Trigger\",\"type\":\"n8n-nodes-base.set\",\"position\":[2460,440],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"24dd90ad-390f-444e-ba6c-8c06a41e836e\",\"name\":\"companyId\",\"type\":\"string\",\"value\":\"={{ $('Set Variables').item.json.companyId }}\"}]}},\"executeOnce\":true,\"typeVersion\":3.4},{\"id\":\"64af9cc7-a194-4427-ba78-d9a1136b962f\",\"name\":\"Execute Workflow Trigger\",\"type\":\"n8n-nodes-base.executeWorkflowTrigger\",\"position\":[316,1220],\"parameters\":{},\"typeVersion\":1},{\"id\":\"7b6ba502-36c2-41e6-9d67-781d0d40a569\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[186.9455564469605,263.2301011325764],\"parameters\":{\"color\":7,\"width\":787.3314861380661,\"height\":465.52420584035275,\"content\":\"## Step 1. Starting Fresh\\nFor this demo, we'll clear any existing records in our Qdrant vector store for the selected company. We do this using the Qdrant's delete points API.\"},\"typeVersion\":1},{\"id\":\"a99389d4-8ea6-4379-b725-f30e92b0d29e\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1006.3778510483207,148.50042906971555],\"parameters\":{\"color\":7,\"width\":638.5221986278162,\"height\":580.2538779032135,\"content\":\"## Step 2. Scraping TrustPilot For Company Reviews\\n[Read more about HTTP Request Node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/)\\n\\nWe'll scrape at the most recent 3 pages of reviews for illustrative purposes but we could easily scrape them all if required. The HTML node offers a convenient way to extract data from the returned html pages and using it, we'll retrieve all the reviews data.\"},\"typeVersion\":1},{\"id\":\"139ccadd-9135-4681-b2eb-403b8d8bd710\",\"name\":\"Get TrustPilot Page\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1140,360],\"parameters\":{\"url\":\"=https://uk.trustpilot.com/review/{{ $('Set Variables').item.json.companyId }}?sort=recency\",\"options\":{\"pagination\":{\"pagination\":{\"parameters\":{\"parameters\":[{\"name\":\"page\",\"value\":\"={{ $pageCount + 1 }}\"}]},\"maxRequests\":3,\"limitPagesFetched\":true}}}},\"executeOnce\":false,\"typeVersion\":4.2},{\"id\":\"1c71db65-713b-4c31-9c11-5ff678fb327a\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1680,140],\"parameters\":{\"color\":7,\"width\":638.5221986278162,\"height\":689.8000993522735,\"content\":\"## Step 3. Store Reviews in Qdrant\\n[Learn more about the Qdrant Vector Store](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.vectorstoreqdrant/)\\n\\nVector databases are a great way to store data if you're interested in perform similiarity searches which applies here as we want to group similar reviews to find patterns. Qdrant is a powerful vector database and tool of choice because of its robust API implementation and advanced filtering capabilities.\"},\"typeVersion\":1},{\"id\":\"a4f82a1b-5a76-46b6-a7a3-84ab09b46699\",\"name\":\"Qdrant Vector Store\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreQdrant\",\"position\":[1860,360],\"parameters\":{\"mode\":\"insert\",\"options\":{},\"qdrantCollection\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"=trustpilot_reviews\"}},\"credentials\":{\"qdrantApi\":{\"id\":\"NyinAS3Pgfik66w5\",\"name\":\"QdrantApi account\"}},\"typeVersion\":1},{\"id\":\"cbad9e73-c5b3-474c-95ef-7269addc4e62\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[216,1000],\"parameters\":{\"color\":7,\"width\":543.4265511994403,\"height\":453.31956386852846,\"content\":\"## Step 5. The Insight Subworkflow\\n[Learn more about Workflow Triggers](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflowtrigger)\\n\\nThis subworkflow takes the companyId to find the relevant records in our Qdrant vector store. It also takes a \\\"from\\\" and \\\"to\\\" date to scope the insights to a particular range - doing this we can say something like \\\"we only want insights for the past month of reviews\\\". \"},\"typeVersion\":1},{\"id\":\"9c530716-63f4-4368-8d0e-0cdbe8f5b08e\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[780,920],\"parameters\":{\"color\":7,\"width\":557.7420442679241,\"height\":526.2781960611934,\"content\":\"## Step 6. Apply Clustering Algorithm to Reviews\\n[Read more about using Python in n8n](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code)\\n\\nWe'll retrieve our vectors embeddings for the desired company reviews and perform an advanced clustering algorithm on them. This powerful echnique allows us to quickly group similar embeddings into clusters which we can then use to discover popular feedback, opinions and pain-points!\"},\"typeVersion\":1},{\"id\":\"9790b3a5-cc7c-4e12-8038-fc661c8226f8\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1360,920],\"parameters\":{\"color\":7,\"width\":598.5585287222906,\"height\":605.9905193915599,\"content\":\"## Step 7. Fetch Reviews By Cluster\\n[Learn more about using the Code Node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code/)\\n\\nWith the Qdrant point IDs grouped and returned by our code node, all that's left is to fetch the payload of each. Note that the clustering algorithm isn't perfect and may require some tweaking depending on your data.\"},\"typeVersion\":1},{\"id\":\"267057b6-9727-4a45-9d87-5429da42f48e\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1980,969],\"parameters\":{\"color\":7,\"width\":587.6069484146701,\"height\":552.9535170892194,\"content\":\"## Step 8. Getting Insights from Grouped Reviews\\n[Read more about using Information Extractor Node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.information-extractor)\\n\\nNext, we'll use our state-of-the-art LLM to generate insights on our reviews. Doing it this way, we'll able to pull more granular results addressing many key topics within the reviews.\"},\"typeVersion\":1},{\"id\":\"b8cc07d0-ffa3-425f-ae74-76dcb68fa88f\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2600,980],\"parameters\":{\"color\":7,\"width\":572.5638733479158,\"height\":464.4019616956416,\"content\":\"## Step 9. Write To Insights Sheet\\nFinally, our completed insights to appended to the Insights Sheet we created earlier in the workflow.\\n\\nYou can find a sample sheet here: https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6ipJnXWXgr5wlUJnhioNpeYrxaIpsRYZCwN3C-fFXumkbh9TAsA_JzE0kbv7DcGAVIP7az0L46_2P/pubhtml\"},\"typeVersion\":1},{\"id\":\"0dac0854-7106-44e3-bd68-fad7b201a6bc\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2340,240],\"parameters\":{\"color\":7,\"width\":519.6419932444072,\"height\":429.11782776909047,\"content\":\"## Step 4. Trigger Insights SubWorkflow\\n[Learn more about Workflow Triggers](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow)\\n\\nA subworkflow is used to trigger the analysis for the survey. This separation is optional but used here to better demonstrate the two part process.\"},\"typeVersion\":1},{\"id\":\"4aa7e73e-c29d-41df-b2f8-a62109285ccb\",\"name\":\"Sticky Note9\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[460,380],\"parameters\":{\"width\":226.36363118160727,\"height\":327.0249036433755,\"content\":\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### ğŸš¨ Set company here!\\nTrustpilot must recognise it as part of the url.\"},\"typeVersion\":1},{\"id\":\"4d895cf9-452c-401e-a6f3-b9d3a359a96d\",\"name\":\"Apply K-means Clustering Algorithm\",\"type\":\"n8n-nodes-base.code\",\"position\":[1116,1160],\"parameters\":{\"language\":\"python\",\"pythonCode\":\"import numpy as np\\nfrom sklearn.cluster import KMeans\\n\\n# get vectors for all answers\\npoint_ids = [item.id for item in _input.first().json.result.points]\\nvectors = [item.vector.to_py() for item in _input.first().json.result.points]\\nvectors_array = np.array(vectors)\\n\\n# apply k-means clustering where n_clusters = 5\\n# this is a max and we'll discard some of these clusters later\\nkmeans = KMeans(n_clusters=min(len(vectors), 5), random_state=42).fit(vectors_array)\\nlabels = kmeans.labels_\\nunique_labels = set(labels)\\n\\n# Extract and print points in each cluster\\nclusters = {}\\nfor label in set(labels):\\n    clusters[label] = vectors_array[labels == label]\\n\\n# return Qdrant point ids for each cluster\\n# we'll use these ids to fetch the payloads from the vector store.\\noutput = []\\nfor cluster_id, cluster_points in clusters.items():\\n    points = [point_ids[i] for i in range(len(labels)) if labels[i] == cluster_id]\\n    output.append({\\n        \\\"id\\\": f\\\"Cluster {cluster_id}\\\",\\n        \\\"total\\\": len(cluster_points),\\n        \\\"points\\\": points\\n    })\\n\\nreturn {\\\"json\\\": {\\\"output\\\": output } }\"},\"typeVersion\":2},{\"id\":\"95c57019-d9d7-4d9f-93dd-21d3d9708861\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,40],\"parameters\":{\"width\":400.381109509268,\"height\":612.855812336249,\"content\":\"## Try It Out!\\n\\n### This workflow generates highly-detailed customer insights from Trustpilot reviews. Works best when dealing with a large number of reviews.\\n\\n* Import Trustpilot reviews and vectorise in Qdrant vectorstore.\\n* Identify clusters of popular topics in reviews using K-means clustering algorithm. \\n* Each valid cluster is analysed and summarised by LLM.\\n* Export LLM response and cluster results back into sheet.\\n\\nCheck out the reference google sheet here: https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6ipJnXWXgr5wlUJnhioNpeYrxaIpsRYZCwN3C-fFXumkbh9TAsA_JzE0kbv7DcGAVIP7az0L46_2P/pubhtml\\n\\n### Need Help?\\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\\n\\nHappy Hacking!\"},\"typeVersion\":1},{\"id\":\"9bba9480-792e-48e3-ad9f-8809ce3aba09\",\"name\":\"Customer Insights Agent\",\"type\":\"@n8n/n8n-nodes-langchain.informationExtractor\",\"position\":[2140,1180],\"parameters\":{\"text\":\"=The {{ $json.result.length }} reviews were:\\n{{\\n$json.result.map(item =>\\n`* ${item.payload.metadata.review_author} gave ${item.payload.metadata.review_rating} stars: \\\"${item.payload.content.replaceAll('\\\"', '\\\\\\\"').replaceAll('\\\\n', ' ')}\\\"`\\n).join('\\\\n')\\n}}\",\"options\":{\"systemPromptTemplate\":\"=You help summarise a selection of trustpilot reviews for a company called \\\"{{ $json.result[0].payload.metadata.company_id }}\\\".\\nThe {{ $json.result.length }} reviews were selected because their contents were similar in context.\\n\\nYour task is to: \\n* summarise the given reviews into a short paragraph. Provide an insight from this summary and what we could learn from the reviews.\\n* determine if the overall sentiment of all the listed responses to be either strongly negative, negative, neutral, positive or strongly positive.\"},\"schemaType\":\"fromJson\",\"jsonSchemaExample\":\"{\\n\\t\\\"Insight\\\": \\\"\\\",\\n    \\\"Sentiment\\\": \\\"\\\",\\n    \\\"Suggested Improvements\\\": \\\"\\\"\\n}\"},\"typeVersion\":1},{\"id\":\"4488deb9-27f6-4f9d-b17e-9b5e7a1bba33\",\"name\":\"Sticky Note12\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[180,760],\"parameters\":{\"color\":5,\"width\":323.2987132716669,\"height\":80,\"content\":\"### Run this once! \\nIf for any reason you need to run more than once, be sure to clear the existing data first.\"},\"typeVersion\":1},{\"id\":\"5cb3bd73-1e77-4eba-9d2e-634fdc374330\",\"name\":\"Sticky Note11\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[780,1480],\"parameters\":{\"color\":5,\"width\":323.2987132716669,\"height\":110.05160146874424,\"content\":\"### First Time Running?\\nThere is a slight delay on first run because the code node has to download the required packages.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Zip Entries\":{\"main\":[[{\"node\":\"Reviews to List\",\"type\":\"main\",\"index\":0}]]},\"Find Reviews\":{\"main\":[[{\"node\":\"Apply K-means Clustering Algorithm\",\"type\":\"main\",\"index\":0}]]},\"Set Variables\":{\"main\":[[{\"node\":\"Clear Existing Reviews\",\"type\":\"main\",\"index\":0}]]},\"Set Variables1\":{\"main\":[[{\"node\":\"Find Reviews\",\"type\":\"main\",\"index\":0}]]},\"Extract Reviews\":{\"main\":[[{\"node\":\"Zip Entries\",\"type\":\"main\",\"index\":0}]]},\"Reviews to List\":{\"main\":[[{\"node\":\"Qdrant Vector Store\",\"type\":\"main\",\"index\":0}]]},\"Clusters To List\":{\"main\":[[{\"node\":\"Only Clusters With 3+ points\",\"type\":\"main\",\"index\":0}]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"Qdrant Vector Store\",\"type\":\"ai_embedding\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"Customer Insights Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Default Data Loader\":{\"ai_document\":[[{\"node\":\"Qdrant Vector Store\",\"type\":\"ai_document\",\"index\":0}]]},\"Get TrustPilot Page\":{\"main\":[[{\"node\":\"Extract Reviews\",\"type\":\"main\",\"index\":0}]]},\"Qdrant Vector Store\":{\"main\":[[{\"node\":\"Prep Values For Trigger\",\"type\":\"main\",\"index\":0}]]},\"Get Payload of Points\":{\"main\":[[{\"node\":\"Customer Insights Agent\",\"type\":\"main\",\"index\":0}]]},\"Clear Existing Reviews\":{\"main\":[[{\"node\":\"Get TrustPilot Page\",\"type\":\"main\",\"index\":0}]]},\"Prep Output For Export\":{\"main\":[[{\"node\":\"Export To Sheets\",\"type\":\"main\",\"index\":0}]]},\"Customer Insights Agent\":{\"main\":[[{\"node\":\"Prep Output For Export\",\"type\":\"main\",\"index\":0}]]},\"Prep Values For Trigger\":{\"main\":[[{\"node\":\"Trigger Insights\",\"type\":\"main\",\"index\":0}]]},\"Execute Workflow Trigger\":{\"main\":[[{\"node\":\"Set Variables1\",\"type\":\"main\",\"index\":0}]]},\"Only Clusters With 3+ points\":{\"main\":[[{\"node\":\"Get Payload of Points\",\"type\":\"main\",\"index\":0}]]},\"Recursive Character Text Splitter\":{\"ai_textSplitter\":[[{\"node\":\"Default Data Loader\",\"type\":\"ai_textSplitter\",\"index\":0}]]},\"When clicking â€˜Test workflowâ€™\":{\"main\":[[{\"node\":\"Set Variables\",\"type\":\"main\",\"index\":0}]]},\"Apply K-means Clustering Algorithm\":{\"main\":[[{\"node\":\"Clusters To List\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This n8n template is one of a 3-part series exploring use-cases for clustering vector embeddings:\n\n  * Survey Insights\n  * Customer Insights\n  * Community Insights\n\n\n\nThis template demonstrates the Customer Insights scenario where Trustpilot reviews can be quickly grouped by similarity and an AI agent can generate insights on those groupings.\n\nWith this workflow, marketers can save days and even weeks of work breaking down their own or competitor reviews and identify frequently mentioned positives and negatives.\n\nSample Output: <https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6ipJnXWXgr5wlUJnhioNpeYrxaIpsRYZCwN3C-fFXumkbh9TAsA_JzE0kbv7DcGAVIP7az0L46_2P/pubhtml>\n\n### How it works\n\n  * Trustpilot reviews are scraped for a particular company using the HTTP request node.\n  * Reviews are then inserted into a Qdrant collection carefully tagged with the question and Trustpilot metadata.\n  * Reviews are fetched and put through a clustering algorithm using the Python Code node. The Qdrant points are returned in clustered groups.\n  * Each group is looped to fetch the payloads of the points and feed them to the AI agent to summarise and generate insights for.\n  * The resulting insights and raw responses are then saved to the Google Spreadsheet for further analysis by the marketer.\n\n\n\n### Requirements\n\n  * Qdrant Vectorstore for storing embeddings.\n  * OpenAI account for embeddings and LLM.\n\n\n\n### Customising the Template\n\n  * Adjust clustering parameters which make sense for your data.\n  * Consider expanding date range of reviews for insights over common intervals: 3mth, 6mth and YTD.\n\n\n",
  "crawled_at": "2025-05-25T23:38:06.645834",
  "readme_zh": "æ­¤n8næ¨¡æ¿æ˜¯ä¸€ä¸ªæ¢ç´¢å‘é‡åµŒå…¥èšç±»åº”ç”¨åœºæ™¯çš„ä¸‰éƒ¨æ›²ç³»åˆ—ä¹‹ä¸€ï¼š\n\n* è°ƒç ”æ´å¯Ÿ\n* å®¢æˆ·æ´å¯Ÿ\n* ç¤¾åŒºæ´å¯Ÿ\n\næœ¬æ¨¡æ¿å±•ç¤ºå®¢æˆ·æ´å¯Ÿåœºæ™¯ï¼Œå¯å¿«é€ŸæŒ‰ç›¸ä¼¼æ€§å¯¹Trustpilotè¯„è®ºè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç”±AIæ™ºèƒ½ä½“ç”Ÿæˆåˆ†ç»„æ´è§ã€‚é€šè¿‡è¯¥å·¥ä½œæµï¼Œè¥é”€äººå‘˜èƒ½èŠ‚çœæ•°æ—¥ç”šè‡³æ•°å‘¨åˆ†æè‡ªèº«æˆ–ç«å“è¯„è®ºçš„æ—¶é—´ï¼Œç²¾å‡†è¯†åˆ«é«˜é¢‘æåŠçš„ä¼˜ç¼ºç‚¹ã€‚\n\nç¤ºä¾‹è¾“å‡ºï¼š<https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6ipJnXWXgr5wlUJnhioNpeYrxaIpsRYZCwN3C-fFXumkbh9TAsA_JzE0kbv7DcGAVIP7az0L46_2P/pubhtml>\n\n### å®ç°åŸç†\n\n* é€šè¿‡HTTPè¯·æ±‚èŠ‚ç‚¹æŠ“å–æŒ‡å®šä¼ä¸šçš„Trustpilotè¯„è®º\n* å°†è¯„è®ºå­˜å…¥Qdranté›†åˆï¼Œå¹¶æ ‡æ³¨é—®é¢˜ç±»å‹å’ŒTrustpilotå…ƒæ•°æ®\n* ä½¿ç”¨Pythonä»£ç èŠ‚ç‚¹è·å–è¯„è®ºå¹¶è¿›è¡Œèšç±»ç®—æ³•å¤„ç†ï¼Œè¿”å›åˆ†ç»„åçš„Qdrantæ•°æ®ç‚¹\n* å¾ªç¯æ¯ä¸ªåˆ†ç»„è·å–æ•°æ®ç‚¹å†…å®¹ï¼Œäº¤ç”±AIæ™ºèƒ½ä½“ç”Ÿæˆæ‘˜è¦å’Œæ´å¯Ÿ\n* æœ€ç»ˆå°†æ´å¯ŸæŠ¥å‘Šå’ŒåŸå§‹æ•°æ®å­˜å…¥Googleè¡¨æ ¼ä¾›è¥é”€äººå‘˜æ·±åº¦åˆ†æ\n\n### ç¯å¢ƒè¦æ±‚\n\n* éœ€éƒ¨ç½²Qdrantå‘é‡æ•°æ®åº“å­˜å‚¨åµŒå…¥æ•°æ®\n* éœ€å¼€é€šOpenAIè´¦æˆ·ç”¨äºåµŒå…¥ç”Ÿæˆå’Œå¤§è¯­è¨€æ¨¡å‹\n\n### æ¨¡æ¿å®šåˆ¶\n\n* æ ¹æ®æ•°æ®ç‰¹æ€§è°ƒæ•´èšç±»å‚æ•°\n* å¯æ‰©å±•è¯„è®ºæ—¶é—´èŒƒå›´ï¼ˆå¦‚3ä¸ªæœˆ/6ä¸ªæœˆ/å¹´åˆè‡³ä»Šï¼‰è·å–å‘¨æœŸæ€§æ´å¯Ÿ",
  "title_zh": "ä½¿ç”¨Qdrantã€Pythonå’Œä¿¡æ¯æå–å™¨è·å–å®¢æˆ·æ´å¯Ÿ",
  "publish_date_zh": "æœ€åæ›´æ–°äº8ä¸ªæœˆå‰",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"63501cc8-77c9-4037-9f70-da23b6d20b03\",\n      \"name\": \"When clicking â€˜Test workflowâ€™\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        280,\n        440\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"00de989c-d9e9-4b42-b5db-7097800a6017\",\n      \"name\": \"Zip Entries\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1380,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"833a554d-2b39-4160-9348-18b17b28ce30\",\n              \"name\": \"data\",\n              \"type\": \"array\",\n              \"value\": \"={{ \\n  $json.review_author.map((review_author, idx) => ({\\n    review_author,\\n    review_author_reviews_count: $json.review_author_reviews_count[idx].replace(' reviews', '').toInt(),\\n    review_country: $json.review_country[idx],\\n    review_date: $json.review_date[idx].toDate(),\\n    review_date_of_experience: $json.review_date_of_experience[idx].replace('Date of experience: ', '').toDate(),\\n    review_rating: $json.review_rating[idx].toInt(),\\n    review_text: $json.review_text[idx],\\n    review_title: $json.review_title[idx],\\n    review_url: $('Get TrustPilot Page').params.url.match(/https:\\\\/\\\\/[^/]+/) + $json.review_url[idx],\\n  }))\\n}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"9290e116-c001-49d5-ae4c-d91cd246f2c2\",\n      \"name\": \"Extract Reviews\",\n      \"type\": \"n8n-nodes-base.html\",\n      \"position\": [\n        1140,\n        520\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"trimValues\": true\n        },\n        \"operation\": \"extractHtmlContent\",\n        \"extractionValues\": {\n          \"values\": [\n            {\n              \"key\": \"review_author\",\n              \"cssSelector\": \"[data-service-review-card-paper] [data-consumer-name-typography]\",\n              \"returnArray\": true\n            },\n            {\n              \"key\": \"review_rating\",\n              \"attribute\": \"data-service-review-rating\",\n              \"cssSelector\": \"[data-service-review-rating]\",\n              \"returnArray\": true,\n              \"returnValue\": \"attribute\"\n            },\n            {\n              \"key\": \"review_title\",\n              \"cssSelector\": \"[data-service-review-title-typography]\",\n              \"returnArray\": true\n            },\n            {\n              \"key\": \"review_text\",\n              \"cssSelector\": \"[data-service-review-text-typography]\",\n              \"returnArray\": true\n            },\n            {\n              \"key\": \"review_date_of_experience\",\n              \"cssSelector\": \"[data-service-review-date-of-experience-typography]\",\n              \"returnArray\": true\n            },\n            {\n              \"key\": \"review_date\",\n              \"attribute\": \"datetime\",\n              \"cssSelector\": \"[data-service-review-date-time-ago]\",\n              \"returnArray\": true,\n              \"returnValue\": \"attribute\"\n            },\n            {\n              \"key\": \"review_country\",\n              \"cssSelector\": \"[data-consumer-country-typography]\",\n              \"returnArray\": true\n            },\n            {\n              \"key\": \"review_author_reviews_count\",\n              \"cssSelector\": \"[data-consumer-reviews-count-typography]\",\n              \"returnArray\": true\n            },\n            {\n              \"key\": \"review_url\",\n              \"attribute\": \"href\",\n              \"cssSelector\": \"a[data-review-title-typography]\",\n              \"returnArray\": true,\n              \"returnValue\": \"attribute\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"4aa3e50d-fcce-48a7-8237-c12f8592f69e\",\n      \"name\": \"Reviews to List\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        1380,\n        520\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a6b9abf9-a17a-4f30-9f90-6183770c4933\",\n      \"name\": \"Default Data Loader\",\n      \"type\": \"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\n      \"position\": [\n        1980,\n        520\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"review_author\",\n                \"value\": \"={{ $json.review_author }}\"\n              },\n              {\n                \"name\": \"review_author_reviews_count\",\n                \"value\": \"={{ $json.review_author_reviews_count }}\"\n              },\n              {\n                \"name\": \"review_country\",\n                \"value\": \"={{ $json.review_country }}\"\n              },\n              {\n                \"name\": \"review_date\",\n                \"value\": \"={{ $json.review_date }}\"\n              },\n              {\n                \"name\": \"review_date_of_experience\",\n                \"value\": \"={{ $json.review_date_of_experience }}\"\n              },\n              {\n                \"name\": \"review_rating\",\n                \"value\": \"={{ $json.review_rating }}\"\n              },\n              {\n                \"name\": \"review_date_month\",\n                \"value\": \"={{ $json.review_date.toDateTime().format('M') }}\"\n              },\n              {\n                \"name\": \"review_date_year\",\n                \"value\": \"={{ $json.review_date.toDateTime().format('yyyy') }}\"\n              },\n              {\n                \"name\": \"review_date_of_experience_month\",\n                \"value\": \"={{ $json.review_date_of_experience.toDateTime().format('M') }}\"\n              },\n              {\n                \"name\": \"review_date_of_experience_year\",\n                \"value\": \"={{ $json.review_date_of_experience.toDateTime().format('yyyy') }}\"\n              },\n              {\n                \"name\": \"company_id\",\n                \"value\": \"={{ $('Set Variables').item.json.companyId }}\"\n              },\n              {\n                \"name\": \"review_url\",\n                \"value\": \"={{ $json.review_url }}\"\n              }\n            ]\n          }\n        },\n        \"jsonData\": \"={{ $json.review_title }}\\n{{ $json.review_text }}\",\n        \"jsonMode\": \"expressionData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"afd8907c-9a59-4dcc-94c5-2114fb2a7d5d\",\n      \"name\": \"Recursive Character Text Splitter\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\n      \"position\": [\n        1980,\n        660\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"chunkSize\": 4000\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e22d92b8-e8e9-42aa-9d02-2e70234f11ed\",\n      \"name\": \"Embeddings OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        1860,\n        520\n      ],\n      \"parameters\": {\n        \"model\": \"text-embedding-3-small\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f0ea6b63-c96d-4b3f-8a21-d0f2dbb4efc3\",\n      \"name\": \"Set Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        520,\n        440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"2e58a9fa-a14d-4a6c-8cc8-8ec947c791fb\",\n              \"name\": \"companyId\",\n              \"type\": \"string\",\n              \"value\": \"www.freddiesflowers.com\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0188986f-fbe9-4c06-892a-3cb71b52a309\",\n      \"name\": \"Get Payload of Points\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1740,\n        1120\n      ],\n      \"parameters\": {\n        \"url\": \"=http://qdrant:6333/collections/trustpilot_reviews/points\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{\\n  {\\n    \\\"ids\\\": $json.points,\\n    \\\"with_payload\\\": true\\n  }\\n}}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"qdrantApi\"\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"NyinAS3Pgfik66w5\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"5fc6e0b6-507f-4cfd-951b-be3709b86ac2\",\n      \"name\": \"Clusters To List\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        1480,\n        1120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"output\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f21369b9-1dd5-4b35-a1f3-00fd67794051\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        2140,\n        1340\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4o-mini\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b0075699-6513-4781-b5de-81d1ab81dfe1\",\n      \"name\": \"Only Clusters With 3+ points\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1480,\n        1300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"328f806c-0792-4d90-9bee-a1e10049e78f\",\n              \"operator\": {\n                \"type\": \"array\",\n                \"operation\": \"lengthGt\",\n                \"rightType\": \"number\"\n              },\n              \"leftValue\": \"={{ $json.points }}\",\n              \"rightValue\": 2\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"f6a6209c-d269-4238-8e92-230df7b41df9\",\n      \"name\": \"Set Variables1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        519,\n        1220\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"2e58a9fa-a14d-4a6c-8cc8-8ec947c791fb\",\n              \"name\": \"companyId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.companyId }}\"\n            },\n            {\n              \"id\": \"37cf8af2-6f0f-40b1-b822-c9bd6a620a3c\",\n              \"name\": \"review_date_from\",\n              \"type\": \"string\",\n              \"value\": \"={{ $today.startOf('month').toISO() }}\"\n            },\n            {\n              \"id\": \"8d72f739-f832-4c25-b62a-2ae70ad2b1e7\",\n              \"name\": \"review_date_to\",\n              \"type\": \"string\",\n              \"value\": \"={{ $today.endOf('month').toISO() }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"85cb48b1-0ab9-4f88-88f3-82fcfb041ebe\",\n      \"name\": \"Find Reviews\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        896,\n        1160\n      ],\n      \"parameters\": {\n        \"url\": \"=http://qdrant:6333/collections/trustpilot_reviews/points/scroll\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"limit\\\": 500,\\n  \\\"filter\\\":{\\n    \\\"must\\\": [\\n      {\\n        \\\"key\\\": \\\"metadata.company_id\\\",\\n        \\\"match\\\": { \\\"value\\\": \\\"{{ $('Set Variables1').item.json.companyId }}\\\" }\\n      },\\n      {\\n        \\\"key\\\": \\\"metadata.review_date\\\",\\n        \\\"range\\\": {\\n          \\\"gte\\\": \\\"{{ $('Set Variables1').item.json.review_date_from }}\\\",\\n          \\\"gt\\\": null,\\n          \\\"lt\\\": null,\\n          \\\"lte\\\": \\\"{{ $('Set Variables1').item.json.review_date_to }}\\\"\\n        }\\n      }\\n    ]\\n  },\\n  \\\"with_vector\\\":true\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"qdrantApi\"\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"NyinAS3Pgfik66w5\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"69bbd197-c78f-4dae-9300-fe23d4d49855\",\n      \"name\": \"Prep Output For Export\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2720,\n        1203\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"options\": {},\n        \"jsonOutput\": \"={{ {\\n  ...$json.output,\\n  \\\"CompanyID\\\": $('Set Variables1').item.json.companyId,\\n  \\\"From\\\": $('Set Variables1').item.json.review_date_from,\\n  \\\"To\\\": $('Set Variables1').item.json.review_date_to,\\n  \\\"Number of Responses\\\": $('Get Payload of Points').item.json.result.length,\\n  \\\"Raw Responses\\\": $('Get Payload of Points').item.json.result.map(item =>\\n    [\\n      item.payload.metadata.review_date,\\n      item.payload.metadata.review_author,\\n      item.payload.metadata.review_rating,\\n      item.payload.content.replaceAll('\\\"', '\\\\\\\"').replaceAll('\\\\n', ' '),\\n      item.payload.metadata.review_url,\\n    ]\\n   ).join('\\\\n')\\n} }}\\n\"\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"d77daa23-6acf-4daa-bf4c-33da4d05a54c\",\n      \"name\": \"Export To Sheets\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        2940,\n        1203\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {},\n          \"schema\": [\n            {\n              \"id\": \"CompanyID\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"CompanyID\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"From\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"From\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"To\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"To\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Insight\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Insight\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Sentiment\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Sentiment\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Suggested Improvements\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Suggested Improvements\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Number of Responses\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Number of Responses\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Raw Responses\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Raw Responses\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"autoMapInputData\",\n          \"matchingColumns\": []\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"name\",\n          \"value\": \"=Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"=1wAwWCcIZod00IGtxwTbTgjIRbKHu3Yl9wYWJ8GeT2Os\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.4\n    },\n    {\n      \"id\": \"1f60c3a5-a47a-4313-9b29-8ea652d573f7\",\n      \"name\": \"Clear Existing Reviews\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        760,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"http://qdrant:6333/collections/trustpilot_reviews/points/delete\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n    \\\"filter\\\": {\\n        \\\"must\\\": [\\n            {\\n                \\\"key\\\": \\\"metadata.company_id\\\",\\n                \\\"match\\\": {\\n                    \\\"value\\\": \\\"{{ $('Set Variables').item.json.companyId }}\\\"\\n                }\\n            }\\n        ]\\n    }\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"qdrantApi\"\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"NyinAS3Pgfik66w5\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"61c3117c-757c-45dd-b9d5-1122b793be30\",\n      \"name\": \"Trigger Insights\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        2660,\n        440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"workflowId\": \"={{ $workflow.id }}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d3c6e81f-34bb-4be9-b869-2c219b87c4fb\",\n      \"name\": \"Prep Values For Trigger\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2460,\n        440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"24dd90ad-390f-444e-ba6c-8c06a41e836e\",\n              \"name\": \"companyId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Set Variables').item.json.companyId }}\"\n            }\n          ]\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"64af9cc7-a194-4427-ba78-d9a1136b962f\",\n      \"name\": \"Execute Workflow Trigger\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        316,\n        1220\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7b6ba502-36c2-41e6-9d67-781d0d40a569\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        186.9455564469605,\n        263.2301011325764\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 787.3314861380661,\n        \"height\": 465.52420584035275,\n        \"content\": \"## ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–ç¯å¢ƒ\\nåœ¨æœ¬æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Qdrantçš„åˆ é™¤ç‚¹APIï¼Œæ¸…ç©ºæ‰€é€‰å…¬å¸åœ¨å‘é‡æ•°æ®åº“ä¸­æ‰€æœ‰ç°æœ‰è®°å½•ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a99389d4-8ea6-4379-b725-f30e92b0d29e\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1006.3778510483207,\n        148.50042906971555\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 638.5221986278162,\n        \"height\": 580.2538779032135,\n        \"content\": \"## ç¬¬äºŒæ­¥ï¼šæŠ“å–TrustPilotå¹³å°çš„å…¬å¸è¯„ä»·  \\n[è¯¦ç»†äº†è§£HTTPè¯·æ±‚èŠ‚ç‚¹](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/)  \\n\\nå‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ä»…æŠ“å–æœ€è¿‘3é¡µçš„è¯„ä»·å†…å®¹ï¼Œä½†å¦‚éœ€è·å–å…¨éƒ¨è¯„ä»·äº¦å¯è½»æ¾å®ç°ã€‚é€šè¿‡HTMLèŠ‚ç‚¹èƒ½å¤Ÿä¾¿æ·åœ°ä»è¿”å›çš„HTMLé¡µé¢æå–æ•°æ®ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¯¥èŠ‚ç‚¹è·å–æ‰€æœ‰è¯„ä»·æ•°æ®ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"139ccadd-9135-4681-b2eb-403b8d8bd710\",\n      \"name\": \"Get TrustPilot Page\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1140,\n        360\n      ],\n      \"parameters\": {\n        \"url\": \"=https://uk.trustpilot.com/review/{{ $('Set Variables').item.json.companyId }}?sort=recency\",\n        \"options\": {\n          \"pagination\": {\n            \"pagination\": {\n              \"parameters\": {\n                \"parameters\": [\n                  {\n                    \"name\": \"page\",\n                    \"value\": \"={{ $pageCount + 1 }}\"\n                  }\n                ]\n              },\n              \"maxRequests\": 3,\n              \"limitPagesFetched\": true\n            }\n          }\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"1c71db65-713b-4c31-9c11-5ff678fb327a\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1680,\n        140\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 638.5221986278162,\n        \"height\": 689.8000993522735,\n        \"content\": \"## ç¬¬ä¸‰æ­¥ï¼šå°†è¯„è®ºå­˜å‚¨è‡³Qdrant\\n[æ·±å…¥äº†è§£Qdrantå‘é‡æ•°æ®åº“](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.vectorstoreqdrant/)\\n\\nè‹¥éœ€è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼ˆè¿™æ­£æ˜¯æˆ‘ä»¬å¸Œæœ›é€šè¿‡å½’ç±»ç›¸ä¼¼è¯„è®ºæ¥å‘ç°è§„å¾‹çš„åº”ç”¨åœºæ™¯ï¼‰ï¼Œå‘é‡æ•°æ®åº“æ˜¯å­˜å‚¨æ•°æ®çš„ç†æƒ³é€‰æ‹©ã€‚Qdrantå‡­å€Ÿå…¶ç¨³å¥çš„APIå®ç°å’Œé«˜çº§è¿‡æ»¤åŠŸèƒ½ï¼Œæˆä¸ºæˆ‘ä»¬é€‰ç”¨çš„å¼ºåŠ›å‘é‡æ•°æ®åº“å·¥å…·ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a4f82a1b-5a76-46b6-a7a3-84ab09b46699\",\n      \"name\": \"Qdrant Vector Store\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreQdrant\",\n      \"position\": [\n        1860,\n        360\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"options\": {},\n        \"qdrantCollection\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"=trustpilot_reviews\"\n        }\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"NyinAS3Pgfik66w5\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cbad9e73-c5b3-474c-95ef-7269addc4e62\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        216,\n        1000\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 543.4265511994403,\n        \"height\": 453.31956386852846,\n        \"content\": \"## ç¬¬äº”æ­¥ï¼šæ´å¯Ÿå­æµç¨‹  \\n[è¯¦ç»†äº†è§£å·¥ä½œæµè§¦å‘å™¨](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflowtrigger)  \\n\\nè¯¥å­æµç¨‹é€šè¿‡å…¬å¸IDï¼ˆcompanyIdï¼‰åœ¨Qdrantå‘é‡æ•°æ®åº“ä¸­æ£€ç´¢ç›¸å…³è®°å½•ï¼ŒåŒæ—¶æ¥æ”¶èµ·æ­¢æ—¥æœŸï¼ˆ\\\"from\\\"å’Œ\\\"to\\\"ï¼‰å‚æ•°é™å®šæ´å¯Ÿåˆ†æçš„æ—¶é—´èŒƒå›´ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è¯¸å¦‚\\\"ä»…åˆ†æè¿‡å»ä¸€ä¸ªæœˆçš„è¯„è®ºæ•°æ®ç”Ÿæˆæ´å¯Ÿ\\\"è¿™æ ·çš„å®šå‘éœ€æ±‚ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9c530716-63f4-4368-8d0e-0cdbe8f5b08e\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        780,\n        920\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 557.7420442679241,\n        \"height\": 526.2781960611934,\n        \"content\": \"## ç¬¬å…­æ­¥ï¼šå¯¹è¯„è®ºåº”ç”¨èšç±»ç®—æ³•\\n[è¿›ä¸€æ­¥äº†è§£å¦‚ä½•åœ¨n8nä¸­ä½¿ç”¨Python](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code)\\n\\næˆ‘ä»¬å°†è·å–ç›®æ ‡å…¬å¸è¯„è®ºçš„å‘é‡åµŒå…¥æ•°æ®ï¼Œå¹¶å¯¹å…¶æ‰§è¡Œé«˜çº§èšç±»ç®—æ³•ã€‚è¿™é¡¹å¼ºå¤§æŠ€æœ¯èƒ½å¿«é€Ÿå°†ç›¸ä¼¼åµŒå…¥åˆ†ç»„èšç±»ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬è¯†åˆ«é«˜é¢‘åé¦ˆã€ä¸»æµæ„è§å’Œç”¨æˆ·ç—›ç‚¹ï¼\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9790b3a5-cc7c-4e12-8038-fc661c8226f8\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1360,\n        920\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 598.5585287222906,\n        \"height\": 605.9905193915599,\n        \"content\": \"## æ­¥éª¤ä¸ƒï¼šæŒ‰èšç±»è·å–è¯„è®º\\n[è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨ä»£ç èŠ‚ç‚¹](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code/)\\n\\né€šè¿‡ä»£ç èŠ‚ç‚¹å¯¹Qdrantç‚¹IDè¿›è¡Œåˆ†ç»„å¹¶è¿”å›åï¼Œå‰©ä¸‹çš„å°±æ˜¯è·å–æ¯ä¸ªç‚¹çš„æœ‰æ•ˆè½½è·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œèšç±»ç®—æ³•å¹¶éå®Œç¾ï¼Œæ ¹æ®æ•°æ®çš„ä¸åŒå¯èƒ½éœ€è¦ä¸€äº›è°ƒæ•´ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"267057b6-9727-4a45-9d87-5429da42f48e\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1980,\n        969\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 587.6069484146701,\n        \"height\": 552.9535170892194,\n        \"content\": \"## æ­¥éª¤8ï¼šä»åˆ†ç»„è¯„è®ºä¸­è·å–æ´å¯Ÿ\\n[è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨ä¿¡æ¯æå–å™¨èŠ‚ç‚¹](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.information-extractor)\\n\\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿ç”¨æœ€å…ˆè¿›çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ¥ç”Ÿæˆå…³äºè¯„è®ºçš„æ´å¯Ÿã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé’ˆå¯¹è¯„è®ºä¸­çš„å¤šä¸ªå…³é”®ä¸»é¢˜ï¼Œæå–å‡ºæ›´ç²¾ç»†çš„åˆ†æç»“æœã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b8cc07d0-ffa3-425f-ae74-76dcb68fa88f\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2600,\n        980\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 572.5638733479158,\n        \"height\": 464.4019616956416,\n        \"content\": \"## æ­¥éª¤9. å†™å…¥æ´å¯Ÿè¡¨  \\næœ€åï¼Œæˆ‘ä»¬å°†å®Œæˆçš„æ´å¯Ÿå†…å®¹è¿½åŠ åˆ°å·¥ä½œæµæ—©æœŸåˆ›å»ºçš„\\\"æ´å¯Ÿè¡¨\\\"ä¸­ã€‚  \\n\\nç¤ºä¾‹è¡¨æ ¼å¯åœ¨æ­¤å¤„æŸ¥çœ‹ï¼šhttps://docs.google.com/spreadsheets/d/e/2PACX-1vQ6ipJnXWXgr5wlUJnhioNpeYrxaIpsRYZCwN3C-fFXumkbh9TAsA_JzE0kbv7DcGAVIP7az0L46_2P/pubhtml\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0dac0854-7106-44e3-bd68-fad7b201a6bc\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2340,\n        240\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 519.6419932444072,\n        \"height\": 429.11782776909047,\n        \"content\": \"## æ­¥éª¤4. è§¦å‘æ´å¯Ÿå­å·¥ä½œæµ\\n[äº†è§£æ›´å¤šå…³äºå·¥ä½œæµè§¦å‘å™¨çš„ä¿¡æ¯](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow)\\n\\næ­¤å¤„ä½¿ç”¨å­å·¥ä½œæµæ¥è§¦å‘è°ƒæŸ¥åˆ†æã€‚è¿™ç§åˆ†ç¦»æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨æ­¤ç”¨äºæ›´å¥½åœ°æ¼”ç¤ºè¿™ä¸ªåˆ†ä¸ºä¸¤éƒ¨åˆ†çš„è¿‡ç¨‹ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4aa7e73e-c29d-41df-b2f8-a62109285ccb\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        460,\n        380\n      ],\n      \"parameters\": {\n        \"width\": 226.36363118160727,\n        \"height\": 327.0249036433755,\n        \"content\": \"### ğŸš¨ åœ¨æ­¤è®¾ç½®å…¬å¸åç§°ï¼\\nTrustpilotå¿…é¡»å°†å…¶è¯†åˆ«ä¸ºç½‘å€çš„ä¸€éƒ¨åˆ†ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4d895cf9-452c-401e-a6f3-b9d3a359a96d\",\n      \"name\": \"Apply K-means Clustering Algorithm\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1116,\n        1160\n      ],\n      \"parameters\": {\n        \"language\": \"python\",\n        \"pythonCode\": \"import numpy as np\\nfrom sklearn.cluster import KMeans\\n\\n# get vectors for all answers\\npoint_ids = [item.id for item in _input.first().json.result.points]\\nvectors = [item.vector.to_py() for item in _input.first().json.result.points]\\nvectors_array = np.array(vectors)\\n\\n# apply k-means clustering where n_clusters = 5\\n# this is a max and we'll discard some of these clusters later\\nkmeans = KMeans(n_clusters=min(len(vectors), 5), random_state=42).fit(vectors_array)\\nlabels = kmeans.labels_\\nunique_labels = set(labels)\\n\\n# Extract and print points in each cluster\\nclusters = {}\\nfor label in set(labels):\\n    clusters[label] = vectors_array[labels == label]\\n\\n# return Qdrant point ids for each cluster\\n# we'll use these ids to fetch the payloads from the vector store.\\noutput = []\\nfor cluster_id, cluster_points in clusters.items():\\n    points = [point_ids[i] for i in range(len(labels)) if labels[i] == cluster_id]\\n    output.append({\\n        \\\"id\\\": f\\\"Cluster {cluster_id}\\\",\\n        \\\"total\\\": len(cluster_points),\\n        \\\"points\\\": points\\n    })\\n\\nreturn {\\\"json\\\": {\\\"output\\\": output } }\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"95c57019-d9d7-4d9f-93dd-21d3d9708861\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -260,\n        40\n      ],\n      \"parameters\": {\n        \"width\": 400.381109509268,\n        \"height\": 612.855812336249,\n        \"content\": \"## è¯•è¯•çœ‹å§ï¼\\n\\n### è¯¥å·¥ä½œæµèƒ½ä»Trustpilotè¯„è®ºä¸­ç”Ÿæˆé«˜åº¦ç²¾ç»†çš„å®¢æˆ·æ´å¯Ÿï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡è¯„è®ºæ•°æ®ã€‚\\n\\n* å¯¼å…¥Trustpilotè¯„è®ºå¹¶å‘é‡åŒ–å­˜å‚¨è‡³Qdrantå‘é‡æ•°æ®åº“  \\n* ä½¿ç”¨K-meansèšç±»ç®—æ³•è¯†åˆ«è¯„è®ºä¸­çš„çƒ­é—¨è¯é¢˜é›†ç¾¤  \\n* æ¯ä¸ªæœ‰æ•ˆé›†ç¾¤ä¼šç»ç”±å¤§è¯­è¨€æ¨¡å‹(LLM)è¿›è¡Œåˆ†ææ€»ç»“  \\n* å°†LLMç”Ÿæˆçš„åˆ†ææŠ¥å‘Šä¸èšç±»ç»“æœå¯¼å›ç”µå­è¡¨æ ¼  \\n\\nå‚è€ƒè°·æ­Œè¡¨æ ¼ç¤ºä¾‹è¯·è§ï¼šhttps://docs.google.com/spreadsheets/d/e/2PACX-1vQ6ipJnXWXgr5wlUJnhioNpeYrxaIpsRYZCwN3C-fFXumkbh9TAsA_JzE0kbv7DcGAVIP7az0L46_2P/pubhtml\\n\\n### éœ€è¦å¸®åŠ©ï¼Ÿ\\nåŠ å…¥[Discordè®¨è®ºç¾¤](https://discord.com/invite/XPKeKXeB7d) æˆ–è®¿é—®[å®˜æ–¹è®ºå›](https://community.n8n.io/)æé—®ï¼\\n\\nç¥æ‚¨æ¢ç´¢æ„‰å¿«ï¼\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9bba9480-792e-48e3-ad9f-8809ce3aba09\",\n      \"name\": \"Customer Insights Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.informationExtractor\",\n      \"position\": [\n        2140,\n        1180\n      ],\n      \"parameters\": {\n        \"text\": \"=The {{ $json.result.length }} reviews were:\\n{{\\n$json.result.map(item =>\\n`* ${item.payload.metadata.review_author} gave ${item.payload.metadata.review_rating} stars: \\\"${item.payload.content.replaceAll('\\\"', '\\\\\\\"').replaceAll('\\\\n', ' ')}\\\"`\\n).join('\\\\n')\\n}}\",\n        \"options\": {\n          \"systemPromptTemplate\": \"=You help summarise a selection of trustpilot reviews for a company called \\\"{{ $json.result[0].payload.metadata.company_id }}\\\".\\nThe {{ $json.result.length }} reviews were selected because their contents were similar in context.\\n\\nYour task is to: \\n* summarise the given reviews into a short paragraph. Provide an insight from this summary and what we could learn from the reviews.\\n* determine if the overall sentiment of all the listed responses to be either strongly negative, negative, neutral, positive or strongly positive.\"\n        },\n        \"schemaType\": \"fromJson\",\n        \"jsonSchemaExample\": \"{\\n\\t\\\"Insight\\\": \\\"\\\",\\n    \\\"Sentiment\\\": \\\"\\\",\\n    \\\"Suggested Improvements\\\": \\\"\\\"\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4488deb9-27f6-4f9d-b17e-9b5e7a1bba33\",\n      \"name\": \"Sticky Note12\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        180,\n        760\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 323.2987132716669,\n        \"height\": 80,\n        \"content\": \"### ä»…è¿è¡Œä¸€æ¬¡ï¼\\nå¦‚æœå› ä»»ä½•åŸå› éœ€è¦å¤šæ¬¡è¿è¡Œï¼Œè¯·åŠ¡å¿…å…ˆæ¸…é™¤ç°æœ‰æ•°æ®ã€‚\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5cb3bd73-1e77-4eba-9d2e-634fdc374330\",\n      \"name\": \"Sticky Note11\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        780,\n        1480\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 323.2987132716669,\n        \"height\": 110.05160146874424,\n        \"content\": \"### é¦–æ¬¡è¿è¡Œï¼Ÿ\\né¦–æ¬¡è¿è¡Œæ—¶ä¼šæœ‰çŸ­æš‚å»¶è¿Ÿï¼Œå› ä¸ºä»£ç èŠ‚ç‚¹éœ€è¦ä¸‹è½½å¿…è¦çš„ä¾èµ–åŒ…ã€‚\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Zip Entries\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Reviews to List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find Reviews\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Apply K-means Clustering Algorithm\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Clear Existing Reviews\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Variables1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Find Reviews\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract Reviews\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Zip Entries\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Reviews to List\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Qdrant Vector Store\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Clusters To List\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Only Clusters With 3+ points\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Qdrant Vector Store\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Customer Insights Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Default Data Loader\": {\n      \"ai_document\": [\n        [\n          {\n            \"node\": \"Qdrant Vector Store\",\n            \"type\": \"ai_document\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get TrustPilot Page\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract Reviews\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Qdrant Vector Store\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prep Values For Trigger\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Payload of Points\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Customer Insights Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Clear Existing Reviews\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get TrustPilot Page\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Prep Output For Export\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Export To Sheets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Customer Insights Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prep Output For Export\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Prep Values For Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Trigger Insights\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Execute Workflow Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Variables1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Only Clusters With 3+ points\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Payload of Points\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Recursive Character Text Splitter\": {\n      \"ai_textSplitter\": [\n        [\n          {\n            \"node\": \"Default Data Loader\",\n            \"type\": \"ai_textSplitter\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking â€˜Test workflowâ€™\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Apply K-means Clustering Algorithm\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Clusters To List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
{
  "url": "https://n8n.io/workflows/2347-query-n8n-credentials-with-ai-sql-agent/",
  "title": "Query n8n Credentials with AI SQL Agent",
  "author": "Jimleuk",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-25",
  "categories": [
    {
      "name": "Other"
    },
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"26ba763460b97c249b82942b23b6384876dfeb9327513332e743c5f6219c2b8e\"},\"nodes\":[{\"id\":\"382dddd4-da50-49fa-90a2-f7d6d160afdf\",\"name\":\"When clicking \\\"Test workflow\\\"\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[920,280],\"parameters\":{},\"typeVersion\":1},{\"id\":\"efa8f415-62f7-43b3-a76a-a2eabf779cb8\",\"name\":\"Map Workflows & Credentials\",\"type\":\"n8n-nodes-base.set\",\"position\":[1360,280],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"0fd19a68-c561-4cc2-94d6-39848977e6d2\",\"name\":\"workflow_id\",\"type\":\"string\",\"value\":\"={{ $json.id }}\"},{\"id\":\"a81f9e6f-9c78-4c3d-9b79-e820f8c5ba29\",\"name\":\"workflow_name\",\"type\":\"string\",\"value\":\"={{ $json.name }}\"},{\"id\":\"58ab0f2f-7598-48de-bea1-f3373c5731fe\",\"name\":\"credentials\",\"type\":\"array\",\"value\":\"={{ $json.nodes.map(node => node.credentials).compact().reduce((acc,cred) => { const keys = Object.keys(cred); const items = keys.map(key => ({ type: key,  ...cred[key] })); acc.push(...items); return acc; }, []) }}\"}]}},\"typeVersion\":3.3},{\"id\":\"9e9b4f9c-12b7-47ba-8cf4-a9818902a538\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1084,252],\"parameters\":{\"width\":216,\"height\":299.56273929030715,\"content\":\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### 🚨Required\\nYou'll need an n8n API key. Note: available workflows will be scoped to your key.\"},\"typeVersion\":1},{\"id\":\"cf04eff5-12b2-42fb-9089-2d0c992af1b8\",\"name\":\"Save to Database\",\"type\":\"n8n-nodes-base.code\",\"position\":[1540,280],\"parameters\":{\"language\":\"python\",\"pythonCode\":\"import json\\nimport sqlite3\\ncon = sqlite3.connect(\\\"n8n_workflow_credentials.db\\\")\\n\\ncur = con.cursor()\\ncur.execute(\\\"CREATE TABLE IF NOT EXISTS n8n_workflow_credentials (workflow_id TEXT PRIMARY KEY, workflow_name TEXT, credentials TEXT);\\\")\\n\\nfor item in _input.all():\\n  cur.execute('INSERT OR REPLACE INTO n8n_workflow_credentials VALUES(?,?,?)', (\\n    item.json.workflow_id,\\n    item.json.workflow_name,\\n    json.dumps(item.json.credentials.to_py())\\n  ))\\n\\ncon.commit()\\ncon.close()\\n\\nreturn [{ \\\"affected_rows\\\": len(_input.all()) }]\"},\"typeVersion\":2},{\"id\":\"7e32cf83-0498-4666-8677-7fd32eec779c\",\"name\":\"Chat Trigger\",\"type\":\"@n8n/n8n-nodes-langchain.chatTrigger\",\"position\":[1880,280],\"webhookId\":\"993ce267-a1e5-4657-a38c-08f86715063d\",\"parameters\":{},\"typeVersion\":1},{\"id\":\"8c37f2ae-192b-4f98-a6fa-5aabf870e9e0\",\"name\":\"Query Workflow Credentials Database\",\"type\":\"@n8n/n8n-nodes-langchain.toolCode\",\"position\":[2320,440],\"parameters\":{\"name\":\"query_workflow_credentials_database\",\"language\":\"python\",\"pythonCode\":\"import json\\nimport sqlite3\\ncon = sqlite3.connect(\\\"n8n_workflow_credentials.db\\\")\\n\\ncur = con.cursor()\\nres = cur.execute(query);\\n\\noutput = json.dumps(res.fetchall())\\n\\ncon.close()\\nreturn output;\",\"description\":\"Call this tool to query the workflow credentials database. The database is already set. The available tables are as follows:\\n* n8n_workflow_credentials (workflow_id TEXT PRIMARY KEY, workflow_name TEXT, credentials TEXT);\\n   * n8n_workflow_credentials.credentials are stored as json string and the app name may be obscured. Prefer querying using the %LIKE% operation for best results.\\n\\nPass a SQL SELECT query to this tool for the available tables.\"},\"typeVersion\":1.1},{\"id\":\"60b2ab16-dc7c-4cb8-a58f-696f721b8d6f\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[2060,440],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"adf576c1-ddb0-4fef-980c-5b485a3204f2\",\"name\":\"Window Buffer Memory\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[2180,440],\"parameters\":{},\"typeVersion\":1.2},{\"id\":\"4335b038-3e9f-4173-986d-cabdb87cc0b4\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[860,100],\"parameters\":{\"color\":7,\"width\":930.8402221561373,\"height\":488.8805508857059,\"content\":\"## Step 1. Store Workflows Credential Mappings to Database\\n\\nWe'll achieve this by querying n8n's built-in API to query all workflows, extract the credentials list from the nodes within and then store them in a SQLite database. Don't worry, the actual credential data won't be exposed! For the database, we'll abuse the fact that the code node is able to create Sqlite databases - however, this is created in memory and will be wiped if the n8n instance is restarted.\"},\"typeVersion\":1},{\"id\":\"c1f557ee-1176-4f3e-8431-d162f1a59990\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1820,100],\"parameters\":{\"color\":7,\"width\":688.6507290693205,\"height\":527.3794193342486,\"content\":\"## Step 2. Use Agent as Search Interface\\n\\nInstead of building a form interface like a regular person, we'll just use an AI tools agent who is given aaccess to perform queries on our database. You can ask it things like \\\"which workflows are using slack + airtable + googlesheets?\\\"\"},\"typeVersion\":1},{\"id\":\"9bdc3fa9-d4a0-4040-bb32-6c76aaca3ad9\",\"name\":\"Workflow Credentials Helper Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[2080,280],\"parameters\":{\"options\":{\"systemMessage\":\"=You help find information on n8n workflow credentials. When user mentions an app, assume they mean the workflow credential for the app.\\n* Only if the user requests to provide a link to the workflow, replace $workflow_id with the workflow id in the following url schema: {{ window.location.protocol + '//' + window.location.host }}/workflow/$workflow_id\"}},\"typeVersion\":1.6},{\"id\":\"ff39f504-9953-47c9-81eb-3146dfd6c8c5\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[420,100],\"parameters\":{\"width\":415.13049730628427,\"height\":347.7398931123371,\"content\":\"## Try It Out!\\n\\n### This workflow let's you query workflow credentials using an AI SQL agent. Example use-case could be:\\n* \\\"Which workflows are using Slack and Google Calendar?\\\"\\n* \\\"Which workflows have AI in their name but are not using openAI?\\\"\\n\\n### Run the Steps separately!\\n* Step 1 populates a local database\\n* Step 2 engages with the chatbot\"},\"typeVersion\":1},{\"id\":\"3db2116c-abde-4856-bd1e-a15e0275477f\",\"name\":\"n8n\",\"type\":\"n8n-nodes-base.n8n\",\"position\":[1140,280],\"parameters\":{\"filters\":{},\"requestOptions\":{}},\"credentials\":{\"n8nApi\":{\"id\":\"5vELmsVPmK4Bkqkg\",\"name\":\"n8n account\"}},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"n8n\":{\"main\":[[{\"node\":\"Map Workflows & Credentials\",\"type\":\"main\",\"index\":0}]]},\"Chat Trigger\":{\"main\":[[{\"node\":\"Workflow Credentials Helper Agent\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"Workflow Credentials Helper Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Window Buffer Memory\":{\"ai_memory\":[[{\"node\":\"Workflow Credentials Helper Agent\",\"type\":\"ai_memory\",\"index\":0}]]},\"Map Workflows & Credentials\":{\"main\":[[{\"node\":\"Save to Database\",\"type\":\"main\",\"index\":0}]]},\"When clicking \\\"Test workflow\\\"\":{\"main\":[[{\"node\":\"n8n\",\"type\":\"main\",\"index\":0}]]},\"Query Workflow Credentials Database\":{\"ai_tool\":[[{\"node\":\"Workflow Credentials Helper Agent\",\"type\":\"ai_tool\",\"index\":0}]]}}}",
  "readme": "This n8n workflow is a fun way to query and search over your credentials on your n8n instance.\n\n**Good to know**  \nYour credentials should remain safe as this workflow does not decrypt or use any decrypted data.\n\n## Example Usage\n\n  * \"Which workflows are using Slack and Google Calendar?\"\n  * \"Which workflows have AI in their name but are not using openAI?\"\n\n\n\n## How it works\n\n  * Using the n8n API, it fetches all workflow data on the instance. Workflow data contains references to credentials used so this will be extracted.\n  * With some necessary reformatting, the workflows and their credentials metadata are stored to a SQLite database.\n  * Next, an AI agent is used with a custom SQL tool that reads the SQLite database created in the previous step.\n  * The AI agent is instructed to perform SQL queries against our workflow credential table when asked about credentials by the user.\n\n\n\n## Requirements\n\n  * You'll need an n8n API key. Please note that only workflows will be scoped to your API key.\n\n\n\n## Customising the workflow\n\nAdd extra table fields to the SQLite database to answer even more complex queries such as:\n\n  * workflow status to differentiate between active and inactive workflows.\n\n\n",
  "crawled_at": "2025-05-25T23:34:36.240626",
  "readme_zh": "这个n8n工作流提供了一种有趣的方式来查询和搜索您n8n实例上的凭证信息。\n\n**重要提示**  \n您的凭证将保持安全，因为该工作流不会解密或使用任何解密数据。\n\n## 使用示例\n\n* \"哪些工作流使用了Slack和Google日历？\"\n* \"哪些工作流名称包含AI但未使用openAI？\"\n\n## 工作原理\n\n* 通过n8n API获取实例上所有工作流数据。工作流数据包含所用凭证的引用信息，这些信息将被提取出来。\n* 经过必要的格式处理后，工作流及其凭证元数据会被存储到SQLite数据库中。\n* 随后，系统会使用一个配备自定义SQL工具的AI代理，该工具可读取上一步创建的SQLite数据库。\n* 当用户询问凭证相关问题时，AI代理会按照指令对我们的工作流凭证表执行SQL查询。\n\n## 使用要求\n\n* 您需要一个n8n API密钥。请注意，只有工作流会受限于您的API密钥范围。\n\n## 自定义工作流\n\n向SQLite数据库添加额外表字段，以回答更复杂的查询，例如：\n\n* 添加工作流状态字段，用于区分活跃和非活跃工作流。",
  "title_zh": "使用AI SQL代理查询n8n凭证",
  "publish_date_zh": "最后更新于9个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"26ba763460b97c249b82942b23b6384876dfeb9327513332e743c5f6219c2b8e\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"382dddd4-da50-49fa-90a2-f7d6d160afdf\",\n      \"name\": \"When clicking \\\"Test workflow\\\"\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        920,\n        280\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"efa8f415-62f7-43b3-a76a-a2eabf779cb8\",\n      \"name\": \"Map Workflows & Credentials\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1360,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"0fd19a68-c561-4cc2-94d6-39848977e6d2\",\n              \"name\": \"workflow_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.id }}\"\n            },\n            {\n              \"id\": \"a81f9e6f-9c78-4c3d-9b79-e820f8c5ba29\",\n              \"name\": \"workflow_name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.name }}\"\n            },\n            {\n              \"id\": \"58ab0f2f-7598-48de-bea1-f3373c5731fe\",\n              \"name\": \"credentials\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.nodes.map(node => node.credentials).compact().reduce((acc,cred) => { const keys = Object.keys(cred); const items = keys.map(key => ({ type: key,  ...cred[key] })); acc.push(...items); return acc; }, []) }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"9e9b4f9c-12b7-47ba-8cf4-a9818902a538\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1084,\n        252\n      ],\n      \"parameters\": {\n        \"width\": 216,\n        \"height\": 299.56273929030715,\n        \"content\": \"### 需要\\n你需要一个n8n API密钥。注意：可用工作流将限定于你的密钥范围。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cf04eff5-12b2-42fb-9089-2d0c992af1b8\",\n      \"name\": \"Save to Database\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1540,\n        280\n      ],\n      \"parameters\": {\n        \"language\": \"python\",\n        \"pythonCode\": \"import json\\nimport sqlite3\\ncon = sqlite3.connect(\\\"n8n_workflow_credentials.db\\\")\\n\\ncur = con.cursor()\\ncur.execute(\\\"CREATE TABLE IF NOT EXISTS n8n_workflow_credentials (workflow_id TEXT PRIMARY KEY, workflow_name TEXT, credentials TEXT);\\\")\\n\\nfor item in _input.all():\\n  cur.execute('INSERT OR REPLACE INTO n8n_workflow_credentials VALUES(?,?,?)', (\\n    item.json.workflow_id,\\n    item.json.workflow_name,\\n    json.dumps(item.json.credentials.to_py())\\n  ))\\n\\ncon.commit()\\ncon.close()\\n\\nreturn [{ \\\"affected_rows\\\": len(_input.all()) }]\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"7e32cf83-0498-4666-8677-7fd32eec779c\",\n      \"name\": \"Chat Trigger\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        1880,\n        280\n      ],\n      \"webhookId\": \"993ce267-a1e5-4657-a38c-08f86715063d\",\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8c37f2ae-192b-4f98-a6fa-5aabf870e9e0\",\n      \"name\": \"Query Workflow Credentials Database\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolCode\",\n      \"position\": [\n        2320,\n        440\n      ],\n      \"parameters\": {\n        \"name\": \"query_workflow_credentials_database\",\n        \"language\": \"python\",\n        \"pythonCode\": \"import json\\nimport sqlite3\\ncon = sqlite3.connect(\\\"n8n_workflow_credentials.db\\\")\\n\\ncur = con.cursor()\\nres = cur.execute(query);\\n\\noutput = json.dumps(res.fetchall())\\n\\ncon.close()\\nreturn output;\",\n        \"description\": \"Call this tool to query the workflow credentials database. The database is already set. The available tables are as follows:\\n* n8n_workflow_credentials (workflow_id TEXT PRIMARY KEY, workflow_name TEXT, credentials TEXT);\\n   * n8n_workflow_credentials.credentials are stored as json string and the app name may be obscured. Prefer querying using the %LIKE% operation for best results.\\n\\nPass a SQL SELECT query to this tool for the available tables.\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"60b2ab16-dc7c-4cb8-a58f-696f721b8d6f\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        2060,\n        440\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"adf576c1-ddb0-4fef-980c-5b485a3204f2\",\n      \"name\": \"Window Buffer Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        2180,\n        440\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"4335b038-3e9f-4173-986d-cabdb87cc0b4\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        860,\n        100\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 930.8402221561373,\n        \"height\": 488.8805508857059,\n        \"content\": \"## 第一步：将工作流凭证映射存储至数据库\\n\\n我们将通过查询n8n内置API获取所有工作流，提取节点中的凭证列表后存入SQLite数据库。请放心，真实的凭证数据不会被泄露！关于数据库实现，我们将利用代码节点能创建Sqlite数据库的特性——不过这个数据库存在于内存中，若n8n实例重启数据就会丢失。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c1f557ee-1176-4f3e-8431-d162f1a59990\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1820,\n        100\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 688.6507290693205,\n        \"height\": 527.3794193342486,\n        \"content\": \"## 第二步：将智能体作为搜索界面\\n\\n我们不会像普通人那样构建表单界面，而是直接使用一个具备数据库查询权限的AI工具智能体。你可以向它提问，例如\\\"哪些工作流程同时使用了Slack、Airtable和谷歌表格？\\\"\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9bdc3fa9-d4a0-4040-bb32-6c76aaca3ad9\",\n      \"name\": \"Workflow Credentials Helper Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        2080,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"systemMessage\": \"=You help find information on n8n workflow credentials. When user mentions an app, assume they mean the workflow credential for the app.\\n* Only if the user requests to provide a link to the workflow, replace $workflow_id with the workflow id in the following url schema: {{ window.location.protocol + '//' + window.location.host }}/workflow/$workflow_id\"\n        }\n      },\n      \"typeVersion\": 1.6\n    },\n    {\n      \"id\": \"ff39f504-9953-47c9-81eb-3146dfd6c8c5\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        420,\n        100\n      ],\n      \"parameters\": {\n        \"width\": 415.13049730628427,\n        \"height\": 347.7398931123371,\n        \"content\": \"## 试试看！\\n\\n### 该工作流允许您通过AI SQL助手查询工作流凭证。示例用例包括：\\n* \\\"哪些工作流正在使用Slack和Google日历？\\\"\\n* \\\"哪些工作流名称包含AI但未使用openAI？\\\"\\n\\n### 请分步运行！\\n* 第一步将填充本地数据库\\n* 第二步启动聊天机器人交互\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3db2116c-abde-4856-bd1e-a15e0275477f\",\n      \"name\": \"n8n\",\n      \"type\": \"n8n-nodes-base.n8n\",\n      \"position\": [\n        1140,\n        280\n      ],\n      \"parameters\": {\n        \"filters\": {},\n        \"requestOptions\": {}\n      },\n      \"credentials\": {\n        \"n8nApi\": {\n          \"id\": \"5vELmsVPmK4Bkqkg\",\n          \"name\": \"n8n account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"n8n\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Map Workflows & Credentials\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Window Buffer Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Map Workflows & Credentials\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Save to Database\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking \\\"Test workflow\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"n8n\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query Workflow Credentials Database\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
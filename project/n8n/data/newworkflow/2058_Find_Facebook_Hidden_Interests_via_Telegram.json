{
  "url": "https://n8n.io/workflows/2058-find-facebook-hidden-interests-via-telegram/",
  "title": "Find Facebook Hidden Interests via Telegram",
  "author": "Ibrahim",
  "publish_date": "Last update a year ago",
  "publish_date_absolute": "",
  "categories": [
    {
      "name": "Marketing"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"ac9d33c4ed758aeca18fdf8990bc14f18826f99beb38fb06a023fa013ee39a0b\"},\"nodes\":[{\"id\":\"9cfeb58b-140f-4941-8442-4e33c671e325\",\"name\":\"No Operation, do nothing\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[440,840],\"parameters\":{},\"typeVersion\":1},{\"id\":\"c4e7c596-4f2a-48e0-a932-ad40157c6282\",\"name\":\"Get interest name\",\"type\":\"n8n-nodes-base.telegramTrigger\",\"position\":[100,660],\"webhookId\":\"3c85f114-6321-4e6d-9b5e-726e1493ee4e\",\"parameters\":{\"updates\":[\"message\"],\"additionalFields\":{}},\"credentials\":{\"telegramApi\":{\"id\":\"JR5rQqmm6CGac5CF\",\"name\":\"Sender Token\"}},\"typeVersion\":1},{\"id\":\"69d432d1-4ab1-4059-af5c-ba589dfe16bc\",\"name\":\"Check message contents\",\"type\":\"n8n-nodes-base.if\",\"position\":[280,660],\"parameters\":{\"conditions\":{\"number\":[{\"value1\":\"={{ $json.message.chat.id }}\",\"value2\":-1001805495093,\"operation\":\"equal\"}],\"string\":[{\"value1\":\"={{ $json.message.text }}\",\"value2\":\"#interest\",\"operation\":\"startsWith\"}]}},\"typeVersion\":1},{\"id\":\"345274b6-2d56-4d54-937a-dd9153fd1fdc\",\"name\":\"Extract message\",\"type\":\"n8n-nodes-base.code\",\"position\":[460,460],\"parameters\":{\"jsCode\":\"let inputData = items[0].json; // get the input data\\nlet message = inputData.message; // replace 'message' with the correct field name\\n\\nlet messageContent = '';\\n\\nif (message && message.text) {\\n  messageContent = message.text;\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      messageContent: messageContent\\n    }\\n  }\\n];\\n\"},\"typeVersion\":2},{\"id\":\"cd808029-1a46-4fad-9065-c726960fb427\",\"name\":\"Split Message\",\"type\":\"n8n-nodes-base.code\",\"position\":[660,460],\"parameters\":{\"jsCode\":\"let inputData = items[0].json; // get the input data\\nlet variableContent = String(inputData.messageContent || ''); // replace 'variable' with the correct field name, convert to string and assign empty string if undefined\\n\\nlet regex = /#(\\\\w+)\\\\b(.*)/; // regex to match hashtag word and rest of the content\\nlet matches = regex.exec(variableContent);\\n\\nlet extractedContent = '';\\nlet remainingContent = '';\\n\\nif (matches !== null) {\\n  extractedContent = matches[1];\\n  remainingContent = matches[2].trim();\\n} else {\\n  remainingContent = variableContent.trim();\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      extractedContent: extractedContent,\\n      remainingContent: remainingContent    }\\n  }\\n];\\n\"},\"typeVersion\":2},{\"id\":\"6f541faf-7756-415e-8391-5470166b8a01\",\"name\":\"Connect to Graph API\",\"type\":\"n8n-nodes-base.facebookGraphApi\",\"position\":[840,460],\"parameters\":{\"edge\":\"=\",\"node\":\"=search?type=adinterest&q={{ $json.remainingContent }}\\n&limit=1000000&locale=en_US \",\"options\":{},\"graphApiVersion\":\"v17.0\"},\"credentials\":{\"facebookGraphApi\":{\"id\":\"AEVlPxPoTe92kkJS\",\"name\":\"Facebook Graph account\"}},\"typeVersion\":1},{\"id\":\"394a34ce-f56d-4a79-8fbb-f37681cbee76\",\"name\":\"Split Interests into a Table\",\"type\":\"n8n-nodes-base.code\",\"position\":[1020,460],\"parameters\":{\"jsCode\":\"let inputData = items[0].json; // get the input data\\nlet outputData = [];\\n\\nfor(let key in inputData) {\\n    if(inputData.hasOwnProperty(key)) {\\n        let itemKey = key;\\n        let itemValue = inputData[key];\\n        \\n        for(let subKey in itemValue) {\\n            if(itemValue.hasOwnProperty(subKey)) {\\n                let formattedItem = {\\n                    'Item': itemKey,\\n                    'SubItem': subKey,\\n                    'Value': itemValue[subKey]\\n                };\\n                \\n                outputData.push({json: formattedItem});\\n            }\\n        }\\n    }\\n}\\n\\nreturn outputData;\"},\"typeVersion\":2},{\"id\":\"1d3f66a4-322f-4398-b887-52ccd2f2f5fe\",\"name\":\"Get variables\",\"type\":\"n8n-nodes-base.code\",\"position\":[1200,460],\"parameters\":{\"jsCode\":\"let outputData = items.map(item => {\\n    let data = item.json.Value;\\n    \\n    return {\\n        json: {\\n            'name': data.name,\\n            'audience_size_lower_bound': data.audience_size_lower_bound,\\n            'audience_size_upper_bound': data.audience_size_upper_bound,\\n            'path': data.path,\\n            'description': data.description,\\n            'topic': data.topic\\n        }\\n    };\\n});\\n\\nreturn outputData;\"},\"typeVersion\":2},{\"id\":\"082ddf0f-29ef-424a-a2a2-4bf9e260657f\",\"name\":\"Create a Spreadsheet\",\"type\":\"n8n-nodes-base.spreadsheetFile\",\"position\":[1380,460],\"parameters\":{\"options\":{},\"operation\":\"toFile\",\"fileFormat\":\"csv\"},\"typeVersion\":2},{\"id\":\"44e4f97a-cd86-4b60-b761-49dc46f7e36b\",\"name\":\"Send the Spreadsheet file\",\"type\":\"n8n-nodes-base.telegram\",\"position\":[1560,460],\"parameters\":{\"chatId\":\"-1001805495093\",\"operation\":\"sendDocument\",\"binaryData\":true,\"additionalFields\":{\"fileName\":\"report.csv\"}},\"credentials\":{\"telegramApi\":{\"id\":\"JR5rQqmm6CGac5CF\",\"name\":\"Sender Token\"}},\"typeVersion\":1},{\"id\":\"22bc6129-7d10-46fd-98e2-0f3fc7a93344\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[800,340],\"parameters\":{\"width\":948.6687115198118,\"height\":296.5325040542755,\"content\":\"## Facebook API\\n\\nTo get the API Key you need to follow these steps:\\nhttps://developers.facebook.com/docs/commerce-platform/setup/api-setup/\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Get variables\":{\"main\":[[{\"node\":\"Create a Spreadsheet\",\"type\":\"main\",\"index\":0}]]},\"Split Message\":{\"main\":[[{\"node\":\"Connect to Graph API\",\"type\":\"main\",\"index\":0}]]},\"Extract message\":{\"main\":[[{\"node\":\"Split Message\",\"type\":\"main\",\"index\":0}]]},\"Get interest name\":{\"main\":[[{\"node\":\"Check message contents\",\"type\":\"main\",\"index\":0}]]},\"Connect to Graph API\":{\"main\":[[{\"node\":\"Split Interests into a Table\",\"type\":\"main\",\"index\":0}]]},\"Create a Spreadsheet\":{\"main\":[[{\"node\":\"Send the Spreadsheet file\",\"type\":\"main\",\"index\":0}]]},\"Check message contents\":{\"main\":[[{\"node\":\"Extract message\",\"type\":\"main\",\"index\":0}],[{\"node\":\"No Operation, do nothing\",\"type\":\"main\",\"index\":0}]]},\"Split Interests into a Table\":{\"main\":[[{\"node\":\"Get variables\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Overview\n\nThis n8n workflow is designed to extract specific interests from messages in a Telegram chat and retrieve related information using the Facebook Graph API. It aims to provide a streamlined solution for parsing and analyzing user-provided interests within the Telegram platform.\n\n### Features\n\n  * **Interest Extraction:**  Automatically identifies and extracts interests from messages that start with the hashtag \"#interest\".\n  * **Data Retrieval:**  Utilizes the Facebook Graph API to retrieve information related to the extracted interests.\n  * **Structured Outputs:**  Presents the retrieved data in an organized format for further analysis and review.\n\n\n\n### Requirements\n\n  * Operational instance of n8n (self-hosted or cloud version).\n  * Basic understanding of n8n workflows and nodes.\n\n\n\n### Setup and Configuration\n\n  1. **Import Workflow:**  Load the provided JSON workflow into your n8n instance.\n  2. **Configure Telegram Trigger Node:**  Ensure the Telegram trigger node is set up with the appropriate credentials and webhook ID.\n  3. **Configure and Test Nodes:**  Adjust node parameters as necessary and test the workflow to ensure proper functionality.\n\n\n\n### How it Works\n\n  1. **Telegram Trigger:**  Listens for incoming messages in a specified Telegram chat.\n  2. **Check Message Contents:**  Verifies if the message begins with the specified hashtag and is from the designated chat ID.\n  3. **Extract Message:**  Extracts the content of the message for further processing.\n  4. **Split Message:**  Splits the extracted message to identify the interest and remaining content.\n  5. **Connect to Graph API:**  Utilizes the Facebook Graph API to search for information related to the extracted interest.\n  6. **Split Interests into a Table:**  Organizes the retrieved data into a structured table format.\n  7. **Get Variables:**  Maps the retrieved data to create a new JSON object containing specific fields related to the interest.\n  8. **Create a Spreadsheet:**  Generates a spreadsheet file in CSV format based on the retrieved and formatted data.\n  9. **Send the Spreadsheet File:**  Sends the generated spreadsheet file back to the original Telegram chat.\n\n\n\n### Customization\n\n  * Modify the filtering conditions and fields to suit specific requirements.\n  * Adjust the frequency of the trigger node based on preference.\n\n\n\n### Best Practices\n\n  * Regularly test the workflow to ensure consistent performance.\n  * Stay informed about any changes to external APIs that might affect the workflow's functionality.\n\n\n\n### Contributing\n\nYour feedback and contributions are highly valued. Feel free to adapt, modify, and share enhancements with the n8n community.\n",
  "crawled_at": "2025-05-25T20:45:40.254996",
  "readme_zh": "### 概述\n\n本n8n工作流专为从Telegram聊天消息中提取特定兴趣标签，并通过Facebook Graph API获取关联信息而设计。旨在为Telegram平台内用户提供的兴趣内容提供高效的解析与分析解决方案。\n\n### 功能特性\n\n  * **兴趣提取**：自动识别并提取以\"#interest\"开头的消息中的兴趣标签\n  * **数据检索**：调用Facebook Graph API获取与兴趣标签相关的信息\n  * **结构化输出**：将检索数据整理为规范化格式以便后续分析与查阅\n\n### 环境要求\n\n  * 可运行的n8n实例（自托管或云端版本）\n  * 基础的n8n工作流与节点操作知识\n\n### 安装配置\n\n  1. **导入工作流**：将提供的JSON工作流文件加载至n8n实例\n  2. **配置Telegram触发节点**：确保Telegram触发节点已配置正确的凭证和Webhook ID\n  3. **节点调试**：按需调整节点参数并测试工作流确保功能正常\n\n### 运作原理\n\n  1. **Telegram触发**：监听指定Telegram聊天室的新消息\n  2. **消息内容校验**：验证消息是否以指定标签开头且来自预设聊天ID\n  3. **消息提取**：提取消息正文进行后续处理\n  4. **消息分割**：拆分消息内容识别兴趣标签与剩余文本\n  5. **连接Graph API**：调用Facebook Graph API搜索与兴趣标签相关的信息\n  6. **表格化处理**：将检索数据整理为结构化表格\n  7. **变量映射**：创建包含兴趣相关字段的新JSON对象\n  8. **生成电子表格**：基于格式化数据创建CSV格式文件\n  9. **回传文件**：将生成的电子表格文件发送回原始Telegram聊天室\n\n### 自定义设置\n\n  * 根据需求修改过滤条件与字段配置\n  * 按需调整触发节点的执行频率\n\n### 最佳实践\n\n  * 定期测试工作流以确保运行稳定性\n  * 及时关注外部API变更可能对功能造成的影响\n\n### 参与贡献\n\n我们高度重视您的反馈与贡献，欢迎根据需求调整工作流并与n8n社区分享改进方案。",
  "title_zh": "通过Telegram发现Facebook隐藏的兴趣",
  "publish_date_zh": "上次更新于一年前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"ac9d33c4ed758aeca18fdf8990bc14f18826f99beb38fb06a023fa013ee39a0b\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"9cfeb58b-140f-4941-8442-4e33c671e325\",\n      \"name\": \"No Operation, do nothing\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        440,\n        840\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c4e7c596-4f2a-48e0-a932-ad40157c6282\",\n      \"name\": \"Get interest name\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        100,\n        660\n      ],\n      \"webhookId\": \"3c85f114-6321-4e6d-9b5e-726e1493ee4e\",\n      \"parameters\": {\n        \"updates\": [\n          \"message\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"JR5rQqmm6CGac5CF\",\n          \"name\": \"Sender Token\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"69d432d1-4ab1-4059-af5c-ba589dfe16bc\",\n      \"name\": \"Check message contents\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        280,\n        660\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{ $json.message.chat.id }}\",\n              \"value2\": -1001805495093,\n              \"operation\": \"equal\"\n            }\n          ],\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.message.text }}\",\n              \"value2\": \"#interest\",\n              \"operation\": \"startsWith\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"345274b6-2d56-4d54-937a-dd9153fd1fdc\",\n      \"name\": \"Extract message\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        460,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let inputData = items[0].json; // get the input data\\nlet message = inputData.message; // replace 'message' with the correct field name\\n\\nlet messageContent = '';\\n\\nif (message && message.text) {\\n  messageContent = message.text;\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      messageContent: messageContent\\n    }\\n  }\\n];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"cd808029-1a46-4fad-9065-c726960fb427\",\n      \"name\": \"Split Message\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        660,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let inputData = items[0].json; // get the input data\\nlet variableContent = String(inputData.messageContent || ''); // replace 'variable' with the correct field name, convert to string and assign empty string if undefined\\n\\nlet regex = /#(\\\\w+)\\\\b(.*)/; // regex to match hashtag word and rest of the content\\nlet matches = regex.exec(variableContent);\\n\\nlet extractedContent = '';\\nlet remainingContent = '';\\n\\nif (matches !== null) {\\n  extractedContent = matches[1];\\n  remainingContent = matches[2].trim();\\n} else {\\n  remainingContent = variableContent.trim();\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      extractedContent: extractedContent,\\n      remainingContent: remainingContent    }\\n  }\\n];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"6f541faf-7756-415e-8391-5470166b8a01\",\n      \"name\": \"Connect to Graph API\",\n      \"type\": \"n8n-nodes-base.facebookGraphApi\",\n      \"position\": [\n        840,\n        460\n      ],\n      \"parameters\": {\n        \"edge\": \"=\",\n        \"node\": \"=search?type=adinterest&q={{ $json.remainingContent }}\\n&limit=1000000&locale=en_US \",\n        \"options\": {},\n        \"graphApiVersion\": \"v17.0\"\n      },\n      \"credentials\": {\n        \"facebookGraphApi\": {\n          \"id\": \"AEVlPxPoTe92kkJS\",\n          \"name\": \"Facebook Graph account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"394a34ce-f56d-4a79-8fbb-f37681cbee76\",\n      \"name\": \"Split Interests into a Table\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1020,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let inputData = items[0].json; // get the input data\\nlet outputData = [];\\n\\nfor(let key in inputData) {\\n    if(inputData.hasOwnProperty(key)) {\\n        let itemKey = key;\\n        let itemValue = inputData[key];\\n        \\n        for(let subKey in itemValue) {\\n            if(itemValue.hasOwnProperty(subKey)) {\\n                let formattedItem = {\\n                    'Item': itemKey,\\n                    'SubItem': subKey,\\n                    'Value': itemValue[subKey]\\n                };\\n                \\n                outputData.push({json: formattedItem});\\n            }\\n        }\\n    }\\n}\\n\\nreturn outputData;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"1d3f66a4-322f-4398-b887-52ccd2f2f5fe\",\n      \"name\": \"Get variables\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1200,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let outputData = items.map(item => {\\n    let data = item.json.Value;\\n    \\n    return {\\n        json: {\\n            'name': data.name,\\n            'audience_size_lower_bound': data.audience_size_lower_bound,\\n            'audience_size_upper_bound': data.audience_size_upper_bound,\\n            'path': data.path,\\n            'description': data.description,\\n            'topic': data.topic\\n        }\\n    };\\n});\\n\\nreturn outputData;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"082ddf0f-29ef-424a-a2a2-4bf9e260657f\",\n      \"name\": \"Create a Spreadsheet\",\n      \"type\": \"n8n-nodes-base.spreadsheetFile\",\n      \"position\": [\n        1380,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"toFile\",\n        \"fileFormat\": \"csv\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"44e4f97a-cd86-4b60-b761-49dc46f7e36b\",\n      \"name\": \"Send the Spreadsheet file\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1560,\n        460\n      ],\n      \"parameters\": {\n        \"chatId\": \"-1001805495093\",\n        \"operation\": \"sendDocument\",\n        \"binaryData\": true,\n        \"additionalFields\": {\n          \"fileName\": \"report.csv\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"JR5rQqmm6CGac5CF\",\n          \"name\": \"Sender Token\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"22bc6129-7d10-46fd-98e2-0f3fc7a93344\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        800,\n        340\n      ],\n      \"parameters\": {\n        \"width\": 948.6687115198118,\n        \"height\": 296.5325040542755,\n        \"content\": \"## Facebook API\\n\\n要获取API密钥，您需要按照以下步骤操作：\\nhttps://developers.facebook.com/docs/commerce-platform/setup/api-setup/\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Get variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create a Spreadsheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Message\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Connect to Graph API\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract message\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get interest name\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check message contents\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Connect to Graph API\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Interests into a Table\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create a Spreadsheet\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send the Spreadsheet file\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check message contents\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Interests into a Table\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
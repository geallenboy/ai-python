{
  "url": "https://n8n.io/workflows/2666-analyze-and-sort-suspicious-email-contents-with-chatgpt/",
  "title": "Analyze & Sort Suspicious Email Contents with ChatGPT",
  "author": "Angel Menendez",
  "publish_date": "Last update 5 months ago",
  "publish_date_absolute": "2024-12-26",
  "categories": [
    {
      "name": "AI"
    },
    {
      "name": "SecOps"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"},\"nodes\":[{\"id\":\"94dd7f48-0013-4fb5-89c4-826ecd7f2d66\",\"name\":\"Gmail Trigger\",\"type\":\"n8n-nodes-base.gmailTrigger\",\"position\":[1460,120],\"parameters\":{\"simple\":false,\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"gmailOAuth2\":{\"id\":\"kkhNhqKpZt6IUZd0\",\"name\":\"Gmail\"}},\"typeVersion\":1.2},{\"id\":\"ca2023fa-ceca-4923-80e4-a3843803536c\",\"name\":\"Microsoft Outlook Trigger\",\"type\":\"n8n-nodes-base.microsoftOutlookTrigger\",\"disabled\":true,\"position\":[1480,680],\"parameters\":{\"fields\":[\"body\",\"toRecipients\",\"subject\",\"bodyPreview\"],\"output\":\"fields\",\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":1},{\"id\":\"1f011214-91a0-4cfa-9d9e-29864937c0a3\",\"name\":\"Screenshot HTML\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2620,420],\"parameters\":{\"url\":\"https://hcti.io/v1/image\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"sendQuery\":true,\"authentication\":\"genericCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"html\",\"value\":\"={{ $('Set Email Variables').item.json.htmlBody }}\"}]},\"genericAuthType\":\"httpBasicAuth\",\"queryParameters\":{\"parameters\":[{}]}},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"64f4789f-9de8-414f-af62-ddc339f0d0ac\",\"name\":\"Retrieve Screenshot\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2800,420],\"parameters\":{\"url\":\"={{ $json.url }}\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpBasicAuth\"},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"db707bd9-6abc-4ab7-8ffa-ad25c5e8adc4\",\"name\":\"Set Outlook Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2040,680],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"},{\"id\":\"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json}}\"},{\"id\":\"20566ad4-7eb7-42b1-8a0d-f8b759610f10\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"},{\"id\":\"7171998f-a5a2-4e23-946a-9c1ad75710e7\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"},{\"id\":\"cc262634-2470-4524-8319-abe2518a6335\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $('Retrieve Headers of Email').item.json.body.content }}\"}]}},\"typeVersion\":3.4},{\"id\":\"7a3622c0-6949-4ea3-ae13-46a1ee26de7b\",\"name\":\"Set Gmail Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2020,120],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $json.html }}\"},{\"id\":\"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json.headers }}\"},{\"id\":\"1d690098-be2a-4604-baf8-62f314930929\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $json.subject }}\"},{\"id\":\"8009f00a-547f-4eb1-b52d-2e7305248885\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $json.to.text }}\"},{\"id\":\"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $json.text }}\"}]}},\"typeVersion\":3.4},{\"id\":\"4b4c6b34-f74c-4402-91a1-4d002e02a3bd\",\"name\":\"Retrieve Headers of Email\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1700,680],\"parameters\":{\"url\":\"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\",\"options\":{},\"sendHeaders\":true,\"authentication\":\"predefinedCredentialType\",\"headerParameters\":{\"parameters\":[{\"name\":\"Accept\",\"value\":\"application/json\"},{\"name\":\"Prefer\",\"value\":\"outlook.body-content-type=\\\"text\\\"\"}]},\"nodeCredentialType\":\"microsoftOutlookOAuth2Api\"},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":4.2},{\"id\":\"0c9883b5-3eb7-45db-9803-d1b30166a3b5\",\"name\":\"Format Headers\",\"type\":\"n8n-nodes-base.code\",\"position\":[1880,680],\"parameters\":{\"jsCode\":\"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"},\"typeVersion\":2},{\"id\":\"c21a976c-00e5-4823-bd94-4c95a7d60438\",\"name\":\"Analyze Email with ChatGPT\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[3000,420],\"parameters\":{\"modelId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o\",\"cachedResultName\":\"GPT-4O\"},\"options\":{},\"messages\":{\"values\":[{\"content\":\"=Describe the following email using the HTML body and headers. Determine if the email could be a phishing email. \\n\\nHere is the HTML body:\\n{{ $('Set Email Variables').item.json.htmlBody }}\\n\\nThe message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\n\"},{\"role\":\"system\",\"content\":\"Please make sure to output all responses using the following structured JSON output:\\n{\\n  \\\"malicious\\\": false,\\n  \\\"summary\\\": \\\"The email appears to be a legitimate communication from a known sender. It contains no suspicious links, attachments, or language that indicates phishing or malicious intent.\\\"\\n}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response. Make the summary as verbose as possible including a full breakdown of why the email is benign or malicious.\"}]},\"jsonOutput\":true},\"credentials\":{\"openAiApi\":{\"id\":\"76\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.6},{\"id\":\"a91f4095-9245-4276-b21f-f415de22df62\",\"name\":\"Create Potentially Malicious Ticket\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3640,400],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10001\",\"cachedResultName\":\"Support\"},\"summary\":\"=Potentially Malicious - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10008\",\"cachedResultName\":\"Task\"},\"additionalFields\":{\"description\":\"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"a5a66a0e-9d8a-45a9-b1ae-aec78ddfec27\",\"name\":\"Create Potentially Benign Ticket\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3640,580],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10001\",\"cachedResultName\":\"Support\"},\"summary\":\"=Potentially Benign - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10008\",\"cachedResultName\":\"Task\"},\"additionalFields\":{\"description\":\"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"5af0d60b-d021-4dd9-98f7-b2842800764a\",\"name\":\"Rename Screenshot\",\"type\":\"n8n-nodes-base.code\",\"position\":[4020,480],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"$('Retrieve Screenshot').item.binary.data.fileName = 'emailScreenshot.png'\\n\\nreturn $('Retrieve Screenshot').item;\"},\"typeVersion\":2},{\"id\":\"441c4cbb-bd93-4213-bd34-e18f2a49389f\",\"name\":\"Set Jira ID\",\"type\":\"n8n-nodes-base.set\",\"position\":[3860,480],\"parameters\":{\"options\":{},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"4c71188c-011d-4f8e-a36c-87900bfab59a\",\"name\":\"Upload Screenshot of Email to Jira\",\"type\":\"n8n-nodes-base.jira\",\"position\":[4220,480],\"parameters\":{\"issueKey\":\"={{ $('Set Jira ID').item.json.key }}\",\"resource\":\"issueAttachment\"},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"3c031c34-8306-44e1-8e0e-a584c5323112\",\"name\":\"Upload Email Body to Jira\",\"type\":\"n8n-nodes-base.jira\",\"position\":[4620,480],\"parameters\":{\"issueKey\":\"={{ $('Set Jira ID').item.json.key }}\",\"resource\":\"issueAttachment\"},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"d033dcbd-7ccb-451f-ab81-cc6d32d2e01f\",\"name\":\"Convert Email Body to File\",\"type\":\"n8n-nodes-base.convertToFile\",\"position\":[2420,420],\"parameters\":{\"options\":{\"fileName\":\"emailBody.txt\"},\"operation\":\"toText\",\"sourceProperty\":\"textBody\"},\"typeVersion\":1.1},{\"id\":\"bda5e2fe-d8c0-456b-975a-35e82ff02816\",\"name\":\"Set Email Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2240,420],\"parameters\":{\"options\":{},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"54ecd8ab-ac4a-4b6b-bd1b-bf8c70082a33\",\"name\":\"Rename Email Body Screenshot\",\"type\":\"n8n-nodes-base.code\",\"position\":[4420,480],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"$('Convert Email Body to File').item.binary.data.fileName = 'emailBody.txt'\\n\\nreturn $('Convert Email Body to File').item;\"},\"typeVersion\":2},{\"id\":\"fe5b82cc-b4bb-4c97-9477-075d5a280e9f\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2574.536755825029,0],\"parameters\":{\"color\":7,\"width\":376.8280004374956,\"height\":595.590013880477,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/hctiapi2.png)\\n## Email Body Screenshot Creation\\n\\nThe **Screenshot HTML** node sends the email's HTML body to the **hcti.io** API, generating a screenshot that visually represents the email's layout. The **Retrieve Screenshot** node then fetches this image, making it available for attachment or review in subsequent steps. This dual-format processing ensures both clarity and flexibility in email analysis workflows.\"},\"typeVersion\":1},{\"id\":\"86b21049-f65e-4c6a-a854-c4376f870da9\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1380,-149.99110983560342],\"parameters\":{\"color\":7,\"width\":814.4556539379754,\"height\":444.5525554815556,\"content\":\"![Gmail](https://uploads.n8n.io/templates/gmail.png)\\n## Gmail Integration and Data Extraction\\n\\nThis section of the workflow connects to a Gmail account using the **Gmail Trigger** node, capturing incoming emails in real-time, with checks performed every minute. Once an email is detected, its key components—such as the subject, recipient, body, and headers—are extracted and assigned to variables using the **Set Gmail Variables** node. These variables are structured for subsequent analysis and processing in later steps.\"},\"typeVersion\":1},{\"id\":\"b1a786cf-7a8d-49e1-90ed-31f3d0e65b13\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1380,308],\"parameters\":{\"color\":7,\"width\":809.7918597571277,\"height\":602.9002284617277,\"content\":\"![Gmail](https://uploads.n8n.io/templates/outlook.png)\\n## Microsoft Outlook Integration and Email Header Processing\\n\\nThis section enables the integration of Microsoft Outlook to monitor and capture incoming emails. The Microsoft Outlook Trigger node checks for new messages every minute. Once an email is detected, the Retrieve Headers of Email node fetches detailed header and body content via the Microsoft Graph API. The Format Headers node organizes the email headers into a structured format using a JavaScript function, ensuring clarity and readiness for further processing. Finally, the Set Outlook Variables node extracts and assigns key details—such as the email subject, recipient, body, and formatted headers—to variables for use in subsequent workflow steps. This section is essential for processing Outlook emails and preparing them for analysis and reporting.\\n\\n\\n\\n\\n\\n\\n\"},\"typeVersion\":1},{\"id\":\"e7ace035-b5f5-4ef3-a117-22c7c938868d\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2958.4325220284563,24.744924120002338],\"parameters\":{\"color\":7,\"width\":593.0990401534098,\"height\":573.1750519720028,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## AI-Powered Email Analysis and Threat Detection\\n\\nThis section leverages ChatGPT for advanced email content and header analysis to determine potential phishing threats. The **Analyze Email with ChatGPT** node processes the email's HTML body and headers, generating a detailed JSON response that categorizes the email as malicious or benign. The response includes a verbose explanation, formatted for Jira, outlining the reasons for the classification. The **Check if Malicious** node evaluates the AI output to determine the next steps based on the email's threat status. If flagged as malicious, subsequent actions like reporting and ticket creation are triggered. This section ensures precise, AI-driven analysis to enhance email security workflows.\"},\"typeVersion\":1},{\"id\":\"02c1ad8e-f952-42d2-ae9f-cf3a77e49e52\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3562.4948140707697,-125.79607719303533],\"parameters\":{\"color\":7,\"width\":1251.7025543502837,\"height\":891.579206098173,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## Automated Jira Ticket Creation and Email Attachment\\n\\nThis section streamlines the process of logging phishing email reports in Jira, complete with detailed analysis and attachments. The workflow creates two distinct Jira tickets depending on the AI classification of the email:\\n\\n1. **Potentially Malicious**: The **Create Potentially Malicious Ticket** node generates a ticket if the email is flagged as a phishing attempt, including a summary of ChatGPT's analysis and the email’s details.\\n2. **Potentially Benign**: If the email is classified as safe, the **Create Potentially Benign Ticket** node logs a ticket with similar details but under a non-malicious category.\\n\\n\\nThe **Set Jira ID** node ensures the generated ticket's ID is tracked for subsequent operations. Attachments are handled efficiently:\\n\\n- **Rename Screenshot** prepares the email screenshot for upload.\\n- **Upload Screenshot of Email to Jira** adds the screenshot to the Jira ticket for visual context.\\n- **Rename Email Body Screenshot** and **Upload Email Body to Jira** manage the attachment of the email's text body as a `.txt` file.\\n\\n\\nThis section enhances reporting by automating ticket creation, ensuring all relevant email data is readily available for review by security teams.\"},\"typeVersion\":1},{\"id\":\"597ef23e-c61c-4e27-8c14-74ec20079c96\",\"name\":\"Check if Malicious\",\"type\":\"n8n-nodes-base.if\",\"position\":[3400,420],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"493f412c-5f11-4173-8940-90f5bc7f5fab\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ $json.message.content.malicious }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"af512af9-924b-4019-bdf9-62aac9cd0dac\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2200,39.041733604283195],\"parameters\":{\"color\":7,\"width\":365.6458805720866,\"height\":559.8072303111675,\"content\":\"![n8n](https://uploads.n8n.io/templates/n8n.png)\\n## Email Body Conversion\\n\\nThis section processes the email body into both text and visual formats for detailed analysis and reporting. The **Set Email Variables** node organizes the email's data, including its HTML body and text content, to prepare it for further steps. The **Convert Email Body to File** node creates a `.txt` file containing the plain text version of the email body, useful for documentation or further analysis.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Set Jira ID\":{\"main\":[[{\"node\":\"Rename Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Gmail Trigger\":{\"main\":[[{\"node\":\"Set Gmail Variables\",\"type\":\"main\",\"index\":0}]]},\"Format Headers\":{\"main\":[[{\"node\":\"Set Outlook Variables\",\"type\":\"main\",\"index\":0}]]},\"Screenshot HTML\":{\"main\":[[{\"node\":\"Retrieve Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Rename Screenshot\":{\"main\":[[{\"node\":\"Upload Screenshot of Email to Jira\",\"type\":\"main\",\"index\":0}]]},\"Check if Malicious\":{\"main\":[[{\"node\":\"Create Potentially Malicious Ticket\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Create Potentially Benign Ticket\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Screenshot\":{\"main\":[[{\"node\":\"Analyze Email with ChatGPT\",\"type\":\"main\",\"index\":0}]]},\"Set Email Variables\":{\"main\":[[{\"node\":\"Convert Email Body to File\",\"type\":\"main\",\"index\":0}]]},\"Set Gmail Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Set Outlook Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Microsoft Outlook Trigger\":{\"main\":[[{\"node\":\"Retrieve Headers of Email\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Headers of Email\":{\"main\":[[{\"node\":\"Format Headers\",\"type\":\"main\",\"index\":0}]]},\"Analyze Email with ChatGPT\":{\"main\":[[{\"node\":\"Check if Malicious\",\"type\":\"main\",\"index\":0}]]},\"Convert Email Body to File\":{\"main\":[[{\"node\":\"Screenshot HTML\",\"type\":\"main\",\"index\":0}]]},\"Rename Email Body Screenshot\":{\"main\":[[{\"node\":\"Upload Email Body to Jira\",\"type\":\"main\",\"index\":0}]]},\"Create Potentially Benign Ticket\":{\"main\":[[{\"node\":\"Set Jira ID\",\"type\":\"main\",\"index\":0}]]},\"Upload Screenshot of Email to Jira\":{\"main\":[[{\"node\":\"Rename Email Body Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Create Potentially Malicious Ticket\":{\"main\":[[{\"node\":\"Set Jira ID\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Analyze & Sort Suspicious Email Contents with ChatGPT and Jira\n\n#### Who is this for?\n\nThis workflow is tailored for IT security teams, managed service providers (MSPs), and organizations aiming to streamline the detection and reporting of phishing emails. It's especially useful for teams handling high email volumes and requiring quick, automated analysis.\n\n#### What problem is this workflow solving?\n\nPhishing emails pose a significant cybersecurity threat, and manual review processes are time-consuming and prone to human error. This workflow automates the identification of malicious emails, provides AI-driven insights, and generates structured reports, enabling faster and more efficient responses to email-based threats.\n\n#### What this workflow does\n\nThis workflow integrates Gmail or Microsoft Outlook to monitor and capture incoming emails. It processes the email content and headers, converts the email's body to a visual screenshot for clarity, and uses ChatGPT's advanced AI to analyze the email for phishing indicators. Based on the analysis, it categorizes emails as potentially malicious or benign, creating detailed Jira tickets for each case. Attachments, including the email body and screenshots, are automatically uploaded for comprehensive reporting.\n\n**Key steps include:**\n\n  1. **Email Integration** : Captures emails from Gmail or Microsoft Outlook.\n  2. **Content Processing** : Extracts and organizes email content and metadata.\n  3. **AI Analysis** : Uses ChatGPT to evaluate email content and headers.\n  4. **Classification** : Categorizes emails as malicious or benign.\n  5. **Automated Reporting** : Creates Jira tickets with detailed analysis and attachments.\n\n\n\n#### Setup\n\n  1. **Authentication** : Configure Gmail or Microsoft Outlook credentials in n8n.\n  2. **API Keys** : Add credentials for the HTML screenshot service (`hcti.io`) and OpenAI.\n  3. **Jira Configuration** : Set up project and issue types in the Jira nodes.\n  4. **Customization** : Update sticky notes and nodes to fit your organizational requirements, such as modifying the AI prompt or Jira ticket fields.\n\n\n\n#### How to customize this workflow to your needs\n\n  * Adjust email triggers to include or exclude specific senders or subjects.\n  * Refine the AI prompt in the ChatGPT node to tailor phishing detection criteria.\n  * Modify Jira ticket content to include additional fields or match specific workflows.\n\n\n\nThis workflow is ideal for automating email threat detection, reducing response times, and enhancing overall cybersecurity processes. By leveraging AI-powered insights, it helps organizations stay ahead of phishing attacks.\n",
  "crawled_at": "2025-05-26T01:38:57.274679",
  "readme_zh": "### 利用ChatGPT与Jira分析归类可疑邮件内容\n\n#### 适用对象\n本流程专为IT安全团队、托管服务提供商（MSP）及希望优化钓鱼邮件检测与报告流程的机构设计，特别适合需要快速自动化分析、处理海量邮件的团队。\n\n#### 解决痛点\n钓鱼邮件是重大网络安全威胁，人工审核耗时且易出错。本流程通过自动化识别恶意邮件、提供AI分析洞察并生成结构化报告，显著提升邮件威胁响应效率。\n\n#### 核心功能\n本流程集成Gmail或Microsoft Outlook监控收件箱，提取邮件内容与标头数据，将邮件正文转换为可视化截图，并运用ChatGPT高级AI检测钓鱼特征。根据分析结果自动分类恶意/正常邮件，生成带完整附件的Jira工单（含邮件正文与截图）。\n\n**关键步骤：**\n1. **邮件集成**：从Gmail或Microsoft Outlook抓取邮件\n2. **内容处理**：解析邮件内容与元数据\n3. **AI分析**：通过ChatGPT评估邮件内容与标头\n4. **风险分类**：标记邮件风险等级\n5. **自动报告**：创建含详细分析的Jira工单\n\n#### 配置指南\n1. **身份验证**：在n8n配置邮箱凭证\n2. **API密钥**：设置HTML截图服务（hcti.io）和OpenAI的密钥\n3. **Jira配置**：在Jira节点中设置项目与事务类型\n4. **自定义**：根据需求调整AI提示词、Jira字段等参数\n\n#### 定制化建议\n• 修改邮件触发条件（发件人/主题过滤）\n• 优化ChatGPT节点的钓鱼检测标准\n• 扩展Jira工单字段以适配现有流程\n\n本流程通过AI驱动分析实现邮件威胁自动化检测，能有效缩短响应时间，是提升网络安全防护水平的理想解决方案。",
  "title_zh": "利用ChatGPT分析与分类可疑邮件内容",
  "publish_date_zh": "最后更新于4个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"94dd7f48-0013-4fb5-89c4-826ecd7f2d66\",\n      \"name\": \"Gmail Trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        1460,\n        120\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {},\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"kkhNhqKpZt6IUZd0\",\n          \"name\": \"Gmail\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"ca2023fa-ceca-4923-80e4-a3843803536c\",\n      \"name\": \"Microsoft Outlook Trigger\",\n      \"type\": \"n8n-nodes-base.microsoftOutlookTrigger\",\n      \"disabled\": true,\n      \"position\": [\n        1480,\n        680\n      ],\n      \"parameters\": {\n        \"fields\": [\n          \"body\",\n          \"toRecipients\",\n          \"subject\",\n          \"bodyPreview\"\n        ],\n        \"output\": \"fields\",\n        \"filters\": {},\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"microsoftOutlookOAuth2Api\": {\n          \"id\": \"vTCK0oVQ0WjFrI5H\",\n          \"name\": \" Outlook Credential\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1f011214-91a0-4cfa-9d9e-29864937c0a3\",\n      \"name\": \"Screenshot HTML\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2620,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"https://hcti.io/v1/image\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"html\",\n              \"value\": \"={{ $('Set Email Variables').item.json.htmlBody }}\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpBasicAuth\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {}\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"8tm8mUWmPvtmPFPk\",\n          \"name\": \"hcti.io\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"64f4789f-9de8-414f-af62-ddc339f0d0ac\",\n      \"name\": \"Retrieve Screenshot\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2800,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.url }}\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpBasicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"8tm8mUWmPvtmPFPk\",\n          \"name\": \"hcti.io\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"db707bd9-6abc-4ab7-8ffa-ad25c5e8adc4\",\n      \"name\": \"Set Outlook Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2040,\n        680\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\n              \"name\": \"htmlBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"\n            },\n            {\n              \"id\": \"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\",\n              \"name\": \"headers\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json}}\"\n            },\n            {\n              \"id\": \"20566ad4-7eb7-42b1-8a0d-f8b759610f10\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"\n            },\n            {\n              \"id\": \"7171998f-a5a2-4e23-946a-9c1ad75710e7\",\n              \"name\": \"recipient\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"\n            },\n            {\n              \"id\": \"cc262634-2470-4524-8319-abe2518a6335\",\n              \"name\": \"textBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Retrieve Headers of Email').item.json.body.content }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"7a3622c0-6949-4ea3-ae13-46a1ee26de7b\",\n      \"name\": \"Set Gmail Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2020,\n        120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\n              \"name\": \"htmlBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.html }}\"\n            },\n            {\n              \"id\": \"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\",\n              \"name\": \"headers\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.headers }}\"\n            },\n            {\n              \"id\": \"1d690098-be2a-4604-baf8-62f314930929\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.subject }}\"\n            },\n            {\n              \"id\": \"8009f00a-547f-4eb1-b52d-2e7305248885\",\n              \"name\": \"recipient\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.to.text }}\"\n            },\n            {\n              \"id\": \"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\",\n              \"name\": \"textBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.text }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4b4c6b34-f74c-4402-91a1-4d002e02a3bd\",\n      \"name\": \"Retrieve Headers of Email\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1700,\n        680\n      ],\n      \"parameters\": {\n        \"url\": \"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Accept\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"Prefer\",\n              \"value\": \"outlook.body-content-type=\\\"text\\\"\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"microsoftOutlookOAuth2Api\"\n      },\n      \"credentials\": {\n        \"microsoftOutlookOAuth2Api\": {\n          \"id\": \"vTCK0oVQ0WjFrI5H\",\n          \"name\": \" Outlook Credential\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"0c9883b5-3eb7-45db-9803-d1b30166a3b5\",\n      \"name\": \"Format Headers\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1880,\n        680\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"c21a976c-00e5-4823-bd94-4c95a7d60438\",\n      \"name\": \"Analyze Email with ChatGPT\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"position\": [\n        3000,\n        420\n      ],\n      \"parameters\": {\n        \"modelId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o\",\n          \"cachedResultName\": \"GPT-4O\"\n        },\n        \"options\": {},\n        \"messages\": {\n          \"values\": [\n            {\n              \"content\": \"=Describe the following email using the HTML body and headers. Determine if the email could be a phishing email. \\n\\nHere is the HTML body:\\n{{ $('Set Email Variables').item.json.htmlBody }}\\n\\nThe message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\n\"\n            },\n            {\n              \"role\": \"system\",\n              \"content\": \"Please make sure to output all responses using the following structured JSON output:\\n{\\n  \\\"malicious\\\": false,\\n  \\\"summary\\\": \\\"The email appears to be a legitimate communication from a known sender. It contains no suspicious links, attachments, or language that indicates phishing or malicious intent.\\\"\\n}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response. Make the summary as verbose as possible including a full breakdown of why the email is benign or malicious.\"\n            }\n          ]\n        },\n        \"jsonOutput\": true\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"76\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.6\n    },\n    {\n      \"id\": \"a91f4095-9245-4276-b21f-f415de22df62\",\n      \"name\": \"Create Potentially Malicious Ticket\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        3640,\n        400\n      ],\n      \"parameters\": {\n        \"project\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10001\",\n          \"cachedResultName\": \"Support\"\n        },\n        \"summary\": \"=Potentially Malicious - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\n        \"issueType\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10008\",\n          \"cachedResultName\": \"Task\"\n        },\n        \"additionalFields\": {\n          \"description\": \"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"\n        }\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a5a66a0e-9d8a-45a9-b1ae-aec78ddfec27\",\n      \"name\": \"Create Potentially Benign Ticket\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        3640,\n        580\n      ],\n      \"parameters\": {\n        \"project\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10001\",\n          \"cachedResultName\": \"Support\"\n        },\n        \"summary\": \"=Potentially Benign - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\n        \"issueType\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10008\",\n          \"cachedResultName\": \"Task\"\n        },\n        \"additionalFields\": {\n          \"description\": \"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"\n        }\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5af0d60b-d021-4dd9-98f7-b2842800764a\",\n      \"name\": \"Rename Screenshot\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        4020,\n        480\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"$('Retrieve Screenshot').item.binary.data.fileName = 'emailScreenshot.png'\\n\\nreturn $('Retrieve Screenshot').item;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"441c4cbb-bd93-4213-bd34-e18f2a49389f\",\n      \"name\": \"Set Jira ID\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        3860,\n        480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4c71188c-011d-4f8e-a36c-87900bfab59a\",\n      \"name\": \"Upload Screenshot of Email to Jira\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        4220,\n        480\n      ],\n      \"parameters\": {\n        \"issueKey\": \"={{ $('Set Jira ID').item.json.key }}\",\n        \"resource\": \"issueAttachment\"\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3c031c34-8306-44e1-8e0e-a584c5323112\",\n      \"name\": \"Upload Email Body to Jira\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        4620,\n        480\n      ],\n      \"parameters\": {\n        \"issueKey\": \"={{ $('Set Jira ID').item.json.key }}\",\n        \"resource\": \"issueAttachment\"\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d033dcbd-7ccb-451f-ab81-cc6d32d2e01f\",\n      \"name\": \"Convert Email Body to File\",\n      \"type\": \"n8n-nodes-base.convertToFile\",\n      \"position\": [\n        2420,\n        420\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"fileName\": \"emailBody.txt\"\n        },\n        \"operation\": \"toText\",\n        \"sourceProperty\": \"textBody\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"bda5e2fe-d8c0-456b-975a-35e82ff02816\",\n      \"name\": \"Set Email Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2240,\n        420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"54ecd8ab-ac4a-4b6b-bd1b-bf8c70082a33\",\n      \"name\": \"Rename Email Body Screenshot\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        4420,\n        480\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"$('Convert Email Body to File').item.binary.data.fileName = 'emailBody.txt'\\n\\nreturn $('Convert Email Body to File').item;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"fe5b82cc-b4bb-4c97-9477-075d5a280e9f\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2574.536755825029,\n        0\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 376.8280004374956,\n        \"height\": 595.590013880477,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/hctiapi2.png)\\n## 邮件正文截图生成\\n\\n**HTML截图**节点将邮件的HTML正文发送至**hcti.io** API，生成呈现邮件布局的可视化截图。随后**获取截图**节点会提取该图像，使其可供后续步骤进行附件添加或审查。这种双重格式处理方式确保了邮件分析工作流程的清晰性与灵活性。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"86b21049-f65e-4c6a-a854-c4376f870da9\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1380,\n        -149.99110983560342\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 814.4556539379754,\n        \"height\": 444.5525554815556,\n        \"content\": \"![Gmail](https://uploads.n8n.io/templates/gmail.png)\\n## Gmail集成与数据提取\\n\\n该工作流模块通过**Gmail触发器**节点连接至Gmail账户，实时捕获新进邮件（每分钟执行一次检查）。当检测到邮件时，系统会使用**设置Gmail变量**节点提取邮件的关键要素（包括主题、收件人、正文及标头）并赋值给相应变量。这些经过结构化的变量将为后续步骤的分析与处理提供数据支持。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b1a786cf-7a8d-49e1-90ed-31f3d0e65b13\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1380,\n        308\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 809.7918597571277,\n        \"height\": 602.9002284617277,\n        \"content\": \"![Gmail](https://uploads.n8n.io/templates/outlook.png)\\n## Microsoft Outlook集成与邮件标头处理\\n\\n本模块实现Microsoft Outlook的集成功能，用于监控和捕获接收邮件。Microsoft Outlook触发器节点每分钟检测新邮件。当检测到邮件时，\\\"检索邮件标头\\\"节点通过Microsoft Graph API获取详细的邮件标头及正文内容。\\\"格式化标头\\\"节点使用JavaScript函数将邮件标头整理为结构化格式，确保信息清晰且便于后续处理。最后，\\\"设置Outlook变量\\\"节点提取关键信息——包括邮件主题、收件人、正文及格式化后的标头——并将其赋值给变量，供后续工作流步骤使用。该模块对于处理Outlook邮件并准备分析报告至关重要。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e7ace035-b5f5-4ef3-a117-22c7c938868d\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2958.4325220284563,\n        24.744924120002338\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 593.0990401534098,\n        \"height\": 573.1750519720028,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## 基于AI的邮件分析与威胁检测\\n\\n本模块运用ChatGPT实现高级邮件内容及信头分析，用于识别潜在钓鱼威胁。**通过ChatGPT分析邮件**节点会处理邮件的HTML正文和信头数据，生成包含详细分类结果的JSON响应（标记为恶意或正常邮件），并附有符合Jira格式的详尽分类依据说明。**恶意邮件校验**节点根据AI输出结果评估威胁状态，决定后续流程。若判定为恶意邮件，将触发举报、工单创建等处置动作。该模块通过精准的AI驱动分析，全面提升邮件安全流程效能。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"02c1ad8e-f952-42d2-ae9f-cf3a77e49e52\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        3562.4948140707697,\n        -125.79607719303533\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1251.7025543502837,\n        \"height\": 891.579206098173,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## 自动化Jira工单创建与邮件附件处理\\n\\n本模块优化了钓鱼邮件报告的Jira记录流程，包含详细分析及附件处理。根据AI对邮件的分类结果，工作流会创建两种不同类型的Jira工单：\\n\\n1. **潜在恶意邮件**：当邮件被标记为钓鱼尝试时，**创建潜在恶意工单**节点将生成包含ChatGPT分析摘要和邮件详情的工单。\\n2. **潜在良性邮件**：若邮件被判定为安全，**创建潜在良性工单**节点会以非恶意分类记录包含相似细节的工单。\\n\\n**设置Jira ID**节点用于追踪生成工单的ID以便后续操作。附件处理环节高效有序：\\n\\n- **重命名截图**节点准备待上传的邮件截图\\n- **上传邮件截图至Jira**节点为工单添加可视化上下文\\n- **重命名邮件正文截图**与**上传邮件正文至Jira**节点负责将邮件文本内容以`.txt`格式附加至工单\\n\\n该模块通过自动化工单创建提升报告效率，确保安全团队能便捷查阅所有相关邮件数据。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"597ef23e-c61c-4e27-8c14-74ec20079c96\",\n      \"name\": \"Check if Malicious\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        3400,\n        420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"493f412c-5f11-4173-8940-90f5bc7f5fab\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.message.content.malicious }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"af512af9-924b-4019-bdf9-62aac9cd0dac\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2200,\n        39.041733604283195\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 365.6458805720866,\n        \"height\": 559.8072303111675,\n        \"content\": \"![n8n](https://uploads.n8n.io/templates/n8n.png)\\n## 邮件正文转换\\n\\n本部分将邮件正文处理为文本和可视化格式，以便进行详细分析与报告生成。**设置邮件变量**节点负责整理邮件数据（包括HTML正文和文本内容），为后续步骤做好准备。**邮件正文转文件**节点会生成包含纯文本版本邮件正文的`.txt`文件，便于归档或深度分析。\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Set Jira ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Rename Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Gmail Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Format Headers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Outlook Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Screenshot HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Rename Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload Screenshot of Email to Jira\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check if Malicious\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Potentially Malicious Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create Potentially Benign Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Analyze Email with ChatGPT\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Email Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert Email Body to File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Gmail Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Outlook Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Microsoft Outlook Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Headers of Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Headers of Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Format Headers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Analyze Email with ChatGPT\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check if Malicious\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert Email Body to File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Screenshot HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Rename Email Body Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload Email Body to Jira\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Potentially Benign Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Jira ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload Screenshot of Email to Jira\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Rename Email Body Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Potentially Malicious Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Jira ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
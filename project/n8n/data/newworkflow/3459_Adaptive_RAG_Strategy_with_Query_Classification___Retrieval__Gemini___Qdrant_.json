{
  "url": "https://n8n.io/workflows/3459-adaptive-rag-strategy-with-query-classification-and-retrieval-gemini-and-qdrant/",
  "title": "Adaptive RAG Strategy with Query Classification & Retrieval (Gemini & Qdrant)",
  "author": "dmr",
  "publish_date": "Last update 19 days ago",
  "publish_date_absolute": "2025-05-07",
  "categories": [
    {
      "name": "Engineering"
    },
    {
      "name": "Building Blocks"
    },
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"id\":\"cpuFyJYHKmjHTncz\",\"meta\":{\"instanceId\":\"2cb7a61f866faf57392b91b31f47e08a2b3640258f0abd08dd71f087f3243a5a\",\"templateCredsSetupCompleted\":true},\"name\":\"Adaptive RAG\",\"tags\":[],\"nodes\":[{\"id\":\"856bd809-8f41-41af-8f72-a3828229c2a5\",\"name\":\"Query Classification\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"notes\":\"Classify a query into one of four categories: Factual, Analytical, Opinion, or Contextual.\\n        \\nReturns:\\nstr: Query category\",\"position\":[380,-20],\"parameters\":{\"text\":\"=Classify this query: {{ $('Combined Fields').item.json.user_query }}\",\"options\":{\"systemMessage\":\"You are an expert at classifying questions. \\n\\nClassify the given query into exactly one of these categories:\\n- Factual: Queries seeking specific, verifiable information.\\n- Analytical: Queries requiring comprehensive analysis or explanation.\\n- Opinion: Queries about subjective matters or seeking diverse viewpoints.\\n- Contextual: Queries that depend on user-specific context.\\n\\nReturn ONLY the category name, without any explanation or additional text.\"},\"promptType\":\"define\"},\"typeVersion\":1.8},{\"id\":\"cc2106fc-f1a8-45ef-b37b-ab981ac13466\",\"name\":\"Switch\",\"type\":\"n8n-nodes-base.switch\",\"position\":[740,-40],\"parameters\":{\"rules\":{\"values\":[{\"outputKey\":\"Factual\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"87f3b50c-9f32-4260-ac76-19c05b28d0b4\",\"operator\":{\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.output.trim() }}\",\"rightValue\":\"Factual\"}]},\"renameOutput\":true},{\"outputKey\":\"Analytical\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"f8651b36-79fa-4be4-91fb-0e6d7deea18f\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.output.trim() }}\",\"rightValue\":\"Analytical\"}]},\"renameOutput\":true},{\"outputKey\":\"Opinion\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"5dde06bc-5fe1-4dca-b6e2-6857c5e96d49\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.output.trim() }}\",\"rightValue\":\"Opinion\"}]},\"renameOutput\":true},{\"outputKey\":\"Contextual\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"bf97926d-7a0b-4e2f-aac0-a820f73344d8\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.output.trim() }}\",\"rightValue\":\"Contextual\"}]},\"renameOutput\":true}]},\"options\":{\"fallbackOutput\":0}},\"typeVersion\":3.2},{\"id\":\"63889cad-1283-4dbf-ba16-2b6cf575f24a\",\"name\":\"Factual Strategy - Focus on Precision\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"notes\":\"Retrieval strategy for factual queries focusing on precision.\",\"position\":[1140,-780],\"parameters\":{\"text\":\"=Enhance this factual query: {{ $('Combined Fields').item.json.user_query }}\",\"options\":{\"systemMessage\":\"=You are an expert at enhancing search queries.\\n\\nYour task is to reformulate the given factual query to make it more precise and specific for information retrieval. Focus on key entities and their relationships.\\n\\nProvide ONLY the enhanced query without any explanation.\"},\"promptType\":\"define\"},\"typeVersion\":1.7},{\"id\":\"020d2201-9590-400d-b496-48c65801271c\",\"name\":\"Analytical Strategy - Comprehensive Coverage\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"notes\":\"Retrieval strategy for analytical queries focusing on comprehensive coverage.\",\"position\":[1140,-240],\"parameters\":{\"text\":\"=Generate sub-questions for this analytical query: {{ $('Combined Fields').item.json.user_query }}\",\"options\":{\"systemMessage\":\"=You are an expert at breaking down complex questions.\\n\\nGenerate sub-questions that explore different aspects of the main analytical query.\\nThese sub-questions should cover the breadth of the topic and help retrieve comprehensive information.\\n\\nReturn a list of exactly 3 sub-questions, one per line.\"},\"promptType\":\"define\"},\"typeVersion\":1.7},{\"id\":\"c35d1b95-68c8-4237-932d-4744f620760d\",\"name\":\"Opinion Strategy - Diverse Perspectives\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"notes\":\"Retrieval strategy for opinion queries focusing on diverse perspectives.\",\"position\":[1140,300],\"parameters\":{\"text\":\"=Identify different perspectives on: {{ $('Combined Fields').item.json.user_query }}\",\"options\":{\"systemMessage\":\"=You are an expert at identifying different perspectives on a topic.\\n\\nFor the given query about opinions or viewpoints, identify different perspectives that people might have on this topic.\\n\\nReturn a list of exactly 3 different viewpoint angles, one per line.\"},\"promptType\":\"define\"},\"typeVersion\":1.7},{\"id\":\"363a3fc3-112f-40df-891e-0a5aa3669245\",\"name\":\"Contextual Strategy - User Context Integration\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"notes\":\"Retrieval strategy for contextual queries integrating user context.\",\"position\":[1140,840],\"parameters\":{\"text\":\"=Infer the implied context in this query: {{ $('Combined Fields').item.json.user_query }}\",\"options\":{\"systemMessage\":\"=You are an expert at understanding implied context in questions.\\n\\nFor the given query, infer what contextual information might be relevant or implied but not explicitly stated. Focus on what background would help answering this query.\\n\\nReturn a brief description of the implied context.\"},\"promptType\":\"define\"},\"typeVersion\":1.7},{\"id\":\"45887701-5ea5-48b4-9b2b-40a80238ab0c\",\"name\":\"Chat\",\"type\":\"@n8n/n8n-nodes-langchain.chatTrigger\",\"position\":[-280,120],\"webhookId\":\"56f626b5-339e-48af-857f-1d4198fc8a4d\",\"parameters\":{\"options\":{}},\"typeVersion\":1.1},{\"id\":\"7f7df364-4829-4e29-be3d-d13a63f65b8f\",\"name\":\"Factual Prompt and Output\",\"type\":\"n8n-nodes-base.set\",\"position\":[1540,-780],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\"name\":\"output\",\"type\":\"string\",\"value\":\"={{ $json.output }}\"},{\"id\":\"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\"name\":\"prompt\",\"type\":\"string\",\"value\":\"You are a helpful assistant providing factual information. Answer the question based on the provided context. Focus on accuracy and precision. If the context doesn't contain the information needed, acknowledge the limitations.\"}]}},\"typeVersion\":3.4},{\"id\":\"590d8667-69eb-4db2-b5be-714c602b319a\",\"name\":\"Contextual Prompt and Output\",\"type\":\"n8n-nodes-base.set\",\"position\":[1540,840],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\"name\":\"output\",\"type\":\"string\",\"value\":\"={{ $json.output }}\"},{\"id\":\"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\"name\":\"prompt\",\"type\":\"string\",\"value\":\"You are a helpful assistant providing contextually relevant information. Answer the question considering both the query and its context. Make connections between the query context and the information in the provided documents. If the context doesn't fully address the specific situation, acknowledge the limitations.\"}]}},\"typeVersion\":3.4},{\"id\":\"fa3228ee-62d8-4c02-9dca-8a1ebc6afc74\",\"name\":\"Opinion Prompt and Output\",\"type\":\"n8n-nodes-base.set\",\"position\":[1540,300],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\"name\":\"output\",\"type\":\"string\",\"value\":\"={{ $json.output }}\"},{\"id\":\"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\"name\":\"prompt\",\"type\":\"string\",\"value\":\"You are a helpful assistant discussing topics with multiple viewpoints. Based on the provided context, present different perspectives on the topic. Ensure fair representation of diverse opinions without showing bias. Acknowledge where the context presents limited viewpoints.\"}]}},\"typeVersion\":3.4},{\"id\":\"c769a76a-fb26-46a1-a00d-825b689d5f7a\",\"name\":\"Analytical Prompt and Output\",\"type\":\"n8n-nodes-base.set\",\"position\":[1540,-240],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\"name\":\"output\",\"type\":\"string\",\"value\":\"={{ $json.output }}\"},{\"id\":\"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\"name\":\"prompt\",\"type\":\"string\",\"value\":\"You are a helpful assistant providing analytical insights. Based on the provided context, offer a comprehensive analysis of the topic. Cover different aspects and perspectives in your explanation. If the context has gaps, acknowledge them while providing the best analysis possible.\"}]}},\"typeVersion\":3.4},{\"id\":\"fcd29f6b-17e8-442c-93f9-b93fbad7cd10\",\"name\":\"Gemini Classification\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[360,180],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash-lite\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"2zwuT5znDglBrUCO\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"c0828ee3-f184-41f5-9a25-0f1059b03711\",\"name\":\"Gemini Factual\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[1120,-560],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"2zwuT5znDglBrUCO\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"98f9981d-ea8e-45cb-b91d-3c8d1fe33e25\",\"name\":\"Gemini Analytical\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[1120,-20],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"2zwuT5znDglBrUCO\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"c85f270d-3224-4e60-9acf-91f173dfe377\",\"name\":\"Chat Buffer Memory Analytical\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[1280,-20],\"parameters\":{\"sessionKey\":\"={{ $('Combined Fields').item.json.chat_memory_key }}\",\"sessionIdType\":\"customKey\",\"contextWindowLength\":10},\"typeVersion\":1.3},{\"id\":\"c39ba907-7388-4152-965a-e28e626bc9b2\",\"name\":\"Chat Buffer Memory Factual\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[1280,-560],\"parameters\":{\"sessionKey\":\"={{ $('Combined Fields').item.json.chat_memory_key }}\",\"sessionIdType\":\"customKey\",\"contextWindowLength\":10},\"typeVersion\":1.3},{\"id\":\"52dcd9f0-e6b3-4d33-bc6f-621ef880178e\",\"name\":\"Gemini Opinion\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[1120,520],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"2zwuT5znDglBrUCO\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"147a709a-4b46-4835-82cf-7d6b633acd4c\",\"name\":\"Chat Buffer Memory Opinion\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[1280,520],\"parameters\":{\"sessionKey\":\"={{ $('Combined Fields').item.json.chat_memory_key }}\",\"sessionIdType\":\"customKey\",\"contextWindowLength\":10},\"typeVersion\":1.3},{\"id\":\"3cb6bf32-5937-49b9-acf7-d7d01dc2ddd1\",\"name\":\"Gemini Contextual\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[1120,1060],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"2zwuT5znDglBrUCO\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"5916c4f1-4369-4d66-8553-2fff006b7e69\",\"name\":\"Chat Buffer Memory Contextual\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[1280,1060],\"parameters\":{\"sessionKey\":\"={{ $('Combined Fields').item.json.chat_memory_key }}\",\"sessionIdType\":\"customKey\",\"contextWindowLength\":10},\"typeVersion\":1.3},{\"id\":\"d33377c2-6b98-4e4d-968f-f3085354ae50\",\"name\":\"Embeddings\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini\",\"position\":[2060,200],\"parameters\":{\"modelName\":\"models/text-embedding-004\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"2zwuT5znDglBrUCO\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"32d9a0c0-0889-4cb2-a088-8ee9cfecacd3\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1040,-900],\"parameters\":{\"color\":7,\"width\":700,\"height\":520,\"content\":\"## Factual Strategy\\n**Retrieve precise facts and figures.**\"},\"typeVersion\":1},{\"id\":\"064a4729-717c-40c8-824a-508406610a13\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1040,-360],\"parameters\":{\"color\":7,\"width\":700,\"height\":520,\"content\":\"## Analytical Strategy\\n**Provide comprehensive coverage of a topics and exploring different aspects.**\"},\"typeVersion\":1},{\"id\":\"9fd52a28-44bc-4dfd-bdb7-90987cc2f4fb\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1040,180],\"parameters\":{\"color\":7,\"width\":700,\"height\":520,\"content\":\"## Opinion Strategy\\n**Gather diverse viewpoints on a subjective issue.**\"},\"typeVersion\":1},{\"id\":\"3797b21f-cc2a-4210-aa63-6d181d413c5e\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1040,720],\"parameters\":{\"color\":7,\"width\":700,\"height\":520,\"content\":\"## Contextual Strategy\\n**Incorporate user-specific context to fine-tune the retrieval.**\"},\"typeVersion\":1},{\"id\":\"16fa1531-9fb9-4b12-961c-be12e20b2134\",\"name\":\"Concatenate Context\",\"type\":\"n8n-nodes-base.summarize\",\"position\":[2440,-20],\"parameters\":{\"options\":{},\"fieldsToSummarize\":{\"values\":[{\"field\":\"document.pageContent\",\"separateBy\":\"other\",\"aggregation\":\"concatenate\",\"customSeparator\":\"={{ \\\"\\\\n\\\\n---\\\\n\\\\n\\\" }}\"}]}},\"typeVersion\":1.1},{\"id\":\"4d6147d1-7a3d-42ab-b23f-cdafe8ea30b0\",\"name\":\"Retrieve Documents from Vector Store\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreQdrant\",\"position\":[2080,-20],\"parameters\":{\"mode\":\"load\",\"topK\":10,\"prompt\":\"={{ $json.prompt }}\\n\\nUser query: \\n{{ $json.output }}\",\"options\":{},\"qdrantCollection\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Combined Fields').item.json.vector_store_id }}\"}},\"credentials\":{\"qdrantApi\":{\"id\":\"mb8rw8tmUeP6aPJm\",\"name\":\"QdrantApi account\"}},\"typeVersion\":1.1},{\"id\":\"7e68f9cb-0a0d-4215-8083-3b9ef92cd237\",\"name\":\"Set Prompt and Output\",\"type\":\"n8n-nodes-base.set\",\"position\":[1880,-20],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"1d782243-0571-4845-b8fe-4c6c4b55379e\",\"name\":\"output\",\"type\":\"string\",\"value\":\"={{ $json.output }}\"},{\"id\":\"547091fb-367c-44d4-ac39-24d073da70e0\",\"name\":\"prompt\",\"type\":\"string\",\"value\":\"={{ $json.prompt }}\"}]}},\"typeVersion\":3.4},{\"id\":\"0c623ca1-da85-48a3-9d8b-90d97283a015\",\"name\":\"Gemini Answer\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[2720,200],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"2zwuT5znDglBrUCO\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"fab91e48-1c62-46a8-b9fc-39704f225274\",\"name\":\"Answer\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[2760,-20],\"parameters\":{\"text\":\"=User query: {{ $('Combined Fields').item.json.user_query }}\",\"options\":{\"systemMessage\":\"={{ $('Set Prompt and Output').item.json.prompt }}\\n\\nUse the following context (delimited by <ctx></ctx>) and the chat history to answer the user query.\\n<ctx>\\n{{ $json.concatenated_document_pageContent }}\\n</ctx>\"},\"promptType\":\"define\"},\"typeVersion\":1.8},{\"id\":\"d69f8d62-3064-40a8-b490-22772fbc38cd\",\"name\":\"Chat Buffer Memory\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[2900,200],\"parameters\":{\"sessionKey\":\"={{ $('Combined Fields').item.json.chat_memory_key }}\",\"sessionIdType\":\"customKey\",\"contextWindowLength\":10},\"typeVersion\":1.3},{\"id\":\"a399f8e6-fafd-4f73-a2de-894f1e3c4bec\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1800,-220],\"parameters\":{\"color\":7,\"width\":820,\"height\":580,\"content\":\"## Perform adaptive retrieval\\n**Find document considering both query and context.**\"},\"typeVersion\":1},{\"id\":\"7f10fe70-1af8-47ad-a9b5-2850412c43f8\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2640,-220],\"parameters\":{\"color\":7,\"width\":740,\"height\":580,\"content\":\"## Reply to the user integrating retrieval context\"},\"typeVersion\":1},{\"id\":\"5cd0dd02-65f4-4351-aeae-c70ecf5f1d66\",\"name\":\"Respond to Webhook\",\"type\":\"n8n-nodes-base.respondToWebhook\",\"position\":[3120,-20],\"parameters\":{\"options\":{}},\"typeVersion\":1.1},{\"id\":\"4c56ef8f-8fce-4525-bb87-15df37e91cc4\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[280,-220],\"parameters\":{\"color\":7,\"width\":700,\"height\":580,\"content\":\"## User query classification\\n**Classify the query into one of four categories: Factual, Analytical, Opinion, or Contextual.**\"},\"typeVersion\":1},{\"id\":\"3ef73405-89de-4bed-9673-90e2c1f2e74b\",\"name\":\"When Executed by Another Workflow\",\"type\":\"n8n-nodes-base.executeWorkflowTrigger\",\"position\":[-280,-140],\"parameters\":{\"workflowInputs\":{\"values\":[{\"name\":\"user_query\"},{\"name\":\"chat_memory_key\"},{\"name\":\"vector_store_id\"}]}},\"typeVersion\":1.1},{\"id\":\"0785714f-c45c-4eda-9937-c97e44c9a449\",\"name\":\"Combined Fields\",\"type\":\"n8n-nodes-base.set\",\"position\":[40,-20],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"90ab73a2-fe01-451a-b9df-bffe950b1599\",\"name\":\"user_query\",\"type\":\"string\",\"value\":\"={{ $json.user_query || $json.chatInput }}\"},{\"id\":\"36686ff5-09fc-40a4-8335-a5dd1576e941\",\"name\":\"chat_memory_key\",\"type\":\"string\",\"value\":\"={{ $json.chat_memory_key || $('Chat').item.json.sessionId }}\"},{\"id\":\"4230c8f3-644c-4985-b710-a4099ccee77c\",\"name\":\"vector_store_id\",\"type\":\"string\",\"value\":\"={{ $json.vector_store_id || \\\"<ID HERE>\\\" }}\"}]}},\"typeVersion\":3.4},{\"id\":\"57a93b72-4233-4ba2-b8c7-99d88f0ed572\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-300,400],\"parameters\":{\"width\":1280,\"height\":1300,\"content\":\"# Adaptive RAG Workflow\\n\\nThis n8n workflow implements a version of the Adaptive Retrieval-Augmented Generation (RAG) approach. It classifies user queries and applies different retrieval and generation strategies based on the query type (Factual, Analytical, Opinion, or Contextual) to provide more relevant and tailored answers from a knowledge base stored in a Qdrant vector store.\\n\\n## How it Works\\n\\n1.  **Input Trigger:**\\n    * The workflow can be initiated via the built-in Chat interface or triggered by another n8n workflow.\\n    * It expects inputs: `user_query`, `chat_memory_key` (for conversation history), and `vector_store_id` (specifying the Qdrant collection).\\n    * A `Set` node (`Combined Fields`) standardizes these inputs.\\n\\n2.  **Query Classification:**\\n    * A Google Gemini agent (`Query Classification`) analyzes the `user_query`.\\n    * It classifies the query into one of four categories:\\n        * **Factual:** Seeking specific, verifiable information.\\n        * **Analytical:** Requiring comprehensive analysis or explanation.\\n        * **Opinion:** Asking about subjective matters or seeking diverse viewpoints.\\n        * **Contextual:** Depending on user-specific or implied context.\\n\\n3.  **Adaptive Strategy Routing:**\\n    * A `Switch` node routes the workflow based on the classification result from the previous step.\\n\\n4.  **Strategy Implementation (Query Adaptation):**\\n    * Depending on the route, a specific Google Gemini agent adapts the query or approach:\\n        * **Factual Strategy:** Rewrites the query for better precision, focusing on key entities (`Factual Strategy - Focus on Precision`).\\n        * **Analytical Strategy:** Breaks down the main query into multiple sub-questions to ensure comprehensive coverage (`Analytical Strategy - Comprehensive Coverage`).\\n        * **Opinion Strategy:** Identifies different potential perspectives or angles related to the query (`Opinion Strategy - Diverse Perspectives`).\\n        * **Contextual Strategy:** Infers implied context needed to answer the query effectively (`Contextual Strategy - User Context Integration`).\\n    * Each strategy path uses its own chat memory buffer for the adaptation step.\\n\\n5.  **Retrieval Prompt & Output Setup:**\\n    * Based on the *original* query classification, a `Set` node (`Factual/Analytical/Opinion/Contextual Prompt and Output`, combined via connections to `Set Prompt and Output`) prepares:\\n        * The output from the strategy step (e.g., rewritten query, sub-questions, perspectives).\\n        * A tailored system prompt for the final answer generation agent, instructing it how to behave based on the query type (e.g., focus on precision for Factual, present diverse views for Opinion).\\n\\n6.  **Document Retrieval (RAG):**\\n    * The `Retrieve Documents from Vector Store` node uses the adapted query/output from the strategy step to search the specified Qdrant collection (`vector_store_id`).\\n    * It retrieves the top relevant document chunks using Google Gemini embeddings.\\n\\n7.  **Context Preparation:**\\n    * The content from the retrieved document chunks is concatenated (`Concatenate Context`) to form a single context block for the final answer generation.\\n\\n8.  **Answer Generation:**\\n    * The final `Answer` agent (powered by Google Gemini) generates the response.\\n    * It uses:\\n        * The tailored system prompt set in step 5.\\n        * The concatenated context from retrieved documents (step 7).\\n        * The original `user_query`.\\n        * The shared chat history (`Chat Buffer Memory` using `chat_memory_key`).\\n\\n9.  **Response:**\\n    * The generated answer is sent back to the user via the `Respond to Webhook` node.\"},\"typeVersion\":1},{\"id\":\"bec8070f-2ce9-4930-b71e-685a2b21d3f2\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-60,-220],\"parameters\":{\"color\":7,\"width\":320,\"height\":580,\"content\":\"## ⚠️  If using in Chat mode\\n\\nUpdate the `vector_store_id` variable to the corresponding Qdrant ID needed to perform the documents retrieval.\"},\"typeVersion\":1}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"7d56eea8-a262-4add-a4e8-45c2b0c7d1a9\",\"connections\":{\"Chat\":{\"main\":[[{\"node\":\"Combined Fields\",\"type\":\"main\",\"index\":0}]]},\"Answer\":{\"main\":[[{\"node\":\"Respond to Webhook\",\"type\":\"main\",\"index\":0}]]},\"Switch\":{\"main\":[[{\"node\":\"Factual Strategy - Focus on Precision\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Analytical Strategy - Comprehensive Coverage\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Opinion Strategy - Diverse Perspectives\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Contextual Strategy - User Context Integration\",\"type\":\"main\",\"index\":0}]]},\"Embeddings\":{\"ai_embedding\":[[{\"node\":\"Retrieve Documents from Vector Store\",\"type\":\"ai_embedding\",\"index\":0}]]},\"Gemini Answer\":{\"ai_languageModel\":[[{\"node\":\"Answer\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Gemini Factual\":{\"ai_languageModel\":[[{\"node\":\"Factual Strategy - Focus on Precision\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Gemini Opinion\":{\"ai_languageModel\":[[{\"node\":\"Opinion Strategy - Diverse Perspectives\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Combined Fields\":{\"main\":[[{\"node\":\"Query Classification\",\"type\":\"main\",\"index\":0}]]},\"Gemini Analytical\":{\"ai_languageModel\":[[{\"node\":\"Analytical Strategy - Comprehensive Coverage\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Gemini Contextual\":{\"ai_languageModel\":[[{\"node\":\"Contextual Strategy - User Context Integration\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Chat Buffer Memory\":{\"ai_memory\":[[{\"node\":\"Answer\",\"type\":\"ai_memory\",\"index\":0}]]},\"Concatenate Context\":{\"main\":[[{\"node\":\"Answer\",\"type\":\"main\",\"index\":0}]]},\"Query Classification\":{\"main\":[[{\"node\":\"Switch\",\"type\":\"main\",\"index\":0}]]},\"Gemini Classification\":{\"ai_languageModel\":[[{\"node\":\"Query Classification\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Set Prompt and Output\":{\"main\":[[{\"node\":\"Retrieve Documents from Vector Store\",\"type\":\"main\",\"index\":0}]]},\"Factual Prompt and Output\":{\"main\":[[{\"node\":\"Set Prompt and Output\",\"type\":\"main\",\"index\":0}]]},\"Opinion Prompt and Output\":{\"main\":[[{\"node\":\"Set Prompt and Output\",\"type\":\"main\",\"index\":0}]]},\"Chat Buffer Memory Factual\":{\"ai_memory\":[[{\"node\":\"Factual Strategy - Focus on Precision\",\"type\":\"ai_memory\",\"index\":0}]]},\"Chat Buffer Memory Opinion\":{\"ai_memory\":[[{\"node\":\"Opinion Strategy - Diverse Perspectives\",\"type\":\"ai_memory\",\"index\":0}]]},\"Analytical Prompt and Output\":{\"main\":[[{\"node\":\"Set Prompt and Output\",\"type\":\"main\",\"index\":0}]]},\"Contextual Prompt and Output\":{\"main\":[[{\"node\":\"Set Prompt and Output\",\"type\":\"main\",\"index\":0}]]},\"Chat Buffer Memory Analytical\":{\"ai_memory\":[[{\"node\":\"Analytical Strategy - Comprehensive Coverage\",\"type\":\"ai_memory\",\"index\":0}]]},\"Chat Buffer Memory Contextual\":{\"ai_memory\":[[{\"node\":\"Contextual Strategy - User Context Integration\",\"type\":\"ai_memory\",\"index\":0}]]},\"When Executed by Another Workflow\":{\"main\":[[{\"node\":\"Combined Fields\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Documents from Vector Store\":{\"main\":[[{\"node\":\"Concatenate Context\",\"type\":\"main\",\"index\":0}]]},\"Factual Strategy - Focus on Precision\":{\"main\":[[{\"node\":\"Factual Prompt and Output\",\"type\":\"main\",\"index\":0}]]},\"Opinion Strategy - Diverse Perspectives\":{\"main\":[[{\"node\":\"Opinion Prompt and Output\",\"type\":\"main\",\"index\":0}]]},\"Analytical Strategy - Comprehensive Coverage\":{\"main\":[[{\"node\":\"Analytical Prompt and Output\",\"type\":\"main\",\"index\":0}]]},\"Contextual Strategy - User Context Integration\":{\"main\":[[{\"node\":\"Contextual Prompt and Output\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This n8n workflow implements a version of the Adaptive Retrieval-Augmented Generation (RAG) framework. It recognizes that the best way to retrieve information often depends on the type of question asked. Instead of a one-size-fits-all approach, this workflow adapts its strategy based on the user's query intent.\n\n## 🌟 How it Works\n\n  1. **Receive Query:** Takes a user query as input (along with context like a chat session ID and Vector Store collection ID if used as sub-workflow).\n  2. **Classify Query:** First, the workflow classifies the query into a predefined category. This template uses four examples: \n     * **Factual:** For specific facts.\n     * **Analytical:** For deeper explanations or comparisons.\n     * **Opinion:** For subjective viewpoints.\n     * **Contextual:** For questions relying on specific background.\n  3. **Select & Adapt Strategy:** Based on the classification, it selects a corresponding strategy to prepare for information retrieval. The example strategies aim to: \n     * _Factual:_ Refine the query for precision.\n     * _Analytical:_ Break the query into sub-questions for broad coverage.\n     * _Opinion:_ Identify different viewpoints to look for.\n     * _Contextual:_ Incorporate implied or user-specific context.\n  4. **Retrieve Info:** Uses the output of the selected strategy to search the specified knowledge base (Qdrant vector store - change as needed) for relevant documents.\n  5. **Generate Response:** Constructs a response using the retrieved documents, guided by a prompt tailored to the original query type.\n\n\n\nBy adapting the retrieval strategy, this workflow aims to provide more relevant results tailored to the user's intent.\n\n## ⚙️ Usage & Flexibility\n\n  * **Sub-Workflow:** Designed to be called from other n8n workflows, passing `user_query`, `chat_memory_key`, and `vector_store_id` as inputs.\n  * **Chat Testing:** Can also be triggered directly via the n8n Chat interface for easy testing and interaction.\n  * **Customizable Framework:** The query categories (Factual, Analytical, etc.) and the associated retrieval strategies are examples. You can modify or replace them entirely to fit your specific domain or requirements.\n\n\n\n## 🛠️ Requirements\n\n  * **Credentials:** You will need API credentials configured in your n8n instance for: \n    * Google Gemini (AI Models)\n    * Qdrant (Vector Store)\n\n\n",
  "crawled_at": "2025-05-26T04:33:51.421967",
  "readme_zh": "该n8n工作流实现了一种自适应检索增强生成（RAG）框架。它认识到最佳的信息检索方式往往取决于所提问题的类型。不同于一刀切的方法，本工作流会根据用户查询意图动态调整策略。\n\n## 🌟 运作原理\n\n1. **接收查询**：获取用户查询输入（若作为子工作流使用，需同时接收聊天会话ID、向量存储集合ID等上下文参数）\n2. **查询分类**：首先将查询归类至预定义类型。本模板设四种示例类型：\n   * **事实型**：针对具体事实\n   * **分析型**：需要深度解释或对比\n   * **观点型**：涉及主观看法\n   * **情境型**：依赖特定背景的问题\n3. **策略适配**：根据分类选择对应检索策略：\n   * _事实型_：优化查询语句提升精确度\n   * _分析型_：拆解为子问题确保覆盖广度\n   * _观点型_：识别不同立场视角\n   * _情境型_：整合隐含或用户特定上下文\n4. **信息检索**：使用策略输出结果搜索指定知识库（默认Qdrant向量库，可替换）\n5. **生成响应**：基于检索文档，通过适配原始查询类型的提示模板构造回答\n\n通过动态调整检索策略，本工作流旨在提供更符合用户意图的精准结果。\n\n## ⚙️ 使用与扩展\n\n* **子工作流模式**：支持通过`user_query`、`chat_memory_key`和`vector_store_id`参数被其他n8n工作流调用\n* **聊天测试**：可直接通过n8n聊天界面触发，便于测试交互\n* **可定制框架**：现有查询分类（事实型/分析型等）及关联策略均为示例，可根据具体领域需求完全修改\n\n## 🛠️ 环境要求\n\n* **API凭证**：需在n8n实例中配置以下服务的访问凭证：\n  * Google Gemini（AI模型）\n  * Qdrant（向量数据库）",
  "title_zh": "自适应RAG策略：基于查询分类与检索（Gemini与Qdrant）",
  "publish_date_zh": "上次更新于8天前",
  "workflow_json_zh": "{\n  \"id\": \"cpuFyJYHKmjHTncz\",\n  \"meta\": {\n    \"instanceId\": \"2cb7a61f866faf57392b91b31f47e08a2b3640258f0abd08dd71f087f3243a5a\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Adaptive RAG\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"856bd809-8f41-41af-8f72-a3828229c2a5\",\n      \"name\": \"Query Classification\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"notes\": \"Classify a query into one of four categories: Factual, Analytical, Opinion, or Contextual.\\n        \\nReturns:\\nstr: Query category\",\n      \"position\": [\n        380,\n        -20\n      ],\n      \"parameters\": {\n        \"text\": \"=Classify this query: {{ $('Combined Fields').item.json.user_query }}\",\n        \"options\": {\n          \"systemMessage\": \"You are an expert at classifying questions. \\n\\nClassify the given query into exactly one of these categories:\\n- Factual: Queries seeking specific, verifiable information.\\n- Analytical: Queries requiring comprehensive analysis or explanation.\\n- Opinion: Queries about subjective matters or seeking diverse viewpoints.\\n- Contextual: Queries that depend on user-specific context.\\n\\nReturn ONLY the category name, without any explanation or additional text.\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.8\n    },\n    {\n      \"id\": \"cc2106fc-f1a8-45ef-b37b-ab981ac13466\",\n      \"name\": \"Switch\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        740,\n        -40\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"Factual\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"87f3b50c-9f32-4260-ac76-19c05b28d0b4\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.output.trim() }}\",\n                    \"rightValue\": \"Factual\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"Analytical\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"f8651b36-79fa-4be4-91fb-0e6d7deea18f\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.output.trim() }}\",\n                    \"rightValue\": \"Analytical\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"Opinion\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"5dde06bc-5fe1-4dca-b6e2-6857c5e96d49\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.output.trim() }}\",\n                    \"rightValue\": \"Opinion\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"Contextual\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"bf97926d-7a0b-4e2f-aac0-a820f73344d8\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.output.trim() }}\",\n                    \"rightValue\": \"Contextual\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {\n          \"fallbackOutput\": 0\n        }\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"63889cad-1283-4dbf-ba16-2b6cf575f24a\",\n      \"name\": \"Factual Strategy - Focus on Precision\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"notes\": \"Retrieval strategy for factual queries focusing on precision.\",\n      \"position\": [\n        1140,\n        -780\n      ],\n      \"parameters\": {\n        \"text\": \"=Enhance this factual query: {{ $('Combined Fields').item.json.user_query }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are an expert at enhancing search queries.\\n\\nYour task is to reformulate the given factual query to make it more precise and specific for information retrieval. Focus on key entities and their relationships.\\n\\nProvide ONLY the enhanced query without any explanation.\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"020d2201-9590-400d-b496-48c65801271c\",\n      \"name\": \"Analytical Strategy - Comprehensive Coverage\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"notes\": \"Retrieval strategy for analytical queries focusing on comprehensive coverage.\",\n      \"position\": [\n        1140,\n        -240\n      ],\n      \"parameters\": {\n        \"text\": \"=Generate sub-questions for this analytical query: {{ $('Combined Fields').item.json.user_query }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are an expert at breaking down complex questions.\\n\\nGenerate sub-questions that explore different aspects of the main analytical query.\\nThese sub-questions should cover the breadth of the topic and help retrieve comprehensive information.\\n\\nReturn a list of exactly 3 sub-questions, one per line.\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"c35d1b95-68c8-4237-932d-4744f620760d\",\n      \"name\": \"Opinion Strategy - Diverse Perspectives\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"notes\": \"Retrieval strategy for opinion queries focusing on diverse perspectives.\",\n      \"position\": [\n        1140,\n        300\n      ],\n      \"parameters\": {\n        \"text\": \"=Identify different perspectives on: {{ $('Combined Fields').item.json.user_query }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are an expert at identifying different perspectives on a topic.\\n\\nFor the given query about opinions or viewpoints, identify different perspectives that people might have on this topic.\\n\\nReturn a list of exactly 3 different viewpoint angles, one per line.\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"363a3fc3-112f-40df-891e-0a5aa3669245\",\n      \"name\": \"Contextual Strategy - User Context Integration\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"notes\": \"Retrieval strategy for contextual queries integrating user context.\",\n      \"position\": [\n        1140,\n        840\n      ],\n      \"parameters\": {\n        \"text\": \"=Infer the implied context in this query: {{ $('Combined Fields').item.json.user_query }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are an expert at understanding implied context in questions.\\n\\nFor the given query, infer what contextual information might be relevant or implied but not explicitly stated. Focus on what background would help answering this query.\\n\\nReturn a brief description of the implied context.\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"45887701-5ea5-48b4-9b2b-40a80238ab0c\",\n      \"name\": \"Chat\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        -280,\n        120\n      ],\n      \"webhookId\": \"56f626b5-339e-48af-857f-1d4198fc8a4d\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"7f7df364-4829-4e29-be3d-d13a63f65b8f\",\n      \"name\": \"Factual Prompt and Output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1540,\n        -780\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\n              \"name\": \"output\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output }}\"\n            },\n            {\n              \"id\": \"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\n              \"name\": \"prompt\",\n              \"type\": \"string\",\n              \"value\": \"You are a helpful assistant providing factual information. Answer the question based on the provided context. Focus on accuracy and precision. If the context doesn't contain the information needed, acknowledge the limitations.\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"590d8667-69eb-4db2-b5be-714c602b319a\",\n      \"name\": \"Contextual Prompt and Output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1540,\n        840\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\n              \"name\": \"output\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output }}\"\n            },\n            {\n              \"id\": \"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\n              \"name\": \"prompt\",\n              \"type\": \"string\",\n              \"value\": \"You are a helpful assistant providing contextually relevant information. Answer the question considering both the query and its context. Make connections between the query context and the information in the provided documents. If the context doesn't fully address the specific situation, acknowledge the limitations.\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"fa3228ee-62d8-4c02-9dca-8a1ebc6afc74\",\n      \"name\": \"Opinion Prompt and Output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1540,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\n              \"name\": \"output\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output }}\"\n            },\n            {\n              \"id\": \"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\n              \"name\": \"prompt\",\n              \"type\": \"string\",\n              \"value\": \"You are a helpful assistant discussing topics with multiple viewpoints. Based on the provided context, present different perspectives on the topic. Ensure fair representation of diverse opinions without showing bias. Acknowledge where the context presents limited viewpoints.\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c769a76a-fb26-46a1-a00d-825b689d5f7a\",\n      \"name\": \"Analytical Prompt and Output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1540,\n        -240\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a4a28ac2-4a56-46f6-8b86-f5d1a34b2ced\",\n              \"name\": \"output\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output }}\"\n            },\n            {\n              \"id\": \"7aa6ce13-afbf-4871-b81c-6e9c722a53dc\",\n              \"name\": \"prompt\",\n              \"type\": \"string\",\n              \"value\": \"You are a helpful assistant providing analytical insights. Based on the provided context, offer a comprehensive analysis of the topic. Cover different aspects and perspectives in your explanation. If the context has gaps, acknowledge them while providing the best analysis possible.\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"fcd29f6b-17e8-442c-93f9-b93fbad7cd10\",\n      \"name\": \"Gemini Classification\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        360,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash-lite\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"2zwuT5znDglBrUCO\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c0828ee3-f184-41f5-9a25-0f1059b03711\",\n      \"name\": \"Gemini Factual\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        1120,\n        -560\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"2zwuT5znDglBrUCO\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"98f9981d-ea8e-45cb-b91d-3c8d1fe33e25\",\n      \"name\": \"Gemini Analytical\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        1120,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"2zwuT5znDglBrUCO\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c85f270d-3224-4e60-9acf-91f173dfe377\",\n      \"name\": \"Chat Buffer Memory Analytical\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        1280,\n        -20\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Combined Fields').item.json.chat_memory_key }}\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 10\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"c39ba907-7388-4152-965a-e28e626bc9b2\",\n      \"name\": \"Chat Buffer Memory Factual\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        1280,\n        -560\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Combined Fields').item.json.chat_memory_key }}\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 10\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"52dcd9f0-e6b3-4d33-bc6f-621ef880178e\",\n      \"name\": \"Gemini Opinion\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        1120,\n        520\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"2zwuT5znDglBrUCO\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"147a709a-4b46-4835-82cf-7d6b633acd4c\",\n      \"name\": \"Chat Buffer Memory Opinion\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        1280,\n        520\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Combined Fields').item.json.chat_memory_key }}\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 10\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"3cb6bf32-5937-49b9-acf7-d7d01dc2ddd1\",\n      \"name\": \"Gemini Contextual\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        1120,\n        1060\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"2zwuT5znDglBrUCO\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5916c4f1-4369-4d66-8553-2fff006b7e69\",\n      \"name\": \"Chat Buffer Memory Contextual\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        1280,\n        1060\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Combined Fields').item.json.chat_memory_key }}\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 10\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"d33377c2-6b98-4e4d-968f-f3085354ae50\",\n      \"name\": \"Embeddings\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini\",\n      \"position\": [\n        2060,\n        200\n      ],\n      \"parameters\": {\n        \"modelName\": \"models/text-embedding-004\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"2zwuT5znDglBrUCO\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"32d9a0c0-0889-4cb2-a088-8ee9cfecacd3\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1040,\n        -900\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 700,\n        \"height\": 520,\n        \"content\": \"## 事实性策略\\n**检索准确的事实与数据。**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"064a4729-717c-40c8-824a-508406610a13\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1040,\n        -360\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 700,\n        \"height\": 520,\n        \"content\": \"## 分析策略\\n**全面覆盖主题内容并探索不同维度。**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9fd52a28-44bc-4dfd-bdb7-90987cc2f4fb\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1040,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 700,\n        \"height\": 520,\n        \"content\": \"## 观点策略\\n**收集关于主观性议题的多元观点。**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3797b21f-cc2a-4210-aa63-6d181d413c5e\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1040,\n        720\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 700,\n        \"height\": 520,\n        \"content\": \"## 情境化策略  \\n**结合用户特定情境优化检索效果。**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"16fa1531-9fb9-4b12-961c-be12e20b2134\",\n      \"name\": \"Concatenate Context\",\n      \"type\": \"n8n-nodes-base.summarize\",\n      \"position\": [\n        2440,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldsToSummarize\": {\n          \"values\": [\n            {\n              \"field\": \"document.pageContent\",\n              \"separateBy\": \"other\",\n              \"aggregation\": \"concatenate\",\n              \"customSeparator\": \"={{ \\\"\\\\n\\\\n---\\\\n\\\\n\\\" }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"4d6147d1-7a3d-42ab-b23f-cdafe8ea30b0\",\n      \"name\": \"Retrieve Documents from Vector Store\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreQdrant\",\n      \"position\": [\n        2080,\n        -20\n      ],\n      \"parameters\": {\n        \"mode\": \"load\",\n        \"topK\": 10,\n        \"prompt\": \"={{ $json.prompt }}\\n\\nUser query: \\n{{ $json.output }}\",\n        \"options\": {},\n        \"qdrantCollection\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Combined Fields').item.json.vector_store_id }}\"\n        }\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"mb8rw8tmUeP6aPJm\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"7e68f9cb-0a0d-4215-8083-3b9ef92cd237\",\n      \"name\": \"Set Prompt and Output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1880,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"1d782243-0571-4845-b8fe-4c6c4b55379e\",\n              \"name\": \"output\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output }}\"\n            },\n            {\n              \"id\": \"547091fb-367c-44d4-ac39-24d073da70e0\",\n              \"name\": \"prompt\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.prompt }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0c623ca1-da85-48a3-9d8b-90d97283a015\",\n      \"name\": \"Gemini Answer\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        2720,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"2zwuT5znDglBrUCO\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fab91e48-1c62-46a8-b9fc-39704f225274\",\n      \"name\": \"Answer\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        2760,\n        -20\n      ],\n      \"parameters\": {\n        \"text\": \"=User query: {{ $('Combined Fields').item.json.user_query }}\",\n        \"options\": {\n          \"systemMessage\": \"={{ $('Set Prompt and Output').item.json.prompt }}\\n\\nUse the following context (delimited by <ctx></ctx>) and the chat history to answer the user query.\\n<ctx>\\n{{ $json.concatenated_document_pageContent }}\\n</ctx>\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.8\n    },\n    {\n      \"id\": \"d69f8d62-3064-40a8-b490-22772fbc38cd\",\n      \"name\": \"Chat Buffer Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        2900,\n        200\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Combined Fields').item.json.chat_memory_key }}\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 10\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"a399f8e6-fafd-4f73-a2de-894f1e3c4bec\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1800,\n        -220\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 820,\n        \"height\": 580,\n        \"content\": \"## 执行自适应检索\\n**结合查询与上下文查找文档**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7f10fe70-1af8-47ad-a9b5-2850412c43f8\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2640,\n        -220\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 740,\n        \"height\": 580,\n        \"content\": \"## 结合检索上下文回复用户\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5cd0dd02-65f4-4351-aeae-c70ecf5f1d66\",\n      \"name\": \"Respond to Webhook\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        3120,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"4c56ef8f-8fce-4525-bb87-15df37e91cc4\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        280,\n        -220\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 700,\n        \"height\": 580,\n        \"content\": \"## 用户查询分类\\n**将查询归类为以下四种类型之一：事实型、分析型、观点型或情境型。**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3ef73405-89de-4bed-9673-90e2c1f2e74b\",\n      \"name\": \"When Executed by Another Workflow\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        -280,\n        -140\n      ],\n      \"parameters\": {\n        \"workflowInputs\": {\n          \"values\": [\n            {\n              \"name\": \"user_query\"\n            },\n            {\n              \"name\": \"chat_memory_key\"\n            },\n            {\n              \"name\": \"vector_store_id\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"0785714f-c45c-4eda-9937-c97e44c9a449\",\n      \"name\": \"Combined Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        40,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"90ab73a2-fe01-451a-b9df-bffe950b1599\",\n              \"name\": \"user_query\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.user_query || $json.chatInput }}\"\n            },\n            {\n              \"id\": \"36686ff5-09fc-40a4-8335-a5dd1576e941\",\n              \"name\": \"chat_memory_key\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.chat_memory_key || $('Chat').item.json.sessionId }}\"\n            },\n            {\n              \"id\": \"4230c8f3-644c-4985-b710-a4099ccee77c\",\n              \"name\": \"vector_store_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.vector_store_id || \\\"<ID HERE>\\\" }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"57a93b72-4233-4ba2-b8c7-99d88f0ed572\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -300,\n        400\n      ],\n      \"parameters\": {\n        \"width\": 1280,\n        \"height\": 1300,\n        \"content\": \"# 自适应RAG工作流\\n\\n本n8n工作流实现了自适应检索增强生成(RAG)方案。它通过分类用户查询（事实型、分析型、观点型或情境型），应用不同的检索与生成策略，从Qdrant向量数据库的知识库中提供更精准的定制化答案。\\n\\n## 工作原理\\n\\n1. **输入触发：**\\n   * 可通过内置聊天界面或其它n8n工作流触发\\n   * 接收参数：`用户查询`、`聊天记忆键`（会话历史）、`向量存储ID`（指定Qdrant集合）\\n   * 通过`Set`节点（`字段合并`）标准化输入\\n\\n2. **查询分类：**\\n   * Google Gemini智能体（`查询分类器`）分析用户查询\\n   * 将查询归类为以下四种类型之一：\\n     - **事实型**：寻求具体可验证信息\\n     - **分析型**：需要全面分析或解释\\n     - **观点型**：询问主观问题或寻求多元观点\\n     - **情境型**：依赖用户特定或隐含上下文\\n\\n3. **策略路由：**\\n   * `Switch`节点根据分类结果分流工作流\\n\\n4. **策略实施（查询适配）：**\\n   * 各路径由专属Google Gemini智能体调整查询策略：\\n     - **事实型策略**：精确重写查询，聚焦关键实体（`事实策略-精准聚焦`）\\n     - **分析型策略**：将主查询拆解为多个子问题（`分析策略-全面覆盖`）\\n     - **观点型策略**：识别相关多元视角（`观点策略-多维视角`）\\n     - **情境型策略**：推断回答所需的隐含上下文（`情境策略-用户情境整合`）\\n   * 各策略路径使用独立的聊天记忆缓冲区\\n\\n5. **检索提示与输出配置：**\\n   * 根据原始查询分类，`Set`节点（通过`设置提示与输出`合并）准备：\\n     - 策略阶段的输出（如重写查询/子问题/视角）\\n     - 为最终生成智能体定制的系统提示，指导其按查询类型生成回答（如事实型需精准，观点型需多元）\\n\\n6. **文档检索（RAG）：**\\n   * `从向量库检索文档`节点使用策略阶段的适配输出，搜索指定Qdrant集合（`vector_store_id`）\\n   * 通过Google Gemini嵌入向量获取最相关的文档片段\\n\\n7. **上下文准备：**\\n   * 将检索到的文档内容拼接（`上下文拼接`）形成统一上下文块\\n\\n8. **答案生成：**\\n   * 最终`回答`智能体（基于Google Gemini）生成响应，使用：\\n     - 第5步设置的系统提示\\n     - 第7步拼接的检索上下文\\n     - 原始用户查询\\n     - 共享的聊天历史（使用`chat_memory_key`的`聊天缓冲记忆`）\\n\\n9. **响应返回：**\\n   * 通过`响应Webhook`节点将生成答案返回用户\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bec8070f-2ce9-4930-b71e-685a2b21d3f2\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -60,\n        -220\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 320,\n        \"height\": 580,\n        \"content\": \"## ⚠️  如果在聊天模式下使用\\n\\n请将 `vector_store_id` 变量更新为执行文档检索所需的对应 Qdrant ID。\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"7d56eea8-a262-4add-a4e8-45c2b0c7d1a9\",\n  \"connections\": {\n    \"Chat\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combined Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Answer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Respond to Webhook\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Factual Strategy - Focus on Precision\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Analytical Strategy - Comprehensive Coverage\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Opinion Strategy - Diverse Perspectives\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Contextual Strategy - User Context Integration\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Retrieve Documents from Vector Store\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gemini Answer\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Answer\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gemini Factual\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Factual Strategy - Focus on Precision\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gemini Opinion\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Opinion Strategy - Diverse Perspectives\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Combined Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Query Classification\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gemini Analytical\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Analytical Strategy - Comprehensive Coverage\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gemini Contextual\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Contextual Strategy - User Context Integration\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Buffer Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Answer\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Concatenate Context\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Answer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query Classification\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gemini Classification\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Query Classification\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Prompt and Output\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Documents from Vector Store\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Factual Prompt and Output\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Opinion Prompt and Output\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Buffer Memory Factual\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Factual Strategy - Focus on Precision\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Buffer Memory Opinion\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Opinion Strategy - Diverse Perspectives\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Analytical Prompt and Output\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Contextual Prompt and Output\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Buffer Memory Analytical\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Analytical Strategy - Comprehensive Coverage\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Buffer Memory Contextual\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Contextual Strategy - User Context Integration\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When Executed by Another Workflow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combined Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Documents from Vector Store\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Concatenate Context\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Factual Strategy - Focus on Precision\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Factual Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Opinion Strategy - Diverse Perspectives\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Opinion Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Analytical Strategy - Comprehensive Coverage\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Analytical Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Contextual Strategy - User Context Integration\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Contextual Prompt and Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
{
  "url": "https://n8n.io/workflows/3937-send-personalized-whatsapp-templates-triggered-by-klicktipp-with-auto-responses/",
  "title": "Send Personalized WhatsApp Templates Triggered by KlickTipp with Auto-Responses",
  "author": "KlickTipp",
  "publish_date": "Last update 17 days ago",
  "publish_date_absolute": "2025-05-09",
  "categories": [
    {
      "name": "Support"
    },
    {
      "name": "AI"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"95b3ab5a70ab1c8c1906357a367f1b236ef12a1409406fd992f60255f0f95f85\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"aec24e02-fc90-482f-98b0-ba1fe8e069ef\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[140,-240],\"parameters\":{\"color\":4,\"width\":380,\"height\":880,\"content\":\"## Data reception via Webhook call or message\"},\"typeVersion\":1},{\"id\":\"16d48a81-06cf-4c58-8769-8e8fd90ed735\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[540,40],\"parameters\":{\"color\":5,\"width\":380,\"height\":600,\"content\":\"## Data filtering and message check\"},\"typeVersion\":1},{\"id\":\"b137f46c-2e00-42be-a708-b6d9e803cde7\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[940,-240],\"parameters\":{\"width\":380,\"height\":560,\"content\":\"## Sending WhatsApp message templates\"},\"typeVersion\":1},{\"id\":\"661df01d-7f5c-429f-a1ea-c29278e76f29\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[940,340],\"parameters\":{\"color\":3,\"width\":380,\"height\":300,\"content\":\"## Contact subscription and tagging\"},\"typeVersion\":1},{\"id\":\"b44aba0c-1ecc-44f2-bd6c-66e903a0b5e7\",\"name\":\"New message in WhatsApp\",\"type\":\"n8n-nodes-base.whatsAppTrigger\",\"notes\":\"Listens for incoming WhatsApp messages. This serves as the entry point of the workflow, capturing the message content and sender details for routing decisions.\",\"position\":[320,140],\"webhookId\":\"e2861f19-0da7-4320-878c-6ec0e138a7d4\",\"parameters\":{\"options\":{},\"updates\":[\"messages\"]},\"credentials\":{\"whatsAppTriggerApi\":{\"id\":\"hGrWILflNJ7mqZq6\",\"name\":\"Ricardo'S WhatsApp OAuth account\"}},\"notesInFlow\":true,\"typeVersion\":1},{\"id\":\"018da945-7aca-45ca-a1dc-a25d6ed1eeb7\",\"name\":\"Cancellation check\",\"type\":\"n8n-nodes-base.switch\",\"notes\":\"Evaluates incoming WhatsApp message content to determine if it begins with the keyword 'STOP' (ignoring whitespace and case). This allows routing messages either towards support or subscription logic.\",\"position\":[780,140],\"parameters\":{\"rules\":{\"values\":[{\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"fb517cd9-362b-4ea2-b9c0-7aaad80255b4\",\"operator\":{\"type\":\"string\",\"operation\":\"notStartsWith\"},\"leftValue\":\"={{ \\n// Normalize the message content to lowercase and remove all spaces\\n$json.messages[0].text.body.toLowerCase().replace(/\\\\s+/g, '') }}\",\"rightValue\":\"stop\"}]}},{\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"55d55779-eb4d-4562-a462-8dbcfc85852d\",\"operator\":{\"type\":\"string\",\"operation\":\"startsWith\"},\"leftValue\":\"={{ \\n// Normalize the message content to lowercase and remove all spaces\\n$json.messages[0].text.body.toLowerCase().replace(/\\\\s+/g, '') }}\",\"rightValue\":\"stop\"}]}}]},\"options\":{}},\"notesInFlow\":true,\"typeVersion\":3.2},{\"id\":\"7d13f787-95f7-4c13-8674-ef20c82e6fa1\",\"name\":\"KlickTipp Outbound triggered\",\"type\":\"CUSTOM.klicktippTrigger\",\"notes\":\"Triggers this workflow when a relevant event occurs in KlickTipp. Used to initiate notifications via WhatsApp message templates when subscriber data changes or a specific event is captured.\",\"position\":[320,-140],\"webhookId\":\"ede76771-57d8-440e-8daf-73cc4c27b7cb\",\"parameters\":{},\"credentials\":{\"klickTippApi\":{\"id\":\"K9JyBdCM4SZc1cXl\",\"name\":\"DEMO KlickTipp account\"}},\"notesInFlow\":true,\"typeVersion\":1},{\"id\":\"964324f7-a818-46e6-b51f-181837479172\",\"name\":\"Sending WhatsApp offer template\",\"type\":\"n8n-nodes-base.whatsApp\",\"notes\":\"Sends a WhatsApp message template when the KlickTipp trigger is activated. This is typically used to confirm an action, notify about updates, or alert based on subscriber activity.\",\"position\":[1060,-140],\"webhookId\":\"fd384a0a-0356-490c-bc7c-9be38ef7754f\",\"parameters\":{\"template\":\"offer_for_manual|de\",\"components\":{\"component\":[{\"bodyParameters\":{\"parameter\":[{\"text\":\"={{ $json.CustomFieldFirstName }}\"},{\"text\":\"={{ $json.CustomField217373 }}\"},{\"text\":\"={{ $json.CustomField217511 }}\"}]}},{\"type\":\"button\",\"sub_type\":\"url\",\"buttonParameters\":{\"parameter\":{\"text\":\"={{ $json.CustomField218042 }}\",\"type\":\"text\"}}}]},\"phoneNumberId\":\"114317595015150\",\"recipientPhoneNumber\":\"={{ //Formats phone numbers by replacing the international dialing prefix eg. (0049) with the plus format (+49)\\n$json.PhoneNumber.replace(/^00/, '+') }}\"},\"credentials\":{\"whatsAppApi\":{\"id\":\"HqfpRQa1HyDz8IQI\",\"name\":\"Ricardo's WhatsApp account\"}},\"notesInFlow\":true,\"typeVersion\":1},{\"id\":\"629c4059-c03e-4b66-841e-674f03519a3f\",\"name\":\"Sending WhatsApp auto-responder template\",\"type\":\"n8n-nodes-base.whatsApp\",\"notes\":\"Sends a WhatsApp template message to the sender when their message begins with 'STOP', signaling intent to reach support. Personalizes the message using the sender’s name.\",\"position\":[1060,140],\"webhookId\":\"632b8645-0d1c-479c-875b-b04e01dcff34\",\"parameters\":{\"template\":\"auto_forward_to_support|de\",\"components\":{\"component\":[{\"bodyParameters\":{\"parameter\":[{\"text\":\"={{ \\n// Insert the profile name of the contact to personalize the message\\n$json.contacts[0].profile.name }}\"}]}}]},\"phoneNumberId\":\"114317595015150\",\"recipientPhoneNumber\":\"={{ \\n// Extract the phone number of the sender from the message\\n$json.messages[0].from }}\"},\"credentials\":{\"whatsAppApi\":{\"id\":\"HqfpRQa1HyDz8IQI\",\"name\":\"Ricardo's WhatsApp account\"}},\"notesInFlow\":true,\"typeVersion\":1},{\"id\":\"a5142a5b-d0cc-4965-8462-588477641d3f\",\"name\":\"Subscribe number to opt-out from WA messages\",\"type\":\"CUSTOM.klicktipp\",\"notes\":\"Subscribes the WhatsApp sender to the KlickTipp list using their phone number. Formats the number with a '+' prefix for compatibility with KlickTipp.\",\"position\":[1060,460],\"parameters\":{\"listId\":\"358895\",\"resource\":\"subscriber\",\"operation\":\"subscribe\",\"smsNumber\":\"={{\\n// Add a \\\"+\\\" prefix to the WhatsApp ID to align with expected format in KlickTipp\\n'+' + $json.contacts[0].wa_id }}\"},\"credentials\":{\"klickTippApi\":{\"id\":\"K9JyBdCM4SZc1cXl\",\"name\":\"DEMO KlickTipp account\"}},\"notesInFlow\":true,\"typeVersion\":2},{\"id\":\"3593831c-4c99-441b-9424-c59440feba3b\",\"name\":\"Filter user messages\",\"type\":\"n8n-nodes-base.filter\",\"notes\":\"This node filters out the messages that come from users responding to automated messages. Otherwise automated messages would trigger the flow.\",\"position\":[580,140],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"c3399312-f3df-4a89-9ce4-3e7773b025fb\",\"operator\":{\"type\":\"object\",\"operation\":\"exists\",\"singleValue\":true},\"leftValue\":\"={{ $json.messages[0] }}\",\"rightValue\":\"\"}]}},\"notesInFlow\":true,\"typeVersion\":2.2},{\"id\":\"96d54af1-44c1-48c0-9bf3-269e2d084a5c\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[240,660],\"parameters\":{\"color\":7,\"width\":988,\"height\":1109,\"content\":\"### Introduction\\nThis workflow enables the automated delivery of personalized WhatsApp messages via WhatsApp Business Cloud triggered by KlickTipp and processes the user's responses to control campaigns in KlickTipp. The setup is ideal for use cases like birthday greetings, coupon codes, or product-specific campaigns using pre-approved WhatsApp templates.\\n\\n### Benefits\\n- **Multi-channel automation**: Enrich your email campaigns with WhatsApp messages, ensuring higher open and engagement rates.\\n- **Personalized outreach**: Templates can dynamically insert contact-specific info such as name, product, or promo link.\\n- **Full integration**: Connect KlickTipp and WhatsApp through n8n for seamless, event-driven messaging.\\n\\n### Key Feature\\n- **KlickTipp Trigger**: Starts the workflow when a contact is tagged via Outbound.\\n- **WhatsApp Template Messaging and response processing**:\\n  - Uses pre-approved WhatsApp Message Templates (required for messages outside of a 24h session).\\n  - Fills dynamic placeholders with data from KlickTipp custom fields such as:\\n    - First name\\n    - Product name\\n    - Discount link\\n    - Sender name\\n  - Supports CTAs like \\\"Redeem Now\\\" with dynamic URLs - you can control the ending of the base URL.\\n  - Listens to the contacts responses and either answers with an auto responder or tags the contact in KlickTipp\\n\\n#### Setup Instructions\\n1. Set up the KlickTipp and WhatsApp Business nodes in your n8n instance.\\n2. Authenticate your KlickTipp and Whatsapp accounts.\\n3. Create the necessary custom fields to match the data structure\\n4. Verify and customize field assignments in the workflow to align with your specific form and subscriber list setup.\\n\\nCustom Fields:\\n   - `Whatsapp_Produkt/Dienstleistung` (Zeile)  \\n   - `Whatsapp_Name/Unternehmen` (Zeile)  \\n   - `Whatsapp_Link_Endung` (Zeile)\\n\\n### Testing and Deployment:\\n1. Test the workflow by triggering the activation Tag of your Outbound in KlickTipp or by sending a response to the offer template message. Fill the custom fields with all the necessary data beforehand.\\n2. Verify the reception of the message template from WhatsApp and or the subscription and tagging in KlickTipp.\\n\\n> ⚠️ *Cooldown Warning*: Repeated tests via Outbound trigger may require a 6-hour wait unless routed through a campaign, which bypasses the cooldown.\\n\\n- **Customization**: Adjust templates per product or audience segment. Use custom domain endings to redirect to different product pages. Segment users by WhatsApp availability (e.g. fallback to email for non-WA users).\\n\\n### Campaign Expansion Ideas\\n- Combine with KlickTipp email series (e.g. welcome mail + WA message).\\n- Add product-based segmentation tags (e.g. `product_X_interest`).\\n- Analyze click rates from WhatsApp CTAs and experiment with A/B message variants.\\n\\n\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Cancellation check\":{\"main\":[[{\"node\":\"Sending WhatsApp auto-responder template\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Subscribe number to opt-out from WA messages\",\"type\":\"main\",\"index\":0}]]},\"Filter user messages\":{\"main\":[[{\"node\":\"Cancellation check\",\"type\":\"main\",\"index\":0}]]},\"New message in WhatsApp\":{\"main\":[[{\"node\":\"Filter user messages\",\"type\":\"main\",\"index\":0}]]},\"KlickTipp Outbound triggered\":{\"main\":[[{\"node\":\"Sending WhatsApp offer template\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "![Ricardo Automated WhatsApp Campaigns via KlickTipp  TEMPLATE.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/Ricardo_Automated_Whats_App_Campaigns_via_Klick_Tipp_TEMPLATE_202136439b.png)\n\n**Community Node Disclaimer:** As this workflow relies on a community node, it is limited to self-hosted environments.\n\n#### How It Works\n\nThis workflow automates personalized WhatsApp message template delivery triggered by events in KlickTipp or by messages sent to the Whatsapp Business account. When a contact triggers an Outbound, the workflow uses a pre-approved WhatsApp message template to send dynamic, real-time messages through the WhatsApp Business Cloud API. When receiving messages it checks whether a cancellation should be processed or if a auto-response is sent.\n\nThis setup is ideal for time-sensitive campaigns such as:\n\n  * Birthday greetings\n  * Discount or promo notifications\n  * Follow-ups on product or service interest\n\n\n\n#### Key Features\n\n**KlickTipp Trigger**\n\n  * Starts the workflow when a specific outbound is triggered\n  * Typical use case: subcriber receives activation Tag and triggers an Outbound which sends a webhook call to trigger WhatsApp messaging.\n\n\n\n**WhatsApp Business Cloud - Message Trigger**\n\n  * Listens to messages from the contact and processes answers with answering auto-responder or by tagging the contact in KlickTipp.\n\n\n\n**WhatsApp Business Cloud - Sending Template Messages**\n\n  * Sends WhatsApp message templates using a pre-approved template.\n  * Template placeholders are filled with data from KlickTipp custom fields.\n\n\n\n#### Setup Instructions\n\n  1. Set up the KlickTipp and Whatsapp nodes in your n8n instance.\n  2. Authenticate your WhatsApp and KlickTipp accounts.\n  3. Create the necessary custom fields to match the data structure\n  4. Verify and customize field assignments in the workflow to align with your specific form and subscriber list setup.\n\nField Label | Field Type  \n---|---  \nWhatsapp_Produkt/Dienstleistung | Single line  \nWhatsapp_Name/Unternehmen | Single line  \nWhatsapp_Link_Endung | Single line  \n  \n* * *\n\n#### Testing & Deployment\n\n  1. Use a real test contact with all required fields filled.\n  2. Trigger the Outbound in KlickTipp using the activation tag and answer with a message to the template.\n  3. Run the scenario once in n8n to verify successful delivery of the whatsapp message template to your test contact as well as the reception of the auto-responder and the subscription and tagging in KlickTipp to stop further messages.\n\n\n\n* * *\n\n#### Campaign Expansion Ideas\n\n  * Connect campaign to process keywords like \"STOP\" from WhatsApp messages\n  * Pair WhatsApp with welcome email series for onboarding.\n  * Use tags like `product_interest_X` for precise segmentation.\n  * A/B test templates with different CTA formats or timings.\n  * Monitor CTRs via dynamic URLs in WhatsApp templates.\n\n\n\n#### Benefits\n\n  * **Multi-channel engagement:** Adds WhatsApp to your marketing toolkit.\n  * **Dynamic content:** Personalizes messages using contact data.  \n-**KlickTipp campaign control** Whatsapp contacts can for example signal with messages like \"STOP\" to receive the according Tag in KlickTipp in order to start/end automations.\n\n\n\n> 💡 **Pro Tip:** Customize the domain link ending per campaign or product line. This allows targeted redirects, e.g., `meinshop.de/ProduktA` or `mein\n",
  "crawled_at": "2025-05-26T06:03:21.893730",
  "readme_zh": "![Ricardo 通过KlickTipp实现的自动化WhatsApp营销活动模板.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/Ricardo_Automated_Whats_App_Campaigns_via_Klick_Tipp_TEMPLATE_202136439b.png)\n\n**社区节点声明：** 由于此工作流依赖社区节点，仅限自托管环境使用。\n\n#### 运作原理\n\n本工作流通过KlickTipp事件或WhatsApp商业账户接收的消息触发，自动发送个性化WhatsApp模板消息。当联系人触发外发事件时，工作流会使用预先审核通过的WhatsApp消息模板，通过WhatsApp商业云API发送动态实时消息。接收消息时，系统会判断是否处理退订请求或发送自动回复。\n\n此配置特别适合时效性强的场景，例如：\n  * 生日祝福\n  * 折扣促销通知\n  * 产品/服务兴趣跟进\n\n#### 核心功能\n\n**KlickTipp触发器**\n  * 特定外发事件触发工作流\n  * 典型场景：订阅者获得激活标签后触发外发事件，通过webhook调用启动WhatsApp消息推送\n\n**WhatsApp商业云 - 消息触发器**\n  * 监听联系人消息，通过自动应答器处理回复或为联系人添加KlickTipp标签\n\n**WhatsApp商业云 - 模板消息发送**\n  * 使用预审模板发送WhatsApp消息\n  * 模板占位符自动填充KlickTipp自定义字段数据\n\n#### 配置指南\n\n1. 在n8n实例中配置KlickTipp和WhatsApp节点  \n2. 验证WhatsApp和KlickTipp账户  \n3. 创建匹配数据结构的自定义字段  \n4. 检查并调整工作流字段映射，确保与您的订阅列表设置一致  \n\n字段标签 | 字段类型  \n---|---  \nWhatsapp_产品/服务 | 单行文本  \nWhatsapp_姓名/公司 | 单行文本  \nWhatsapp_链接后缀 | 单行文本  \n\n* * *\n\n#### 测试与部署\n\n1. 使用已填写所有必填字段的真实测试联系人  \n2. 在KlickTipp用激活标签触发外发事件，并回复模板消息  \n3. 在n8n运行测试场景，验证：  \n   - WhatsApp模板消息成功送达  \n   - 自动回复接收正常  \n   - KlickTipp订阅与标签设置生效以停止后续消息  \n\n* * *\n\n#### 营销扩展方案\n\n  * 对接关键词处理流程（如WhatsApp消息中的\"STOP\"）  \n  * 结合欢迎邮件系列实现全渠道 onboarding  \n  * 使用`product_interest_X`等标签实现精准分群  \n  * 对不同CTA形式或发送时间的模板进行A/B测试  \n  * 通过动态URL追踪模板点击率  \n\n#### 核心优势\n\n  * **多渠道互动：** 将WhatsApp纳入营销矩阵  \n  * **动态内容：** 基于联系人数据的个性化消息  \n  * **KlickTipp流程控制：** 例如当联系人发送\"STOP\"时自动添加标签，用于启停自动化流程  \n\n> 💡 **专业建议：** 按营销活动或产品线定制链接后缀（如`meinshop.de/产品A`），实现精准跳转跟踪",
  "title_zh": "通过KlickTipp触发发送个性化WhatsApp模板并自动回复",
  "publish_date_zh": "上次更新于5天前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"95b3ab5a70ab1c8c1906357a367f1b236ef12a1409406fd992f60255f0f95f85\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"aec24e02-fc90-482f-98b0-ba1fe8e069ef\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        140,\n        -240\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 380,\n        \"height\": 880,\n        \"content\": \"## 通过Webhook调用或消息接收数据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"16d48a81-06cf-4c58-8769-8e8fd90ed735\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        540,\n        40\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 380,\n        \"height\": 600,\n        \"content\": \"## 数据过滤与消息检查\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b137f46c-2e00-42be-a708-b6d9e803cde7\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        940,\n        -240\n      ],\n      \"parameters\": {\n        \"width\": 380,\n        \"height\": 560,\n        \"content\": \"## 发送WhatsApp消息模板\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"661df01d-7f5c-429f-a1ea-c29278e76f29\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        940,\n        340\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 380,\n        \"height\": 300,\n        \"content\": \"## 联系人订阅与标记\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b44aba0c-1ecc-44f2-bd6c-66e903a0b5e7\",\n      \"name\": \"New message in WhatsApp\",\n      \"type\": \"n8n-nodes-base.whatsAppTrigger\",\n      \"notes\": \"Listens for incoming WhatsApp messages. This serves as the entry point of the workflow, capturing the message content and sender details for routing decisions.\",\n      \"position\": [\n        320,\n        140\n      ],\n      \"webhookId\": \"e2861f19-0da7-4320-878c-6ec0e138a7d4\",\n      \"parameters\": {\n        \"options\": {},\n        \"updates\": [\n          \"messages\"\n        ]\n      },\n      \"credentials\": {\n        \"whatsAppTriggerApi\": {\n          \"id\": \"hGrWILflNJ7mqZq6\",\n          \"name\": \"Ricardo'S WhatsApp OAuth account\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"018da945-7aca-45ca-a1dc-a25d6ed1eeb7\",\n      \"name\": \"Cancellation check\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"notes\": \"Evaluates incoming WhatsApp message content to determine if it begins with the keyword 'STOP' (ignoring whitespace and case). This allows routing messages either towards support or subscription logic.\",\n      \"position\": [\n        780,\n        140\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"fb517cd9-362b-4ea2-b9c0-7aaad80255b4\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"notStartsWith\"\n                    },\n                    \"leftValue\": \"={{ \\n// Normalize the message content to lowercase and remove all spaces\\n$json.messages[0].text.body.toLowerCase().replace(/\\\\s+/g, '') }}\",\n                    \"rightValue\": \"stop\"\n                  }\n                ]\n              }\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"55d55779-eb4d-4562-a462-8dbcfc85852d\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"startsWith\"\n                    },\n                    \"leftValue\": \"={{ \\n// Normalize the message content to lowercase and remove all spaces\\n$json.messages[0].text.body.toLowerCase().replace(/\\\\s+/g, '') }}\",\n                    \"rightValue\": \"stop\"\n                  }\n                ]\n              }\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"7d13f787-95f7-4c13-8674-ef20c82e6fa1\",\n      \"name\": \"KlickTipp Outbound triggered\",\n      \"type\": \"CUSTOM.klicktippTrigger\",\n      \"notes\": \"Triggers this workflow when a relevant event occurs in KlickTipp. Used to initiate notifications via WhatsApp message templates when subscriber data changes or a specific event is captured.\",\n      \"position\": [\n        320,\n        -140\n      ],\n      \"webhookId\": \"ede76771-57d8-440e-8daf-73cc4c27b7cb\",\n      \"parameters\": {},\n      \"credentials\": {\n        \"klickTippApi\": {\n          \"id\": \"K9JyBdCM4SZc1cXl\",\n          \"name\": \"DEMO KlickTipp account\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"964324f7-a818-46e6-b51f-181837479172\",\n      \"name\": \"Sending WhatsApp offer template\",\n      \"type\": \"n8n-nodes-base.whatsApp\",\n      \"notes\": \"Sends a WhatsApp message template when the KlickTipp trigger is activated. This is typically used to confirm an action, notify about updates, or alert based on subscriber activity.\",\n      \"position\": [\n        1060,\n        -140\n      ],\n      \"webhookId\": \"fd384a0a-0356-490c-bc7c-9be38ef7754f\",\n      \"parameters\": {\n        \"template\": \"offer_for_manual|de\",\n        \"components\": {\n          \"component\": [\n            {\n              \"bodyParameters\": {\n                \"parameter\": [\n                  {\n                    \"text\": \"={{ $json.CustomFieldFirstName }}\"\n                  },\n                  {\n                    \"text\": \"={{ $json.CustomField217373 }}\"\n                  },\n                  {\n                    \"text\": \"={{ $json.CustomField217511 }}\"\n                  }\n                ]\n              }\n            },\n            {\n              \"type\": \"button\",\n              \"sub_type\": \"url\",\n              \"buttonParameters\": {\n                \"parameter\": {\n                  \"text\": \"={{ $json.CustomField218042 }}\",\n                  \"type\": \"text\"\n                }\n              }\n            }\n          ]\n        },\n        \"phoneNumberId\": \"114317595015150\",\n        \"recipientPhoneNumber\": \"={{ //Formats phone numbers by replacing the international dialing prefix eg. (0049) with the plus format (+49)\\n$json.PhoneNumber.replace(/^00/, '+') }}\"\n      },\n      \"credentials\": {\n        \"whatsAppApi\": {\n          \"id\": \"HqfpRQa1HyDz8IQI\",\n          \"name\": \"Ricardo's WhatsApp account\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"629c4059-c03e-4b66-841e-674f03519a3f\",\n      \"name\": \"Sending WhatsApp auto-responder template\",\n      \"type\": \"n8n-nodes-base.whatsApp\",\n      \"notes\": \"Sends a WhatsApp template message to the sender when their message begins with 'STOP', signaling intent to reach support. Personalizes the message using the sender’s name.\",\n      \"position\": [\n        1060,\n        140\n      ],\n      \"webhookId\": \"632b8645-0d1c-479c-875b-b04e01dcff34\",\n      \"parameters\": {\n        \"template\": \"auto_forward_to_support|de\",\n        \"components\": {\n          \"component\": [\n            {\n              \"bodyParameters\": {\n                \"parameter\": [\n                  {\n                    \"text\": \"={{ \\n// Insert the profile name of the contact to personalize the message\\n$json.contacts[0].profile.name }}\"\n                  }\n                ]\n              }\n            }\n          ]\n        },\n        \"phoneNumberId\": \"114317595015150\",\n        \"recipientPhoneNumber\": \"={{ \\n// Extract the phone number of the sender from the message\\n$json.messages[0].from }}\"\n      },\n      \"credentials\": {\n        \"whatsAppApi\": {\n          \"id\": \"HqfpRQa1HyDz8IQI\",\n          \"name\": \"Ricardo's WhatsApp account\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a5142a5b-d0cc-4965-8462-588477641d3f\",\n      \"name\": \"Subscribe number to opt-out from WA messages\",\n      \"type\": \"CUSTOM.klicktipp\",\n      \"notes\": \"Subscribes the WhatsApp sender to the KlickTipp list using their phone number. Formats the number with a '+' prefix for compatibility with KlickTipp.\",\n      \"position\": [\n        1060,\n        460\n      ],\n      \"parameters\": {\n        \"listId\": \"358895\",\n        \"resource\": \"subscriber\",\n        \"operation\": \"subscribe\",\n        \"smsNumber\": \"={{\\n// Add a \\\"+\\\" prefix to the WhatsApp ID to align with expected format in KlickTipp\\n'+' + $json.contacts[0].wa_id }}\"\n      },\n      \"credentials\": {\n        \"klickTippApi\": {\n          \"id\": \"K9JyBdCM4SZc1cXl\",\n          \"name\": \"DEMO KlickTipp account\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"3593831c-4c99-441b-9424-c59440feba3b\",\n      \"name\": \"Filter user messages\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"notes\": \"This node filters out the messages that come from users responding to automated messages. Otherwise automated messages would trigger the flow.\",\n      \"position\": [\n        580,\n        140\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"c3399312-f3df-4a89-9ce4-3e7773b025fb\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.messages[0] }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"96d54af1-44c1-48c0-9bf3-269e2d084a5c\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        240,\n        660\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 988,\n        \"height\": 1109,\n        \"content\": \"### 简介  \\n本工作流支持通过KlickTipp触发WhatsApp商业云API自动发送个性化消息，并处理用户回复以控制KlickTipp中的营销活动。该方案特别适用于生日祝福、优惠券发放、产品定向营销等需使用预审WhatsApp模板的场景。\\n\\n### 核心优势  \\n- **全渠道自动化**：将WhatsApp消息与电子邮件营销结合，显著提升打开率与互动率  \\n- **深度个性化**：模板支持动态插入联系人专属信息（如姓名、产品名称、促销链接）  \\n- **无缝集成**：通过n8n实现KlickTipp与WhatsApp的事件驱动型通信  \\n\\n### 核心功能  \\n- **KlickTipp触发器**：当联系人被Outbound功能标记时启动流程  \\n- **WhatsApp模板消息与响应处理**：  \\n  - 采用预审通过的WhatsApp消息模板（24小时会话外消息必需）  \\n  - 动态填充KlickTipp自定义字段数据，包括：  \\n    - 收件人名  \\n    - 产品名称  \\n    - 折扣链接  \\n    - 发件人署名  \\n  - 支持\\\"立即兑换\\\"等动态链接行动号召（可自定义基础链接后缀）  \\n  - 实时监听用户回复，自动响应或为联系人添加KlickTipp标签  \\n\\n#### 配置指南  \\n1. 在n8n实例中配置KlickTipp和WhatsApp商业版节点  \\n2. 完成KlickTipp与WhatsApp账户授权  \\n3. 创建匹配数据结构的自定义字段：  \\n   - `Whatsapp_Produkt/Dienstleistung`（文本行）  \\n   - `Whatsapp_Name/Unternehmen`（文本行）  \\n   - `Whatsapp_Link_Endung`（文本行）  \\n4. 校验并调整工作流字段映射，确保与您的订阅列表结构匹配  \\n\\n### 测试与部署  \\n1. 测试方式：  \\n   - 在KlickTipp中触发Outbound激活标签  \\n   - 或向模板消息发送回复（测试前需填充所有自定义字段数据）  \\n2. 验证项：  \\n   - WhatsApp模板消息接收情况  \\n   - KlickTipp中的订阅状态及标签更新  \\n\\n> ⚠️ *冷却期提示*：通过Outbound重复测试需间隔6小时，经营销活动触发的测试不受此限制  \\n\\n- **定制化建议**：  \\n  - 按产品或受众细分调整模板  \\n  - 通过自定义链接后缀跳转不同产品页  \\n  - 为非WhatsApp用户设置邮件备用方案  \\n\\n### 营销扩展思路  \\n- 与KlickTipp邮件序列组合（如欢迎邮件+WA消息）  \\n- 添加基于产品的兴趣标签（如`product_X_interest`）  \\n- 分析WhatsApp行动号召点击率，进行A/B版消息测试\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Cancellation check\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Sending WhatsApp auto-responder template\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Subscribe number to opt-out from WA messages\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter user messages\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Cancellation check\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"New message in WhatsApp\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter user messages\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"KlickTipp Outbound triggered\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Sending WhatsApp offer template\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
{
  "url": "https://n8n.io/workflows/4105-generate-invoices-save-to-drive-and-send-email-to-customer-with-js-g-sheets/",
  "title": "Generate Invoices, Save to Drive and Send Email to Customer with JS + G Sheets",
  "author": "Joseph",
  "publish_date": "Last update 9 days ago",
  "publish_date_absolute": "2025-05-17",
  "categories": [
    {
      "name": "Finance"
    },
    {
      "name": "AI"
    },
    {
      "name": "IT Ops"
    }
  ],
  "workflow_json": "{\"id\":\"K4XpJbwBJYnDiYkF\",\"meta\":{\"instanceId\":\"b3c467df4053d13fe31cc98f3c66fa1d16300ba750506bfd019a0913cec71ea3\",\"templateCredsSetupCompleted\":true},\"name\":\"Generate Invoices\",\"tags\":[],\"nodes\":[{\"id\":\"e56cbf88-1e0d-4dd7-a269-091ad2ce8420\",\"name\":\"Webhook Simulator\",\"type\":\"n8n-nodes-base.webhook\",\"position\":[-240,20],\"webhookId\":\"7f884a07-861e-49da-bb0e-1ac6ca40ea00\",\"parameters\":{\"path\":\"7f884a07-861e-49da-bb0e-1ac6ca40ea00\",\"options\":{}},\"typeVersion\":2},{\"id\":\"b01307f7-b5cb-421e-833a-0889925bb09c\",\"name\":\"Generate Invoice ID\",\"type\":\"n8n-nodes-base.code\",\"position\":[-20,20],\"parameters\":{\"jsCode\":\"function generateOrderID(length = 6) {\\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\\n  let result = 'INV-';\\n  for (let i = 0; i < length; i++) {\\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\\n  }\\n  return result;\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      order_id: generateOrderID()\\n    }\\n  }\\n];\\n\"},\"typeVersion\":2},{\"id\":\"bf50ca10-4021-4e6f-9c08-56fd84ce13ed\",\"name\":\"Check if ID Already Exists\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[200,20],\"parameters\":{\"options\":{},\"filtersUI\":{\"values\":[{\"lookupValue\":\"={{ $json.order_id }}\",\"lookupColumn\":\"Invoice ID\"}]},\"sheetName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gid=0\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit#gid=0\",\"cachedResultName\":\"Invoices\"},\"documentId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit?usp=drivesdk\",\"cachedResultName\":\"Uppfy Shop Invoices\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"d0qeLhShx9sGXalR\",\"name\":\"Google Sheets\"}},\"typeVersion\":4.5,\"alwaysOutputData\":true},{\"id\":\"c63871fa-ca0f-4069-ac0d-422d39018a9e\",\"name\":\"If Does not Exist\",\"type\":\"n8n-nodes-base.if\",\"position\":[420,20],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"loose\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"cee7659a-cea3-494a-b4f3-c76d035a3a32\",\"operator\":{\"type\":\"string\",\"operation\":\"empty\",\"singleValue\":true},\"leftValue\":\"={{ $json.row_number }}\",\"rightValue\":\"\"}]},\"looseTypeValidation\":true},\"typeVersion\":2.2},{\"id\":\"feb9ed84-a62c-4cec-bf36-b53a76711bcd\",\"name\":\"Set Fields\",\"type\":\"n8n-nodes-base.set\",\"position\":[740,-140],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"1bd457b4-2c15-433a-96b3-5fabb8566866\",\"name\":\"order_id\",\"type\":\"string\",\"value\":\"={{ $('Generate Invoice ID').item.json.order_id }}\"},{\"id\":\"15c51334-b127-485e-9be4-051b086d74b2\",\"name\":\"customer_name\",\"type\":\"string\",\"value\":\"={{ $('Webhook Simulator').item.json.customer_name }}\"},{\"id\":\"8c4f2d5c-09c8-4b8c-a77f-ab3c1d752c13\",\"name\":\"customer_email\",\"type\":\"string\",\"value\":\"={{ $('Webhook Simulator').item.json.customer_email }}\"},{\"id\":\"ea1bbfe4-c12d-450f-9bee-fff8710eed42\",\"name\":\"products\",\"type\":\"array\",\"value\":\"={{ $('Webhook Simulator').item.json.products }}\"},{\"id\":\"025d0783-7eb0-4ac4-b373-39f744692cfd\",\"name\":\"total\",\"type\":\"number\",\"value\":\"={{ $('Webhook Simulator').item.json.total }}\"}]}},\"typeVersion\":3.4},{\"id\":\"0532fa4b-cdd9-4857-8701-6a5baf48fd7c\",\"name\":\"Create Invoice HTML\",\"type\":\"n8n-nodes-base.code\",\"position\":[740,100],\"parameters\":{\"jsCode\":\"const { order_id, customer_name, customer_email, products, total } = $json;\\n\\n// Format products table rows\\nconst productRows = products.map((item, index) => {\\n  const subtotal = item.quantity * item.price;\\n  return `\\n    <tr>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">${index + 1}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">${item.name}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">${item.quantity}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">$${item.price.toFixed(2)}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">$${subtotal.toFixed(2)}</td>\\n    </tr>\\n  `;\\n}).join('');\\n\\nconst html = `\\n<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\">\\n  <title>Invoice ${order_id}</title>\\n</head>\\n<body style=\\\"font-family: Arial, sans-serif; color: #333; max-width: 700px; margin: auto; padding: 20px; border: 1px solid #ddd;\\\">\\n  <h2 style=\\\"text-align: center;\\\">Invoice</h2>\\n  <p><strong>Order ID:</strong> ${order_id}</p>\\n  <p><strong>Customer Name:</strong> ${customer_name}</p>\\n  <p><strong>Email:</strong> ${customer_email}</p>\\n\\n  <table style=\\\"width: 100%; border-collapse: collapse; margin-top: 20px;\\\">\\n    <thead>\\n      <tr>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">#</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Product</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Qty</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Unit Price</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Subtotal</th>\\n      </tr>\\n    </thead>\\n    <tbody>\\n      ${productRows}\\n    </tbody>\\n    <tfoot>\\n      <tr>\\n        <td colspan=\\\"4\\\" style=\\\"text-align: right; padding: 8px; border: 1px solid #ccc;\\\"><strong>Total:</strong></td>\\n        <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\"><strong>$${total.toFixed(2)}</strong></td>\\n      </tr>\\n    </tfoot>\\n  </table>\\n\\n  <p style=\\\"margin-top: 40px; text-align: center;\\\">Thank you for your order!</p>\\n</body>\\n</html>\\n`;\\n\\nreturn [\\n  {\\n    json: {\\n      html\\n    }\\n  }\\n];\\n\"},\"typeVersion\":2},{\"id\":\"5a3adb6a-9f64-477e-9622-3d2b9ef2e6de\",\"name\":\"HTML to PDF\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-20,320],\"parameters\":{\"url\":\"https://html2pdf2.p.rapidapi.com/html2pdf\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"sendHeaders\":true,\"bodyParameters\":{\"parameters\":[{\"name\":\"html\",\"value\":\"={{ $json.html }}\"}]},\"headerParameters\":{\"parameters\":[{\"name\":\"x-rapidapi-host\",\"value\":\"html2pdf2.p.rapidapi.com\"},{\"name\":\"x-rapidapi-key\",\"value\":\"\\\"your_rapid_api_key\\\"\"}]}},\"typeVersion\":4.2},{\"id\":\"cebf6d0d-d43f-4e50-abc0-79ff8da1817a\",\"name\":\"Upload PDF to GDrive\",\"type\":\"n8n-nodes-base.googleDrive\",\"position\":[420,320],\"parameters\":{\"name\":\"={{ $('Set Fields').item.json.order_id }} - {{ $('Set Fields').item.json.customer_name }}\",\"driveId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"My Drive\"},\"options\":{},\"folderId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"root\",\"cachedResultName\":\"/ (Root folder)\"}},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"l8Cc2MEVE7foBfbK\",\"name\":\"Google Drive account\"}},\"typeVersion\":3},{\"id\":\"b181eddc-e786-4d44-a334-e1b581b3981f\",\"name\":\"Email Invoice to Customer\",\"type\":\"n8n-nodes-base.emailSend\",\"position\":[640,320],\"webhookId\":\"cdc852fc-03b9-4a89-ba56-879064da5cbb\",\"parameters\":{\"html\":\"=Hello  {{ $('Set Fields').item.json.customer_name }},\\n\\nPlease pay this invoice\\n\\n\\n{{ $('Create Invoice HTML').item.json.html }}\\n\\n\\n<!DOCTYPE html>\\n<html>\\n<head>\\n    <style>\\n        .button {\\n            display: inline-block;\\n            background-color: #4CAF50;\\n            border: none;\\n            border-radius: 4px;\\n            color: white;\\n            padding: 15px 32px;\\n            text-align: center;\\n            text-decoration: none;\\n            font-size: 16px;\\n            font-weight: bold;\\n            margin: 4px 2px;\\n            cursor: pointer;\\n            font-family: Arial, sans-serif;\\n        }\\n    </style>\\n</head>\\n<body>\\n    <div style=\\\"text-align: center;\\\">\\n        <a href=\\\"YOUR_PAYMENT_LINK_HERE\\\" class=\\\"button\\\">Pay Now</a>\\n    </div>\\n</body>\\n</html>\\n\\n\",\"options\":{\"appendAttribution\":false},\"subject\":\"={{ $('Set Fields').item.json.order_id }} - New Invoice from Uppfy Shop \",\"toEmail\":\"={{ $('Set Fields').item.json.customer_email }}\",\"fromEmail\":\"Uppfy Shop <your_from_email>\"},\"credentials\":{\"smtp\":{\"id\":\"xcnAVXwtuOa1IOqE\",\"name\":\"SMTP account\"}},\"typeVersion\":2.1},{\"id\":\"883e32b6-a812-44c8-b525-97e819af90bd\",\"name\":\"Append Details to Invoices Sheet\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[860,320],\"parameters\":{\"columns\":{\"value\":{\"Status\":\"Unpaid\",\"Invoice ID\":\"={{ $('Set Fields').item.json.order_id }}\",\"Invoice URL\":\"={{ $('Upload PDF to GDrive').item.json.webViewLink }}\",\"Invoice Amt.\":\"=${{ $('Set Fields').item.json.total }}\",\"Customer Name\":\"={{ $('Set Fields').item.json.customer_name }}\",\"Customer Email\":\"={{ $('Set Fields').item.json.customer_email }}\"},\"schema\":[{\"id\":\"Invoice ID\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Invoice ID\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Customer Name\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Customer Name\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Customer Email\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Customer Email\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Invoice Amt.\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"Invoice Amt.\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Invoice URL\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"Invoice URL\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Status\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"Status\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[\"Invoice ID\"],\"attemptToConvertTypes\":false,\"convertFieldsToString\":false},\"options\":{},\"operation\":\"appendOrUpdate\",\"sheetName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gid=0\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit#gid=0\",\"cachedResultName\":\"Invoices\"},\"documentId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit?usp=drivesdk\",\"cachedResultName\":\"Uppfy Shop Invoices\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"d0qeLhShx9sGXalR\",\"name\":\"Google Sheets\"}},\"typeVersion\":4.5},{\"id\":\"cd06d6c9-903d-4af8-8327-eb36ba3bc73a\",\"name\":\"Download PDF from API\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[200,320],\"parameters\":{\"url\":\" https://rhodium-tecnologia-html2pdf.s3.amazonaws.com/public/pdfs/1747392997249.pdf\",\"options\":{}},\"typeVersion\":4.2},{\"id\":\"7d308e22-9b2d-4993-8aad-cc701303d38d\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-280,-160],\"parameters\":{\"width\":180,\"height\":320,\"content\":\"## Pinned Data to Simulate Webhook Query\"},\"typeVersion\":1}],\"active\":false,\"pinData\":{\"Webhook Simulator\":[{\"json\":{\"total\":65,\"products\":[{\"name\":\"T-shirt\",\"price\":25,\"quantity\":2},{\"name\":\"Hat\",\"price\":15,\"quantity\":1}],\"customer_name\":\"Jane Doe\",\"customer_email\":\"jane@example.com\"}}]},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"dec45f2b-cb36-4f86-a8cc-d3c498ae7aa2\",\"connections\":{\"Set Fields\":{\"main\":[[{\"node\":\"Create Invoice HTML\",\"type\":\"main\",\"index\":0}]]},\"HTML to PDF\":{\"main\":[[{\"node\":\"Download PDF from API\",\"type\":\"main\",\"index\":0}]]},\"If Does not Exist\":{\"main\":[[{\"node\":\"Set Fields\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Generate Invoice ID\",\"type\":\"main\",\"index\":0}]]},\"Webhook Simulator\":{\"main\":[[{\"node\":\"Generate Invoice ID\",\"type\":\"main\",\"index\":0}]]},\"Create Invoice HTML\":{\"main\":[[{\"node\":\"HTML to PDF\",\"type\":\"main\",\"index\":0}]]},\"Generate Invoice ID\":{\"main\":[[{\"node\":\"Check if ID Already Exists\",\"type\":\"main\",\"index\":0}]]},\"Upload PDF to GDrive\":{\"main\":[[{\"node\":\"Email Invoice to Customer\",\"type\":\"main\",\"index\":0}]]},\"Download PDF from API\":{\"main\":[[{\"node\":\"Upload PDF to GDrive\",\"type\":\"main\",\"index\":0}]]},\"Email Invoice to Customer\":{\"main\":[[{\"node\":\"Append Details to Invoices Sheet\",\"type\":\"main\",\"index\":0}]]},\"Check if ID Already Exists\":{\"main\":[[{\"node\":\"If Does not Exist\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow automates invoice generation from form submissions, ensuring unique order IDs, creating PDF invoices, storing files, emailing customers, and logging invoice data — all seamlessly integrated.\n\n* * *\n\n## 🔹 Workflow Overview\n\n  1. **Trigger (Webhook)**  \nStarts when an order form is submitted, capturing customer and order details.\n\n  2. **Generate Random Order ID**  \nA Function node creates a unique alphanumeric invoice ID (e.g., `INV-X92B7D`).\n\n  3. **Check for Duplicate Order ID**  \nGoogle Sheets looks up the generated order ID in your invoice log sheet to prevent duplicates.\n\n  4. **Conditional Check (IF Node)**\n\n     * If the ID already exists → regenerates a new ID (loops back)\n     * If unique → proceeds to invoice creation\n  5. **Prepare Invoice Data**  \nA Set node formats customer info, date, order items, and the unique order ID to fit your invoice template.\n\n  6. **Convert HTML to PDF**  \nHTTP Request node sends your invoice HTML to the RapidAPI HTML-to-PDF service and receives the PDF file.\n\n  7. **Upload PDF to Cloud Storage**  \nSave the PDF in Google Drive or Dropbox with a clear file name like `Invoice-INV-X92B7D.pdf`.\n\n  8. **Send Invoice Email to Customer**  \nEmail node attaches the PDF and includes the order ID in the email subject/body.\n\n  9. **Log Invoice Details**  \nAppend invoice data (customer info, order ID, total, PDF link) to your Google Sheet for tracking.\n\n\n\n\n* * *\n\n## ⚙️ Node Details & Setup\n\n### 1\\. Webhook Trigger\n\n  * Configure to receive form submissions (order details like name, email, items, total).\n\n\n\n### 2\\. Function: Generate Random Order ID\n\n  * Sample JS code generates unique IDs prefixed by `INV-`.\n\n\n\n### 3\\. Google Sheets: Lookup Row\n\n  * Set up connection to your invoice log sheet.\n  * Search for existing order ID to avoid duplicates.\n\n\n\n### 4\\. IF Node: Check Order ID Existence\n\n  * Condition: If order ID found → loop to regenerate.\n  * Else → continue workflow.\n\n\n\n### 5\\. Set Node: Prepare Invoice HTML\n\n  * Define variables like customer name, date, items, and order ID.\n  * This data populates your HTML invoice template.\n\n\n\n### 6\\. HTTP Request: Convert HTML to PDF\n\n  * [API URL to get your key](https://rapidapi.com/rhodium/api/html2pdf2/playground/apiendpoint_9b1017c6-2f56-4b7e-80d5-0fe24937d398)\n  * Send invoice HTML in the request body.\n  * Receive PDF file blob or download URL.\n\n\n\n### 7\\. Google Drive (or Dropbox) Upload\n\n  * Upload the PDF file.\n  * Use file name format: `Invoice-{{$json[\"order_id\"]}}.pdf`\n\n\n\n### 8\\. Email Node\n\n  * Recipient: customer email from the form data.\n  * Attach generated PDF.\n  * Include order ID in email subject or body for reference.\n\n\n\n### 9\\. Google Sheets: Append Row\n\n  * Log invoice metadata to keep records updated.\n\n\n\n* * *\n\n## 📁 Google Sheets Template\n\nYou can make a copy of the invoice log template [here](https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit?gid=0)\n\n`This sheet includes columns for order\\_id, customer name, email, total, and invoice PDF link. Customize it as needed.`\n\n* * *\n\n## 📌 Additional Notes\n\n  * Customize the invoice HTML template inside the Set node to match your branding.\n  * Ensure API credentials for RapidAPI, Google Drive/Dropbox, and email are properly set up in your n8n credentials.\n  * You can expand this workflow by adding payment processing or SMS notifications.\n\n\n\n* * *\n\n## Need help or want a custom workflow?\n\nReach out via email at [joseph@uppfy.com](mailto:joseph@uppfy.com).\n",
  "crawled_at": "2025-05-26T06:42:35.708554",
  "title_zh": "使用JS + G表格生成发票、保存至云端硬盘并发送邮件给客户",
  "readme_zh": "该工作流可自动将表单提交内容转换为发票，包含生成唯一订单号、创建PDF发票、存储文件、邮件发送客户及记录发票数据等全流程自动化操作。\n\n* * *\n\n## 🔹 工作流概览\n\n  1. **触发节点（Webhook）**  \n通过订单表单提交触发，自动捕获客户及订单信息。\n\n  2. **生成随机订单号**  \n函数节点创建唯一字母数字发票ID（如`INV-X92B7D`）。\n\n  3. **检查订单号重复**  \n通过Google Sheets核对历史记录，确保订单号唯一性。\n\n  4. **条件判断（IF节点）**\n\n     * 若订单号已存在 → 重新生成新ID（循环此步骤）\n     * 若订单号唯一 → 进入发票创建流程\n  5. **准备发票数据**  \nSet节点格式化客户信息、日期、订单明细及唯一订单号，适配发票模板。\n\n  6. **HTML转PDF**  \n通过HTTP请求节点调用RapidAPI转换服务，生成PDF文件。\n\n  7. **上传PDF至云存储**  \n将PDF保存至Google Drive或Dropbox，命名格式示例：`Invoice-INV-X92B7D.pdf`。\n\n  8. **发送发票邮件**  \n邮件节点自动附加PDF文件，并在主题/正文中注明订单号。\n\n  9. **记录发票数据**  \n将客户信息、订单号、金额及PDF链接归档至Google Sheets。\n\n* * *\n\n## ⚙️ 节点配置详情\n\n### 1\\. Webhook触发\n\n  * 配置接收表单数据（含客户姓名、邮箱、商品清单、总金额等字段）\n\n### 2\\. 函数节点：生成随机订单号\n\n  * 示例JS代码生成带`INV-`前缀的唯一ID\n\n### 3\\. Google Sheets：数据查重\n\n  * 连接至发票记录表格\n  * 检索现有订单号避免重复\n\n### 4\\. IF节点：订单号校验\n\n  * 条件判断：若订单号存在 → 返回重新生成\n  * 若不存在 → 继续后续流程\n\n### 5\\. Set节点：构建发票HTML\n\n  * 定义客户姓名、日期、商品明细等变量\n  * 数据将动态填充至HTML发票模板\n\n### 6\\. HTTP请求：HTML转PDF\n\n  * [获取API密钥](https://rapidapi.com/rhodium/api/html2pdf2/playground/apiendpoint_9b1017c6-2f56-4b7e-80d5-0fe24937d398)\n  * 提交HTML内容并接收PDF文件或下载链接\n\n### 7\\. Google Drive/Dropbox上传\n\n  * 上传PDF文件\n  * 文件名格式：`Invoice-{{$json[\"order_id\"]}}.pdf`\n\n### 8\\. 邮件节点\n\n  * 收件人：表单中的客户邮箱\n  * 附件：生成的PDF发票\n  * 邮件主题/正文需包含订单号\n\n### 9\\. Google Sheets：数据归档\n\n  * 记录发票元数据至电子表格\n\n* * *\n\n## 📁 Google Sheets模板\n\n[点击此处复制发票记录模板](https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit?gid=0)\n\n`模板已预设订单号、客户姓名、邮箱、金额及PDF链接字段，支持自定义修改`\n\n* * *\n\n## 📌 注意事项\n\n  * 在Set节点中自定义HTML模板以匹配品牌风格\n  * 确保RapidAPI、云存储及邮件服务的API凭证已在n8n配置\n  * 可扩展支付处理或短信通知等功能\n\n* * *\n\n## 需要帮助或定制工作流？\n\n联系邮箱：[joseph@uppfy.com](mailto:joseph@uppfy.com)",
  "publish_date_zh": "上次更新于9天前",
  "workflow_json_zh": "{\n  \"id\": \"K4XpJbwBJYnDiYkF\",\n  \"meta\": {\n    \"instanceId\": \"b3c467df4053d13fe31cc98f3c66fa1d16300ba750506bfd019a0913cec71ea3\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Generate Invoices\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"e56cbf88-1e0d-4dd7-a269-091ad2ce8420\",\n      \"name\": \"Webhook Simulator\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -240,\n        20\n      ],\n      \"webhookId\": \"7f884a07-861e-49da-bb0e-1ac6ca40ea00\",\n      \"parameters\": {\n        \"path\": \"7f884a07-861e-49da-bb0e-1ac6ca40ea00\",\n        \"options\": {}\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"b01307f7-b5cb-421e-833a-0889925bb09c\",\n      \"name\": \"Generate Invoice ID\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -20,\n        20\n      ],\n      \"parameters\": {\n        \"jsCode\": \"function generateOrderID(length = 6) {\\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\\n  let result = 'INV-';\\n  for (let i = 0; i < length; i++) {\\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\\n  }\\n  return result;\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      order_id: generateOrderID()\\n    }\\n  }\\n];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"bf50ca10-4021-4e6f-9c08-56fd84ce13ed\",\n      \"name\": \"Check if ID Already Exists\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        200,\n        20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupValue\": \"={{ $json.order_id }}\",\n              \"lookupColumn\": \"Invoice ID\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit#gid=0\",\n          \"cachedResultName\": \"Invoices\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Uppfy Shop Invoices\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"d0qeLhShx9sGXalR\",\n          \"name\": \"Google Sheets\"\n        }\n      },\n      \"typeVersion\": 4.5,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"c63871fa-ca0f-4069-ac0d-422d39018a9e\",\n      \"name\": \"If Does not Exist\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        420,\n        20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"loose\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"cee7659a-cea3-494a-b4f3-c76d035a3a32\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"empty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.row_number }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        },\n        \"looseTypeValidation\": true\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"feb9ed84-a62c-4cec-bf36-b53a76711bcd\",\n      \"name\": \"Set Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        740,\n        -140\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"1bd457b4-2c15-433a-96b3-5fabb8566866\",\n              \"name\": \"order_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Generate Invoice ID').item.json.order_id }}\"\n            },\n            {\n              \"id\": \"15c51334-b127-485e-9be4-051b086d74b2\",\n              \"name\": \"customer_name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Webhook Simulator').item.json.customer_name }}\"\n            },\n            {\n              \"id\": \"8c4f2d5c-09c8-4b8c-a77f-ab3c1d752c13\",\n              \"name\": \"customer_email\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Webhook Simulator').item.json.customer_email }}\"\n            },\n            {\n              \"id\": \"ea1bbfe4-c12d-450f-9bee-fff8710eed42\",\n              \"name\": \"products\",\n              \"type\": \"array\",\n              \"value\": \"={{ $('Webhook Simulator').item.json.products }}\"\n            },\n            {\n              \"id\": \"025d0783-7eb0-4ac4-b373-39f744692cfd\",\n              \"name\": \"total\",\n              \"type\": \"number\",\n              \"value\": \"={{ $('Webhook Simulator').item.json.total }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0532fa4b-cdd9-4857-8701-6a5baf48fd7c\",\n      \"name\": \"Create Invoice HTML\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        740,\n        100\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const { order_id, customer_name, customer_email, products, total } = $json;\\n\\n// Format products table rows\\nconst productRows = products.map((item, index) => {\\n  const subtotal = item.quantity * item.price;\\n  return `\\n    <tr>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">${index + 1}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">${item.name}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">${item.quantity}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">$${item.price.toFixed(2)}</td>\\n      <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\">$${subtotal.toFixed(2)}</td>\\n    </tr>\\n  `;\\n}).join('');\\n\\nconst html = `\\n<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\">\\n  <title>Invoice ${order_id}</title>\\n</head>\\n<body style=\\\"font-family: Arial, sans-serif; color: #333; max-width: 700px; margin: auto; padding: 20px; border: 1px solid #ddd;\\\">\\n  <h2 style=\\\"text-align: center;\\\">Invoice</h2>\\n  <p><strong>Order ID:</strong> ${order_id}</p>\\n  <p><strong>Customer Name:</strong> ${customer_name}</p>\\n  <p><strong>Email:</strong> ${customer_email}</p>\\n\\n  <table style=\\\"width: 100%; border-collapse: collapse; margin-top: 20px;\\\">\\n    <thead>\\n      <tr>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">#</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Product</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Qty</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Unit Price</th>\\n        <th style=\\\"padding: 8px; border: 1px solid #ccc;\\\">Subtotal</th>\\n      </tr>\\n    </thead>\\n    <tbody>\\n      ${productRows}\\n    </tbody>\\n    <tfoot>\\n      <tr>\\n        <td colspan=\\\"4\\\" style=\\\"text-align: right; padding: 8px; border: 1px solid #ccc;\\\"><strong>Total:</strong></td>\\n        <td style=\\\"padding: 8px; border: 1px solid #ccc;\\\"><strong>$${total.toFixed(2)}</strong></td>\\n      </tr>\\n    </tfoot>\\n  </table>\\n\\n  <p style=\\\"margin-top: 40px; text-align: center;\\\">Thank you for your order!</p>\\n</body>\\n</html>\\n`;\\n\\nreturn [\\n  {\\n    json: {\\n      html\\n    }\\n  }\\n];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"5a3adb6a-9f64-477e-9622-3d2b9ef2e6de\",\n      \"name\": \"HTML to PDF\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -20,\n        320\n      ],\n      \"parameters\": {\n        \"url\": \"https://html2pdf2.p.rapidapi.com/html2pdf\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"html\",\n              \"value\": \"={{ $json.html }}\"\n            }\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"x-rapidapi-host\",\n              \"value\": \"html2pdf2.p.rapidapi.com\"\n            },\n            {\n              \"name\": \"x-rapidapi-key\",\n              \"value\": \"\\\"your_rapid_api_key\\\"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"cebf6d0d-d43f-4e50-abc0-79ff8da1817a\",\n      \"name\": \"Upload PDF to GDrive\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        420,\n        320\n      ],\n      \"parameters\": {\n        \"name\": \"={{ $('Set Fields').item.json.order_id }} - {{ $('Set Fields').item.json.customer_name }}\",\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\"\n        },\n        \"options\": {},\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"root\",\n          \"cachedResultName\": \"/ (Root folder)\"\n        }\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"l8Cc2MEVE7foBfbK\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"b181eddc-e786-4d44-a334-e1b581b3981f\",\n      \"name\": \"Email Invoice to Customer\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        640,\n        320\n      ],\n      \"webhookId\": \"cdc852fc-03b9-4a89-ba56-879064da5cbb\",\n      \"parameters\": {\n        \"html\": \"=Hello  {{ $('Set Fields').item.json.customer_name }},\\n\\nPlease pay this invoice\\n\\n\\n{{ $('Create Invoice HTML').item.json.html }}\\n\\n\\n<!DOCTYPE html>\\n<html>\\n<head>\\n    <style>\\n        .button {\\n            display: inline-block;\\n            background-color: #4CAF50;\\n            border: none;\\n            border-radius: 4px;\\n            color: white;\\n            padding: 15px 32px;\\n            text-align: center;\\n            text-decoration: none;\\n            font-size: 16px;\\n            font-weight: bold;\\n            margin: 4px 2px;\\n            cursor: pointer;\\n            font-family: Arial, sans-serif;\\n        }\\n    </style>\\n</head>\\n<body>\\n    <div style=\\\"text-align: center;\\\">\\n        <a href=\\\"YOUR_PAYMENT_LINK_HERE\\\" class=\\\"button\\\">Pay Now</a>\\n    </div>\\n</body>\\n</html>\\n\\n\",\n        \"options\": {\n          \"appendAttribution\": false\n        },\n        \"subject\": \"={{ $('Set Fields').item.json.order_id }} - New Invoice from Uppfy Shop \",\n        \"toEmail\": \"={{ $('Set Fields').item.json.customer_email }}\",\n        \"fromEmail\": \"Uppfy Shop <your_from_email>\"\n      },\n      \"credentials\": {\n        \"smtp\": {\n          \"id\": \"xcnAVXwtuOa1IOqE\",\n          \"name\": \"SMTP account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"883e32b6-a812-44c8-b525-97e819af90bd\",\n      \"name\": \"Append Details to Invoices Sheet\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        860,\n        320\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"Status\": \"Unpaid\",\n            \"Invoice ID\": \"={{ $('Set Fields').item.json.order_id }}\",\n            \"Invoice URL\": \"={{ $('Upload PDF to GDrive').item.json.webViewLink }}\",\n            \"Invoice Amt.\": \"=${{ $('Set Fields').item.json.total }}\",\n            \"Customer Name\": \"={{ $('Set Fields').item.json.customer_name }}\",\n            \"Customer Email\": \"={{ $('Set Fields').item.json.customer_email }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"Invoice ID\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Invoice ID\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Customer Name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Customer Name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Customer Email\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Customer Email\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Invoice Amt.\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Invoice Amt.\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Invoice URL\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Invoice URL\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Status\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"Invoice ID\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"appendOrUpdate\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit#gid=0\",\n          \"cachedResultName\": \"Invoices\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1QW_Lg1aoEBku8GaxwPbZfBY5ITAuSdvoAXRyNdCEujM/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Uppfy Shop Invoices\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"d0qeLhShx9sGXalR\",\n          \"name\": \"Google Sheets\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"cd06d6c9-903d-4af8-8327-eb36ba3bc73a\",\n      \"name\": \"Download PDF from API\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        200,\n        320\n      ],\n      \"parameters\": {\n        \"url\": \" https://rhodium-tecnologia-html2pdf.s3.amazonaws.com/public/pdfs/1747392997249.pdf\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"7d308e22-9b2d-4993-8aad-cc701303d38d\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -280,\n        -160\n      ],\n      \"parameters\": {\n        \"width\": 180,\n        \"height\": 320,\n        \"content\": \"## 固定数据以模拟Webhook查询\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {\n    \"Webhook Simulator\": [\n      {\n        \"json\": {\n          \"total\": 65,\n          \"products\": [\n            {\n              \"name\": \"T-shirt\",\n              \"price\": 25,\n              \"quantity\": 2\n            },\n            {\n              \"name\": \"Hat\",\n              \"price\": 15,\n              \"quantity\": 1\n            }\n          ],\n          \"customer_name\": \"Jane Doe\",\n          \"customer_email\": \"jane@example.com\"\n        }\n      }\n    ]\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"dec45f2b-cb36-4f86-a8cc-d3c498ae7aa2\",\n  \"connections\": {\n    \"Set Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Invoice HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"HTML to PDF\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download PDF from API\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If Does not Exist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Generate Invoice ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook Simulator\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Invoice ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Invoice HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTML to PDF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Generate Invoice ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check if ID Already Exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload PDF to GDrive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Email Invoice to Customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download PDF from API\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload PDF to GDrive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Email Invoice to Customer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Append Details to Invoices Sheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check if ID Already Exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If Does not Exist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
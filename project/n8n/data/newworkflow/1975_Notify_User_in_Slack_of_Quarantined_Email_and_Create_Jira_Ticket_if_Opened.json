{
  "url": "https://n8n.io/workflows/1975-notify-user-in-slack-of-quarantined-email-and-create-jira-ticket-if-opened/",
  "title": "Notify User in Slack of Quarantined Email and Create Jira Ticket if Opened",
  "author": "n8n Team",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-25",
  "categories": [
    {
      "name": "SecOps"
    }
  ],
  "workflow_json": "{\"id\":\"LSH4x5nnNGQbNBkh\",\"meta\":{\"instanceId\":\"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"},\"name\":\"Notify_user_in_Slack_of_quarantined_email_and_create_Jira_ticket_if_opened\",\"tags\":[{\"id\":\"5TDAHOQdlBnsFbrY\",\"name\":\"Completed\",\"createdAt\":\"2023-11-06T22:57:07.494Z\",\"updatedAt\":\"2023-11-06T22:57:07.494Z\"},{\"id\":\"QPJKatvLSxxtrE8U\",\"name\":\"Secops\",\"createdAt\":\"2023-10-31T02:15:11.396Z\",\"updatedAt\":\"2023-10-31T02:15:11.396Z\"}],\"nodes\":[{\"id\":\"f0bf5f9b-58c5-4dff-95cc-3af378fc49a3\",\"name\":\"has email been opened?\",\"type\":\"n8n-nodes-base.if\",\"position\":[1280,1040],\"parameters\":{\"conditions\":{\"boolean\":[{\"value1\":\"={{ !!($json.read_at ?? false) }}\",\"value2\":true}]}},\"typeVersion\":1},{\"id\":\"7acb2409-6b67-4500-993f-5beeaecec718\",\"name\":\"Receive Sublime Security Alert\",\"type\":\"n8n-nodes-base.webhook\",\"position\":[840,1040],\"webhookId\":\"3ea0b887-9caa-477e-b6e4-1d3edf72d11e\",\"parameters\":{\"path\":\"3ea0b887-9caa-477e-b6e4-1d3edf72d11e\",\"options\":{},\"httpMethod\":\"POST\",\"authentication\":\"headerAuth\"},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"a9rnBXHOmqHidbGH\",\"name\":\"sublimesecurity.com - webhook calling n8n \"}},\"typeVersion\":1},{\"id\":\"ad876000-e3a4-4f3e-b917-629cc450a15c\",\"name\":\"Get message details in Sublime Security\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1040,1040],\"parameters\":{\"url\":\"=https://api.platform.sublimesecurity.com/v0/messages/{{ $json.body.data.messageId }}\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\"},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"Pc9hRVp3NXeK3XwV\",\"name\":\"sublimesecurity.com - API Key\"}},\"typeVersion\":4.1},{\"id\":\"2945cdef-f595-410d-9344-767e8cae3cd6\",\"name\":\"Jira Software\",\"type\":\"n8n-nodes-base.jira\",\"position\":[1680,900],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"\"},\"summary\":\"=Flagged email has been opened before quarantine | {{ $('Get message details in Sublime Security').item.json.subject }}\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"\"},\"additionalFields\":{\"description\":\"=An email has been automatically flagged by Sublime Security and has been quarantined.\\nThe recipient has opened the email before the quarantine occurred.\\n\\n## **Flagged Rules**\\n|Name |Severity|Tags|ID|\\n|--|--|--|--|\\n{{ $json[\\\"table\\\"] }}\\n\\n## **Email information**\\n| | |\\n|--|--|\\n|Email ID|{{ $('Get message details in Sublime Security').item.json[\\\"id\\\"] }}|\\n|Time Created At|{{ $('Get message details in Sublime Security').item.json[\\\"created_at\\\"] }}|\\n|Receiving Mailbox Address|{{ $('Get message details in Sublime Security').item.json[\\\"mailbox\\\"][\\\"email\\\"] }}|\\n|Subject line|{{ $('Get message details in Sublime Security').item.json[\\\"subject\\\"] }}|\\n|Sender Email|{{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"email\\\"] }}|\\n|Sender Display Name|{{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"display_name\\\"] }}|\\n|Time Read At|{{ $('Get message details in Sublime Security').item.json[\\\"read_at\\\"] }}|\\n\\nTo view the message details and further information, please check the Sublime Security dashboard.\\n\\nAn email has been sent to {{ $('Get message details in Sublime Security').item.json[\\\"mailbox\\\"][\\\"email\\\"] }} notifying them that an incoming message has been quarantined.\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"OYvpDV2Q42eY6iyA\",\"name\":\"Alex Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"9c55d492-0fdd-4edd-995c-b3c5fecd9840\",\"name\":\"lookup slack user by email\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1280,460],\"parameters\":{\"url\":\"https://slack.com/api/users.lookupByEmail\",\"options\":{},\"sendQuery\":true,\"authentication\":\"predefinedCredentialType\",\"queryParameters\":{\"parameters\":[{\"name\":\"email\",\"value\":\"={{ $json.mailbox.email }}\"}]},\"nodeCredentialType\":\"slackApi\"},\"credentials\":{\"slackApi\":{\"id\":\"350\",\"name\":\"n8n License Token\"},\"slackOAuth2Api\":{\"id\":\"346\",\"name\":\"n8n License Bot\"}},\"typeVersion\":4.1},{\"id\":\"f1bcb2c7-4ef4-4f9b-a68e-6620ab66b435\",\"name\":\"user found?\",\"type\":\"n8n-nodes-base.if\",\"position\":[1480,460],\"parameters\":{\"conditions\":{\"boolean\":[{\"value1\":\"={{ !!($json.user.id ?? false) }}\",\"value2\":true}]}},\"typeVersion\":1},{\"id\":\"dcca54b8-d09c-45bf-a789-7545103bb7c3\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[480,364.84681758846136],\"parameters\":{\"width\":718.6188455173532,\"height\":863.9601939404693,\"content\":\"![Sublime Security](https://i.imgur.com/DfXJLIw.png)\\n# Workflow Overview\\n\\nThis workflow is initiated by `Sublime Security` whenever an inbound email undergoes scanning and triggers an alert.\\n\\nIn the event that Sublime Security is set up to automatically quarantine the email, this workflow will make an effort to inform the recipient through Slack. To accomplish this, it will utilize the recipient's mailbox address to search for their corresponding Slack username.\\n\\nIf the flagged email has already been opened, this workflow will additionally create a Jira ticket to manage the incident.\\n\\n## **HTTP Request Node Requirements**\\n1. Create a rule in Sublime Security which has [auto-quarantine enabled](https://docs.sublimesecurity.com/docs/quarantine).\\n2. [Create a webhook](https://docs.sublimesecurity.com/docs/webhooks) in Sublime which will send an alert to the `Receive Sublime Security Alert` node whenever a selected rule is triggered.\\n\\n## **Credentials**\\n- Sublime Security: Find your API key for [Sublime Security](https://docs.sublimesecurity.com/reference/authentication#create-an-api-key) and save it as an n8n credential with Header Auth in the format `Authorization: Bearer YOUR-API-KEY`.\\n\\n- Slack: Provide credentials for a Slack app that has access to `users:read.email` and `im:write` scopes.\\n\"},\"typeVersion\":1},{\"id\":\"8255a3f7-fcda-4d93-97c3-4d223778014f\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1220,175.18665303995851],\"parameters\":{\"width\":714.4547337311393,\"height\":522.7074838611178,\"content\":\"![Slack](https://i.imgur.com/iKyMV0N.png)\\n## Try to find quarantined email user's slack username \\nWith the quarantined email’s details at hand, n8n tries to notify the user via Slack. The message explains the reason for the email’s absence, provides identifying details, and instructs on further action if the user recognizes the email as safe.\"},\"typeVersion\":1},{\"id\":\"c149a4b8-4f12-4018-a1dc-dfbed9e081eb\",\"name\":\"Found, notify user\",\"type\":\"n8n-nodes-base.slack\",\"position\":[1700,400],\"parameters\":{\"text\":\"=Hello,\\nOur security team has detected a potentially malicious email sent to your inbox and have quarantined it undergoing investigation.\\n\\nFrom: {{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"display_name\\\"] }} | {{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"email\\\"] }}\\nSubject: {{ $('Get message details in Sublime Security').item.json[\\\"subject\\\"] }}\\n\\nIf you believe that the email is not malicious and was intended for you, please contact IT, referencing email ID `{{ $('Get message details in Sublime Security').item.json[\\\"id\\\"] }}`.\\n\\nThe email may be restored by IT if it is determined to be safe.\\n\\nThank you for helping keep the company secure!\",\"user\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $json.user.id }}\"},\"select\":\"user\",\"otherOptions\":{}},\"credentials\":{\"slackApi\":{\"id\":\"350\",\"name\":\"n8n License Token\"}},\"typeVersion\":2.1},{\"id\":\"04712fdf-0409-4f9d-bd0b-7e40af9ffade\",\"name\":\"Not Found, Do Nothing\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[1700,560],\"parameters\":{},\"typeVersion\":1},{\"id\":\"c9f8ede6-1886-4779-a4e8-3c32e12d6aae\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1220,710.6363009271314],\"parameters\":{\"width\":718.1630306649816,\"height\":516.9144812801944,\"content\":\"![Jira](https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Jira_%28Software%29_logo.svg/320px-Jira_%28Software%29_logo.svg.png)\\n## If user opened email before quarantine, create jira ticket\\nIf an email is opened prior to quarantine, n8n automatically creates a Jira ticket for further investigation. This ensures a swift response to potential threats that bypass the initial quarantine measures, highlighting n8n's critical role in incident response workflows.\"},\"typeVersion\":1},{\"id\":\"a75d35a2-eefa-490c-9a05-9474a1e093fb\",\"name\":\"No, do nothing\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[1500,1080],\"parameters\":{},\"typeVersion\":1},{\"id\":\"8c44c4fb-ec26-4005-b17b-ac8a9ef79721\",\"name\":\"Yes, prep flaggedRules table\",\"type\":\"n8n-nodes-base.code\",\"position\":[1500,900],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"console.log($(\\\"Receive Sublime Security Alert\\\").item.json.body);\\n\\nconst table = $(\\\"Receive Sublime Security Alert\\\")\\n  .item.json.body.data.flagged_rules.map(\\n    (rule) => `|${rule.name}|${rule.severity}|${rule.tags.join(\\\",\\\")}|${rule.id}`\\n  )\\n  .join(\\\"\\\\n\\\");\\n\\nconsole.log(table);\\n\\nreturn {\\n  table\\n}\\n\"},\"typeVersion\":2}],\"active\":false,\"pinData\":{\"Receive Sublime Security Alert\":[{\"json\":{\"body\":{\"data\":{\"messageId\":\"d61efe63-b350-4436-bccf-936a7e54503b\",\"flagged_rules\":[{\"id\":1,\"name\":\"rule 1\",\"tags\":[\"tag-1\",\"tag-2\"],\"severity\":\"high\"},{\"id\":2,\"name\":\"rule 2\",\"tags\":[\"tag-2\",\"tag-3\"],\"severity\":\"low\"}]}},\"query\":{},\"params\":{},\"headers\":{}}}],\"Get message details in Sublime Security\":[{\"json\":{\"id\":\"d61efe63-b350-4436-bccf-936a7e54503b\",\"sender\":{\"email\":\"a.sender@gmail.com\",\"display_name\":\"A. Sender\"},\"mailbox\":{\"id\":\"3e51603f-c2cb-4807-bc34-022994b0d149\",\"email\":\"john.doe@example.io\",\"external_id\":null},\"read_at\":\"2023-09-06T11:49:20.355807Z\",\"subject\":\"test subject\",\"created_at\":\"2023-09-06T11:49:20.355807Z\",\"recipients\":[{\"email\":\"john.doe@example.io\"}],\"replied_at\":null,\"external_id\":\"3\",\"canonical_id\":\"1173a16af634b58191cd11291aac39e06dfa418a0140522b4875385c544da511\",\"forwarded_at\":null,\"message_source_id\":\"0ba6712e-6d92-4df8-b6f3-198dcfac08d5\",\"forward_recipients\":[]}}]},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"cfa69dd2-286b-46ae-bc6b-6b4086bc8a20\",\"connections\":{\"user found?\":{\"main\":[[{\"node\":\"Found, notify user\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Not Found, Do Nothing\",\"type\":\"main\",\"index\":0}]]},\"has email been opened?\":{\"main\":[[{\"node\":\"Yes, prep flaggedRules table\",\"type\":\"main\",\"index\":0}],[{\"node\":\"No, do nothing\",\"type\":\"main\",\"index\":0}]]},\"lookup slack user by email\":{\"main\":[[{\"node\":\"user found?\",\"type\":\"main\",\"index\":0}]]},\"Yes, prep flaggedRules table\":{\"main\":[[{\"node\":\"Jira Software\",\"type\":\"main\",\"index\":0}]]},\"Receive Sublime Security Alert\":{\"main\":[[{\"node\":\"Get message details in Sublime Security\",\"type\":\"main\",\"index\":0}]]},\"Get message details in Sublime Security\":{\"main\":[[{\"node\":\"has email been opened?\",\"type\":\"main\",\"index\":0},{\"node\":\"lookup slack user by email\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This n8n workflow serves as an incident response and notification system for handling potentially malicious emails flagged by Sublime Security. It begins with a Webhook trigger that Sublime Security uses to initiate the workflow by POSTing an alert. The workflow then extracts message details from Sublime Security using an HTTP Request node, based on the provided messageId, and subsequently splits into two parallel paths.\n\nIn the first path, the workflow looks up a Slack user by email, aiming to find the recipient of the email that triggered the alert. If a user is found in Slack, a notification is sent to them, explaining that they have received a potentially malicious email that has been quarantined and is under investigation. This notification includes details such as the email's subject and sender.\n\nThe second path checks whether the flagged email has been opened by inspecting the read_at value from Sublime Security. If the email was opened, the workflow prepares a table summarizing the flagged rules and creates a corresponding issue in Jira Software. The Jira issue contains information about the email, including its subject, sender, and recipient, along with the flagged rules.\n\nIssues that someone might encounter when setting up this workflow for the first time include potential problems with the Slack user lookup if the user information is not available or if Slack API integration is not configured correctly. Additionally, the issue creation in Jira Software may not work as expected, as indicated by the note that mentions a need for possible node replacement. Thorough testing and validation with sample data from Sublime Security alerts can help identify and resolve any potential issues during setup.\n",
  "crawled_at": "2025-05-25T20:29:37.849730",
  "readme_zh": "该n8n工作流作为事件响应与通知系统，用于处理Sublime Security标记的潜在恶意邮件。流程始于一个Webhook触发器，当Sublime Security通过POST警报触发时启动。工作流首先通过HTTP Request节点根据提供的messageId从Sublime Security提取邮件详情，随后分拆为两条并行路径。\n\n第一条路径通过邮件地址查找Slack用户，旨在定位触发警报的邮件接收者。若在Slack中找到相应用户，系统会向其发送通知，说明其收到的可疑邮件已被隔离并正在调查中。通知内容包含邮件主题、发件人等详细信息。\n\n第二条路径通过检查Sublime Security的read_at值，判断标记邮件是否被打开。若邮件已被查阅，工作流将汇总标记规则生成表格，并在Jira Software中创建对应问题单。该问题单包含邮件主题、发件人、收件人及标记规则等关键信息。\n\n初次部署此工作流时可能遇到的问题包括：若用户信息缺失或Slack API集成配置不当，可能导致用户查找失败；如备注所示，Jira问题创建节点可能需要替换才能正常运作。建议通过Sublime Security警报的测试数据进行全面验证，以便在部署阶段及时发现并解决潜在问题。",
  "title_zh": "在Slack中通知用户有关被隔离的邮件，并在邮件被打开时创建Jira工单",
  "publish_date_zh": "最后更新于10个月前",
  "workflow_json_zh": "{\n  \"id\": \"LSH4x5nnNGQbNBkh\",\n  \"meta\": {\n    \"instanceId\": \"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"\n  },\n  \"name\": \"Notify_user_in_Slack_of_quarantined_email_and_create_Jira_ticket_if_opened\",\n  \"tags\": [\n    {\n      \"id\": \"5TDAHOQdlBnsFbrY\",\n      \"name\": \"Completed\",\n      \"createdAt\": \"2023-11-06T22:57:07.494Z\",\n      \"updatedAt\": \"2023-11-06T22:57:07.494Z\"\n    },\n    {\n      \"id\": \"QPJKatvLSxxtrE8U\",\n      \"name\": \"Secops\",\n      \"createdAt\": \"2023-10-31T02:15:11.396Z\",\n      \"updatedAt\": \"2023-10-31T02:15:11.396Z\"\n    }\n  ],\n  \"nodes\": [\n    {\n      \"id\": \"f0bf5f9b-58c5-4dff-95cc-3af378fc49a3\",\n      \"name\": \"has email been opened?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1280,\n        1040\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"boolean\": [\n            {\n              \"value1\": \"={{ !!($json.read_at ?? false) }}\",\n              \"value2\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7acb2409-6b67-4500-993f-5beeaecec718\",\n      \"name\": \"Receive Sublime Security Alert\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        840,\n        1040\n      ],\n      \"webhookId\": \"3ea0b887-9caa-477e-b6e4-1d3edf72d11e\",\n      \"parameters\": {\n        \"path\": \"3ea0b887-9caa-477e-b6e4-1d3edf72d11e\",\n        \"options\": {},\n        \"httpMethod\": \"POST\",\n        \"authentication\": \"headerAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"a9rnBXHOmqHidbGH\",\n          \"name\": \"sublimesecurity.com - webhook calling n8n \"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ad876000-e3a4-4f3e-b917-629cc450a15c\",\n      \"name\": \"Get message details in Sublime Security\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1040,\n        1040\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.platform.sublimesecurity.com/v0/messages/{{ $json.body.data.messageId }}\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"Pc9hRVp3NXeK3XwV\",\n          \"name\": \"sublimesecurity.com - API Key\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"2945cdef-f595-410d-9344-767e8cae3cd6\",\n      \"name\": \"Jira Software\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        1680,\n        900\n      ],\n      \"parameters\": {\n        \"project\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\"\n        },\n        \"summary\": \"=Flagged email has been opened before quarantine | {{ $('Get message details in Sublime Security').item.json.subject }}\",\n        \"issueType\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\"\n        },\n        \"additionalFields\": {\n          \"description\": \"=An email has been automatically flagged by Sublime Security and has been quarantined.\\nThe recipient has opened the email before the quarantine occurred.\\n\\n## **Flagged Rules**\\n|Name |Severity|Tags|ID|\\n|--|--|--|--|\\n{{ $json[\\\"table\\\"] }}\\n\\n## **Email information**\\n| | |\\n|--|--|\\n|Email ID|{{ $('Get message details in Sublime Security').item.json[\\\"id\\\"] }}|\\n|Time Created At|{{ $('Get message details in Sublime Security').item.json[\\\"created_at\\\"] }}|\\n|Receiving Mailbox Address|{{ $('Get message details in Sublime Security').item.json[\\\"mailbox\\\"][\\\"email\\\"] }}|\\n|Subject line|{{ $('Get message details in Sublime Security').item.json[\\\"subject\\\"] }}|\\n|Sender Email|{{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"email\\\"] }}|\\n|Sender Display Name|{{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"display_name\\\"] }}|\\n|Time Read At|{{ $('Get message details in Sublime Security').item.json[\\\"read_at\\\"] }}|\\n\\nTo view the message details and further information, please check the Sublime Security dashboard.\\n\\nAn email has been sent to {{ $('Get message details in Sublime Security').item.json[\\\"mailbox\\\"][\\\"email\\\"] }} notifying them that an incoming message has been quarantined.\"\n        }\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"OYvpDV2Q42eY6iyA\",\n          \"name\": \"Alex Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9c55d492-0fdd-4edd-995c-b3c5fecd9840\",\n      \"name\": \"lookup slack user by email\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1280,\n        460\n      ],\n      \"parameters\": {\n        \"url\": \"https://slack.com/api/users.lookupByEmail\",\n        \"options\": {},\n        \"sendQuery\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"email\",\n              \"value\": \"={{ $json.mailbox.email }}\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"slackApi\"\n      },\n      \"credentials\": {\n        \"slackApi\": {\n          \"id\": \"350\",\n          \"name\": \"n8n License Token\"\n        },\n        \"slackOAuth2Api\": {\n          \"id\": \"346\",\n          \"name\": \"n8n License Bot\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"f1bcb2c7-4ef4-4f9b-a68e-6620ab66b435\",\n      \"name\": \"user found?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1480,\n        460\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"boolean\": [\n            {\n              \"value1\": \"={{ !!($json.user.id ?? false) }}\",\n              \"value2\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"dcca54b8-d09c-45bf-a789-7545103bb7c3\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        480,\n        364.84681758846136\n      ],\n      \"parameters\": {\n        \"width\": 718.6188455173532,\n        \"height\": 863.9601939404693,\n        \"content\": \"![Sublime Security](https://i.imgur.com/DfXJLIw.png)\\n# 工作流概览\\n\\n当入站邮件经过扫描并触发警报时，`Sublime Security`会启动此工作流。\\n\\n若Sublime Security设置为自动隔离邮件，本工作流将通过Slack尝试通知收件人。为此，系统将使用收件人邮箱地址查询其对应的Slack用户名。\\n\\n若被标记邮件已被打开，此工作流还将创建Jira工单以跟进事件。\\n\\n## **HTTP请求节点要求**\\n1. 在Sublime Security中创建[启用自动隔离功能](https://docs.sublimesecurity.com/docs/quarantine)的规则\\n2. 在Sublime中[创建Webhook](https://docs.sublimesecurity.com/docs/webhooks)，当选定规则触发时向`接收Sublime安全警报`节点发送警报\\n\\n## **凭证配置**\\n- Sublime Security：获取[Sublime Security API密钥](https://docs.sublimesecurity.com/reference/authentication#create-an-api-key)，以Header Auth格式`Authorization: Bearer YOUR-API-KEY`保存为n8n凭证\\n\\n- Slack：提供具有`users:read.email`和`im:write`权限范围的Slack应用凭证\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8255a3f7-fcda-4d93-97c3-4d223778014f\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1220,\n        175.18665303995851\n      ],\n      \"parameters\": {\n        \"width\": 714.4547337311393,\n        \"height\": 522.7074838611178,\n        \"content\": \"![Slack](https://i.imgur.com/iKyMV0N.png)\\n## 尝试查找被隔离邮件用户的Slack用户名\\n在掌握被隔离邮件的详细信息后，n8n尝试通过Slack通知用户。消息中会说明邮件缺失的原因、提供识别详情，并指导用户若认为该邮件安全时应采取的后续操作。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c149a4b8-4f12-4018-a1dc-dfbed9e081eb\",\n      \"name\": \"Found, notify user\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"position\": [\n        1700,\n        400\n      ],\n      \"parameters\": {\n        \"text\": \"=Hello,\\nOur security team has detected a potentially malicious email sent to your inbox and have quarantined it undergoing investigation.\\n\\nFrom: {{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"display_name\\\"] }} | {{ $('Get message details in Sublime Security').item.json[\\\"sender\\\"][\\\"email\\\"] }}\\nSubject: {{ $('Get message details in Sublime Security').item.json[\\\"subject\\\"] }}\\n\\nIf you believe that the email is not malicious and was intended for you, please contact IT, referencing email ID `{{ $('Get message details in Sublime Security').item.json[\\\"id\\\"] }}`.\\n\\nThe email may be restored by IT if it is determined to be safe.\\n\\nThank you for helping keep the company secure!\",\n        \"user\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.user.id }}\"\n        },\n        \"select\": \"user\",\n        \"otherOptions\": {}\n      },\n      \"credentials\": {\n        \"slackApi\": {\n          \"id\": \"350\",\n          \"name\": \"n8n License Token\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"04712fdf-0409-4f9d-bd0b-7e40af9ffade\",\n      \"name\": \"Not Found, Do Nothing\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        1700,\n        560\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c9f8ede6-1886-4779-a4e8-3c32e12d6aae\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1220,\n        710.6363009271314\n      ],\n      \"parameters\": {\n        \"width\": 718.1630306649816,\n        \"height\": 516.9144812801944,\n        \"content\": \"![Jira](https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Jira_%28Software%29_logo.svg/320px-Jira_%28Software%29_logo.svg.png)\\n## 若用户在隔离前已打开邮件，则创建Jira工单\\n当邮件在隔离措施生效前被用户打开时，n8n将自动创建Jira工单以便深入调查。这一机制确保了对绕过初始隔离措施潜在威胁的快速响应，凸显了n8n在事件响应工作流中的关键作用。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a75d35a2-eefa-490c-9a05-9474a1e093fb\",\n      \"name\": \"No, do nothing\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        1500,\n        1080\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8c44c4fb-ec26-4005-b17b-ac8a9ef79721\",\n      \"name\": \"Yes, prep flaggedRules table\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1500,\n        900\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"console.log($(\\\"Receive Sublime Security Alert\\\").item.json.body);\\n\\nconst table = $(\\\"Receive Sublime Security Alert\\\")\\n  .item.json.body.data.flagged_rules.map(\\n    (rule) => `|${rule.name}|${rule.severity}|${rule.tags.join(\\\",\\\")}|${rule.id}`\\n  )\\n  .join(\\\"\\\\n\\\");\\n\\nconsole.log(table);\\n\\nreturn {\\n  table\\n}\\n\"\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {\n    \"Receive Sublime Security Alert\": [\n      {\n        \"json\": {\n          \"body\": {\n            \"data\": {\n              \"messageId\": \"d61efe63-b350-4436-bccf-936a7e54503b\",\n              \"flagged_rules\": [\n                {\n                  \"id\": 1,\n                  \"name\": \"rule 1\",\n                  \"tags\": [\n                    \"tag-1\",\n                    \"tag-2\"\n                  ],\n                  \"severity\": \"high\"\n                },\n                {\n                  \"id\": 2,\n                  \"name\": \"rule 2\",\n                  \"tags\": [\n                    \"tag-2\",\n                    \"tag-3\"\n                  ],\n                  \"severity\": \"low\"\n                }\n              ]\n            }\n          },\n          \"query\": {},\n          \"params\": {},\n          \"headers\": {}\n        }\n      }\n    ],\n    \"Get message details in Sublime Security\": [\n      {\n        \"json\": {\n          \"id\": \"d61efe63-b350-4436-bccf-936a7e54503b\",\n          \"sender\": {\n            \"email\": \"a.sender@gmail.com\",\n            \"display_name\": \"A. Sender\"\n          },\n          \"mailbox\": {\n            \"id\": \"3e51603f-c2cb-4807-bc34-022994b0d149\",\n            \"email\": \"john.doe@example.io\",\n            \"external_id\": null\n          },\n          \"read_at\": \"2023-09-06T11:49:20.355807Z\",\n          \"subject\": \"test subject\",\n          \"created_at\": \"2023-09-06T11:49:20.355807Z\",\n          \"recipients\": [\n            {\n              \"email\": \"john.doe@example.io\"\n            }\n          ],\n          \"replied_at\": null,\n          \"external_id\": \"3\",\n          \"canonical_id\": \"1173a16af634b58191cd11291aac39e06dfa418a0140522b4875385c544da511\",\n          \"forwarded_at\": null,\n          \"message_source_id\": \"0ba6712e-6d92-4df8-b6f3-198dcfac08d5\",\n          \"forward_recipients\": []\n        }\n      }\n    ]\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"cfa69dd2-286b-46ae-bc6b-6b4086bc8a20\",\n  \"connections\": {\n    \"user found?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Found, notify user\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Not Found, Do Nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"has email been opened?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Yes, prep flaggedRules table\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"lookup slack user by email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"user found?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Yes, prep flaggedRules table\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Jira Software\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Receive Sublime Security Alert\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get message details in Sublime Security\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get message details in Sublime Security\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"has email been opened?\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"lookup slack user by email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
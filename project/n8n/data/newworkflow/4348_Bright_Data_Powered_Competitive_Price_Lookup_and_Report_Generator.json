{
  "url": "https://n8n.io/workflows/4348-bright-data-powered-competitive-price-lookup-and-report-generator/",
  "title": "Bright Data-Powered Competitive Price Lookup and Report Generator",
  "author": "Gleb D",
  "publish_date": "Last update a day ago",
  "publish_date_absolute": "",
  "categories": [
    {
      "name": "AI"
    },
    {
      "name": "Marketing"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"71eb5622cf8abac565805540c0900dbae437dddbda45bf1b87bf3bfeea26393c\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"588abc91-e839-4f69-b5b1-dcd33b6bcd48\",\"name\":\"When clicking ‘Test workflow’\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[-460,-80],\"parameters\":{},\"typeVersion\":1},{\"id\":\"2481cb1d-6309-4e32-970c-3b68c556758f\",\"name\":\"Google Sheets\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[-180,-80],\"parameters\":{\"options\":{},\"sheetName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gid=0\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Jf8qNEg-KTh__aZ8L5YS5iMmBZLEEKCYipIszWARCmw/edit#gid=0\",\"cachedResultName\":\"input\"},\"documentId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1Jf8qNEg-KTh__aZ8L5YS5iMmBZLEEKCYipIszWARCmw\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Jf8qNEg-KTh__aZ8L5YS5iMmBZLEEKCYipIszWARCmw/edit?usp=drivesdk\",\"cachedResultName\":\"Items\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"xEyma1PCHrpnF0ZW\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.5},{\"id\":\"e165f017-7abf-4a5c-82d4-97013b25b582\",\"name\":\"Wait 30s - Polling Bright Data\",\"type\":\"n8n-nodes-base.wait\",\"position\":[480,-440],\"webhookId\":\"8005a2b3-2195-479e-badb-d90e4240e699\",\"parameters\":{\"amount\":30},\"executeOnce\":false,\"typeVersion\":1.1},{\"id\":\"8cbd727d-9104-4d40-8ec2-0a4718c0e4e0\",\"name\":\"Snapshot Progress\",\"type\":\"n8n-nodes-brightdata.brightData\",\"position\":[700,-440],\"parameters\":{\"resource\":\"marketplaceDataset\",\"operation\":\"getSnapshotMetadata\",\"snapshot_id\":\"={{ $json.snapshot_id }}\"},\"credentials\":{\"brightdataApi\":{\"id\":\"M05NojNBUiV9U7KO\",\"name\":\"BrightData account\"}},\"typeVersion\":1},{\"id\":\"0ce012a2-6827-4128-9642-c22f97f5a89d\",\"name\":\"Snapshot Content\",\"type\":\"n8n-nodes-brightdata.brightData\",\"position\":[360,40],\"parameters\":{\"resource\":\"marketplaceDataset\",\"operation\":\"getSnapshotContent\",\"snapshot_id\":\"={{ $('Snapshot Request').item.json.snapshot_id }}\"},\"credentials\":{\"brightdataApi\":{\"id\":\"M05NojNBUiV9U7KO\",\"name\":\"BrightData account\"}},\"typeVersion\":1},{\"id\":\"3b4c2dc2-9191-411d-b9eb-1c9038b3e82c\",\"name\":\"Snapshot Request\",\"type\":\"n8n-nodes-brightdata.brightData\",\"position\":[260,-440],\"parameters\":{\"resource\":\"marketplaceDataset\",\"operation\":\"filterDataset\",\"dataset_id\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gd_ltppk50q18kdw67omz\",\"cachedResultName\":\"Google Shopping\"},\"filter_type\":\"filters_group\",\"filters_group\":\"={\\\"operator\\\":\\\"and\\\",\\\"filters\\\":[{\\\"name\\\":\\\"title\\\",\\\"operator\\\":\\\"includes\\\",\\\"value\\\":\\\"{{$json.title}}\\\"},\\n{\\\"name\\\":\\\"item_price\\\",\\\"operator\\\":\\\"is_not_null\\\"}]}\"},\"credentials\":{\"brightdataApi\":{\"id\":\"M05NojNBUiV9U7KO\",\"name\":\"BrightData account\"}},\"typeVersion\":1},{\"id\":\"1421cc56-469e-4a7a-8a73-c3f8aff795c1\",\"name\":\"If - Checking status of Snapshot\",\"type\":\"n8n-nodes-base.if\",\"position\":[920,-440],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"7932282b-71bb-4bbb-ab73-4978e554de7e\",\"operator\":{\"type\":\"string\",\"operation\":\"notEquals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"running\"}]}},\"typeVersion\":2.2},{\"id\":\"f774e258-3da9-4ad9-8843-04814ac64ec0\",\"name\":\"Check if snapshot ready\",\"type\":\"n8n-nodes-base.if\",\"position\":[800,40],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"645d85d3-c5cc-4e51-a989-075c0a851449\",\"operator\":{\"type\":\"boolean\",\"operation\":\"false\",\"singleValue\":true},\"leftValue\":\"={{ $json.isArray}}\",\"rightValue\":\"false\"}]}},\"typeVersion\":2.2},{\"id\":\"e434c805-06f3-4497-b21c-897ff7aab9d4\",\"name\":\"Loop Over Items\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[100,-80],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"30e1f4f1-9cee-493f-9b52-0998ebd2c2da\",\"name\":\"If - Checking status for errors\",\"type\":\"n8n-nodes-base.if\",\"position\":[1140,-380],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"7932282b-71bb-4bbb-ab73-4978e554de7e\",\"operator\":{\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.status }}\",\"rightValue\":\"failed\"}]}},\"typeVersion\":2.2},{\"id\":\"ff36ddb4-c22a-4bf7-9776-a12ffbad0280\",\"name\":\"Code - Check If Snapshot is built\",\"type\":\"n8n-nodes-base.code\",\"position\":[580,40],\"parameters\":{\"jsCode\":\"const value = $json.items;\\nconst isArray = Array.isArray(value);\\n\\nreturn [\\n  {\\n    json: {\\n      isArray: isArray,\\n      original: value\\n    }\\n  }\\n];\"},\"typeVersion\":2},{\"id\":\"036893c2-57f7-4e69-a617-9c8f256d33cf\",\"name\":\"Code - Extract Necessary Data\",\"type\":\"n8n-nodes-base.code\",\"position\":[1020,40],\"parameters\":{\"jsCode\":\"const input = items[0].json.original;\\nconst posts = Array.isArray(input) ? input : [];\\n\\n// Фильтруем те, где item_price присутствует\\nconst filteredPosts = posts.filter(post =>\\n  post && post.item_price !== null && post.item_price !== undefined\\n);\\n\\n// Оставляем только нужные поля\\nconst extracted = filteredPosts.map(post => {\\n  return {\\n    price: post.item_price,\\n    seller_name: post.seller_name || null,\\n    title: post.title || null,\\n    url: post.url || null,\\n  };\\n});\\n\\nreturn [\\n  {\\n    json: {\\n      items: extracted\\n    }\\n  }\\n];\\n\"},\"typeVersion\":2},{\"id\":\"dfa86828-7bcf-423f-ad24-8b1a39d92d50\",\"name\":\"Email Report\",\"type\":\"n8n-nodes-base.emailSend\",\"position\":[2020,240],\"webhookId\":\"1e6e9588-2bc6-4f05-8531-2d7ca8348d0c\",\"parameters\":{\"html\":\"={{ $json.html }}\",\"options\":{},\"subject\":\"=Your N8N report about {{ $('Loop Over Items').item.json.title }}\",\"toEmail\":\"jotunheim166@gmail.com\",\"fromEmail\":\"n8n-mail@example.com\"},\"credentials\":{\"smtp\":{\"id\":\"2TLeEvocq163Riy6\",\"name\":\"SMTP account\"}},\"typeVersion\":2.1},{\"id\":\"1194906b-74d1-4cee-9429-7d9168ee97a5\",\"name\":\"Error message (replace with webhook/other notifier if needed)\",\"type\":\"n8n-nodes-base.set\",\"position\":[1380,-300],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"c1137a35-0854-4af2-b22d-6d7817f2a2f2\",\"name\":\"message\",\"type\":\"string\",\"value\":\"=Bright Data snapshot error for item \\\"{{ $('Loop Over Items').item.json.title }}\\\": \\n{{ $('Snapshot Progress').item.json.warning }}\"}]}},\"typeVersion\":3.4},{\"id\":\"a9f8c6fb-b8c4-45bf-a452-20544dd2b72f\",\"name\":\"Google Gemini Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[1260,260],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"vZJIC5jaE984SWu3\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"9f3f912d-9d9a-4269-86a2-e6edbe26c793\",\"name\":\"Compare Prices and Generate Report\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[1240,40],\"parameters\":{\"text\":\"={{$json}}\",\"messages\":{\"messageValues\":[{\"message\":\"=Analyze these listings from Google Shopping and identify the top 20 sources (stores or websites) offering the lowest prices. Provide a ranked list including the seller name, product price, and link to the listing if available. Ensure all product names match or are highly relevent to {{ $('Loop Over Items').item }}. Don't start your answer with 'Okay'. Return all the text as Markdown.\"}]},\"promptType\":\"define\"},\"typeVersion\":1.6},{\"id\":\"8b564b07-5f07-4d45-b3c2-203e56d23617\",\"name\":\"Markdown\",\"type\":\"n8n-nodes-base.markdown\",\"position\":[1620,40],\"parameters\":{\"mode\":\"markdownToHtml\",\"options\":{},\"markdown\":\"={{ $json.text }}\",\"destinationKey\":\"html\"},\"typeVersion\":1},{\"id\":\"67e40e23-e514-435f-8795-81e8112b2234\",\"name\":\"Code - Build HTML\",\"type\":\"n8n-nodes-base.code\",\"position\":[1840,40],\"parameters\":{\"jsCode\":\"const rawHtml = $json.html;\\n\\nreturn [{\\n  json: {\\n    html: `\\n      <html>\\n        <head>\\n          <style>\\n            body { font-family: Arial, sans-serif; line-height: 1.5; font-size: 15px; }\\n            h1, h2, h3 { color: #333; }\\n            a { color: #1a73e8; text-decoration: none; }\\n            ul { padding-left: 20px; }\\n            li { margin-bottom: 6px; }\\n          </style>\\n        </head>\\n        <body>\\n          ${rawHtml}\\n        </body>\\n      </html>\\n    `\\n  }\\n}];\"},\"typeVersion\":2},{\"id\":\"613822ea-6e5c-4aba-a4c5-84a1a696a446\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-240,80],\"parameters\":{\"height\":240,\"content\":\"⚠️ Note\\nItem searching in the dataset is case-sensitive.\\n\\nMake sure that the item names in your table are typed correctly.\\nFor example:\\nUse \\\"Iphone\\\" instead of \\\"iphone\\\", \\\"GeForce\\\" instead of \\\"Geforce\\\", and so on.\\n\\nOtherwise, your search may return zero results.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Markdown\":{\"main\":[[{\"node\":\"Code - Build HTML\",\"type\":\"main\",\"index\":0}]]},\"Email Report\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Google Sheets\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Loop Over Items\":{\"main\":[[],[{\"node\":\"Snapshot Request\",\"type\":\"main\",\"index\":0}]]},\"Snapshot Content\":{\"main\":[[{\"node\":\"Code - Check If Snapshot is built\",\"type\":\"main\",\"index\":0}]]},\"Snapshot Request\":{\"main\":[[{\"node\":\"Wait 30s - Polling Bright Data\",\"type\":\"main\",\"index\":0}]]},\"Code - Build HTML\":{\"main\":[[{\"node\":\"Email Report\",\"type\":\"main\",\"index\":0}]]},\"Snapshot Progress\":{\"main\":[[{\"node\":\"If - Checking status of Snapshot\",\"type\":\"main\",\"index\":0}]]},\"Check if snapshot ready\":{\"main\":[[{\"node\":\"Snapshot Content\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Code - Extract Necessary Data\",\"type\":\"main\",\"index\":0}]]},\"Google Gemini Chat Model\":{\"ai_languageModel\":[[{\"node\":\"Compare Prices and Generate Report\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Code - Extract Necessary Data\":{\"main\":[[{\"node\":\"Compare Prices and Generate Report\",\"type\":\"main\",\"index\":0}]]},\"Wait 30s - Polling Bright Data\":{\"main\":[[{\"node\":\"Snapshot Progress\",\"type\":\"main\",\"index\":0}]]},\"If - Checking status for errors\":{\"main\":[[{\"node\":\"Error message (replace with webhook/other notifier if needed)\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Snapshot Content\",\"type\":\"main\",\"index\":0}]]},\"If - Checking status of Snapshot\":{\"main\":[[{\"node\":\"If - Checking status for errors\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Wait 30s - Polling Bright Data\",\"type\":\"main\",\"index\":0}]]},\"Code - Check If Snapshot is built\":{\"main\":[[{\"node\":\"Check if snapshot ready\",\"type\":\"main\",\"index\":0}]]},\"When clicking ‘Test workflow’\":{\"main\":[[{\"node\":\"Google Sheets\",\"type\":\"main\",\"index\":0}]]},\"Compare Prices and Generate Report\":{\"main\":[[{\"node\":\"Markdown\",\"type\":\"main\",\"index\":0}]]},\"Error message (replace with webhook/other notifier if needed)\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This n8n workflow automates the collection, enrichment, and analysis of e-commerce product listings using Bright Data and AI, then delivers an HTML email report with the most competitive offers.\n\n🚀 **What It Does**\n\n  * Pulls product titles from a Google Sheet.\n  * For each product, searches a Bright Data marketplace dataset (Google Shopping) for available listings.\n  * Extracts relevant fields: price, title, seller name, and listing URL.\n  * Sends this data to Google Gemini for AI-powered Markdown report generation.\n  * Converts Markdown to HTML and styles the output for better email rendering.\n  * Sends an email report for each product with the top 20 most affordable offers.\n\n\n\n🛠️ **Step-by-Step Setup**\n\n  * Load product list from Google Sheets.\n  * For each product title, run a Bright Data filter request (case-sensitive match).\n  * Poll the snapshot status until it is ready.\n  * Retrieve snapshot content and clean the results with a Code node.\n  * Pass the results to Gemini (PaLM/Gemini Flash) for analysis and report generation in Markdown.\n  * Convert Markdown into styled HTML using Markdown + Code nodes.\n  * Send formatted email to a predefined recipient.\n  * Return to the loop and repeat for the next product.\n\n\n\n🧠 **How It Works**\n\n  * Loop Control: SplitInBatches handles product-by-product processing.\n  * Snapshot Handling: Snapshot status is polled every 30s until success/failure.\n  * AI Formatting: Gemini summarizes listings and formats content.\n  * Error Handling: Failed snapshots produce a warning message and resume the loop.\n\n\n\n📨 **Final Output**\n\n  * Each email contains:\n  * The product name\n  * A clean HTML of up to 20 sellers with lowest prices\n  * Links to listings\n  * AI-generated pricing summary\n\n\n\n🔐 **Credentials Used**\n\n  * Bright Data account\n  * Google Gemini (PaLM/Gemini Flash)\n  * Google Sheets (OAuth2)\n  * SMTP Email (emailSend node)\n\n\n\n⚠️ **Important Notes**\n\n  * Item title search is case-sensitive. Typos or casing mismatches may result in no results.\n  * Requires **n8n-nodes-brightdata community node** to be installed.\n\n\n",
  "crawled_at": "2025-05-27T23:09:52.735106",
  "readme_zh": "该n8n工作流通过Bright Data与AI技术实现电商商品列表的自动采集、数据增强及分析，最终生成包含最具竞争力报价的HTML邮件报告。\n\n🚀 **核心功能**\n\n  * 从Google表格提取商品名称\n  * 通过Bright Data市场数据集（Google Shopping）检索每个商品的在线报价\n  * 提取关键字段：价格、标题、商家名称及商品链接\n  * 将数据发送至Google Gemini生成AI驱动的Markdown报告\n  * 将Markdown转换为HTML并优化样式以适应邮件展示\n  * 为每个商品发送包含前20名最优惠报价的邮件报告",
  "title_zh": "亮数据驱动的竞争性价格查询与报告生成器",
  "publish_date_zh": "最近更新于一天前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"71eb5622cf8abac565805540c0900dbae437dddbda45bf1b87bf3bfeea26393c\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"588abc91-e839-4f69-b5b1-dcd33b6bcd48\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -460,\n        -80\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2481cb1d-6309-4e32-970c-3b68c556758f\",\n      \"name\": \"Google Sheets\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        -180,\n        -80\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1Jf8qNEg-KTh__aZ8L5YS5iMmBZLEEKCYipIszWARCmw/edit#gid=0\",\n          \"cachedResultName\": \"input\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1Jf8qNEg-KTh__aZ8L5YS5iMmBZLEEKCYipIszWARCmw\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1Jf8qNEg-KTh__aZ8L5YS5iMmBZLEEKCYipIszWARCmw/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Items\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"xEyma1PCHrpnF0ZW\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"e165f017-7abf-4a5c-82d4-97013b25b582\",\n      \"name\": \"Wait 30s - Polling Bright Data\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        480,\n        -440\n      ],\n      \"webhookId\": \"8005a2b3-2195-479e-badb-d90e4240e699\",\n      \"parameters\": {\n        \"amount\": 30\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"8cbd727d-9104-4d40-8ec2-0a4718c0e4e0\",\n      \"name\": \"Snapshot Progress\",\n      \"type\": \"n8n-nodes-brightdata.brightData\",\n      \"position\": [\n        700,\n        -440\n      ],\n      \"parameters\": {\n        \"resource\": \"marketplaceDataset\",\n        \"operation\": \"getSnapshotMetadata\",\n        \"snapshot_id\": \"={{ $json.snapshot_id }}\"\n      },\n      \"credentials\": {\n        \"brightdataApi\": {\n          \"id\": \"M05NojNBUiV9U7KO\",\n          \"name\": \"BrightData account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0ce012a2-6827-4128-9642-c22f97f5a89d\",\n      \"name\": \"Snapshot Content\",\n      \"type\": \"n8n-nodes-brightdata.brightData\",\n      \"position\": [\n        360,\n        40\n      ],\n      \"parameters\": {\n        \"resource\": \"marketplaceDataset\",\n        \"operation\": \"getSnapshotContent\",\n        \"snapshot_id\": \"={{ $('Snapshot Request').item.json.snapshot_id }}\"\n      },\n      \"credentials\": {\n        \"brightdataApi\": {\n          \"id\": \"M05NojNBUiV9U7KO\",\n          \"name\": \"BrightData account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3b4c2dc2-9191-411d-b9eb-1c9038b3e82c\",\n      \"name\": \"Snapshot Request\",\n      \"type\": \"n8n-nodes-brightdata.brightData\",\n      \"position\": [\n        260,\n        -440\n      ],\n      \"parameters\": {\n        \"resource\": \"marketplaceDataset\",\n        \"operation\": \"filterDataset\",\n        \"dataset_id\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gd_ltppk50q18kdw67omz\",\n          \"cachedResultName\": \"Google Shopping\"\n        },\n        \"filter_type\": \"filters_group\",\n        \"filters_group\": \"={\\\"operator\\\":\\\"and\\\",\\\"filters\\\":[{\\\"name\\\":\\\"title\\\",\\\"operator\\\":\\\"includes\\\",\\\"value\\\":\\\"{{$json.title}}\\\"},\\n{\\\"name\\\":\\\"item_price\\\",\\\"operator\\\":\\\"is_not_null\\\"}]}\"\n      },\n      \"credentials\": {\n        \"brightdataApi\": {\n          \"id\": \"M05NojNBUiV9U7KO\",\n          \"name\": \"BrightData account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1421cc56-469e-4a7a-8a73-c3f8aff795c1\",\n      \"name\": \"If - Checking status of Snapshot\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        920,\n        -440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"7932282b-71bb-4bbb-ab73-4978e554de7e\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEquals\"\n              },\n              \"leftValue\": \"={{ $json.status }}\",\n              \"rightValue\": \"running\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"f774e258-3da9-4ad9-8843-04814ac64ec0\",\n      \"name\": \"Check if snapshot ready\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        800,\n        40\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"645d85d3-c5cc-4e51-a989-075c0a851449\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"false\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.isArray}}\",\n              \"rightValue\": \"false\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"e434c805-06f3-4497-b21c-897ff7aab9d4\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        100,\n        -80\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"30e1f4f1-9cee-493f-9b52-0998ebd2c2da\",\n      \"name\": \"If - Checking status for errors\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1140,\n        -380\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"7932282b-71bb-4bbb-ab73-4978e554de7e\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.status }}\",\n              \"rightValue\": \"failed\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"ff36ddb4-c22a-4bf7-9776-a12ffbad0280\",\n      \"name\": \"Code - Check If Snapshot is built\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        580,\n        40\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const value = $json.items;\\nconst isArray = Array.isArray(value);\\n\\nreturn [\\n  {\\n    json: {\\n      isArray: isArray,\\n      original: value\\n    }\\n  }\\n];\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"036893c2-57f7-4e69-a617-9c8f256d33cf\",\n      \"name\": \"Code - Extract Necessary Data\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1020,\n        40\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const input = items[0].json.original;\\nconst posts = Array.isArray(input) ? input : [];\\n\\n// Фильтруем те, где item_price присутствует\\nconst filteredPosts = posts.filter(post =>\\n  post && post.item_price !== null && post.item_price !== undefined\\n);\\n\\n// Оставляем только нужные поля\\nconst extracted = filteredPosts.map(post => {\\n  return {\\n    price: post.item_price,\\n    seller_name: post.seller_name || null,\\n    title: post.title || null,\\n    url: post.url || null,\\n  };\\n});\\n\\nreturn [\\n  {\\n    json: {\\n      items: extracted\\n    }\\n  }\\n];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"dfa86828-7bcf-423f-ad24-8b1a39d92d50\",\n      \"name\": \"Email Report\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        2020,\n        240\n      ],\n      \"webhookId\": \"1e6e9588-2bc6-4f05-8531-2d7ca8348d0c\",\n      \"parameters\": {\n        \"html\": \"={{ $json.html }}\",\n        \"options\": {},\n        \"subject\": \"=Your N8N report about {{ $('Loop Over Items').item.json.title }}\",\n        \"toEmail\": \"jotunheim166@gmail.com\",\n        \"fromEmail\": \"n8n-mail@example.com\"\n      },\n      \"credentials\": {\n        \"smtp\": {\n          \"id\": \"2TLeEvocq163Riy6\",\n          \"name\": \"SMTP account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"1194906b-74d1-4cee-9429-7d9168ee97a5\",\n      \"name\": \"Error message (replace with webhook/other notifier if needed)\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1380,\n        -300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"c1137a35-0854-4af2-b22d-6d7817f2a2f2\",\n              \"name\": \"message\",\n              \"type\": \"string\",\n              \"value\": \"=Bright Data snapshot error for item \\\"{{ $('Loop Over Items').item.json.title }}\\\": \\n{{ $('Snapshot Progress').item.json.warning }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"a9f8c6fb-b8c4-45bf-a452-20544dd2b72f\",\n      \"name\": \"Google Gemini Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        1260,\n        260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"vZJIC5jaE984SWu3\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9f3f912d-9d9a-4269-86a2-e6edbe26c793\",\n      \"name\": \"Compare Prices and Generate Report\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        1240,\n        40\n      ],\n      \"parameters\": {\n        \"text\": \"={{$json}}\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"=Analyze these listings from Google Shopping and identify the top 20 sources (stores or websites) offering the lowest prices. Provide a ranked list including the seller name, product price, and link to the listing if available. Ensure all product names match or are highly relevent to {{ $('Loop Over Items').item }}. Don't start your answer with 'Okay'. Return all the text as Markdown.\"\n            }\n          ]\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.6\n    },\n    {\n      \"id\": \"8b564b07-5f07-4d45-b3c2-203e56d23617\",\n      \"name\": \"Markdown\",\n      \"type\": \"n8n-nodes-base.markdown\",\n      \"position\": [\n        1620,\n        40\n      ],\n      \"parameters\": {\n        \"mode\": \"markdownToHtml\",\n        \"options\": {},\n        \"markdown\": \"={{ $json.text }}\",\n        \"destinationKey\": \"html\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"67e40e23-e514-435f-8795-81e8112b2234\",\n      \"name\": \"Code - Build HTML\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1840,\n        40\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const rawHtml = $json.html;\\n\\nreturn [{\\n  json: {\\n    html: `\\n      <html>\\n        <head>\\n          <style>\\n            body { font-family: Arial, sans-serif; line-height: 1.5; font-size: 15px; }\\n            h1, h2, h3 { color: #333; }\\n            a { color: #1a73e8; text-decoration: none; }\\n            ul { padding-left: 20px; }\\n            li { margin-bottom: 6px; }\\n          </style>\\n        </head>\\n        <body>\\n          ${rawHtml}\\n        </body>\\n      </html>\\n    `\\n  }\\n}];\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"613822ea-6e5c-4aba-a4c5-84a1a696a446\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -240,\n        80\n      ],\n      \"parameters\": {\n        \"height\": 240,\n        \"content\": \"⚠️ 注意  \\n数据集中的物品搜索区分大小写。  \\n\\n请确保表格中的物品名称拼写正确。  \\n例如：  \\n使用 \\\"Iphone\\\" 而非 \\\"iphone\\\"，\\\"GeForce\\\" 而非 \\\"Geforce\\\"，以此类推。  \\n\\n否则，您的搜索可能返回零结果。\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Markdown\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code - Build HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Email Report\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Sheets\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"Snapshot Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Snapshot Content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code - Check If Snapshot is built\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Snapshot Request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait 30s - Polling Bright Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Code - Build HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Email Report\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Snapshot Progress\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If - Checking status of Snapshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check if snapshot ready\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Snapshot Content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Code - Extract Necessary Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Gemini Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Compare Prices and Generate Report\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Code - Extract Necessary Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Compare Prices and Generate Report\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait 30s - Polling Bright Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Snapshot Progress\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If - Checking status for errors\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Error message (replace with webhook/other notifier if needed)\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Snapshot Content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If - Checking status of Snapshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If - Checking status for errors\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Wait 30s - Polling Bright Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Code - Check If Snapshot is built\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check if snapshot ready\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Sheets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Compare Prices and Generate Report\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Markdown\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Error message (replace with webhook/other notifier if needed)\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
{
  "url": "https://n8n.io/workflows/1978-personalize-marketing-emails-using-customer-data-and-ai/",
  "title": "Personalize marketing emails using customer data and AI",
  "author": "n8n Team",
  "publish_date": "Last update 2 months ago",
  "publish_date_absolute": "2025-03-25",
  "categories": [
    {
      "name": "AI"
    },
    {
      "name": "Marketing"
    }
  ],
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"9681490a-68f1-4c6a-86ea-bf2331c3125d\",\"name\":\"When clicking \\\"Execute Workflow\\\"\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[-600,1040],\"parameters\":{},\"typeVersion\":1},{\"id\":\"f665f0c6-7694-456f-b877-5f8d69b9f503\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-680,920],\"parameters\":{\"width\":715.3278290432247,\"height\":315.32782904322477,\"content\":\"## Get and prepare Dummy Data\"},\"typeVersion\":1},{\"id\":\"79a9ece6-daa5-4cc0-bfb8-5cf8c9e81296\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[340,480],\"parameters\":{\"width\":520.9323109877616,\"height\":577.5426854600692,\"content\":\"## Let GPT do the heavy work\\n\\nFor the prompt we follow the one-shot'ish principle. Also I've decided to **_NOT_** give the AI the personal data. Keeps it simpler regarding data privacy.\\n\\nThe AI-Chain will generate a **Headline** and the **Text** for the Email and even **decides** if we should send the user a **Coupon**.\"},\"typeVersion\":1},{\"id\":\"51e1bc15-0b9e-4d53-9b99-0ec8ed5e00f8\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2240,620],\"parameters\":{\"width\":358,\"height\":324,\"content\":\"## HTML Email-Template without Coupon\"},\"typeVersion\":1},{\"id\":\"ee29375a-77fe-4d13-a453-c8b62f0884a7\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1100,880],\"parameters\":{\"width\":447,\"height\":465,\"content\":\"## Make sure we have what we need\\nWe do not want to sent empty messages to our customers\"},\"typeVersion\":1},{\"id\":\"37e09224-3649-43e0-a40f-f8177aa93cda\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2240,1140],\"parameters\":{\"width\":369.917435648372,\"height\":330.56011245057107,\"content\":\"## HTML Email-Template with Coupon\"},\"typeVersion\":1},{\"id\":\"5147fe48-606d-4dad-9977-2713f40fc8e6\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1880,1140],\"parameters\":{\"width\":319.84249777513367,\"height\":330.6656654860422,\"content\":\"## Mocked: Fake a Coupon Code\\nFor a real life scenario add the automated coupon generation here\"},\"typeVersion\":1},{\"id\":\"6a3ee9b0-540e-4242-a6ac-535e2b23ea3a\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-680,300],\"parameters\":{\"width\":534.1315466553021,\"height\":566.556517486655,\"content\":\"# Documentation\\n\\nThis Workflow is for the n8n AI / Langchain Competition.\\n\\nIt solves the Problem: Personalizing marketing emails based on customer purchase history.\\n\\nI've found it a bit ambiguous and decided to go the \\\"Convert unhappy customers with a Coupon\\\"-Route.\\n\\nSo this workflow utilizes the new LangChain Node for generating personalized E-Mail campaigns and decide if the user might need a coupon to be satisfied. Classic Rebound stuff. \\n\\nThere is also a Node \\\"Some Options...\\\" which can be adjusted to quickly change the direction this Campaign should go.\\n\\nAdditionally we use n8n to generate the HTML Mails by two different Templates. One with simple text and another for that Coupon handling.\\n\\n![Image](https://let-the-work-flow.com/logo-64.png)\\nEnjoy the Workflow! ❤️ \\nhttps://let-the-work-flow.com\\n\"},\"typeVersion\":1},{\"id\":\"01cf3e60-c280-46c1-9971-ccf63a28ab9a\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3040,760],\"parameters\":{\"width\":326.9476248855971,\"height\":414.15459581943776,\"content\":\"## Send the Email to the Customer\\n\\nAlthough it's cool that n8n allows sending emails via SMPT I would recommend to stick to your newsletter tool for that to keep track of opt-outs and stuff.\"},\"typeVersion\":1},{\"id\":\"6c458bf6-ea7b-43b5-bc65-d9ae68542a8c\",\"name\":\"Extract from File\",\"type\":\"n8n-nodes-base.extractFromFile\",\"position\":[-160,1040],\"parameters\":{\"options\":{},\"operation\":\"xls\"},\"typeVersion\":1},{\"id\":\"780dd707-4493-4679-9064-acc3c59011f8\",\"name\":\"Some Options for the Campaign\",\"type\":\"n8n-nodes-base.set\",\"position\":[140,1040],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"8ef766db-4ad1-43c7-b621-8ea3ed0a44b2\",\"name\":\"Campaign Target\",\"type\":\"string\",\"value\":\"Engage the Customer\"},{\"id\":\"9f9ce88a-a24a-4a27-8b25-25ee85e730d6\",\"name\":\"Flavour\",\"type\":\"string\",\"value\":\"be friendly and witty but also cool and direct. Critique is valuable and embrace the feedback.\"}]},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"3b152bdc-acb8-4f37-8b91-1ab02c0e9532\",\"name\":\"Information Extractor\",\"type\":\"@n8n/n8n-nodes-langchain.informationExtractor\",\"position\":[480,700],\"parameters\":{\"text\":\"=Item Purchased: {{ $json['Item Purchased'] }} \\nFeedback: {{ $json.Feedback }}\\nShould we send a coupon to make the customer happy? Yes/No\",\"options\":{\"systemPromptTemplate\":\"=Determine the sentiment of the given product feedback. Then generate a Headline and Text without salutation or any greeting for a personalized Email Campagin after a User gave a product review. If the user seems not happy, tell them that you have a Coupon for them. The User finds the Coupon Code below this E-mail. \\nThe target of the campagin: {{ $json['Campaign Target'] }}.\\nRemember: {{ $json['Flavour'] }}. Avoid any greeting.\\n\"},\"schemaType\":\"manual\",\"inputSchema\":\"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"required\\\": [\\\"Headline\\\",\\\"Body\\\",\\\"SendCoupon\\\"],\\n  \\\"properties\\\": {\\n    \\\"Headline\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"Body\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"SendCoupon\\\": {\\n      \\\"type\\\": \\\"boolean\\\"\\n    }\\n  }\\n}\"},\"typeVersion\":1},{\"id\":\"f597a54e-27e9-46e8-b9d5-46dd54406803\",\"name\":\"OpenAI Chat Model1\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[480,880],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"716e4281-cf18-4cc7-b5ed-4de0308bf9aa\",\"name\":\"AI did fail us1\",\"type\":\"n8n-nodes-base.stopAndError\",\"position\":[1380,1180],\"parameters\":{\"errorMessage\":\"Unexpected Langchain Output\"},\"typeVersion\":1},{\"id\":\"1dc51ad5-e605-4cad-9a5b-3b20eabd9797\",\"name\":\"Fake coupon\",\"type\":\"n8n-nodes-base.set\",\"position\":[1980,1280],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"73989d0e-667f-4227-ab41-4eb1e8c1c10e\",\"name\":\"Coupon\",\"type\":\"string\",\"value\":\"F4k3ItT1llY0uM4k3It\"},{\"id\":\"4d86d8c8-1be3-40b0-b4fd-09f9ffc24386\",\"name\":\"Coupon Value\",\"type\":\"string\",\"value\":\"20% of any purchase\"},{\"id\":\"f73b8a70-5bf6-45c2-8061-d10f95b199a8\",\"name\":\"Coupon Terms\",\"type\":\"string\",\"value\":\"=Valid until {{ $today.plus({days: 14}).format(\\\"d. MMM. y\\\") }} | minimum purchase amount: 20$ \"}]},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"dfa6b376-dd66-40f1-8626-0f3f04e4c4bd\",\"name\":\"Download dummy data\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-380,1040],\"parameters\":{\"url\":\"https://let-the-work-flow.com/dummy/n8n-contest-merch.xlsx\",\"options\":{}},\"typeVersion\":4.2},{\"id\":\"a95ce7c4-c592-40c7-9dfa-db0e37d5b71f\",\"name\":\"AI Output + Prev Data\",\"type\":\"n8n-nodes-base.merge\",\"position\":[940,1040],\"parameters\":{\"mode\":\"combine\",\"options\":{},\"combineBy\":\"combineByPosition\"},\"typeVersion\":3},{\"id\":\"bb0474a1-425c-4a02-a13e-385272091189\",\"name\":\"Is the result valid?\",\"type\":\"n8n-nodes-base.if\",\"position\":[1160,1040],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"9b4ced26-dd86-4ae4-8f69-6177ec42c827\",\"operator\":{\"type\":\"string\",\"operation\":\"notEmpty\",\"singleValue\":true},\"leftValue\":\"Headline\",\"rightValue\":\"\"},{\"id\":\"7723102c-43d2-48df-82f6-5bb45ddf615c\",\"operator\":{\"type\":\"string\",\"operation\":\"notEmpty\",\"singleValue\":true},\"leftValue\":\"Body\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"b39e0b98-6824-4265-94a0-fe12154f2ad4\",\"name\":\"Coupon them or not to Coupon them\",\"type\":\"n8n-nodes-base.if\",\"position\":[1620,1040],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"967f37a1-a600-46a2-82cf-f340dd3c7a96\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ $json.SendCoupon }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"13c4426f-f522-4127-b899-7e6397e18182\",\"name\":\"Html Template for our Email\",\"type\":\"n8n-nodes-base.html\",\"position\":[2360,740],\"parameters\":{\"html\":\"<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\" />\\n  <title>{{ $json['Headline'] }}</title>\\n</head>\\n<body>\\n  <div class=\\\"container\\\">\\n    <img class=\\\"logo\\\" src=\\\"https://img.logoipsum.com/264.svg\\\"/>\\n    <h1>Hey {{ $json['Custome Name'] ? $json['Custome Name']+', ' : '!' }}</h1>\\n    <p>{{ $json['Body'] }}</p>\\n    \\n  <div class=\\\"footer\\\">\\n   <p>\\n    Definitely not a real company Lmt.<br>\\n    Also not a real street 123<br>\\n    Unreal Town\\n   </p>  \\n</div> \\n </div>\\n \\n  \\n</body>\\n</html>\\n\\n<style>\\n.logo {\\n  margin-top: 20px;\\n }\\n.container {\\n  background-color: #ffffff;\\n  font-family: sans-serif;\\n  padding: 16px;\\n  border-radius: 8px;\\n}\\n\\nh1 {\\n  color: #ff6d5a;\\n  font-size: 24px;\\n  font-weight: bold;\\n  margin-top: 30px;\\n}\\n\\np {\\n  color: #606060;\\n  line-height: 1.6;\\n}\\n\\nh2 {\\n  color: #909399;\\n  font-size: 20px;\\n  font-weight: bold;\\n  padding: 8px;\\n}\\n\\n.footer {\\n  margin-top: 30px;\\n}\\n\\n.footer > p {\\n    font-size: 14px;\\n  color: #ccc;\\n }\\n\\n</style>\"},\"typeVersion\":1.2},{\"id\":\"71e36c09-6e24-4eb2-9b1a-4fb3bb4b4536\",\"name\":\"The composed E-Mail + Prev Data\",\"type\":\"n8n-nodes-base.merge\",\"position\":[2740,860],\"parameters\":{\"mode\":\"combine\",\"options\":{},\"combineBy\":\"combineByPosition\"},\"typeVersion\":3},{\"id\":\"a2b6ec8e-1bcf-4216-b9b6-476c0d82f706\",\"name\":\"Html Template for our Email with a Coupon\",\"type\":\"n8n-nodes-base.html\",\"position\":[2360,1280],\"parameters\":{\"html\":\"<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\" />\\n  <title>{{ $json.output['Headline'] }}</title>\\n</head>\\n<body>\\n  <div class=\\\"container\\\">\\n    <img class=\\\"logo\\\" src=\\\"https://img.logoipsum.com/264.svg\\\"/>\\n    <h1>Hey {{ $json['Custome Name'] ? $json['Custome Name']+', ' : '!' }}</h1>\\n    <p>{{ $json.output['Body'] }}</p>\\n    \\n    <div class=\\\"coupon\\\">\\n        <h3>Here's a Coupon for you!<br>\\n        {{ $json['Coupon Value'] }}</h3>\\n        <h4 class=\\\"code\\\">{{ $json['Coupon'] }}</h4>\\n        <p>{{ $json['Coupon Terms'] }}</p>\\n    </div>\\n  <div class=\\\"footer\\\">\\n   <p>\\n    Definitely not a real company Lmt.<br>\\n    Also not a real street 123<br>\\n    Unreal Town\\n   </p>  \\n</div> \\n </div>\\n \\n  \\n</body>\\n</html>\\n\\n<style>\\n.logo {\\n  margin-top: 20px;\\n }\\n.container {\\n  background-color: #ffffff;\\n  font-family: sans-serif;\\n  padding: 16px;\\n  border-radius: 8px;\\n}\\n\\nh1 {\\n  color: #ff6d5a;\\n  font-size: 24px;\\n  font-weight: bold;\\n  margin-top: 30px;\\n}\\n\\np {\\n  color: #606060;\\n  line-height: 1.6;\\n}\\n\\nh2 {\\n  color: #909399;\\n  font-size: 20px;\\n  font-weight: bold;\\n  padding: 8px;\\n}\\n\\n.coupon {\\n  background: #ff6d5a;\\n  color: #fff;\\n  padding: 20px;\\n}\\n.coupon p {\\n  color: #fff;\\n}\\n  \\n.coupon .code {\\n  font-weight: bold;\\n  font-size: 24px;\\n  font-family: monospace;\\n }\\n\\n.footer {\\n  margin-top: 30px;\\n}\\n\\n.footer > p {\\n    font-size: 14px;\\n  color: #ccc;\\n }\\n\\n</style>\"},\"typeVersion\":1.2},{\"id\":\"2d5dd858-cf61-4136-b405-e6ad4a372725\",\"name\":\"The composed E-Mail with Coupon + Prev Data\",\"type\":\"n8n-nodes-base.merge\",\"position\":[2740,1040],\"parameters\":{\"mode\":\"combine\",\"options\":{},\"combineBy\":\"combineByPosition\"},\"typeVersion\":3},{\"id\":\"5b1606b4-903a-4e90-8cf6-01fd92006195\",\"name\":\"Send Email\",\"type\":\"n8n-nodes-base.emailSend\",\"position\":[3140,960],\"webhookId\":\"a155d7b3-39b1-4a96-adc5-4f8e984506ec\",\"parameters\":{\"html\":\"={{ $json.html }}\",\"options\":{},\"subject\":\"={{ $json.output.Headline }}\",\"toEmail\":\"={{ $json.Email }}\",\"fromEmail\":\"n8n@myemail.com\"},\"credentials\":{\"smtp\":{\"id\":\"EagS3depRLAKo3Sw\",\"name\":\"Greenmail SMTP account (bob@example.com)\"}},\"typeVersion\":2.1}],\"pinData\":{},\"connections\":{\"Fake coupon\":{\"main\":[[{\"node\":\"Html Template for our Email with a Coupon\",\"type\":\"main\",\"index\":0}]]},\"Extract from File\":{\"main\":[[{\"node\":\"Some Options for the Campaign\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model1\":{\"ai_languageModel\":[[{\"node\":\"Information Extractor\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Download dummy data\":{\"main\":[[{\"node\":\"Extract from File\",\"type\":\"main\",\"index\":0}]]},\"Is the result valid?\":{\"main\":[[{\"node\":\"Coupon them or not to Coupon them\",\"type\":\"main\",\"index\":0}],[{\"node\":\"AI did fail us1\",\"type\":\"main\",\"index\":0}]]},\"AI Output + Prev Data\":{\"main\":[[{\"node\":\"Is the result valid?\",\"type\":\"main\",\"index\":0}]]},\"Information Extractor\":{\"main\":[[{\"node\":\"AI Output + Prev Data\",\"type\":\"main\",\"index\":0}]]},\"Html Template for our Email\":{\"main\":[[{\"node\":\"The composed E-Mail + Prev Data\",\"type\":\"main\",\"index\":0}]]},\"Some Options for the Campaign\":{\"main\":[[{\"node\":\"Information Extractor\",\"type\":\"main\",\"index\":0},{\"node\":\"AI Output + Prev Data\",\"type\":\"main\",\"index\":1}]]},\"The composed E-Mail + Prev Data\":{\"main\":[[{\"node\":\"Send Email\",\"type\":\"main\",\"index\":0}]]},\"When clicking \\\"Execute Workflow\\\"\":{\"main\":[[{\"node\":\"Download dummy data\",\"type\":\"main\",\"index\":0}]]},\"Coupon them or not to Coupon them\":{\"main\":[[{\"node\":\"Html Template for our Email\",\"type\":\"main\",\"index\":0},{\"node\":\"The composed E-Mail + Prev Data\",\"type\":\"main\",\"index\":1}],[{\"node\":\"Fake coupon\",\"type\":\"main\",\"index\":0},{\"node\":\"The composed E-Mail with Coupon + Prev Data\",\"type\":\"main\",\"index\":0}]]},\"Html Template for our Email with a Coupon\":{\"main\":[[{\"node\":\"The composed E-Mail with Coupon + Prev Data\",\"type\":\"main\",\"index\":1}]]},\"The composed E-Mail with Coupon + Prev Data\":{\"main\":[[{\"node\":\"Send Email\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow uses AI to analyze customer sentiment from product feedback. If the sentiment is negative, AI will determine whether offering a coupon could improve the customer experience.\n\nUpon completing the sentiment analysis, the workflow creates a personalized email templates. This solution streamlines the process of engaging with customers post-purchase, particularly when addressing dissatisfaction, and ensures that outreach is both personalized and automated.\n\nThis workflow won the 1st place in our last AI contest.\n\nNote that to use this template, you need to be on n8n version 1.19.4 or later.\n",
  "crawled_at": "2025-05-25T20:31:20.004973",
  "readme_zh": "This workflow uses AI to analyze customer sentiment from product feedback. If the sentiment is negative, AI will determine whether offering a coupon could improve the customer experience.\n\nUpon completing the sentiment analysis, the workflow creates a personalized email templates. This solution streamlines the process of engaging with customers post-purchase, particularly when addressing dissatisfaction, and ensures that outreach is both personalized and automated.\n\nThis workflow won the 1st place in our last AI contest.\n\nNote that to use this template, you need to be on n8n version 1.19.4 or later.\n",
  "title_zh": "利用客户数据和人工智能个性化营销邮件",
  "publish_date_zh": "上次更新于一个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"9681490a-68f1-4c6a-86ea-bf2331c3125d\",\n      \"name\": \"When clicking \\\"Execute Workflow\\\"\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -600,\n        1040\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f665f0c6-7694-456f-b877-5f8d69b9f503\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -680,\n        920\n      ],\n      \"parameters\": {\n        \"width\": 715.3278290432247,\n        \"height\": 315.32782904322477,\n        \"content\": \"## 获取并准备虚拟数据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"79a9ece6-daa5-4cc0-bfb8-5cf8c9e81296\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        340,\n        480\n      ],\n      \"parameters\": {\n        \"width\": 520.9323109877616,\n        \"height\": 577.5426854600692,\n        \"content\": \"## 让GPT承担繁重工作\\n\\n在提示设计上我们遵循\\\"单样本\\\"原则。同时我已决定**_不_**向AI提供个人数据。这样在数据隐私方面能保持更简洁的处理。\\n\\nAI链将自动生成邮件**标题**和**正文**内容，甚至还会自主**判断**是否应该给用户发送**优惠券**。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"51e1bc15-0b9e-4d53-9b99-0ec8ed5e00f8\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2240,\n        620\n      ],\n      \"parameters\": {\n        \"width\": 358,\n        \"height\": 324,\n        \"content\": \"## 不含优惠券的HTML电子邮件模板\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ee29375a-77fe-4d13-a453-c8b62f0884a7\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1100,\n        880\n      ],\n      \"parameters\": {\n        \"width\": 447,\n        \"height\": 465,\n        \"content\": \"## 确保我们拥有所需的一切\\n我们不想向客户发送空消息\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"37e09224-3649-43e0-a40f-f8177aa93cda\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2240,\n        1140\n      ],\n      \"parameters\": {\n        \"width\": 369.917435648372,\n        \"height\": 330.56011245057107,\n        \"content\": \"## 带优惠券的HTML电子邮件模板\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5147fe48-606d-4dad-9977-2713f40fc8e6\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1880,\n        1140\n      ],\n      \"parameters\": {\n        \"width\": 319.84249777513367,\n        \"height\": 330.6656654860422,\n        \"content\": \"## 模拟操作：伪造优惠券代码\\n在实际应用场景中，此处可添加自动生成优惠券的功能\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6a3ee9b0-540e-4242-a6ac-535e2b23ea3a\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -680,\n        300\n      ],\n      \"parameters\": {\n        \"width\": 534.1315466553021,\n        \"height\": 566.556517486655,\n        \"content\": \"# 文档说明\\n\\n此工作流专为n8n AI/Langchain竞赛设计。\\n\\n它解决的问题是：根据客户购买历史实现营销邮件的个性化定制。\\n\\n鉴于需求描述存在一定模糊性，我选择了\\\"通过优惠券挽回不满客户\\\"的实现路径。\\n\\n该工作流运用了全新的LangChain节点来生成个性化邮件营销内容，并智能判断用户是否需要优惠券来提升满意度——这是经典的客户挽回策略。\\n\\n工作流中还包含一个\\\"可选参数...\\\"节点，通过调整该节点可快速切换整个营销活动的策略方向。\\n\\n此外，我们利用n8n基于两种不同模板生成HTML邮件：一种是纯文本版本，另一种则是专门处理优惠券的增强版本。\\n\\n![图片](https://let-the-work-flow.com/logo-64.png)\\n祝您使用愉快！❤️\\nhttps://let-the-work-flow.com\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"01cf3e60-c280-46c1-9971-ccf63a28ab9a\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        3040,\n        760\n      ],\n      \"parameters\": {\n        \"width\": 326.9476248855971,\n        \"height\": 414.15459581943776,\n        \"content\": \"## 发送邮件给客户\\n\\n虽然n8n支持通过SMTP发送邮件这点很酷，但我建议还是使用您的新闻简报工具来操作，以便更好地跟踪退订情况等事宜。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6c458bf6-ea7b-43b5-bc65-d9ae68542a8c\",\n      \"name\": \"Extract from File\",\n      \"type\": \"n8n-nodes-base.extractFromFile\",\n      \"position\": [\n        -160,\n        1040\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"xls\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"780dd707-4493-4679-9064-acc3c59011f8\",\n      \"name\": \"Some Options for the Campaign\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        140,\n        1040\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"8ef766db-4ad1-43c7-b621-8ea3ed0a44b2\",\n              \"name\": \"Campaign Target\",\n              \"type\": \"string\",\n              \"value\": \"Engage the Customer\"\n            },\n            {\n              \"id\": \"9f9ce88a-a24a-4a27-8b25-25ee85e730d6\",\n              \"name\": \"Flavour\",\n              \"type\": \"string\",\n              \"value\": \"be friendly and witty but also cool and direct. Critique is valuable and embrace the feedback.\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"3b152bdc-acb8-4f37-8b91-1ab02c0e9532\",\n      \"name\": \"Information Extractor\",\n      \"type\": \"@n8n/n8n-nodes-langchain.informationExtractor\",\n      \"position\": [\n        480,\n        700\n      ],\n      \"parameters\": {\n        \"text\": \"=Item Purchased: {{ $json['Item Purchased'] }} \\nFeedback: {{ $json.Feedback }}\\nShould we send a coupon to make the customer happy? Yes/No\",\n        \"options\": {\n          \"systemPromptTemplate\": \"=Determine the sentiment of the given product feedback. Then generate a Headline and Text without salutation or any greeting for a personalized Email Campagin after a User gave a product review. If the user seems not happy, tell them that you have a Coupon for them. The User finds the Coupon Code below this E-mail. \\nThe target of the campagin: {{ $json['Campaign Target'] }}.\\nRemember: {{ $json['Flavour'] }}. Avoid any greeting.\\n\"\n        },\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"required\\\": [\\\"Headline\\\",\\\"Body\\\",\\\"SendCoupon\\\"],\\n  \\\"properties\\\": {\\n    \\\"Headline\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"Body\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"SendCoupon\\\": {\\n      \\\"type\\\": \\\"boolean\\\"\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f597a54e-27e9-46e8-b9d5-46dd54406803\",\n      \"name\": \"OpenAI Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        480,\n        880\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"716e4281-cf18-4cc7-b5ed-4de0308bf9aa\",\n      \"name\": \"AI did fail us1\",\n      \"type\": \"n8n-nodes-base.stopAndError\",\n      \"position\": [\n        1380,\n        1180\n      ],\n      \"parameters\": {\n        \"errorMessage\": \"Unexpected Langchain Output\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1dc51ad5-e605-4cad-9a5b-3b20eabd9797\",\n      \"name\": \"Fake coupon\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1980,\n        1280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"73989d0e-667f-4227-ab41-4eb1e8c1c10e\",\n              \"name\": \"Coupon\",\n              \"type\": \"string\",\n              \"value\": \"F4k3ItT1llY0uM4k3It\"\n            },\n            {\n              \"id\": \"4d86d8c8-1be3-40b0-b4fd-09f9ffc24386\",\n              \"name\": \"Coupon Value\",\n              \"type\": \"string\",\n              \"value\": \"20% of any purchase\"\n            },\n            {\n              \"id\": \"f73b8a70-5bf6-45c2-8061-d10f95b199a8\",\n              \"name\": \"Coupon Terms\",\n              \"type\": \"string\",\n              \"value\": \"=Valid until {{ $today.plus({days: 14}).format(\\\"d. MMM. y\\\") }} | minimum purchase amount: 20$ \"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"dfa6b376-dd66-40f1-8626-0f3f04e4c4bd\",\n      \"name\": \"Download dummy data\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -380,\n        1040\n      ],\n      \"parameters\": {\n        \"url\": \"https://let-the-work-flow.com/dummy/n8n-contest-merch.xlsx\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"a95ce7c4-c592-40c7-9dfa-db0e37d5b71f\",\n      \"name\": \"AI Output + Prev Data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        940,\n        1040\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"combineBy\": \"combineByPosition\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"bb0474a1-425c-4a02-a13e-385272091189\",\n      \"name\": \"Is the result valid?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1160,\n        1040\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"9b4ced26-dd86-4ae4-8f69-6177ec42c827\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"Headline\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"7723102c-43d2-48df-82f6-5bb45ddf615c\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"Body\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"b39e0b98-6824-4265-94a0-fe12154f2ad4\",\n      \"name\": \"Coupon them or not to Coupon them\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1620,\n        1040\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"967f37a1-a600-46a2-82cf-f340dd3c7a96\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.SendCoupon }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"13c4426f-f522-4127-b899-7e6397e18182\",\n      \"name\": \"Html Template for our Email\",\n      \"type\": \"n8n-nodes-base.html\",\n      \"position\": [\n        2360,\n        740\n      ],\n      \"parameters\": {\n        \"html\": \"<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\" />\\n  <title>{{ $json['Headline'] }}</title>\\n</head>\\n<body>\\n  <div class=\\\"container\\\">\\n    <img class=\\\"logo\\\" src=\\\"https://img.logoipsum.com/264.svg\\\"/>\\n    <h1>Hey {{ $json['Custome Name'] ? $json['Custome Name']+', ' : '!' }}</h1>\\n    <p>{{ $json['Body'] }}</p>\\n    \\n  <div class=\\\"footer\\\">\\n   <p>\\n    Definitely not a real company Lmt.<br>\\n    Also not a real street 123<br>\\n    Unreal Town\\n   </p>  \\n</div> \\n </div>\\n \\n  \\n</body>\\n</html>\\n\\n<style>\\n.logo {\\n  margin-top: 20px;\\n }\\n.container {\\n  background-color: #ffffff;\\n  font-family: sans-serif;\\n  padding: 16px;\\n  border-radius: 8px;\\n}\\n\\nh1 {\\n  color: #ff6d5a;\\n  font-size: 24px;\\n  font-weight: bold;\\n  margin-top: 30px;\\n}\\n\\np {\\n  color: #606060;\\n  line-height: 1.6;\\n}\\n\\nh2 {\\n  color: #909399;\\n  font-size: 20px;\\n  font-weight: bold;\\n  padding: 8px;\\n}\\n\\n.footer {\\n  margin-top: 30px;\\n}\\n\\n.footer > p {\\n    font-size: 14px;\\n  color: #ccc;\\n }\\n\\n</style>\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"71e36c09-6e24-4eb2-9b1a-4fb3bb4b4536\",\n      \"name\": \"The composed E-Mail + Prev Data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2740,\n        860\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"combineBy\": \"combineByPosition\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"a2b6ec8e-1bcf-4216-b9b6-476c0d82f706\",\n      \"name\": \"Html Template for our Email with a Coupon\",\n      \"type\": \"n8n-nodes-base.html\",\n      \"position\": [\n        2360,\n        1280\n      ],\n      \"parameters\": {\n        \"html\": \"<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\" />\\n  <title>{{ $json.output['Headline'] }}</title>\\n</head>\\n<body>\\n  <div class=\\\"container\\\">\\n    <img class=\\\"logo\\\" src=\\\"https://img.logoipsum.com/264.svg\\\"/>\\n    <h1>Hey {{ $json['Custome Name'] ? $json['Custome Name']+', ' : '!' }}</h1>\\n    <p>{{ $json.output['Body'] }}</p>\\n    \\n    <div class=\\\"coupon\\\">\\n        <h3>Here's a Coupon for you!<br>\\n        {{ $json['Coupon Value'] }}</h3>\\n        <h4 class=\\\"code\\\">{{ $json['Coupon'] }}</h4>\\n        <p>{{ $json['Coupon Terms'] }}</p>\\n    </div>\\n  <div class=\\\"footer\\\">\\n   <p>\\n    Definitely not a real company Lmt.<br>\\n    Also not a real street 123<br>\\n    Unreal Town\\n   </p>  \\n</div> \\n </div>\\n \\n  \\n</body>\\n</html>\\n\\n<style>\\n.logo {\\n  margin-top: 20px;\\n }\\n.container {\\n  background-color: #ffffff;\\n  font-family: sans-serif;\\n  padding: 16px;\\n  border-radius: 8px;\\n}\\n\\nh1 {\\n  color: #ff6d5a;\\n  font-size: 24px;\\n  font-weight: bold;\\n  margin-top: 30px;\\n}\\n\\np {\\n  color: #606060;\\n  line-height: 1.6;\\n}\\n\\nh2 {\\n  color: #909399;\\n  font-size: 20px;\\n  font-weight: bold;\\n  padding: 8px;\\n}\\n\\n.coupon {\\n  background: #ff6d5a;\\n  color: #fff;\\n  padding: 20px;\\n}\\n.coupon p {\\n  color: #fff;\\n}\\n  \\n.coupon .code {\\n  font-weight: bold;\\n  font-size: 24px;\\n  font-family: monospace;\\n }\\n\\n.footer {\\n  margin-top: 30px;\\n}\\n\\n.footer > p {\\n    font-size: 14px;\\n  color: #ccc;\\n }\\n\\n</style>\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"2d5dd858-cf61-4136-b405-e6ad4a372725\",\n      \"name\": \"The composed E-Mail with Coupon + Prev Data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2740,\n        1040\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"combineBy\": \"combineByPosition\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"5b1606b4-903a-4e90-8cf6-01fd92006195\",\n      \"name\": \"Send Email\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        3140,\n        960\n      ],\n      \"webhookId\": \"a155d7b3-39b1-4a96-adc5-4f8e984506ec\",\n      \"parameters\": {\n        \"html\": \"={{ $json.html }}\",\n        \"options\": {},\n        \"subject\": \"={{ $json.output.Headline }}\",\n        \"toEmail\": \"={{ $json.Email }}\",\n        \"fromEmail\": \"n8n@myemail.com\"\n      },\n      \"credentials\": {\n        \"smtp\": {\n          \"id\": \"EagS3depRLAKo3Sw\",\n          \"name\": \"Greenmail SMTP account (bob@example.com)\"\n        }\n      },\n      \"typeVersion\": 2.1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Fake coupon\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Html Template for our Email with a Coupon\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract from File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Some Options for the Campaign\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Information Extractor\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download dummy data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract from File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is the result valid?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Coupon them or not to Coupon them\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"AI did fail us1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"AI Output + Prev Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is the result valid?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Information Extractor\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Output + Prev Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Html Template for our Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"The composed E-Mail + Prev Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Some Options for the Campaign\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Information Extractor\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"AI Output + Prev Data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"The composed E-Mail + Prev Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking \\\"Execute Workflow\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download dummy data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Coupon them or not to Coupon them\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Html Template for our Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"The composed E-Mail + Prev Data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ],\n        [\n          {\n            \"node\": \"Fake coupon\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"The composed E-Mail with Coupon + Prev Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Html Template for our Email with a Coupon\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"The composed E-Mail with Coupon + Prev Data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"The composed E-Mail with Coupon + Prev Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
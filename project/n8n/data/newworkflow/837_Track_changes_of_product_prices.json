{
  "url": "https://n8n.io/workflows/837-track-changes-of-product-prices/",
  "title": "Track changes of product prices",
  "author": "sthosstudio",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-25",
  "categories": [
    {
      "name": "Building Blocks"
    }
  ],
  "workflow_json": "{\"nodes\":[{\"name\":\"HTML Extract\",\"type\":\"n8n-nodes-base.htmlExtract\",\"position\":[-220,-390],\"parameters\":{\"options\":{},\"extractionValues\":{\"values\":[{\"key\":\"price\",\"cssSelector\":\"={{$node[\\\"initItem\\\"].json[\\\"selector\\\"]}}\"}]}},\"typeVersion\":1},{\"name\":\"Cron\",\"type\":\"n8n-nodes-base.cron\",\"position\":[-1290,-390],\"parameters\":{\"triggerTimes\":{\"item\":[{\"mode\":\"everyX\",\"unit\":\"minutes\",\"value\":15}]}},\"typeVersion\":1},{\"name\":\"getActualPrice\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[-20,-390],\"parameters\":{\"functionCode\":\"const globalData = getWorkflowStaticData('global');\\n\\nvar price = String(item.price).replace(\\\",\\\", \\\".\\\");\\nprice = parseFloat(price);\\n//price = price.replace(/\\\\D/g, '');\\n//item.price = String(item.price).replace(\\\",\\\", \\\".\\\");\\n//item.price = parseFloat(item.price);\\n\\nitem.priceExists = (price > 0 ? true : false)\\nitem.price = price;\\n\\n// Update its data\\nglobalData.actualPrice = item;\\n\\nreturn item;\"},\"typeVersion\":1},{\"name\":\"fetchWeb\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-410,-390],\"parameters\":{\"url\":\"={{$node[\\\"initItem\\\"].json[\\\"link\\\"]}}\",\"options\":{},\"responseFormat\":\"string\"},\"typeVersion\":1},{\"name\":\"FunctionItem\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[1020,-390],\"parameters\":{\"functionCode\":\"const globalData = getWorkflowStaticData('global');\\n\\nglobalData.iteration = 0;\\n//var thiselem = $node[\\\"initItem\\\"].json;\\n\\n//const s1 = {'slug': thiselem.slug, \\\"link\\\": thiselem.link, \\\"selector\\\": thiselem.selector, \\\"price\\\":$node[\\\"getActualPrice\\\"].json.price, \\\"currency\\\": thiselem.currency};\\n//const s2 = {'slug': thiselem.slug+'2', \\\"link\\\": thiselem.link, \\\"selector\\\": thiselem.selector, \\\"price\\\":$node[\\\"getActualPrice\\\"].json.price, \\\"currency\\\": thiselem.currency};\\n//const s3 = {'slug': thiselem.slug+'3', \\\"link\\\": thiselem.link, \\\"selector\\\": thiselem.selector, \\\"price\\\":$node[\\\"getActualPrice\\\"].json.price, \\\"currency\\\": thiselem.currency};\\n\\nreturn $node[\\\"changeME\\\"].json.myWatchers;\\n\"},\"typeVersion\":1},{\"name\":\"Write Binary File1\",\"type\":\"n8n-nodes-base.writeBinaryFile\",\"position\":[1850,-390],\"parameters\":{\"fileName\":\"/data/kopacky.json\",\"dataPropertyName\":\"=price\"},\"typeVersion\":1},{\"name\":\"Move Binary Data1\",\"type\":\"n8n-nodes-base.moveBinaryData\",\"position\":[1420,-390],\"parameters\":{\"mode\":\"jsonToBinary\",\"options\":{},\"destinationKey\":\"price\"},\"typeVersion\":1},{\"name\":\"IF1\",\"type\":\"n8n-nodes-base.if\",\"position\":[550,-370],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{$node[\\\"checkifexists\\\"].json[\\\"stdout\\\"]}}\",\"value2\":\"Exists\",\"operation\":\"notEqual\"}]}},\"typeVersion\":1},{\"name\":\"checkifexists\",\"type\":\"n8n-nodes-base.executeCommand\",\"position\":[410,-370],\"parameters\":{\"command\":\"if [ -r /data/kopacky.json ]; then echo Exists; fi\"},\"typeVersion\":1},{\"name\":\"IF3\",\"type\":\"n8n-nodes-base.if\",\"position\":[680,110],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{$node[\\\"checkifexists\\\"].json[\\\"stdout\\\"]}}\",\"value2\":\"Exists\"}]}},\"typeVersion\":1},{\"name\":\"SaveToFile\",\"type\":\"n8n-nodes-base.writeBinaryFile\",\"position\":[1650,110],\"parameters\":{\"fileName\":\"/data/kopacky.json\",\"dataPropertyName\":\"=price\"},\"typeVersion\":1},{\"name\":\"JsonToBinary\",\"type\":\"n8n-nodes-base.moveBinaryData\",\"position\":[1500,110],\"parameters\":{\"mode\":\"jsonToBinary\",\"options\":{},\"destinationKey\":\"price\"},\"typeVersion\":1},{\"name\":\"changeME\",\"type\":\"n8n-nodes-base.functionItem\",\"color\":\"#3BDD33\",\"position\":[-830,-390],\"parameters\":{\"functionCode\":\"const globalData = getWorkflowStaticData('global');\\n\\n//{'slug': 'kopacky', 'link': 'https://www.adsport.sk/kopacky-lisovky-adidas-x-19-3-ll-fg-ef0598/#1131861', 'currency': 'EUR'}[]\\nvar myWatchers = [\\n{'slug': 'kopacky', 'link': 'https://www.adsport.sk/kopacky-lisovky-adidas-x-19-3-ll-fg-ef0598/#1131861', 'selector':'.prices > strong:nth-child(1) > span:nth-child(1)', 'currency': 'EUR'},\\n{'slug': 'kopacky2', 'link': 'https://www.adsport.sk/turfy-adidas-ace-tango-17-3-tf-by2203/', 'selector':'.col-xs-4 > strong:nth-child(1) > span:nth-child(1)', 'currency': 'EUR'},\\n{'slug': 'mobilcek', 'link': 'https://mobil.bazos.sk/inzerat/112253662/predam-odolny-doogee-s60-52-4g-lte-nfc.php', 'selector':'.listadvlevo > table:nth-child(1) > tbody:nth-child(1) > tr:nth-child(5) > td:nth-child(2) > b:nth-child(2)', 'currency': 'EUR'},\\n{'slug': 'ADIZERO RC 2', 'link': 'https://www.adsport.sk/panske-bezecke-topanky-adidas-adizero-rc-2-eg1187/', 'selector':'.col-xs-4 > strong:nth-child(1) > span:nth-child(1)', 'currency': 'EUR'}\\n];\\n\\nitem.myWatchers = myWatchers;\\nitem.watchersCount = myWatchers.length;\\nglobalData.myWatchers = myWatchers;\\n\\nreturn item;\"},\"typeVersion\":1},{\"name\":\"initItem\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[-620,-390],\"parameters\":{\"functionCode\":\"const globalData = getWorkflowStaticData('global');\\n\\nvar counter = globalData.iteration;\\n\\nitem.myWatchers[counter].watchersCount = item.watchersCount;\\nitem.myWatchers[counter].canContinue = (globalData.iteration < item.watchersCount-1 ? true : false);\\n//item.myWatchers[counter].canContinue = false;\\n\\nglobalData.iteration = counter + 1;\\n\\nreturn item.myWatchers[counter];\"},\"typeVersion\":1},{\"name\":\"savedItems\",\"type\":\"n8n-nodes-base.readBinaryFile\",\"position\":[850,-20],\"parameters\":{\"filePath\":\"/data/kopacky.json\",\"dataPropertyName\":\"savedItems\"},\"typeVersion\":1,\"continueOnFail\":true,\"alwaysOutputData\":true},{\"name\":\"itemsToJSON\",\"type\":\"n8n-nodes-base.moveBinaryData\",\"position\":[1020,-20],\"parameters\":{\"options\":{},\"sourceKey\":\"savedItems\"},\"typeVersion\":1},{\"name\":\"IF\",\"type\":\"n8n-nodes-base.if\",\"position\":[2190,-90],\"parameters\":{\"conditions\":{\"string\":[],\"boolean\":[{\"value1\":\"={{$node[\\\"initItem\\\"].json[\\\"canContinue\\\"]}}\",\"value2\":true}]}},\"typeVersion\":1},{\"name\":\"initItem1\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[-1060,-390],\"parameters\":{\"functionCode\":\"const globalData = getWorkflowStaticData('global');\\n\\nglobalData.iteration = 0;\\n\\nreturn item;\"},\"typeVersion\":1},{\"name\":\"IF2\",\"type\":\"n8n-nodes-base.if\",\"position\":[1850,110],\"parameters\":{\"conditions\":{\"number\":[{\"value1\":\"={{$node[\\\"getActualPrice\\\"].json[\\\"price\\\"]}}\",\"value2\":\"={{$node[\\\"updateSavedItems1\\\"].json[\\\"oldPrice\\\"]}}\"}],\"string\":[]}},\"typeVersion\":1},{\"name\":\"updateSavedItems\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[1350,110],\"parameters\":{\"functionCode\":\"const globalData = getWorkflowStaticData('global');\\n\\nvar myitems = [];\\nvar i;\\nfor (i = 0; i < item.items.length; i++) { \\n  if($node[\\\"initItem\\\"].json.slug == item.items[i].slug && $node[\\\"getActualPrice\\\"].json.price < item.items[i].price) {\\n    item.items[i].price = $node[\\\"getActualPrice\\\"].json.price;\\n  }\\n  myitems.push(item.items[i]);\\n} \\n\\nreturn myitems;\\n\"},\"typeVersion\":1},{\"name\":\"updateSavedItems1\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[1200,-20],\"parameters\":{\"functionCode\":\"const globalData = getWorkflowStaticData('global');\\nvar oldPrice = null;\\nvar myitems = [];\\nvar i;\\nfor (i = 0; i < item.length; i++) {\\n  if($node[\\\"initItem\\\"].json.slug == item[i].slug) {\\n\\n    item[i].link = $node[\\\"initItem\\\"].json.link;\\n    item[i].selector = $node[\\\"initItem\\\"].json.selector;\\n    item[i].currency = $node[\\\"initItem\\\"].json.currency;\\n    \\n    if(!item[i].price){\\n      item[i].price = $node[\\\"getActualPrice\\\"].json.price;\\n    }\\n    \\n    if($node[\\\"getActualPrice\\\"].json.price < item[i].price){\\n      oldPrice = item[i].price;\\n      item[i].price = $node[\\\"getActualPrice\\\"].json.price;\\n    }\\n    \\n    \\n  }\\n  \\n  myitems.push(item[i]);\\n} \\n\\n//item.somar = $node[\\\"initItem\\\"].json;\\n//return globalData.actualPrice;\\n\\nvar itemm = {};\\nitemm.items = myitems;\\nitemm.oldPrice = oldPrice;\\nreturn itemm;\\n\"},\"typeVersion\":1},{\"name\":\"cleanData\",\"type\":\"n8n-nodes-base.executeCommand\",\"notes\":\"This will remove all storaged data.\",\"position\":[-1290,-560],\"parameters\":{\"command\":\"file=\\\"/data/kopacky.json\\\"\\n[ -f $file ] && rm $file\"},\"typeVersion\":1},{\"name\":\"IF4\",\"type\":\"n8n-nodes-base.if\",\"position\":[150,-390],\"parameters\":{\"conditions\":{\"string\":[],\"boolean\":[{\"value1\":\"={{$node[\\\"getActualPrice\\\"].json[\\\"priceExists\\\"]}}\"}]}},\"typeVersion\":1},{\"name\":\"NotifyBetterPrice\",\"type\":\"n8n-nodes-base.emailSend\",\"position\":[1850,-90],\"parameters\":{\"html\":\"=<h2>Nová cena je: {{$node[\\\"getActualPrice\\\"].json[\\\"price\\\"]}} {{$node[\\\"initItem\\\"].json[\\\"currency\\\"]}}</h2><br>\\nPôvodná cena bola: {{$node[\\\"updateSavedItems1\\\"].json[\\\"oldPrice\\\"]}} {{$node[\\\"initItem\\\"].json[\\\"currency\\\"]}}<br>\\nURL: {{$node[\\\"initItem\\\"].json[\\\"link\\\"]}}\",\"text\":\"=\",\"options\":{},\"subject\":\"=Nová cena - {{$node[\\\"initItem\\\"].json[\\\"slug\\\"]}} - {{$node[\\\"getActualPrice\\\"].json[\\\"price\\\"]}} {{$node[\\\"initItem\\\"].json[\\\"currency\\\"]}}\",\"toEmail\":\"sthosstudio@gmail.com\",\"fromEmail\":\"hostovecky@weyou.sk\"},\"credentials\":{\"smtp\":\"hostovecky@weyou.sk\"},\"typeVersion\":1},{\"name\":\"NotifyIncorrectPrice\",\"type\":\"n8n-nodes-base.emailSend\",\"position\":[270,-690],\"parameters\":{\"html\":\"=Please check the link or selector for the item with slug <strong>{{$node[\\\"initItem\\\"].json[\\\"slug\\\"]}}</strong><br>\\nURL: {{$node[\\\"initItem\\\"].json[\\\"link\\\"]}}\",\"text\":\"=\",\"options\":{},\"subject\":\"={{$node[\\\"initItem\\\"].json[\\\"slug\\\"]}} - Getting price issue.\",\"toEmail\":\"sthosstudio@gmail.com\",\"fromEmail\":\"hostovecky@weyou.sk\"},\"credentials\":{\"smtp\":\"hostovecky@weyou.sk\"},\"typeVersion\":1}],\"connections\":{\"IF\":{\"main\":[[{\"node\":\"changeME\",\"type\":\"main\",\"index\":0}]]},\"IF1\":{\"main\":[[{\"node\":\"FunctionItem\",\"type\":\"main\",\"index\":0}],[{\"node\":\"IF3\",\"type\":\"main\",\"index\":0}]]},\"IF2\":{\"main\":[[{\"node\":\"NotifyBetterPrice\",\"type\":\"main\",\"index\":0}],[{\"node\":\"IF\",\"type\":\"main\",\"index\":0}]]},\"IF3\":{\"main\":[[{\"node\":\"savedItems\",\"type\":\"main\",\"index\":0}]]},\"IF4\":{\"main\":[[{\"node\":\"NotifyIncorrectPrice\",\"type\":\"main\",\"index\":0}],[{\"node\":\"checkifexists\",\"type\":\"main\",\"index\":0}]]},\"Cron\":{\"main\":[[{\"node\":\"initItem1\",\"type\":\"main\",\"index\":0}]]},\"changeME\":{\"main\":[[{\"node\":\"initItem\",\"type\":\"main\",\"index\":0}]]},\"fetchWeb\":{\"main\":[[{\"node\":\"HTML Extract\",\"type\":\"main\",\"index\":0}]]},\"initItem\":{\"main\":[[{\"node\":\"fetchWeb\",\"type\":\"main\",\"index\":0}]]},\"initItem1\":{\"main\":[[{\"node\":\"changeME\",\"type\":\"main\",\"index\":0}]]},\"SaveToFile\":{\"main\":[[{\"node\":\"IF2\",\"type\":\"main\",\"index\":0}]]},\"savedItems\":{\"main\":[[{\"node\":\"itemsToJSON\",\"type\":\"main\",\"index\":0}]]},\"itemsToJSON\":{\"main\":[[{\"node\":\"updateSavedItems1\",\"type\":\"main\",\"index\":0}]]},\"FunctionItem\":{\"main\":[[{\"node\":\"Move Binary Data1\",\"type\":\"main\",\"index\":0}]]},\"HTML Extract\":{\"main\":[[{\"node\":\"getActualPrice\",\"type\":\"main\",\"index\":0}]]},\"JsonToBinary\":{\"main\":[[{\"node\":\"SaveToFile\",\"type\":\"main\",\"index\":0}]]},\"checkifexists\":{\"main\":[[{\"node\":\"IF1\",\"type\":\"main\",\"index\":0}]]},\"getActualPrice\":{\"main\":[[{\"node\":\"IF4\",\"type\":\"main\",\"index\":0}]]},\"updateSavedItems\":{\"main\":[[{\"node\":\"JsonToBinary\",\"type\":\"main\",\"index\":0}]]},\"Move Binary Data1\":{\"main\":[[{\"node\":\"Write Binary File1\",\"type\":\"main\",\"index\":0}]]},\"NotifyBetterPrice\":{\"main\":[[{\"node\":\"IF\",\"type\":\"main\",\"index\":0}]]},\"updateSavedItems1\":{\"main\":[[{\"node\":\"updateSavedItems\",\"type\":\"main\",\"index\":0}]]},\"Write Binary File1\":{\"main\":[[{\"node\":\"IF\",\"type\":\"main\",\"index\":0}]]},\"NotifyIncorrectPrice\":{\"main\":[[{\"node\":\"checkifexists\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow automatically tracks changes on specific websites, typically in e-commerce where you want to get information about price changes.\n\n## Prerequisites\n\n  * Basic knowledge of HTML and JavaScript\n\n\n\n## Nodes\n\n  * [Execute Command nodes](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.executecommand/) create a file named `kopacky.json` in the `/data/` folder (Make sure that n8n has the permissions to make changes to the folder in your setup) and clean data.\n  * [Cron node](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.cron/) triggers the workflow at regular intervals (default is 15 minutes), depending on how often you want to crawl URLs of your watchers.\n  * [Function Item node](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.functionItem/) **(Change me)** adds the URL watchers. You can put as many URLs (watchers) as you want by changing the JavaScript code in the node. There are four properties for each watcher:\n\nProperty | Meaning  \n---|---  \nslug | Unique identifier for the watcher.  \nlink | URL of the website where you want to track changes.  \nselector | CSS selector of the HTML tag, where your price is placed. You can use browser web tools to get a specific selector.  \ncurrency | Currency code in which your price is set.  \n  \n  * [Function Item node](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.functionItem/) **(Init item)** saves all required data from each watcher to the `kopacky.json` file.\n  * [HTTP Request node](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.httpRequest/) fetches data from the website.\n  * [HTML Extract node](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.htmlExtract/) extracts the required information from the webpage.\n  * [Send Email nodes](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.sendemail/) **(NotifyBetterPrice)** send you an email when there is an issue with getting the price, and when a better price is available (this could happen if the website is down, your tracking product is not available anymore, or the owner of the website changed the selector or HTML).\n  * [IF nodes](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.if/) filter the incoming data and route the workflow.\n  * [Move Binary Data nodes](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.movebinarydata/) convert the JSON file to binary data.\n  * [Write Binary File nodes](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.writebinaryfile/) write the product prices in the file.\n\n\n\nNOTE: This is the first (beta) version of this workflow, so it could have some issues. For example, there is an issue with getting content of those websites, where the owner of the website blocks any calls from unknown foreign services - it's typical protection against crawlers.\n",
  "crawled_at": "2025-05-25T18:56:01.106637",
  "readme_zh": "该工作流能自动追踪特定网站的变更，尤其适用于需要监控价格变动的电商场景。\n\n## 前提条件\n\n* 需具备HTML与JavaScript基础知识\n\n## 节点说明\n\n* **[执行命令节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.executecommand/)**  \n  在`/data/`目录创建`kopacky.json`文件（需确保n8n有目录修改权限）并清理数据\n\n* **[定时任务节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.cron/)**  \n  按设定间隔（默认15分钟）触发工作流，频率取决于目标网址的监控需求\n\n* **[函数项节点（需修改）](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.functionItem/)**  \n  通过修改节点内JavaScript代码添加监控网址（可设置多个），每个监控对象包含四个属性：\n\n属性 | 说明  \n---|---  \nslug | 监控项唯一标识符  \nlink | 要追踪的目标网址  \nselector | 价格所在HTML标签的CSS选择器（可通过浏览器开发者工具获取）  \ncurrency | 价格对应的货币代码  \n\n* **[函数项节点（初始化）](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.functionItem/)**  \n  将所有监控数据保存至`kopacky.json`文件\n\n* **[HTTP请求节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.httpRequest/)**  \n  获取目标网页数据\n\n* **[HTML提取节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.htmlExtract/)**  \n  从网页中提取目标信息\n\n* **[邮件发送节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.sendemail/)**  \n  - **NotifyBetterPrice**：当出现价格获取异常或更优价格时发送邮件通知（可能因网站宕机、商品下架或HTML结构调整触发）\n\n* **[条件判断节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.if/)**  \n  过滤输入数据并控制工作流分支\n\n* **[二进制数据转换节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.movebinarydata/)**  \n  将JSON文件转为二进制数据\n\n* **[二进制文件写入节点](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.writebinaryfile/)**  \n  将商品价格写入文件\n\n> 注意：此为测试版工作流，可能存在异常。例如部分网站会屏蔽境外未知服务的请求——这是反爬虫的常见防护机制。",
  "title_zh": "产品价格变动追踪",
  "publish_date_zh": "最后更新于10个月前",
  "workflow_json_zh": "{\n  \"nodes\": [\n    {\n      \"name\": \"HTML Extract\",\n      \"type\": \"n8n-nodes-base.htmlExtract\",\n      \"position\": [\n        -220,\n        -390\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"extractionValues\": {\n          \"values\": [\n            {\n              \"key\": \"price\",\n              \"cssSelector\": \"={{$node[\\\"initItem\\\"].json[\\\"selector\\\"]}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Cron\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        -1290,\n        -390\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyX\",\n              \"unit\": \"minutes\",\n              \"value\": 15\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"getActualPrice\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        -20,\n        -390\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const globalData = getWorkflowStaticData('global');\\n\\nvar price = String(item.price).replace(\\\",\\\", \\\".\\\");\\nprice = parseFloat(price);\\n//price = price.replace(/\\\\D/g, '');\\n//item.price = String(item.price).replace(\\\",\\\", \\\".\\\");\\n//item.price = parseFloat(item.price);\\n\\nitem.priceExists = (price > 0 ? true : false)\\nitem.price = price;\\n\\n// Update its data\\nglobalData.actualPrice = item;\\n\\nreturn item;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"fetchWeb\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -410,\n        -390\n      ],\n      \"parameters\": {\n        \"url\": \"={{$node[\\\"initItem\\\"].json[\\\"link\\\"]}}\",\n        \"options\": {},\n        \"responseFormat\": \"string\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"FunctionItem\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        1020,\n        -390\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const globalData = getWorkflowStaticData('global');\\n\\nglobalData.iteration = 0;\\n//var thiselem = $node[\\\"initItem\\\"].json;\\n\\n//const s1 = {'slug': thiselem.slug, \\\"link\\\": thiselem.link, \\\"selector\\\": thiselem.selector, \\\"price\\\":$node[\\\"getActualPrice\\\"].json.price, \\\"currency\\\": thiselem.currency};\\n//const s2 = {'slug': thiselem.slug+'2', \\\"link\\\": thiselem.link, \\\"selector\\\": thiselem.selector, \\\"price\\\":$node[\\\"getActualPrice\\\"].json.price, \\\"currency\\\": thiselem.currency};\\n//const s3 = {'slug': thiselem.slug+'3', \\\"link\\\": thiselem.link, \\\"selector\\\": thiselem.selector, \\\"price\\\":$node[\\\"getActualPrice\\\"].json.price, \\\"currency\\\": thiselem.currency};\\n\\nreturn $node[\\\"changeME\\\"].json.myWatchers;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Write Binary File1\",\n      \"type\": \"n8n-nodes-base.writeBinaryFile\",\n      \"position\": [\n        1850,\n        -390\n      ],\n      \"parameters\": {\n        \"fileName\": \"/data/kopacky.json\",\n        \"dataPropertyName\": \"=price\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Move Binary Data1\",\n      \"type\": \"n8n-nodes-base.moveBinaryData\",\n      \"position\": [\n        1420,\n        -390\n      ],\n      \"parameters\": {\n        \"mode\": \"jsonToBinary\",\n        \"options\": {},\n        \"destinationKey\": \"price\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF1\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        550,\n        -370\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{$node[\\\"checkifexists\\\"].json[\\\"stdout\\\"]}}\",\n              \"value2\": \"Exists\",\n              \"operation\": \"notEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"checkifexists\",\n      \"type\": \"n8n-nodes-base.executeCommand\",\n      \"position\": [\n        410,\n        -370\n      ],\n      \"parameters\": {\n        \"command\": \"if [ -r /data/kopacky.json ]; then echo Exists; fi\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF3\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        680,\n        110\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{$node[\\\"checkifexists\\\"].json[\\\"stdout\\\"]}}\",\n              \"value2\": \"Exists\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"SaveToFile\",\n      \"type\": \"n8n-nodes-base.writeBinaryFile\",\n      \"position\": [\n        1650,\n        110\n      ],\n      \"parameters\": {\n        \"fileName\": \"/data/kopacky.json\",\n        \"dataPropertyName\": \"=price\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"JsonToBinary\",\n      \"type\": \"n8n-nodes-base.moveBinaryData\",\n      \"position\": [\n        1500,\n        110\n      ],\n      \"parameters\": {\n        \"mode\": \"jsonToBinary\",\n        \"options\": {},\n        \"destinationKey\": \"price\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"changeME\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"color\": \"#3BDD33\",\n      \"position\": [\n        -830,\n        -390\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const globalData = getWorkflowStaticData('global');\\n\\n//{'slug': 'kopacky', 'link': 'https://www.adsport.sk/kopacky-lisovky-adidas-x-19-3-ll-fg-ef0598/#1131861', 'currency': 'EUR'}[]\\nvar myWatchers = [\\n{'slug': 'kopacky', 'link': 'https://www.adsport.sk/kopacky-lisovky-adidas-x-19-3-ll-fg-ef0598/#1131861', 'selector':'.prices > strong:nth-child(1) > span:nth-child(1)', 'currency': 'EUR'},\\n{'slug': 'kopacky2', 'link': 'https://www.adsport.sk/turfy-adidas-ace-tango-17-3-tf-by2203/', 'selector':'.col-xs-4 > strong:nth-child(1) > span:nth-child(1)', 'currency': 'EUR'},\\n{'slug': 'mobilcek', 'link': 'https://mobil.bazos.sk/inzerat/112253662/predam-odolny-doogee-s60-52-4g-lte-nfc.php', 'selector':'.listadvlevo > table:nth-child(1) > tbody:nth-child(1) > tr:nth-child(5) > td:nth-child(2) > b:nth-child(2)', 'currency': 'EUR'},\\n{'slug': 'ADIZERO RC 2', 'link': 'https://www.adsport.sk/panske-bezecke-topanky-adidas-adizero-rc-2-eg1187/', 'selector':'.col-xs-4 > strong:nth-child(1) > span:nth-child(1)', 'currency': 'EUR'}\\n];\\n\\nitem.myWatchers = myWatchers;\\nitem.watchersCount = myWatchers.length;\\nglobalData.myWatchers = myWatchers;\\n\\nreturn item;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"initItem\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        -620,\n        -390\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const globalData = getWorkflowStaticData('global');\\n\\nvar counter = globalData.iteration;\\n\\nitem.myWatchers[counter].watchersCount = item.watchersCount;\\nitem.myWatchers[counter].canContinue = (globalData.iteration < item.watchersCount-1 ? true : false);\\n//item.myWatchers[counter].canContinue = false;\\n\\nglobalData.iteration = counter + 1;\\n\\nreturn item.myWatchers[counter];\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"savedItems\",\n      \"type\": \"n8n-nodes-base.readBinaryFile\",\n      \"position\": [\n        850,\n        -20\n      ],\n      \"parameters\": {\n        \"filePath\": \"/data/kopacky.json\",\n        \"dataPropertyName\": \"savedItems\"\n      },\n      \"typeVersion\": 1,\n      \"continueOnFail\": true,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"name\": \"itemsToJSON\",\n      \"type\": \"n8n-nodes-base.moveBinaryData\",\n      \"position\": [\n        1020,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sourceKey\": \"savedItems\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        2190,\n        -90\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [],\n          \"boolean\": [\n            {\n              \"value1\": \"={{$node[\\\"initItem\\\"].json[\\\"canContinue\\\"]}}\",\n              \"value2\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"initItem1\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        -1060,\n        -390\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const globalData = getWorkflowStaticData('global');\\n\\nglobalData.iteration = 0;\\n\\nreturn item;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF2\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1850,\n        110\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{$node[\\\"getActualPrice\\\"].json[\\\"price\\\"]}}\",\n              \"value2\": \"={{$node[\\\"updateSavedItems1\\\"].json[\\\"oldPrice\\\"]}}\"\n            }\n          ],\n          \"string\": []\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"updateSavedItems\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        1350,\n        110\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const globalData = getWorkflowStaticData('global');\\n\\nvar myitems = [];\\nvar i;\\nfor (i = 0; i < item.items.length; i++) { \\n  if($node[\\\"initItem\\\"].json.slug == item.items[i].slug && $node[\\\"getActualPrice\\\"].json.price < item.items[i].price) {\\n    item.items[i].price = $node[\\\"getActualPrice\\\"].json.price;\\n  }\\n  myitems.push(item.items[i]);\\n} \\n\\nreturn myitems;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"updateSavedItems1\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        1200,\n        -20\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const globalData = getWorkflowStaticData('global');\\nvar oldPrice = null;\\nvar myitems = [];\\nvar i;\\nfor (i = 0; i < item.length; i++) {\\n  if($node[\\\"initItem\\\"].json.slug == item[i].slug) {\\n\\n    item[i].link = $node[\\\"initItem\\\"].json.link;\\n    item[i].selector = $node[\\\"initItem\\\"].json.selector;\\n    item[i].currency = $node[\\\"initItem\\\"].json.currency;\\n    \\n    if(!item[i].price){\\n      item[i].price = $node[\\\"getActualPrice\\\"].json.price;\\n    }\\n    \\n    if($node[\\\"getActualPrice\\\"].json.price < item[i].price){\\n      oldPrice = item[i].price;\\n      item[i].price = $node[\\\"getActualPrice\\\"].json.price;\\n    }\\n    \\n    \\n  }\\n  \\n  myitems.push(item[i]);\\n} \\n\\n//item.somar = $node[\\\"initItem\\\"].json;\\n//return globalData.actualPrice;\\n\\nvar itemm = {};\\nitemm.items = myitems;\\nitemm.oldPrice = oldPrice;\\nreturn itemm;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"cleanData\",\n      \"type\": \"n8n-nodes-base.executeCommand\",\n      \"notes\": \"This will remove all storaged data.\",\n      \"position\": [\n        -1290,\n        -560\n      ],\n      \"parameters\": {\n        \"command\": \"file=\\\"/data/kopacky.json\\\"\\n[ -f $file ] && rm $file\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF4\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        150,\n        -390\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [],\n          \"boolean\": [\n            {\n              \"value1\": \"={{$node[\\\"getActualPrice\\\"].json[\\\"priceExists\\\"]}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"NotifyBetterPrice\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        1850,\n        -90\n      ],\n      \"parameters\": {\n        \"html\": \"=<h2>Nová cena je: {{$node[\\\"getActualPrice\\\"].json[\\\"price\\\"]}} {{$node[\\\"initItem\\\"].json[\\\"currency\\\"]}}</h2><br>\\nPôvodná cena bola: {{$node[\\\"updateSavedItems1\\\"].json[\\\"oldPrice\\\"]}} {{$node[\\\"initItem\\\"].json[\\\"currency\\\"]}}<br>\\nURL: {{$node[\\\"initItem\\\"].json[\\\"link\\\"]}}\",\n        \"text\": \"=\",\n        \"options\": {},\n        \"subject\": \"=Nová cena - {{$node[\\\"initItem\\\"].json[\\\"slug\\\"]}} - {{$node[\\\"getActualPrice\\\"].json[\\\"price\\\"]}} {{$node[\\\"initItem\\\"].json[\\\"currency\\\"]}}\",\n        \"toEmail\": \"sthosstudio@gmail.com\",\n        \"fromEmail\": \"hostovecky@weyou.sk\"\n      },\n      \"credentials\": {\n        \"smtp\": \"hostovecky@weyou.sk\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"NotifyIncorrectPrice\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        270,\n        -690\n      ],\n      \"parameters\": {\n        \"html\": \"=Please check the link or selector for the item with slug <strong>{{$node[\\\"initItem\\\"].json[\\\"slug\\\"]}}</strong><br>\\nURL: {{$node[\\\"initItem\\\"].json[\\\"link\\\"]}}\",\n        \"text\": \"=\",\n        \"options\": {},\n        \"subject\": \"={{$node[\\\"initItem\\\"].json[\\\"slug\\\"]}} - Getting price issue.\",\n        \"toEmail\": \"sthosstudio@gmail.com\",\n        \"fromEmail\": \"hostovecky@weyou.sk\"\n      },\n      \"credentials\": {\n        \"smtp\": \"hostovecky@weyou.sk\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"IF\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"changeME\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"FunctionItem\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"IF3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"NotifyBetterPrice\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"IF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF3\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"savedItems\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF4\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"NotifyIncorrectPrice\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"checkifexists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Cron\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"initItem1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"changeME\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"initItem\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"fetchWeb\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTML Extract\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"initItem\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"fetchWeb\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"initItem1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"changeME\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SaveToFile\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"savedItems\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"itemsToJSON\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"itemsToJSON\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"updateSavedItems1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"FunctionItem\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Move Binary Data1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"HTML Extract\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"getActualPrice\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"JsonToBinary\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SaveToFile\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"checkifexists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"getActualPrice\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF4\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"updateSavedItems\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"JsonToBinary\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Move Binary Data1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Write Binary File1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"NotifyBetterPrice\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"updateSavedItems1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"updateSavedItems\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Write Binary File1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"NotifyIncorrectPrice\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"checkifexists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
{
  "title": "Automated Discord Spam Moderation with AI and Human-in-the-Loop",
  "url": "https://n8n.io/workflows/3351-automated-discord-spam-moderation-with-ai-and-human-in-the-loop/",
  "category": "ITOps",
  "category_url": "https://n8n.io/workflows/categories/it-ops/?sort=createdAt:desc",
  "author": "Jimleuk",
  "publish_date": "Last update 8 days ago",
  "publish_date_absolute": "2025-05-14",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"59b7eed3-8622-4722-b93f-f225cc0aa4e0\",\"name\":\"Spam Detection\",\"type\":\"@n8n/n8n-nodes-langchain.textClassifier\",\"position\":[260,100],\"parameters\":{\"options\":{},\"inputText\":\"={{ $json.content }}\",\"categories\":{\"categories\":[{\"category\":\"is_spam\",\"description\":\"This text is a promotion, sales pitch or likely spam message to get members to visit another site.\"},{\"category\":\"is_not_spam\",\"description\":\"This text is not spam.\"}]}},\"typeVersion\":1},{\"id\":\"74420874-d831-4ff0-a8f4-e7c3b6551c57\",\"name\":\"Get Recent Messages\",\"type\":\"n8n-nodes-base.discord\",\"position\":[-1020,40],\"webhookId\":\"7aa72e1f-06f4-4fe8-82ec-ad0e87a5b6b9\",\"parameters\":{\"guildId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"123456789\"},\"options\":{\"simplify\":true},\"resource\":\"message\",\"channelId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1248678443432808512\",\"cachedResultUrl\":\"https://discord.com/channels/1248678443432808509/1248678443432808512\",\"cachedResultName\":\"general\"},\"operation\":\"getAll\"},\"credentials\":{\"discordBotApi\":{\"id\":\"YUwD52E3oHsSUWdW\",\"name\":\"Discord Bot account\"}},\"typeVersion\":2},{\"id\":\"6db26c7e-f1eb-45b8-a444-01270fab157f\",\"name\":\"Only Once\",\"type\":\"n8n-nodes-base.removeDuplicates\",\"position\":[-820,40],\"parameters\":{\"options\":{\"historySize\":100},\"operation\":\"removeItemsSeenInPreviousExecutions\",\"dedupeValue\":\"={{ $json.id }}\"},\"typeVersion\":2},{\"id\":\"36923da1-5ebc-40fc-9780-74845ff2b268\",\"name\":\"Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[240,260],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"o3-mini\",\"cachedResultName\":\"o3-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"af01bb60-fdef-4fa1-bf33-1862a18ebc99\",\"name\":\"Warn User\",\"type\":\"n8n-nodes-base.discord\",\"position\":[2880,20],\"webhookId\":\"88bdd468-8eb9-41b8-b017-1deec91c9498\",\"parameters\":{\"sendTo\":\"user\",\"userId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('When Executed by Another Workflow').first().json.author.id }}\"},\"content\":\"=Warning: Please do not spam our channels\\nYour message was deleted to be in violation of our community terms & conditions and was subsequently deleted.\\n\\nFurther violations will result in a ban.\\n\\nIf you think this is a mistake, please message the moderation team.\",\"guildId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"123456789\"},\"options\":{},\"resource\":\"message\"},\"credentials\":{\"discordBotApi\":{\"id\":\"YUwD52E3oHsSUWdW\",\"name\":\"Discord Bot account\"}},\"typeVersion\":2},{\"id\":\"04e9f167-f816-4056-813a-3168dc22f209\",\"name\":\"Warn User Only\",\"type\":\"n8n-nodes-base.discord\",\"position\":[2540,180],\"webhookId\":\"88bdd468-8eb9-41b8-b017-1deec91c9498\",\"parameters\":{\"sendTo\":\"user\",\"userId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('When Executed by Another Workflow').first().json.author.id }}\"},\"content\":\"=Warning: Please do not spam our channels\\nYour message was flagged to be in violation of our community terms & conditions. Please consider other members before posting.\\n\\nFurther violations will result in a ban.\\n\\nIf you think this is a mistake, please message the moderation team.\",\"guildId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"123456789\"},\"options\":{},\"resource\":\"message\"},\"credentials\":{\"discordBotApi\":{\"id\":\"YUwD52E3oHsSUWdW\",\"name\":\"Discord Bot account\"}},\"typeVersion\":2},{\"id\":\"41240c95-c5c1-4ac2-81e7-782ff8f3511b\",\"name\":\"Group By User\",\"type\":\"n8n-nodes-base.code\",\"position\":[-540,100],\"parameters\":{\"jsCode\":\"const groupByUser = {};\\n\\nfor (const item of $input.all()) {\\n  if (!groupByUser[item.json.author.id]) {\\n    groupByUser[item.json.author.id] = [];\\n  }\\n  groupByUser[item.json.author.id].push(item.json);\\n}\\n\\nreturn { json : { groupByUser } };\"},\"typeVersion\":2},{\"id\":\"03d56683-c307-455d-bd03-84107d30f328\",\"name\":\"For Each User...\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[-160,100],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"e7eb71a8-cfe5-4e3b-81c1-66ea18cc55ec\",\"name\":\"Split Out\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[-360,100],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"groupByUser\"},\"typeVersion\":1},{\"id\":\"b74a7092-2b51-452b-bf29-6620969b3efb\",\"name\":\"Message to List\",\"type\":\"n8n-nodes-base.code\",\"position\":[100,100],\"parameters\":{\"jsCode\":\"const messages = $input.first().json;\\nreturn Object.keys(messages).map(key => messages[key]);\"},\"typeVersion\":2},{\"id\":\"762e3a5e-e013-4ca3-a2a9-cf7d5b0dd3f4\",\"name\":\"Notify Moderators with Send & Wait\",\"type\":\"n8n-nodes-base.discord\",\"position\":[1980,180],\"webhookId\":\"644a85f3-5add-4321-9d8a-bcc4acfa33f1\",\"parameters\":{\"guildId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"123456789\"},\"message\":\"=**Spam Detected**\\nUser: @{{ $json.author.username }}\\nMessage:\\n{{\\n$input.all().map(item =>\\n  `* [${DateTime.fromISO(item.json.timestamp).format('yyyy-MM-dd @ hh:mm')}] ${item.json.content}`).join('\\\\n')\\n}}\",\"options\":{},\"resource\":\"message\",\"channelId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"=_moderation\"},\"operation\":\"sendAndWait\",\"formFields\":{\"values\":[{\"fieldType\":\"dropdown\",\"fieldLabel\":\"Action\",\"fieldOptions\":{\"values\":[{\"option\":\"Delete Message and Warn User\"},{\"option\":\"Do nothing and Warn User\"},{\"option\":\"Do nothing\"}]},\"requiredField\":true}]},\"responseType\":\"customForm\"},\"credentials\":{\"discordBotApi\":{\"id\":\"YUwD52E3oHsSUWdW\",\"name\":\"Discord Bot account\"}},\"executeOnce\":true,\"typeVersion\":2},{\"id\":\"f35bc6b0-855c-451b-aee7-e2af4e268893\",\"name\":\"Flag as Spam\",\"type\":\"n8n-nodes-base.set\",\"position\":[620,0],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"e1eddfbe-c32d-4a3b-9660-07800f52f4c4\",\"name\":\"is_spam\",\"type\":\"boolean\",\"value\":true}]},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"f77a0101-d209-4d3c-ab4a-405579a1f539\",\"name\":\"Flag as Not Spam\",\"type\":\"n8n-nodes-base.set\",\"position\":[620,200],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"e1eddfbe-c32d-4a3b-9660-07800f52f4c4\",\"name\":\"is_spam\",\"type\":\"boolean\",\"value\":false}]},\"includeOtherFields\":true},\"typeVersion\":3.4,\"alwaysOutputData\":true},{\"id\":\"eefe79e2-603f-4f12-a385-fab4b8bdbc65\",\"name\":\"Merge\",\"type\":\"n8n-nodes-base.merge\",\"position\":[800,100],\"parameters\":{},\"typeVersion\":3},{\"id\":\"f7d6cccc-0d4a-4353-bc30-9a760196361f\",\"name\":\"Spam Messages Only\",\"type\":\"n8n-nodes-base.filter\",\"position\":[1060,100],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"f1dd7aa3-4215-47b5-830c-0d8d17e97c17\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ $json.is_spam }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2,\"alwaysOutputData\":true},{\"id\":\"7b4257b9-a5d3-4542-b4e2-563bf5634aa5\",\"name\":\"Has Flagged Messages?\",\"type\":\"n8n-nodes-base.if\",\"position\":[1240,180],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"f085cf62-e82d-4a15-806b-4a740e3b119c\",\"operator\":{\"type\":\"object\",\"operation\":\"notEmpty\",\"singleValue\":true},\"leftValue\":\"={{ $json }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"0282a8bf-ab06-427f-b58b-83131205b26c\",\"name\":\"Get Message IDs\",\"type\":\"n8n-nodes-base.code\",\"position\":[2540,20],\"parameters\":{\"jsCode\":\"return $('When Executed by Another Workflow').all().map(item => ({ json: {\\n  id: item.json.id,\\n  channel_id: item.json.channel_id\\n}}))\"},\"typeVersion\":2},{\"id\":\"fc43a315-6b81-4d93-8e11-7955b7650b94\",\"name\":\"Delete Messages\",\"type\":\"n8n-nodes-base.discord\",\"position\":[2720,20],\"webhookId\":\"6fa8bb1c-c5b7-4498-af63-dbe43691e602\",\"parameters\":{\"guildId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"123456789\"},\"resource\":\"message\",\"channelId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $json.channel_id }}\"},\"messageId\":\"={{ $json.id }}\",\"operation\":\"deleteMessage\"},\"credentials\":{\"discordBotApi\":{\"id\":\"YUwD52E3oHsSUWdW\",\"name\":\"Discord Bot account\"}},\"executeOnce\":false,\"typeVersion\":2},{\"id\":\"3868754b-26df-4f06-b27b-dba3959cb365\",\"name\":\"Receive Instructions\",\"type\":\"n8n-nodes-base.switch\",\"position\":[2180,180],\"parameters\":{\"rules\":{\"values\":[{\"outputKey\":\"Delete & Warn\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"c9a82ef5-49f7-4196-9ee3-977d34bd1ec9\",\"operator\":{\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.data.Action }}\",\"rightValue\":\"Delete Message and Warn User\"}]},\"renameOutput\":true},{\"outputKey\":\"Warn User Only\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"0e0d56da-bae0-4624-b712-fa44413eb17f\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.data.Action }}\",\"rightValue\":\"Do nothing and Warn User\"}]},\"renameOutput\":true},{\"outputKey\":\"Do nothing\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"2f85cdf6-db7b-4e30-9577-20ddee437807\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.data.Action }}\",\"rightValue\":\"Do nothing\"}]},\"renameOutput\":true}]},\"options\":{}},\"typeVersion\":3.2},{\"id\":\"27ea2dd8-07f0-438a-bee8-8c4a6ee7b5f7\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1280,-160],\"parameters\":{\"color\":7,\"width\":620,\"height\":520,\"content\":\"## 1. Get Channel Messages\\n[Read more about the scheduled Trigger](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.scheduletrigger/)\\n\\nThe scheduled trigger is used to execute this workflow throughout the day. Depending on how busy your community is, you may want to increase the messages fetched or set shorter intervals. The \\\"Remove Duplicates\\\" node is used to ensure we only process new messages.\"},\"typeVersion\":1},{\"id\":\"66e770ab-4eaa-40b6-be73-c36bad254c2a\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-640,-160],\"parameters\":{\"color\":7,\"width\":640,\"height\":520,\"content\":\"## 2. Group Messages By User\\n[Learn more about the loop node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.splitinbatches/)\\n\\nWhen dealing with nested data such as user and messages, using the loop node is a great way to ensure item references are not getting mixed up. Here, we're grouping users so that we can batch their messages and help minimise the number of notifications we need to send.\"},\"typeVersion\":1},{\"id\":\"963074bf-91e5-4a47-886d-0dbcbbba8fc4\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[20,-160],\"parameters\":{\"color\":7,\"width\":960,\"height\":620,\"content\":\"## 3. Spam Detection using AI-powered Text Classification\\n[Learn more about the text classification node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.text-classifier)\\n\\nIn this template, our goal is to moderate spam messages and one way to do this is by using an AI text classifier. This approach uses a Reasoning LLM to determine if a message falls into a generalised criteria of spam ie. promotion. You may prefer to customise this prompt for production use-case.\"},\"typeVersion\":1},{\"id\":\"0cbcfe9d-7f66-423c-b930-a3c700636bd8\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1680,-160],\"parameters\":{\"color\":7,\"width\":740,\"height\":620,\"content\":\"## 5. Moderation using Human-in-the-Loop\\n[Read more about n8n's human-fallback functionality](https://docs.n8n.io/advanced-ai/examples/human-fallback/)\\n\\nIn this step, we can use the \\\"Send and Wait for Response\\\" operation in our Discord node to allow human moderators to decide which actions to perform on the flagged messages. There are currently 3 response types available and in this template, we'll use the custom form option which allows us to specify a dropdown list from which the moderator can select from a predefined list of actions. Using this approach, we can ensure consistency across all moderators.\"},\"typeVersion\":1},{\"id\":\"c808c1a9-818e-4652-a92b-b6be1cb12706\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2440,-160],\"parameters\":{\"color\":7,\"width\":660,\"height\":680,\"content\":\"## 6. Execute Moderation Actions\\n[Learn more about the Discord node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.discord/)\\n\\nFinally, moderation actions can be executed on behalf of the moderator and thus saving them time. In the case of the delete action, the template will bulk remove the flagged messages accurately and even across multiple channels.\"},\"typeVersion\":1},{\"id\":\"c08416cb-a477-4ccc-b682-85c35d9c2cd6\",\"name\":\"Moderation Subworkflow\",\"type\":\"n8n-nodes-base.executeWorkflow\",\"position\":[1460,200],\"parameters\":{\"options\":{\"waitForSubWorkflow\":false},\"workflowId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $workflow.id }}\"},\"workflowInputs\":{\"value\":{},\"schema\":[],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[],\"attemptToConvertTypes\":false,\"convertFieldsToString\":true}},\"typeVersion\":1.2},{\"id\":\"f130b908-1653-4cb4-a72d-ae539c7a08dc\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1000,-160],\"parameters\":{\"color\":7,\"width\":660,\"height\":620,\"content\":\"## 4. Concurrent Processing using Subworkflows\\n[Learn more about Subworkflow Trigger](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow)\\n\\nOne issue we might come across if we have a human-in-the-loop step inside another loop is that later users will not be processed until the current user is actioned. One way of solving this is to use subworkflows. Subworkflows allow us to run our remaining workflow steps in a separate execution and with specifically the \\\"wait for subworkflow completion\\\" set to \\\"off\\\", it won't block our current loop.\"},\"typeVersion\":1},{\"id\":\"dc5e79f1-1ed9-4171-a787-a6b9dfee71f2\",\"name\":\"When Executed by Another Workflow\",\"type\":\"n8n-nodes-base.executeWorkflowTrigger\",\"position\":[1780,180],\"parameters\":{\"inputSource\":\"passthrough\"},\"typeVersion\":1.1},{\"id\":\"df28cb07-a4fe-4edf-afd0-18f4fa12521d\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1700,-580],\"parameters\":{\"width\":380,\"height\":940,\"content\":\"## Try it out\\n### This n8n template demonstrates how you can automate community moderation using human-in-the-loop functionality for Discord.\\n\\nThe use-case is for detecting and dealing with spam messages in a predefined and consistent way. Human-in-the-loop allows for a balance between overly aggressive bots and time and effort from the moderation team.\\n\\n### How it works\\n* A scheduled trigger is used to scan the most recent messages in a Discord Channel. Messages are tagged via the \\\"Remove Duplicates\\\" node so they don't get processed again in the future.\\n* Messages are grouped by user to allow for minimising of number of notifications sent.\\n* An AI text classifier node is then used to detect for spam in each user's message.\\n* When detected, a notification is sent to a moderation channel using the Send-and-wait mode for Discord. This notification comes with an n8n form and dropdown list of predefined actions to take in dealing with the spam messages. Once sent the workflow waits until a response is received.\\n* Once a moderator selects an action, the workflow continues and carries out a predefined moderation action.\\n\\n### How to use\\n* Depending on how busy your community is and subject to spammers, you may need to increase the scheduled interval.\\n* Add as many or few moderation actions as required.\\n* Remember to activate the workflow to  get it started.\\n\\n\\n### Need Help?\\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\"},\"typeVersion\":1},{\"id\":\"a437d4f3-af31-4677-b853-99832ff6c051\",\"name\":\"No Action Taken\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[2540,340],\"parameters\":{},\"typeVersion\":1},{\"id\":\"82a5b512-296b-4ad7-aa50-2f34ff2cf681\",\"name\":\"Schedule Trigger\",\"type\":\"n8n-nodes-base.scheduleTrigger\",\"position\":[-1220,40],\"parameters\":{\"rule\":{\"interval\":[{\"field\":\"hours\"}]}},\"typeVersion\":1.2}],\"pinData\":{},\"connections\":{\"Merge\":{\"main\":[[{\"node\":\"Spam Messages Only\",\"type\":\"main\",\"index\":0}]]},\"Model\":{\"ai_languageModel\":[[{\"node\":\"Spam Detection\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Only Once\":{\"main\":[[{\"node\":\"Group By User\",\"type\":\"main\",\"index\":0}]]},\"Split Out\":{\"main\":[[{\"node\":\"For Each User...\",\"type\":\"main\",\"index\":0}]]},\"Warn User\":{\"main\":[[]]},\"Flag as Spam\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}]]},\"Group By User\":{\"main\":[[{\"node\":\"Split Out\",\"type\":\"main\",\"index\":0}]]},\"Spam Detection\":{\"main\":[[{\"node\":\"Flag as Spam\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Flag as Not Spam\",\"type\":\"main\",\"index\":0}]]},\"Warn User Only\":{\"main\":[[]]},\"Delete Messages\":{\"main\":[[{\"node\":\"Warn User\",\"type\":\"main\",\"index\":0}]]},\"Get Message IDs\":{\"main\":[[{\"node\":\"Delete Messages\",\"type\":\"main\",\"index\":0}]]},\"Message to List\":{\"main\":[[{\"node\":\"Spam Detection\",\"type\":\"main\",\"index\":0}]]},\"Flag as Not Spam\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"For Each User...\":{\"main\":[[],[{\"node\":\"Message to List\",\"type\":\"main\",\"index\":0}]]},\"Schedule Trigger\":{\"main\":[[{\"node\":\"Get Recent Messages\",\"type\":\"main\",\"index\":0}]]},\"Spam Messages Only\":{\"main\":[[{\"node\":\"Has Flagged Messages?\",\"type\":\"main\",\"index\":0}]]},\"Get Recent Messages\":{\"main\":[[{\"node\":\"Only Once\",\"type\":\"main\",\"index\":0}]]},\"Receive Instructions\":{\"main\":[[{\"node\":\"Get Message IDs\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Warn User Only\",\"type\":\"main\",\"index\":0}],[{\"node\":\"No Action Taken\",\"type\":\"main\",\"index\":0}]]},\"Has Flagged Messages?\":{\"main\":[[{\"node\":\"Moderation Subworkflow\",\"type\":\"main\",\"index\":0}],[{\"node\":\"For Each User...\",\"type\":\"main\",\"index\":0}]]},\"Moderation Subworkflow\":{\"main\":[[{\"node\":\"For Each User...\",\"type\":\"main\",\"index\":0}]]},\"When Executed by Another Workflow\":{\"main\":[[{\"node\":\"Notify Moderators with Send & Wait\",\"type\":\"main\",\"index\":0}]]},\"Notify Moderators with Send & Wait\":{\"main\":[[{\"node\":\"Receive Instructions\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### This n8n template demonstrates how you can automate community moderation using human-in-the-loop functionality for Discord.\n\nThe use-case is for detecting and dealing with spam messages in a predefined and consistent way. Human-in-the-loop allows for a balance between overly aggressive bots and time and effort from the moderation team.\n\n### How it works\n\n  * A scheduled trigger is used to scan the most recent messages in a Discord Channel. Messages are tagged via the \"Remove Duplicates\" node so they don't get processed again in the future.\n  * Messages are grouped by user to allow for minimising of number of notifications sent.\n  * An AI text classifier node is then used to detect for spam in each user's message.\n  * When detected, a notification is sent to a moderation channel using the Send-and-wait mode for Discord. This notification comes with an n8n form and dropdown list of predefined actions to take in dealing with the spam messages. Once sent the workflow waits until a response is received.\n  * Once a moderator selects an action, the workflow continues and carries out a predefined moderation action.\n\n\n\n### How to use\n\n  * Depending on how busy your community is and subject to spammers, you may need to increase the scheduled interval.\n  * Add as many or few moderation actions as required.\n  * Remember to activate the workflow to get it started.\n\n\n\n### Requirements\n\n  * Discord channel for messages to moderate\n  * OpenAI for text classification\n\n\n\n### Customising this template\n\n  * It is possible to cover multiple channels. Add as many as your community needs.\n  * Not using Discord. The template can also work in slack or other services which offer the same bot functionality.\n\n\n",
  "readme_html": "<!--[--><div data-v-859c7806=\"\"><h3>This n8n template demonstrates how you can automate community moderation using human-in-the-loop functionality for Discord.</h3>\n<p>The use-case is for detecting and dealing with spam messages in a predefined and consistent way. Human-in-the-loop allows for a balance between overly aggressive bots and time and effort from the moderation team.</p>\n<h3>How it works</h3>\n<ul>\n<li>A scheduled trigger is used to scan the most recent messages in a Discord Channel. Messages are tagged via the \"Remove Duplicates\" node so they don't get processed again in the future.</li>\n<li>Messages are grouped by user to allow for minimising of number of notifications sent.</li>\n<li>An AI text classifier node is then used to detect for spam in each user's message.</li>\n<li>When detected, a notification is sent to a moderation channel using the Send-and-wait mode for Discord. This notification comes with an n8n form and dropdown list of predefined actions to take in dealing with the spam messages. Once sent the workflow waits until a response is received.</li>\n<li>Once a moderator selects an action, the workflow continues and carries out a predefined moderation action.</li>\n</ul>\n<h3>How to use</h3>\n<ul>\n<li>Depending on how busy your community is and subject to spammers, you may need to increase the scheduled interval.</li>\n<li>Add as many or few moderation actions as required.</li>\n<li>Remember to activate the workflow to  get it started.</li>\n</ul>\n<h3>Requirements</h3>\n<ul>\n<li>Discord channel for messages to moderate</li>\n<li>OpenAI for text classification</li>\n</ul>\n<h3>Customising this template</h3>\n<ul>\n<li>It is possible to cover multiple channels. Add as many as your community needs.</li>\n<li>Not using Discord. The template can also work in slack or other services which offer the same bot functionality.</li>\n</ul>\n</div><!--]-->",
  "readme_zh": "### 该n8n模板展示了如何通过人机协同机制实现Discord社区内容审核自动化\n\n本方案用于以标准化方式检测和处理垃圾信息。人机协同机制能在过度敏感的机器人与人工审核团队耗时费力之间取得平衡。\n\n#### 运行原理\n* 通过定时触发器扫描Discord频道最新消息。\"去重节点\"会对消息打标记避免重复处理\n* 按用户分组消息以减少通知发送频次\n* 采用AI文本分类节点检测每个用户消息中的垃圾内容\n* 当检测到可疑内容时，通过Discord的\"发送-等待\"模式向审核频道发送通知。通知附带n8n表单和预设处理动作的下拉菜单，工作流将暂停直至收到回复\n* 审核人员选择处理方案后，工作流将执行预设的标准化操作\n\n#### 使用指南\n* 根据社区活跃度和垃圾信息出现频率调整定时扫描间隔\n* 可自由增删预设审核动作\n* 启用工作流后方可开始运行\n\n#### 环境要求\n* 需配置待审核的Discord文本频道\n* 需接入OpenAI文本分类服务\n\n#### 定制建议\n* 支持扩展至多个频道，可根据社区实际需求添加\n* 非Discord平台（如Slack等具有相同机器人功能的平台）亦可适配本模板",
  "title_zh": "利用人工智能与人机协作实现Discord垃圾信息自动审核",
  "publish_date_zh": "上次更新于8天前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"59b7eed3-8622-4722-b93f-f225cc0aa4e0\",\n      \"name\": \"Spam Detection\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textClassifier\",\n      \"position\": [\n        260,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"inputText\": \"={{ $json.content }}\",\n        \"categories\": {\n          \"categories\": [\n            {\n              \"category\": \"is_spam\",\n              \"description\": \"This text is a promotion, sales pitch or likely spam message to get members to visit another site.\"\n            },\n            {\n              \"category\": \"is_not_spam\",\n              \"description\": \"This text is not spam.\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"74420874-d831-4ff0-a8f4-e7c3b6551c57\",\n      \"name\": \"Get Recent Messages\",\n      \"type\": \"n8n-nodes-base.discord\",\n      \"position\": [\n        -1020,\n        40\n      ],\n      \"webhookId\": \"7aa72e1f-06f4-4fe8-82ec-ad0e87a5b6b9\",\n      \"parameters\": {\n        \"guildId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"123456789\"\n        },\n        \"options\": {\n          \"simplify\": true\n        },\n        \"resource\": \"message\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1248678443432808512\",\n          \"cachedResultUrl\": \"https://discord.com/channels/1248678443432808509/1248678443432808512\",\n          \"cachedResultName\": \"general\"\n        },\n        \"operation\": \"getAll\"\n      },\n      \"credentials\": {\n        \"discordBotApi\": {\n          \"id\": \"YUwD52E3oHsSUWdW\",\n          \"name\": \"Discord Bot account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"6db26c7e-f1eb-45b8-a444-01270fab157f\",\n      \"name\": \"Only Once\",\n      \"type\": \"n8n-nodes-base.removeDuplicates\",\n      \"position\": [\n        -820,\n        40\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"historySize\": 100\n        },\n        \"operation\": \"removeItemsSeenInPreviousExecutions\",\n        \"dedupeValue\": \"={{ $json.id }}\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"36923da1-5ebc-40fc-9780-74845ff2b268\",\n      \"name\": \"Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        240,\n        260\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"o3-mini\",\n          \"cachedResultName\": \"o3-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"af01bb60-fdef-4fa1-bf33-1862a18ebc99\",\n      \"name\": \"Warn User\",\n      \"type\": \"n8n-nodes-base.discord\",\n      \"position\": [\n        2880,\n        20\n      ],\n      \"webhookId\": \"88bdd468-8eb9-41b8-b017-1deec91c9498\",\n      \"parameters\": {\n        \"sendTo\": \"user\",\n        \"userId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('When Executed by Another Workflow').first().json.author.id }}\"\n        },\n        \"content\": \"=Warning: Please do not spam our channels\\nYour message was deleted to be in violation of our community terms & conditions and was subsequently deleted.\\n\\nFurther violations will result in a ban.\\n\\nIf you think this is a mistake, please message the moderation team.\",\n        \"guildId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"123456789\"\n        },\n        \"options\": {},\n        \"resource\": \"message\"\n      },\n      \"credentials\": {\n        \"discordBotApi\": {\n          \"id\": \"YUwD52E3oHsSUWdW\",\n          \"name\": \"Discord Bot account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"04e9f167-f816-4056-813a-3168dc22f209\",\n      \"name\": \"Warn User Only\",\n      \"type\": \"n8n-nodes-base.discord\",\n      \"position\": [\n        2540,\n        180\n      ],\n      \"webhookId\": \"88bdd468-8eb9-41b8-b017-1deec91c9498\",\n      \"parameters\": {\n        \"sendTo\": \"user\",\n        \"userId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('When Executed by Another Workflow').first().json.author.id }}\"\n        },\n        \"content\": \"=Warning: Please do not spam our channels\\nYour message was flagged to be in violation of our community terms & conditions. Please consider other members before posting.\\n\\nFurther violations will result in a ban.\\n\\nIf you think this is a mistake, please message the moderation team.\",\n        \"guildId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"123456789\"\n        },\n        \"options\": {},\n        \"resource\": \"message\"\n      },\n      \"credentials\": {\n        \"discordBotApi\": {\n          \"id\": \"YUwD52E3oHsSUWdW\",\n          \"name\": \"Discord Bot account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"41240c95-c5c1-4ac2-81e7-782ff8f3511b\",\n      \"name\": \"Group By User\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -540,\n        100\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const groupByUser = {};\\n\\nfor (const item of $input.all()) {\\n  if (!groupByUser[item.json.author.id]) {\\n    groupByUser[item.json.author.id] = [];\\n  }\\n  groupByUser[item.json.author.id].push(item.json);\\n}\\n\\nreturn { json : { groupByUser } };\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"03d56683-c307-455d-bd03-84107d30f328\",\n      \"name\": \"For Each User...\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        -160,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"e7eb71a8-cfe5-4e3b-81c1-66ea18cc55ec\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -360,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"groupByUser\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b74a7092-2b51-452b-bf29-6620969b3efb\",\n      \"name\": \"Message to List\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        100,\n        100\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const messages = $input.first().json;\\nreturn Object.keys(messages).map(key => messages[key]);\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"762e3a5e-e013-4ca3-a2a9-cf7d5b0dd3f4\",\n      \"name\": \"Notify Moderators with Send & Wait\",\n      \"type\": \"n8n-nodes-base.discord\",\n      \"position\": [\n        1980,\n        180\n      ],\n      \"webhookId\": \"644a85f3-5add-4321-9d8a-bcc4acfa33f1\",\n      \"parameters\": {\n        \"guildId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"123456789\"\n        },\n        \"message\": \"=**Spam Detected**\\nUser: @{{ $json.author.username }}\\nMessage:\\n{{\\n$input.all().map(item =>\\n  `* [${DateTime.fromISO(item.json.timestamp).format('yyyy-MM-dd @ hh:mm')}] ${item.json.content}`).join('\\\\n')\\n}}\",\n        \"options\": {},\n        \"resource\": \"message\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"=_moderation\"\n        },\n        \"operation\": \"sendAndWait\",\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldType\": \"dropdown\",\n              \"fieldLabel\": \"Action\",\n              \"fieldOptions\": {\n                \"values\": [\n                  {\n                    \"option\": \"Delete Message and Warn User\"\n                  },\n                  {\n                    \"option\": \"Do nothing and Warn User\"\n                  },\n                  {\n                    \"option\": \"Do nothing\"\n                  }\n                ]\n              },\n              \"requiredField\": true\n            }\n          ]\n        },\n        \"responseType\": \"customForm\"\n      },\n      \"credentials\": {\n        \"discordBotApi\": {\n          \"id\": \"YUwD52E3oHsSUWdW\",\n          \"name\": \"Discord Bot account\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"f35bc6b0-855c-451b-aee7-e2af4e268893\",\n      \"name\": \"Flag as Spam\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        620,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"e1eddfbe-c32d-4a3b-9660-07800f52f4c4\",\n              \"name\": \"is_spam\",\n              \"type\": \"boolean\",\n              \"value\": true\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"f77a0101-d209-4d3c-ab4a-405579a1f539\",\n      \"name\": \"Flag as Not Spam\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        620,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"e1eddfbe-c32d-4a3b-9660-07800f52f4c4\",\n              \"name\": \"is_spam\",\n              \"type\": \"boolean\",\n              \"value\": false\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"eefe79e2-603f-4f12-a385-fab4b8bdbc65\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        800,\n        100\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"f7d6cccc-0d4a-4353-bc30-9a760196361f\",\n      \"name\": \"Spam Messages Only\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1060,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"f1dd7aa3-4215-47b5-830c-0d8d17e97c17\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.is_spam }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"7b4257b9-a5d3-4542-b4e2-563bf5634aa5\",\n      \"name\": \"Has Flagged Messages?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1240,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"f085cf62-e82d-4a15-806b-4a740e3b119c\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"0282a8bf-ab06-427f-b58b-83131205b26c\",\n      \"name\": \"Get Message IDs\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        2540,\n        20\n      ],\n      \"parameters\": {\n        \"jsCode\": \"return $('When Executed by Another Workflow').all().map(item => ({ json: {\\n  id: item.json.id,\\n  channel_id: item.json.channel_id\\n}}))\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"fc43a315-6b81-4d93-8e11-7955b7650b94\",\n      \"name\": \"Delete Messages\",\n      \"type\": \"n8n-nodes-base.discord\",\n      \"position\": [\n        2720,\n        20\n      ],\n      \"webhookId\": \"6fa8bb1c-c5b7-4498-af63-dbe43691e602\",\n      \"parameters\": {\n        \"guildId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"123456789\"\n        },\n        \"resource\": \"message\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.channel_id }}\"\n        },\n        \"messageId\": \"={{ $json.id }}\",\n        \"operation\": \"deleteMessage\"\n      },\n      \"credentials\": {\n        \"discordBotApi\": {\n          \"id\": \"YUwD52E3oHsSUWdW\",\n          \"name\": \"Discord Bot account\"\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"3868754b-26df-4f06-b27b-dba3959cb365\",\n      \"name\": \"Receive Instructions\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        2180,\n        180\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"Delete & Warn\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"c9a82ef5-49f7-4196-9ee3-977d34bd1ec9\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.data.Action }}\",\n                    \"rightValue\": \"Delete Message and Warn User\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"Warn User Only\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"0e0d56da-bae0-4624-b712-fa44413eb17f\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.data.Action }}\",\n                    \"rightValue\": \"Do nothing and Warn User\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"Do nothing\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"2f85cdf6-db7b-4e30-9577-20ddee437807\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.data.Action }}\",\n                    \"rightValue\": \"Do nothing\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"27ea2dd8-07f0-438a-bee8-8c4a6ee7b5f7\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1280,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 620,\n        \"height\": 520,\n        \"content\": \"## 1. 获取频道消息\\n[详细了解计划触发器](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.scheduletrigger/)\\n\\n计划触发器用于全天候执行此工作流。根据您社区的活跃程度，您可能需要增加获取的消息数量或设置更短的时间间隔。\\\"去重\\\"节点用于确保我们仅处理新消息。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"66e770ab-4eaa-40b6-be73-c36bad254c2a\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -640,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 640,\n        \"height\": 520,\n        \"content\": \"## 2. 按用户分组消息\\n[了解更多关于循环节点的信息](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.splitinbatches/)\\n\\n在处理诸如用户和消息这样的嵌套数据时，使用循环节点是确保项目引用不会混淆的好方法。这里，我们将用户分组以便批量处理他们的消息，从而帮助减少需要发送的通知数量。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"963074bf-91e5-4a47-886d-0dbcbbba8fc4\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        20,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 960,\n        \"height\": 620,\n        \"content\": \"## 3. 使用AI文本分类进行垃圾信息检测\\n[了解更多关于文本分类节点的信息](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.text-classifier)\\n\\n在此模板中，我们的目标是过滤垃圾信息，其中一种方法是利用AI文本分类器。该方法通过推理型大语言模型（LLM）来判断某条信息是否符合垃圾信息的通用标准，例如促销内容。针对实际生产场景，建议根据需求自定义提示词模板。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0cbcfe9d-7f66-423c-b930-a3c700636bd8\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1680,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 740,\n        \"height\": 620,\n        \"content\": \"## 5. 采用人机回环（Human-in-the-Loop）的审核机制\\n[详细了解n8n的人工介入功能](https://docs.n8n.io/advanced-ai/examples/human-fallback/)\\n\\n本步骤中，我们可利用Discord节点中的\\\"发送并等待响应\\\"功能，让人工审核员决定对被标记消息采取何种操作。当前系统支持3种响应类型，本模板将采用自定义表单选项——通过预设的下拉菜单，审核员可从标准化操作列表中选择处理方式。这种方法能确保所有审核人员执行统一的操作标准。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c808c1a9-818e-4652-a92b-b6be1cb12706\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2440,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 660,\n        \"height\": 680,\n        \"content\": \"## 6. 执行管理操作\\n[了解更多关于Discord节点的信息](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.discord/)\\n\\n最后，可以代表管理员执行管理操作，从而节省他们的时间。以删除操作为例，该模板能够精准批量移除被标记的消息，甚至可跨多个频道进行操作。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c08416cb-a477-4ccc-b682-85c35d9c2cd6\",\n      \"name\": \"Moderation Subworkflow\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        1460,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"waitForSubWorkflow\": false\n        },\n        \"workflowId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $workflow.id }}\"\n        },\n        \"workflowInputs\": {\n          \"value\": {},\n          \"schema\": [],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": true\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"f130b908-1653-4cb4-a72d-ae539c7a08dc\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1000,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 660,\n        \"height\": 620,\n        \"content\": \"## 4. 使用子工作流实现并发处理\\n[了解更多关于子工作流触发器的信息](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow)\\n\\n当我们在循环结构中包含需要人工干预的步骤时，可能会遇到一个问题：当前用户未完成操作前，后续用户将无法被处理。解决这一问题的方法之一是采用子工作流。通过子工作流，我们可以在独立的执行流程中运行剩余的工作流步骤，特别是当\\\"等待子工作流完成\\\"选项设置为\\\"关闭\\\"时，它不会阻塞当前的主循环流程。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"dc5e79f1-1ed9-4171-a787-a6b9dfee71f2\",\n      \"name\": \"When Executed by Another Workflow\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        1780,\n        180\n      ],\n      \"parameters\": {\n        \"inputSource\": \"passthrough\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"df28cb07-a4fe-4edf-afd0-18f4fa12521d\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1700,\n        -580\n      ],\n      \"parameters\": {\n        \"width\": 380,\n        \"height\": 940,\n        \"content\": \"## 试试看\\n### 本n8n模板展示了如何通过人机协同功能实现Discord社区内容审核自动化\\n\\n该方案用于以标准化方式检测和处理垃圾信息。人机协同机制在过度敏感的机器人与人工审核团队的时间精力消耗之间取得了平衡。\\n\\n### 工作原理\\n* 通过定时触发器扫描Discord频道最新消息，经\\\"去重节点\\\"标记的消息将避免重复处理\\n* 按用户分组消息以减少通知发送频次\\n* 采用AI文本分类节点检测每个用户的垃圾信息\\n* 检测到垃圾信息时，通过Discord的\\\"发送-等待\\\"模式向审核频道发送通知。通知附带n8n表单和预设处理动作的下拉菜单，工作流将暂停直至收到回复\\n* 审核人员选择操作后，工作流将执行预设的审核动作\\n\\n### 使用指南\\n* 根据社区活跃度和垃圾信息出现频率调整定时扫描间隔\\n* 可自由增减预设审核动作数量\\n* 记得激活工作流才能开始运行\\n\\n### 需要帮助？\\n加入[Discord频道](https://discord.com/invite/XPKeKXeB7d)或访问[官方论坛](https://community.n8n.io/)提问！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a437d4f3-af31-4677-b853-99832ff6c051\",\n      \"name\": \"No Action Taken\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        2540,\n        340\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"82a5b512-296b-4ad7-aa50-2f34ff2cf681\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        -1220,\n        40\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"hours\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Spam Messages Only\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Spam Detection\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Only Once\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Group By User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each User...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Warn User\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Flag as Spam\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Group By User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Spam Detection\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Flag as Spam\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Flag as Not Spam\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Warn User Only\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Delete Messages\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Warn User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Message IDs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Delete Messages\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Message to List\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Spam Detection\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Flag as Not Spam\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"For Each User...\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"Message to List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Recent Messages\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Spam Messages Only\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Has Flagged Messages?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Recent Messages\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Only Once\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Receive Instructions\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Message IDs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Warn User Only\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Action Taken\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Has Flagged Messages?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Moderation Subworkflow\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"For Each User...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Moderation Subworkflow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each User...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When Executed by Another Workflow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Notify Moderators with Send & Wait\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Notify Moderators with Send & Wait\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Receive Instructions\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
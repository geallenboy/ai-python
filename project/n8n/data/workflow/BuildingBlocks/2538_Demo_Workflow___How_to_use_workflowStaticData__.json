{
  "title": "Demo Workflow - How to use workflowStaticData()",
  "url": "https://n8n.io/workflows/2538-demo-workflow-how-to-use-workflowstaticdata/",
  "category": "BuildingBlocks",
  "category_url": "https://n8n.io/workflows/categories/building-blocks/?sort=createdAt:desc",
  "author": "Ria",
  "publish_date": "Last update 6 months ago",
  "publish_date_absolute": "2024-11-06",
  "content": "",
  "workflow_json": "{\"nodes\":[{\"id\":\"517fad39-50ec-4eae-94c4-aca5b111a093\",\"name\":\"Webhook\",\"type\":\"n8n-nodes-base.webhook\",\"position\":[-120,-100],\"webhookId\":\"a227afae-e16e-44c2-bb5c-e69fe553b455\",\"parameters\":{\"path\":\"a227afae-e16e-44c2-bb5c-e69fe553b455\",\"options\":{}},\"typeVersion\":2},{\"id\":\"cbd978df-9b95-4148-a054-7772213f5b8f\",\"name\":\"continue with valid token\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[1020,-40],\"parameters\":{},\"typeVersion\":1},{\"id\":\"65167cf9-3ec5-4727-a604-a318e86bb54e\",\"name\":\"get new accessToken\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[560,80],\"parameters\":{\"url\":\"http://your-api.com\",\"options\":{\"response\":{\"response\":{\"fullResponse\":true}}}},\"notesInFlow\":false,\"typeVersion\":4.2},{\"id\":\"b17e01d2-c43a-486f-ab08-d81e05f8d110\",\"name\":\"2. set token in static data\",\"type\":\"n8n-nodes-base.code\",\"position\":[780,80],\"parameters\":{\"jsCode\":\"const workflowStaticData = $getWorkflowStaticData('global');\\n\\n// get new access token\\nworkflowStaticData.accessToken = $input.first().json.AccessToken;\\n// set timestamp of new access token\\nworkflowStaticData.timestamp = $now.toISO().toString();\\n\\nreturn [\\n  {\\n      // data: $input.all(),\\n      accessToken: workflowStaticData.accessToken,\\n      timestamp: workflowStaticData.timestamp,\\n      // today: $today\\n  }\\n];\"},\"typeVersion\":2},{\"id\":\"31fd494a-f323-47cc-8f89-0bb2f2332e0f\",\"name\":\"Schedule Trigger\",\"type\":\"n8n-nodes-base.scheduleTrigger\",\"position\":[-120,60],\"parameters\":{\"rule\":{\"interval\":[{}]}},\"typeVersion\":1.2},{\"id\":\"77623419-99f9-4369-9546-375eaf6f5732\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-180,240],\"parameters\":{\"width\":660,\"height\":400,\"content\":\"# StaticData Demo\\n\\n\\nThis workflow demonstrates how to use the [`workflowStaticData()` function](https://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/\\n) to set any type of variable that will persist within workflow executions. \\n\\nThis can be useful for working with access tokens that expire after a certain time period. \\n\\nhttps://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/\\n\\n## Important\\n\\nStatic Data only persists across **_production_** executions, i.e. triggered by Webhooks or Schedule Triggers (not manual executions!)\\nFor this the workflow will have to be activated. \\n\\n\\n\\n\"},\"typeVersion\":1},{\"id\":\"e4cbdbf7-7b3d-4c52-9d41-bc427d63df5d\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[520,60],\"parameters\":{\"color\":5,\"width\":180,\"height\":420,\"content\":\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### HTTP Request\\n\\nToggle \\n`Include Response Headers and Status` \\noption if access token is not sent in the body\"},\"typeVersion\":1},{\"id\":\"bed68570-bf35-4fa9-984c-1b67a53b59ba\",\"name\":\"if token is valid\",\"type\":\"n8n-nodes-base.if\",\"notes\":\"(1 minute expiration)\",\"position\":[340,-20],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"loose\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"65f5c979-3e7d-4e50-92c3-3ae39f1bba3d\",\"operator\":{\"type\":\"dateTime\",\"operation\":\"afterOrEquals\"},\"leftValue\":\"={{ $json.timestamp }}\",\"rightValue\":\"={{ $now.minus(1,'minute') }}\"}]},\"looseTypeValidation\":true},\"notesInFlow\":true,\"typeVersion\":2.2},{\"id\":\"57a4f5f9-eb77-4fd4-b6b1-55137f108374\",\"name\":\"1. initiate static data\",\"type\":\"n8n-nodes-base.code\",\"position\":[120,-20],\"parameters\":{\"jsCode\":\"// initialize staticData object\\nconst workflowStaticData = $getWorkflowStaticData('global');\\n\\n// initialize accessToken on staticData if it desn't exist yet\\nif (!workflowStaticData.hasOwnProperty('accessToken')) {\\n  workflowStaticData.accessToken = 0\\n}\\n\\n// initializing any other variables on the staticData object\\nif (!workflowStaticData.hasOwnProperty('timestamp')) {\\n  workflowStaticData.timestamp = $now.toISO()\\n}\\n\\nreturn [\\n  {\\n      // data: $input.all(),\\n      accessToken: workflowStaticData.accessToken,\\n      timestamp: workflowStaticData.timestamp,\\n      // today: $today\\n  }\\n];\"},\"notesInFlow\":false,\"typeVersion\":2}],\"pinData\":{\"get new accessToken\":[{\"AccessToken\":\"5763273631\"}]},\"connections\":{\"Webhook\":{\"main\":[[{\"node\":\"1. initiate static data\",\"type\":\"main\",\"index\":0}]]},\"Schedule Trigger\":{\"main\":[[{\"node\":\"1. initiate static data\",\"type\":\"main\",\"index\":0}]]},\"if token is valid\":{\"main\":[[{\"node\":\"continue with valid token\",\"type\":\"main\",\"index\":0}],[{\"node\":\"get new accessToken\",\"type\":\"main\",\"index\":0}]]},\"get new accessToken\":{\"main\":[[{\"node\":\"2. set token in static data\",\"type\":\"main\",\"index\":0}]]},\"1. initiate static data\":{\"main\":[[{\"node\":\"if token is valid\",\"type\":\"main\",\"index\":0}]]},\"2. set token in static data\":{\"main\":[[{\"node\":\"continue with valid token\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow demonstrates how to use the `workflowStaticData()` function to set any type of variable that will persist within workflow executions.\n\n<https://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/>\n\nThis can be useful for example when working with access tokens that expire after a certain time period. Using `staticData` we can keep a record of that access token and the expiry time and build our workflow logic around it.\n\n## Important\n\nStatic Data only persists across **_production_** executions, i.e. triggered by Webhooks or Schedule Triggers (not manual executions!)  \nFor this the workflow will have to be activated.\n\n## Setup\n\n  * configure HTTP Request node to fetch access token from your API (optional)\n  * activate workflow\n  * test the workflow with the webhook production link\n  * you can check the population of the static data in the single executions\n\n\n\n### Feedback\n\nIf you found this useful or want to report some missing information - I'd be happy to hear from you at [ria@n8n.io](mailto:ria@n8n.io)\n",
  "readme_html": "<!--[--><div data-v-50766329=\"\"><p>This workflow demonstrates how to use the <code>workflowStaticData()</code> function to set any type of variable that will persist within workflow executions.</p>\n<p><a href=\"https://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/\" rel=\"ugc nofollow\" target=\"_blank\">https://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/</a></p>\n<p>This can be useful for example when working with access tokens that expire after a certain time period. Using <code>staticData</code> we can keep a record of that access token and the expiry time and build our workflow logic around it.</p>\n<h2>Important</h2>\n<p>Static Data only persists across <strong><em>production</em></strong> executions, i.e. triggered by Webhooks or Schedule Triggers (not manual executions!)<br>\nFor this the workflow will have to be activated.</p>\n<h2>Setup</h2>\n<ul>\n<li>configure HTTP Request node to fetch access token from your API (optional)</li>\n<li>activate workflow</li>\n<li>test the workflow with the webhook production link</li>\n<li>you can check the population of the static data in the single executions</li>\n</ul>\n<h3>Feedback</h3>\n<p>If you found this useful or want to report some missing information - I'd be happy to hear from you at <a href=\"mailto:ria@n8n.io\" rel=\"ugc nofollow\">ria@n8n.io</a></p>\n</div><!--]-->",
  "readme_zh": "本工作流演示了如何运用`workflowStaticData()`函数来设置各类变量，这些变量将在工作流执行过程中持续存在。\n\n<https://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/>\n\n此功能特别适用于处理具有时效性的访问令牌等场景。通过`staticData`，我们可以记录访问令牌及其过期时间，并围绕这些数据构建工作流逻辑。\n\n## 重要说明\n\n静态数据仅在**_生产环境_**执行期间持久化（即由Webhook或定时触发器触发的执行，手动执行无效！）  \n使用前需激活工作流。\n\n## 配置步骤\n\n  * 配置HTTP Request节点从API获取访问令牌（可选）\n  * 激活工作流\n  * 通过webhook生产链接测试工作流\n  * 可在单次执行记录中查看静态数据的存储情况",
  "title_zh": "演示工作流程 - 如何使用workflowStaticData()",
  "publish_date_zh": "最后更新于6个月前",
  "workflow_json_zh": "{\n  \"nodes\": [\n    {\n      \"id\": \"517fad39-50ec-4eae-94c4-aca5b111a093\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -120,\n        -100\n      ],\n      \"webhookId\": \"a227afae-e16e-44c2-bb5c-e69fe553b455\",\n      \"parameters\": {\n        \"path\": \"a227afae-e16e-44c2-bb5c-e69fe553b455\",\n        \"options\": {}\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"cbd978df-9b95-4148-a054-7772213f5b8f\",\n      \"name\": \"continue with valid token\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        1020,\n        -40\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"65167cf9-3ec5-4727-a604-a318e86bb54e\",\n      \"name\": \"get new accessToken\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        560,\n        80\n      ],\n      \"parameters\": {\n        \"url\": \"http://your-api.com\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"fullResponse\": true\n            }\n          }\n        }\n      },\n      \"notesInFlow\": false,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"b17e01d2-c43a-486f-ab08-d81e05f8d110\",\n      \"name\": \"2. set token in static data\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        780,\n        80\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const workflowStaticData = $getWorkflowStaticData('global');\\n\\n// get new access token\\nworkflowStaticData.accessToken = $input.first().json.AccessToken;\\n// set timestamp of new access token\\nworkflowStaticData.timestamp = $now.toISO().toString();\\n\\nreturn [\\n  {\\n      // data: $input.all(),\\n      accessToken: workflowStaticData.accessToken,\\n      timestamp: workflowStaticData.timestamp,\\n      // today: $today\\n  }\\n];\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"31fd494a-f323-47cc-8f89-0bb2f2332e0f\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        -120,\n        60\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"77623419-99f9-4369-9546-375eaf6f5732\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -180,\n        240\n      ],\n      \"parameters\": {\n        \"width\": 660,\n        \"height\": 400,\n        \"content\": \"# 静态数据演示\\n\\n此工作流演示了如何使用[`workflowStaticData()`函数](https://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/)来设置在工作流执行期间持续存在的任意类型变量。\\n\\n这对于处理具有时效性的访问令牌特别有用。\\n\\nhttps://docs.n8n.io/code/cookbook/builtin/get-workflow-static-data/\\n\\n## 重要说明\\n\\n静态数据仅在**_生产_**执行中保持持久性，即由Webhook或计划触发器触发的执行（非手动执行！）\\n为此，工作流必须处于激活状态。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e4cbdbf7-7b3d-4c52-9d41-bc427d63df5d\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        520,\n        60\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 180,\n        \"height\": 420,\n        \"content\": \"### HTTP请求\\n\\n切换 \\n`包含响应头和状态` \\n选项，如果访问令牌未在请求体中发送\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bed68570-bf35-4fa9-984c-1b67a53b59ba\",\n      \"name\": \"if token is valid\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"notes\": \"(1 minute expiration)\",\n      \"position\": [\n        340,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"loose\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"65f5c979-3e7d-4e50-92c3-3ae39f1bba3d\",\n              \"operator\": {\n                \"type\": \"dateTime\",\n                \"operation\": \"afterOrEquals\"\n              },\n              \"leftValue\": \"={{ $json.timestamp }}\",\n              \"rightValue\": \"={{ $now.minus(1,'minute') }}\"\n            }\n          ]\n        },\n        \"looseTypeValidation\": true\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"57a4f5f9-eb77-4fd4-b6b1-55137f108374\",\n      \"name\": \"1. initiate static data\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        120,\n        -20\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// initialize staticData object\\nconst workflowStaticData = $getWorkflowStaticData('global');\\n\\n// initialize accessToken on staticData if it desn't exist yet\\nif (!workflowStaticData.hasOwnProperty('accessToken')) {\\n  workflowStaticData.accessToken = 0\\n}\\n\\n// initializing any other variables on the staticData object\\nif (!workflowStaticData.hasOwnProperty('timestamp')) {\\n  workflowStaticData.timestamp = $now.toISO()\\n}\\n\\nreturn [\\n  {\\n      // data: $input.all(),\\n      accessToken: workflowStaticData.accessToken,\\n      timestamp: workflowStaticData.timestamp,\\n      // today: $today\\n  }\\n];\"\n      },\n      \"notesInFlow\": false,\n      \"typeVersion\": 2\n    }\n  ],\n  \"pinData\": {\n    \"get new accessToken\": [\n      {\n        \"AccessToken\": \"5763273631\"\n      }\n    ]\n  },\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"1. initiate static data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"1. initiate static data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"if token is valid\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"continue with valid token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"get new accessToken\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"get new accessToken\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"2. set token in static data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"1. initiate static data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"if token is valid\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"2. set token in static data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"continue with valid token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
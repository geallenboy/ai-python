{
  "title": "Sync payment and customer data between Stripe and Pipedrive",
  "url": "https://n8n.io/workflows/1776-sync-payment-and-customer-data-between-stripe-and-pipedrive/",
  "category": "BuildingBlocks",
  "category_url": "https://n8n.io/workflows/categories/building-blocks/?sort=createdAt:desc",
  "author": "n8n Team",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-07",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"8c8c5237b8e37b006a7adce87f4369350c58e41f3ca9de16196d3197f69eabcd\"},\"nodes\":[{\"id\":\"28349bfd-f68e-4479-9508-28d408033d09\",\"name\":\"Get customers\",\"type\":\"n8n-nodes-base.stripe\",\"position\":[5360,1100],\"parameters\":{\"filters\":{},\"resource\":\"customer\",\"operation\":\"getAll\",\"returnAll\":true},\"credentials\":{\"stripeApi\":{\"id\":\"26\",\"name\":\"Stripe account\"}},\"typeVersion\":1},{\"id\":\"3f3d2389-e9ab-4140-8b04-f0a07003cecc\",\"name\":\"Rename fields and keep only needed fields\",\"type\":\"n8n-nodes-base.set\",\"position\":[5560,1100],\"parameters\":{\"values\":{\"string\":[{\"name\":\"customerName\",\"value\":\"={{ $json[\\\"name\\\"] }}\"},{\"name\":\"customerId\",\"value\":\"={{ $json[\\\"id\\\"] }}\"}]},\"options\":{},\"keepOnlySet\":true},\"typeVersion\":1},{\"id\":\"d6d3ccff-f565-49c9-9cda-8e278d298433\",\"name\":\"Add customer name to charge data\",\"type\":\"n8n-nodes-base.merge\",\"position\":[5860,920],\"parameters\":{\"mode\":\"mergeByKey\",\"propertyName1\":\"customer\",\"propertyName2\":\"customerId\"},\"typeVersion\":1},{\"id\":\"eadce8e7-f523-485b-8cc0-5a336c8633ef\",\"name\":\"Search organisation\",\"type\":\"n8n-nodes-base.pipedrive\",\"position\":[6140,1060],\"parameters\":{\"term\":\"={{ $json[\\\"customerName\\\"] }}\",\"resource\":\"organization\",\"operation\":\"search\",\"additionalFields\":{}},\"credentials\":{\"pipedriveApi\":{\"id\":\"96\",\"name\":\"Pipedrive account\"}},\"typeVersion\":1},{\"id\":\"dde08b48-21b0-44af-a66d-ff69399608e7\",\"name\":\"Add organisation Information to charge data\",\"type\":\"n8n-nodes-base.merge\",\"position\":[6400,940],\"parameters\":{\"join\":\"inner\",\"mode\":\"mergeByIndex\"},\"typeVersion\":1},{\"id\":\"6cbd0f06-0f10-4360-8c5c-e181679ba370\",\"name\":\"Create note with charge information\",\"type\":\"n8n-nodes-base.pipedrive\",\"position\":[6620,940],\"parameters\":{\"content\":\"={{ $json[\\\"description\\\"] }}: {{ $json[\\\"amount\\\"] / 100 }} {{ $json[\\\"currency\\\"] }}\",\"resource\":\"note\",\"additionalFields\":{\"org_id\":\"={{ $json[\\\"id\\\"] }}\"}},\"credentials\":{\"pipedriveApi\":{\"id\":\"96\",\"name\":\"Pipedrive account\"}},\"typeVersion\":1},{\"id\":\"c6ed5a89-b50a-40ad-bd78-62ffc2430fde\",\"name\":\"Get last execution timestamp\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[5140,900],\"parameters\":{\"functionCode\":\"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nif(!staticData.lastExecution){\\n  staticData.lastExecution = Math.round( new Date().getTime() / 1000 );\\n}\\n\\nitem.executionTimeStamp = Math.round( new Date().getTime() / 1000 );\\nitem.lastExecution = staticData.lastExecution;\\n\\n\\nreturn item;\"},\"typeVersion\":1},{\"id\":\"41b2c937-d479-4402-b428-29faabe32845\",\"name\":\"Set new last execution timestamp\",\"type\":\"n8n-nodes-base.functionItem\",\"position\":[6820,940],\"parameters\":{\"functionCode\":\"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nstaticData.lastExecution = $item(0).$node[\\\"Get last execution timestamp\\\"].executionTimeStamp;\\n\\nreturn item;\"},\"executeOnce\":true,\"typeVersion\":1},{\"id\":\"56612271-08c4-4347-92b1-b898c68c3460\",\"name\":\"Split array of charges to items\",\"type\":\"n8n-nodes-base.itemLists\",\"position\":[5560,900],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"data\"},\"typeVersion\":1},{\"id\":\"b866ba46-6269-4c8d-8021-ea99591d676d\",\"name\":\"Search for charges in Stripe\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[5360,900],\"parameters\":{\"url\":\"https://api.stripe.com/v1/charges/search\",\"options\":{},\"authentication\":\"predefinedCredentialType\",\"queryParametersUi\":{\"parameter\":[{\"name\":\"query\",\"value\":\"=created>{{$json[\\\"lastExecution\\\"]}} AND status:\\\"succeeded\\\"\"}]},\"nodeCredentialType\":\"stripeApi\"},\"credentials\":{\"stripeApi\":{\"id\":\"26\",\"name\":\"Stripe account\"}},\"typeVersion\":2},{\"id\":\"a3249f70-1cd4-4d5f-8f27-15badcf10296\",\"name\":\"Every day at 8 am\",\"type\":\"n8n-nodes-base.cron\",\"position\":[4920,900],\"parameters\":{\"triggerTimes\":{\"item\":[{\"hour\":8}]}},\"typeVersion\":1}],\"connections\":{\"Get customers\":{\"main\":[[{\"node\":\"Rename fields and keep only needed fields\",\"type\":\"main\",\"index\":0}]]},\"Every day at 8 am\":{\"main\":[[{\"node\":\"Get last execution timestamp\",\"type\":\"main\",\"index\":0}]]},\"Search organisation\":{\"main\":[[{\"node\":\"Add organisation Information to charge data\",\"type\":\"main\",\"index\":1}]]},\"Get last execution timestamp\":{\"main\":[[{\"node\":\"Search for charges in Stripe\",\"type\":\"main\",\"index\":0}]]},\"Search for charges in Stripe\":{\"main\":[[{\"node\":\"Split array of charges to items\",\"type\":\"main\",\"index\":0}]]},\"Split array of charges to items\":{\"main\":[[{\"node\":\"Add customer name to charge data\",\"type\":\"main\",\"index\":0}]]},\"Add customer name to charge data\":{\"main\":[[{\"node\":\"Search organisation\",\"type\":\"main\",\"index\":0},{\"node\":\"Add organisation Information to charge data\",\"type\":\"main\",\"index\":0}]]},\"Create note with charge information\":{\"main\":[[{\"node\":\"Set new last execution timestamp\",\"type\":\"main\",\"index\":0}]]},\"Rename fields and keep only needed fields\":{\"main\":[[{\"node\":\"Add customer name to charge data\",\"type\":\"main\",\"index\":1}]]},\"Add organisation Information to charge data\":{\"main\":[[{\"node\":\"Create note with charge information\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow combines customers' details with their payment data and passes the input to Pipedrive as a note to the organization.\n\n## Prerequisites\n\n  * Stripe account and [Stripe credentials](https://docs.n8n.io/integrations/builtin/credentials/stripe/)\n  * Pipedrive account and [Pipedrive credentials](https://docs.n8n.io/integrations/builtin/credentials/pipedrive/)\n\n\n\n## How it works\n\n  1. Cron node triggers the workflow every day at 8 a.m.\n  2. HTTP Request node searches for payments in Stripe.\n  3. The Item Lists node creates separate items from a list of payment data.\n  4. Merge node takes in the payment data as an input 1.\n  5. Stripe node gets all the customers data.\n  6. Set node renames customer-related data fields and keeps only needed fields.\n  7. Merge node takes in the customer data as an input 2.\n  8. Merge node combines the payment data with the customers one.\n  9. Pipedrive node searches for the organization and creates a note with payment data.\n\n\n",
  "readme_html": "<!--[--><div data-v-50766329=\"\"><p>This workflow combines customers' details with their payment data and passes the input to Pipedrive as a note to the organization.</p>\n<h2>Prerequisites</h2>\n<ul>\n<li>Stripe account and <a href=\"https://docs.n8n.io/integrations/builtin/credentials/stripe/\" rel=\"ugc nofollow\" target=\"_blank\">Stripe credentials</a></li>\n<li>Pipedrive account and <a href=\"https://docs.n8n.io/integrations/builtin/credentials/pipedrive/\" rel=\"ugc nofollow\" target=\"_blank\">Pipedrive credentials</a></li>\n</ul>\n<h2>How it works</h2>\n<ol>\n<li>Cron node triggers the workflow every day at 8 a.m.</li>\n<li>HTTP Request node searches for payments in Stripe.</li>\n<li>The Item Lists node creates separate items from a list of payment data.</li>\n<li>Merge node takes in the payment data as an input 1.</li>\n<li>Stripe node gets all the customers data.</li>\n<li>Set node renames customer-related data fields and keeps only needed fields.</li>\n<li>Merge node takes in the customer data as an input 2.</li>\n<li>Merge node combines the payment data with the customers one.</li>\n<li>Pipedrive node searches for the organization and creates a note with payment data.</li>\n</ol>\n</div><!--]-->",
  "readme_zh": "该工作流将客户详细信息与其支付数据整合，并将输入内容作为机构备注传递至Pipedrive。\n\n## 前置条件\n\n* Stripe账户及[Stripe凭证](https://docs.n8n.io/integrations/builtin/credentials/stripe/)\n* Pipedrive账户及[Pipedrive凭证](https://docs.n8n.io/integrations/builtin/credentials/pipedrive/)\n\n## 运作流程\n\n1. Cron节点每日上午8点触发工作流  \n2. HTTP请求节点在Stripe中检索支付记录  \n3. 项目列表节点从支付数据清单中创建独立条目  \n4. 合并节点接收支付数据作为输入源1  \n5. Stripe节点获取所有客户数据  \n6. 设置节点重命名客户相关字段并仅保留必要字段  \n7. 合并节点接收客户数据作为输入源2  \n8. 合并节点将支付数据与客户数据关联整合  \n9. Pipedrive节点检索对应机构并创建含支付数据的备注",
  "title_zh": "在Stripe和Pipedrive之间同步支付与客户数据",
  "publish_date_zh": "Last update 10 months ago",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"8c8c5237b8e37b006a7adce87f4369350c58e41f3ca9de16196d3197f69eabcd\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"28349bfd-f68e-4479-9508-28d408033d09\",\n      \"name\": \"Get customers\",\n      \"type\": \"n8n-nodes-base.stripe\",\n      \"position\": [\n        5360,\n        1100\n      ],\n      \"parameters\": {\n        \"filters\": {},\n        \"resource\": \"customer\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"stripeApi\": {\n          \"id\": \"26\",\n          \"name\": \"Stripe account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3f3d2389-e9ab-4140-8b04-f0a07003cecc\",\n      \"name\": \"Rename fields and keep only needed fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        5560,\n        1100\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"customerName\",\n              \"value\": \"={{ $json[\\\"name\\\"] }}\"\n            },\n            {\n              \"name\": \"customerId\",\n              \"value\": \"={{ $json[\\\"id\\\"] }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d6d3ccff-f565-49c9-9cda-8e278d298433\",\n      \"name\": \"Add customer name to charge data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        5860,\n        920\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByKey\",\n        \"propertyName1\": \"customer\",\n        \"propertyName2\": \"customerId\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"eadce8e7-f523-485b-8cc0-5a336c8633ef\",\n      \"name\": \"Search organisation\",\n      \"type\": \"n8n-nodes-base.pipedrive\",\n      \"position\": [\n        6140,\n        1060\n      ],\n      \"parameters\": {\n        \"term\": \"={{ $json[\\\"customerName\\\"] }}\",\n        \"resource\": \"organization\",\n        \"operation\": \"search\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"96\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"dde08b48-21b0-44af-a66d-ff69399608e7\",\n      \"name\": \"Add organisation Information to charge data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        6400,\n        940\n      ],\n      \"parameters\": {\n        \"join\": \"inner\",\n        \"mode\": \"mergeByIndex\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6cbd0f06-0f10-4360-8c5c-e181679ba370\",\n      \"name\": \"Create note with charge information\",\n      \"type\": \"n8n-nodes-base.pipedrive\",\n      \"position\": [\n        6620,\n        940\n      ],\n      \"parameters\": {\n        \"content\": \"={{ $json[\\\"description\\\"] }}: {{ $json[\\\"amount\\\"] / 100 }} {{ $json[\\\"currency\\\"] }}\",\n        \"resource\": \"note\",\n        \"additionalFields\": {\n          \"org_id\": \"={{ $json[\\\"id\\\"] }}\"\n        }\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"96\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c6ed5a89-b50a-40ad-bd78-62ffc2430fde\",\n      \"name\": \"Get last execution timestamp\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        5140,\n        900\n      ],\n      \"parameters\": {\n        \"functionCode\": \"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nif(!staticData.lastExecution){\\n  staticData.lastExecution = Math.round( new Date().getTime() / 1000 );\\n}\\n\\nitem.executionTimeStamp = Math.round( new Date().getTime() / 1000 );\\nitem.lastExecution = staticData.lastExecution;\\n\\n\\nreturn item;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"41b2c937-d479-4402-b428-29faabe32845\",\n      \"name\": \"Set new last execution timestamp\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        6820,\n        940\n      ],\n      \"parameters\": {\n        \"functionCode\": \"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nstaticData.lastExecution = $item(0).$node[\\\"Get last execution timestamp\\\"].executionTimeStamp;\\n\\nreturn item;\"\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"56612271-08c4-4347-92b1-b898c68c3460\",\n      \"name\": \"Split array of charges to items\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"position\": [\n        5560,\n        900\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b866ba46-6269-4c8d-8021-ea99591d676d\",\n      \"name\": \"Search for charges in Stripe\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        5360,\n        900\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.stripe.com/v1/charges/search\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"query\",\n              \"value\": \"=created>{{$json[\\\"lastExecution\\\"]}} AND status:\\\"succeeded\\\"\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"stripeApi\"\n      },\n      \"credentials\": {\n        \"stripeApi\": {\n          \"id\": \"26\",\n          \"name\": \"Stripe account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"a3249f70-1cd4-4d5f-8f27-15badcf10296\",\n      \"name\": \"Every day at 8 am\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        4920,\n        900\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"hour\": 8\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Get customers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Rename fields and keep only needed fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Every day at 8 am\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search organisation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add organisation Information to charge data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Get last execution timestamp\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search for charges in Stripe\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search for charges in Stripe\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split array of charges to items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split array of charges to items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add customer name to charge data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add customer name to charge data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search organisation\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Add organisation Information to charge data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create note with charge information\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set new last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Rename fields and keep only needed fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add customer name to charge data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Add organisation Information to charge data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create note with charge information\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
{
  "title": "Error Handling System with PostgreSQL Logging and Rate-Limited Notifications",
  "url": "https://n8n.io/workflows/3882-error-handling-system-with-postgresql-logging-and-rate-limited-notifications/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?sort=createdAt:desc",
  "author": "Davi Saranszky Mesquita",
  "publish_date": "Last update 8 days ago",
  "publish_date_absolute": "",
  "content": "",
  "workflow_json": "{\"id\":\"YybYYc430rmZWJPJ\",\"meta\":{\"instanceId\":\"febfa0961d1e55a48938f0337f348b73a50538aa16673607611ead85d95f662c\",\"templateCredsSetupCompleted\":true},\"name\":\"Log errors and avoid sending too many emails\",\"tags\":[{\"id\":\"7YoU4oTsaGGEtWJj\",\"name\":\"sample\",\"createdAt\":\"2025-01-31T16:41:27.407Z\",\"updatedAt\":\"2025-01-31T16:41:27.407Z\"}],\"nodes\":[{\"id\":\"0e44df4c-00d2-4545-89ae-844a590de369\",\"name\":\"Error Trigger\",\"type\":\"n8n-nodes-base.errorTrigger\",\"position\":[-1200,90],\"parameters\":{},\"typeVersion\":1},{\"id\":\"7101542a-5146-4917-a1f2-13686cad197e\",\"name\":\"Insert Log\",\"type\":\"n8n-nodes-base.postgres\",\"position\":[-980,40],\"parameters\":{\"table\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"N8Err\",\"cachedResultName\":\"N8Err\"},\"schema\":{\"__rl\":true,\"mode\":\"name\",\"value\":\"p1gq6ljdsam3x1m\"},\"columns\":{\"value\":{\"URL\":\"={{ $json.execution.url }}\",\"json\":\"={{ JSON.stringify($json) }}\",\"Stack\":\"={{ $json.execution.error.stack }}\",\"title\":\"={{ $json.workflow.name }}\",\"Message\":\"={{ $json.execution.error.message }}\",\"LastNode\":\"={{ $json.execution.lastNodeExecuted }}\",\"created_at\":\"={{ $now }}\"},\"schema\":[{\"id\":\"id\",\"type\":\"number\",\"display\":true,\"removed\":true,\"required\":false,\"displayName\":\"id\",\"defaultMatch\":true,\"canBeUsedToMatch\":true},{\"id\":\"created_at\",\"type\":\"dateTime\",\"display\":true,\"required\":false,\"displayName\":\"created_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"updated_at\",\"type\":\"dateTime\",\"display\":true,\"removed\":true,\"required\":false,\"displayName\":\"updated_at\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"created_by\",\"type\":\"string\",\"display\":true,\"removed\":true,\"required\":false,\"displayName\":\"created_by\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"updated_by\",\"type\":\"string\",\"display\":true,\"removed\":true,\"required\":false,\"displayName\":\"updated_by\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"nc_order\",\"type\":\"number\",\"display\":true,\"removed\":true,\"required\":false,\"displayName\":\"nc_order\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"title\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"title\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"URL\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"URL\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Stack\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"Stack\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"json\",\"type\":\"object\",\"display\":true,\"required\":false,\"displayName\":\"json\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Message\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"Message\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"LastNode\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"LastNode\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[\"id\"],\"attemptToConvertTypes\":false,\"convertFieldsToString\":false},\"options\":{}},\"credentials\":{\"postgres\":{\"id\":\"2VsRB7eDnG0FA3z2\",\"name\":\"Postgres Nocodb\"}},\"typeVersion\":2.6},{\"id\":\"8fb1201c-353e-466c-8d08-fd969e6b10b1\",\"name\":\"Count for 5 minutes\",\"type\":\"n8n-nodes-base.postgres\",\"position\":[-980,-210],\"parameters\":{\"query\":\"SELECT count(*) FROM p1gq6ljdsam3x1m.\\\"N8Err\\\" where created_at >= $1;\\n\",\"options\":{\"queryReplacement\":\"={{ $now.minus(5, 'minutes').toString() }}\"},\"operation\":\"executeQuery\"},\"credentials\":{\"postgres\":{\"id\":\"2VsRB7eDnG0FA3z2\",\"name\":\"Postgres Nocodb\"}},\"typeVersion\":2.6},{\"id\":\"89f836dc-8141-4c20-a758-bf7ff261a87b\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-2260,-300],\"parameters\":{\"color\":5,\"width\":820,\"height\":1140,\"content\":\"# Log errors and avoid sending too many emails\\n\\n## Use case\\n\\nMost of the time, it’s necessary to log all errors that occur. However, in some cases, a scheduled task or service consuming excessive resources might trigger a surge of errors.\\n\\nTo address this, we can log all errors but limit alerts to a maximum of one notification every 5 minutes.\\n\\n## What this workflow does\\n\\nThis workflow can be configured to receive error events, or you can integrate it **before your own error-handling logic.**  \\n\\nIf used as the **primary error handler**, note that this flow will **only add a database log entry** and take no further action. You’ll need to add your own alerts (e.g., email or push notifications). Below is an example of a notification setup I prefer to use.  \\n\\nAt the end, there’s an **error cleanup** option. This feature is particularly useful in development environments.  \\n\\nIf you already have an error-handling workflow, you can call this one as a **sub-workflow**. Its final steps include cleanup logic to reset the execution state and terminate the workflow.\\n\\n## Setup\\n\\n**Verify all Postgres nodes and credentials when using the 'Error Handling Sample'**\\n\\n## How to adjust it to your needs\\n\\n1) You can set this workflow as a sub-workflow within your existing error-handling setup.\\n\\n2) Alternatively, you can add the \\\"Error Handling Sample\\\" at the end of this workflow, which sends email and push notifications.\\n\\nConfiguration Requirements:\\n\\n⚠️ You must create a database table for this to work!\\n\\n\\n\\nDDL of this sample:\\n\\ncreate table p1gq6ljdsam3x1m.\\\"N8Err\\\"\\n(\\n    id         serial\\n        primary key,\\n    created_at timestamp,\\n    updated_at timestamp,\\n    created_by varchar,\\n    updated_by varchar,\\n    nc_order   numeric,\\n    title      text,\\n    \\\"URL\\\"      text,\\n    \\\"Stack\\\"    text,\\n    json       json,\\n    \\\"Message\\\"  text,\\n    \\\"LastNode\\\" text\\n);\\n\\nalter table p1gq6ljdsam3x1m.\\\"N8Err\\\"\\n    owner to postgres;\\n\\ncreate index \\\"N8Err_order_idx\\\"\\n    on p1gq6ljdsam3x1m.\\\"N8Err\\\" (nc_order);\\n\\nby Davi Saranszky Mesquita\\nhttps://www.linkedin.com/in/mesquitadavi/\"},\"typeVersion\":1},{\"id\":\"fba7fec5-5285-46bd-9cc7-270b7dcc8c5f\",\"name\":\"Principal E-Mail\",\"type\":\"n8n-nodes-base.emailSend\",\"onError\":\"continueErrorOutput\",\"disabled\":true,\"position\":[-980,350],\"webhookId\":\"d76d2e82-b0a8-4e35-88f9-1815d4ce6c79\",\"parameters\":{\"text\":\"={{ $(\\\"Error Trigger\\\").item.json.execution.url }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.lastNodeExecuted }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.message }}\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.stack }}\",\"options\":{\"appendAttribution\":false},\"subject\":\"=Erro -  {{ $(\\\"Error Trigger\\\").item.json.workflow.name }}\",\"toEmail\":\"davimesquita@gmail.com\",\"fromEmail\":\"suporte@ideias.casa\",\"emailFormat\":\"text\"},\"credentials\":{\"smtp\":{\"id\":\"0YIoKeISQNR2kxwO\",\"name\":\"SMTP Resent\"}},\"typeVersion\":2.1},{\"id\":\"979d0e82-42e8-450a-95b1-3c204ad61a50\",\"name\":\"Fallback E-Mail\",\"type\":\"n8n-nodes-base.emailSend\",\"disabled\":true,\"position\":[-760,350],\"webhookId\":\"d76d2e82-b0a8-4e35-88f9-1815d4ce6c79\",\"parameters\":{\"text\":\"={{ $(\\\"Error Trigger\\\").item.json.execution.url }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.lastNodeExecuted }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.message }}\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.stack }}\",\"options\":{\"appendAttribution\":false},\"subject\":\"=Erro -  {{ $(\\\"Error Trigger\\\").item.json.workflow.name }}\",\"toEmail\":\"davimesquita@gmail.com\",\"fromEmail\":\"contato@ideias.casa\",\"emailFormat\":\"text\"},\"credentials\":{\"smtp\":{\"id\":\"UvWloRL7Jyqt8tm9\",\"name\":\"SMTP Contato\"}},\"typeVersion\":2.1},{\"id\":\"6c073c03-e00e-45b1-8f14-faa29fd58472\",\"name\":\"Push mobile notification\",\"type\":\"n8n-nodes-base.pushover\",\"disabled\":true,\"position\":[-980,550],\"parameters\":{\"message\":\"={{ $(\\\"Error Trigger\\\").item.json.workflow.name }} - {{ $(\\\"Error Trigger\\\").item.json.execution.url }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.lastNodeExecuted }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.message }}\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.stack }}\",\"userKey\":\"=u4RMqXQR9EFdeSQBfaL1riBy1Qd953\",\"additionalFields\":{}},\"credentials\":{\"pushoverApi\":{\"id\":\"ae8Jsj87n2hSWDbs\",\"name\":\"Pushover account\"}},\"typeVersion\":1},{\"id\":\"4ca939e4-dcb1-40bd-b5eb-4cd00cb403fb\",\"name\":\"Truncate Log Database\",\"type\":\"n8n-nodes-base.postgres\",\"position\":[-980,810],\"parameters\":{\"table\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"N8Err\",\"cachedResultName\":\"N8Err\"},\"schema\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"p1gq6ljdsam3x1m\",\"cachedResultName\":\"p1gq6ljdsam3x1m\"},\"options\":{},\"operation\":\"deleteTable\",\"restartSequences\":true},\"credentials\":{\"postgres\":{\"id\":\"2VsRB7eDnG0FA3z2\",\"name\":\"Postgres Nocodb\"}},\"typeVersion\":2.6},{\"id\":\"1eaf67ca-fb77-4b76-8ee3-ae65d4b79182\",\"name\":\"Sometimes... just cleanup\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[-1200,810],\"parameters\":{},\"typeVersion\":1},{\"id\":\"01e5a7dd-41a2-43f1-bbf5-241e6791cf18\",\"name\":\"Call this Sample - Prepend to your error catcher\",\"type\":\"n8n-nodes-base.executeWorkflow\",\"disabled\":true,\"position\":[-1200,450],\"parameters\":{\"options\":{},\"workflowId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"\"}},\"typeVersion\":1.2},{\"id\":\"4386788d-5f10-468a-8a02-cff45a4a7ed5\",\"name\":\"See below to prepend this at your error handling\",\"type\":\"n8n-nodes-base.executeWorkflowTrigger\",\"position\":[-1200,-260],\"parameters\":{\"inputSource\":\"passthrough\"},\"typeVersion\":1.1},{\"id\":\"d6aed974-4a36-4edd-809d-867a95d0f6ef\",\"name\":\"If there is no logs in 5 minutes\",\"type\":\"n8n-nodes-base.if\",\"position\":[-760,-210],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"loose\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"a17b915d-f581-4774-a78a-48bc386aebc9\",\"operator\":{\"type\":\"number\",\"operation\":\"lte\"},\"leftValue\":\"={{ $json.count }}\",\"rightValue\":0}]},\"looseTypeValidation\":true},\"typeVersion\":2.2},{\"id\":\"3c49f611-f1a6-409a-a4c6-903dadb27165\",\"name\":\"CleanUp execution. See below if you will prepend this workflow\",\"type\":\"n8n-nodes-base.code\",\"position\":[-540,-10],\"parameters\":{\"jsCode\":\"return [];\"},\"typeVersion\":2},{\"id\":\"192443fc-c032-4815-acc7-c8cf6040cc34\",\"name\":\"Insert your error handling logic after this\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[-540,-260],\"parameters\":{},\"typeVersion\":1},{\"id\":\"2f87907f-816f-4054-8517-bb713a203131\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1350,250],\"parameters\":{\"width\":840,\"height\":460,\"content\":\"# Error handling sample\\n\"},\"typeVersion\":1},{\"id\":\"b173898f-d1d8-4f83-b7b7-ba52cab7651e\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1610,630],\"parameters\":{\"width\":1140,\"height\":340,\"content\":\"# Database Cleanup: Useful in DEV, but DO NOT run in production\"},\"typeVersion\":1}],\"active\":false,\"pinData\":{\"Error Trigger\":[{\"json\":{\"workflow\":{\"id\":\"1\",\"name\":\"Example Workflow\"},\"execution\":{\"id\":231,\"url\":\"https://work.ideias.casa/execution/workflow/1/231\",\"mode\":\"manual\",\"error\":{\"stack\":\"Stacktrace\",\"message\":\"Example Error Message\"},\"retryOf\":\"34\",\"lastNodeExecuted\":\"Node With Error\"}}}]},\"settings\":{\"callerPolicy\":\"workflowsFromSameOwner\",\"executionOrder\":\"v1\",\"saveManualExecutions\":false,\"saveExecutionProgress\":false,\"saveDataErrorExecution\":\"all\",\"saveDataSuccessExecution\":\"none\"},\"versionId\":\"07c6795a-f906-4e22-a15a-4f1984e540a3\",\"connections\":{\"Insert Log\":{\"main\":[[{\"node\":\"CleanUp execution. See below if you will prepend this workflow\",\"type\":\"main\",\"index\":0}]]},\"Error Trigger\":{\"main\":[[{\"node\":\"Insert Log\",\"type\":\"main\",\"index\":0},{\"node\":\"Count for 5 minutes\",\"type\":\"main\",\"index\":0}]]},\"Principal E-Mail\":{\"main\":[[],[{\"node\":\"Fallback E-Mail\",\"type\":\"main\",\"index\":0}]]},\"Count for 5 minutes\":{\"main\":[[{\"node\":\"If there is no logs in 5 minutes\",\"type\":\"main\",\"index\":0}]]},\"Sometimes... just cleanup\":{\"main\":[[{\"node\":\"Truncate Log Database\",\"type\":\"main\",\"index\":0}]]},\"If there is no logs in 5 minutes\":{\"main\":[[{\"node\":\"Insert your error handling logic after this\",\"type\":\"main\",\"index\":0}],[{\"node\":\"CleanUp execution. See below if you will prepend this workflow\",\"type\":\"main\",\"index\":0}]]},\"Call this Sample - Prepend to your error catcher\":{\"main\":[[{\"node\":\"Principal E-Mail\",\"type\":\"main\",\"index\":0},{\"node\":\"Push mobile notification\",\"type\":\"main\",\"index\":0}]]},\"See below to prepend this at your error handling\":{\"main\":[[{\"node\":\"Insert Log\",\"type\":\"main\",\"index\":0},{\"node\":\"Count for 5 minutes\",\"type\":\"main\",\"index\":0}]]},\"CleanUp execution. See below if you will prepend this workflow\":{\"main\":[[]]}}}",
  "readme": "# Log errors and avoid sending too many emails\n\n## Use case\n\nMost of the time, it’s necessary to log all errors that occur. However, in some cases, a scheduled task or service consuming excessive resources might trigger a surge of errors.\n\nTo address this, we can log all errors but limit alerts to a maximum of one notification every 5 minutes.\n\n## What this workflow does\n\nThis workflow can be configured to receive error events, or you can integrate it **before your own error-handling logic.**\n\nIf used as the **primary error handler** , note that this flow will **only add a database log entry** and take no further action. You’ll need to add your own alerts (e.g., email or push notifications). Below is an example of a notification setup I prefer to use.\n\nAt the end, there’s an **error cleanup** option. This feature is particularly useful in development environments.\n\nIf you already have an error-handling workflow, you can call this one as a **sub-workflow**. Its final steps include cleanup logic to reset the execution state and terminate the workflow.\n\n## Setup\n\n**Verify all Postgres nodes and credentials when using the 'Error Handling Sample'**\n\n## How to adjust it to your needs\n\n  1. You can set this workflow as a sub-workflow within your existing error-handling setup.\n\n  2. Alternatively, you can add the \"Error Handling Sample\" at the end of this workflow, which sends email and push notifications.\n\n\n\n\nConfiguration Requirements:\n\n⚠️ You must create a database table for this to work!\n\nDDL of this sample:\n\ncreate table p1gq6ljdsam3x1m.\"N8Err\"  \n(  \nid serial  \nprimary key,  \ncreated_at timestamp,  \nupdated_at timestamp,  \ncreated_by varchar,  \nupdated_by varchar,  \nnc_order numeric,  \ntitle text,  \n\"URL\" text,  \n\"Stack\" text,  \njson json,  \n\"Message\" text,  \n\"LastNode\" text  \n);\n\nalter table p1gq6ljdsam3x1m.\"N8Err\"  \nowner to postgres;\n\ncreate index \"N8Err_order_idx\"  \non p1gq6ljdsam3x1m.\"N8Err\" (nc_order);\n\nby Davi Saranszky Mesquita  \n<https://www.linkedin.com/in/mesquitadavi/>\n",
  "readme_html": "<!--[--><div data-v-859c7806=\"\"><h1>Log errors and avoid sending too many emails</h1>\n<h2>Use case</h2>\n<p>Most of the time, it’s necessary to log all errors that occur. However, in some cases, a scheduled task or service consuming excessive resources might trigger a surge of errors.</p>\n<p>To address this, we can log all errors but limit alerts to a maximum of one notification every 5 minutes.</p>\n<h2>What this workflow does</h2>\n<p>This workflow can be configured to receive error events, or you can integrate it <strong>before your own error-handling logic.</strong></p>\n<p>If used as the <strong>primary error handler</strong>, note that this flow will <strong>only add a database log entry</strong> and take no further action. You’ll need to add your own alerts (e.g., email or push notifications). Below is an example of a notification setup I prefer to use.</p>\n<p>At the end, there’s an <strong>error cleanup</strong> option. This feature is particularly useful in development environments.</p>\n<p>If you already have an error-handling workflow, you can call this one as a <strong>sub-workflow</strong>. Its final steps include cleanup logic to reset the execution state and terminate the workflow.</p>\n<h2>Setup</h2>\n<p><strong>Verify all Postgres nodes and credentials when using the 'Error Handling Sample'</strong></p>\n<h2>How to adjust it to your needs</h2>\n<ol>\n<li>\n<p>You can set this workflow as a sub-workflow within your existing error-handling setup.</p>\n</li>\n<li>\n<p>Alternatively, you can add the \"Error Handling Sample\" at the end of this workflow, which sends email and push notifications.</p>\n</li>\n</ol>\n<p>Configuration Requirements:</p>\n<p>⚠️ You must create a database table for this to work!</p>\n<p>DDL of this sample:</p>\n<p>create table p1gq6ljdsam3x1m.\"N8Err\"<br>\n(<br>\nid         serial<br>\nprimary key,<br>\ncreated_at timestamp,<br>\nupdated_at timestamp,<br>\ncreated_by varchar,<br>\nupdated_by varchar,<br>\nnc_order   numeric,<br>\ntitle      text,<br>\n\"URL\"      text,<br>\n\"Stack\"    text,<br>\njson       json,<br>\n\"Message\"  text,<br>\n\"LastNode\" text<br>\n);</p>\n<p>alter table p1gq6ljdsam3x1m.\"N8Err\"<br>\nowner to postgres;</p>\n<p>create index \"N8Err_order_idx\"<br>\non p1gq6ljdsam3x1m.\"N8Err\" (nc_order);</p>\n<p>by Davi Saranszky Mesquita<br>\n<a href=\"https://www.linkedin.com/in/mesquitadavi/\" rel=\"ugc nofollow\" target=\"_blank\">https://www.linkedin.com/in/mesquitadavi/</a></p>\n</div><!--]-->",
  "title_zh": "带有PostgreSQL日志记录和限速通知的错误处理系统",
  "readme_zh": "# 记录错误并避免发送过多的邮件\n\n## 使用场景\n\n大多数时候，有必要记录所有发生的错误。然而，在某些情况下，某个计划任务或服务可能会由于过度消耗资源而触发大量错误。\n\n为了解决这个问题，我们可以记录所有错误，但将警报频率限制为每 5 分钟最多发送一次通知。\n\n## 此工作流的功能\n\n此工作流可以配置为接收错误事件，或者你可以在**自己的错误处理逻辑之前**集成它。\n\n如果用作**主要错误处理器**，请注意，此流程将**仅添加一个数据库日志条目**，不会执行其他操作。你需要自行添加通知机制（如邮件或推送通知）。下面是我个人偏好的一个通知设置示例。\n\n最后，提供了一个**错误清理**选项。该功能在开发环境中特别有用。\n\n如果你已经有一个错误处理工作流，可以将此工作流作为**子工作流**调用。其最终步骤包括重置执行状态和终止工作流的清理逻辑。\n\n## 设置方法\n\n**使用“错误处理示例”时，请验证所有 Postgres 节点和凭据**\n\n## 如何根据需求进行调整\n\n  1. 你可以将此工作流设置为你现有错误处理配置中的子工作流。\n\n  2. 或者，你可以在此工作流末尾添加“错误处理示例”，用于发送邮件与推送通知。\n\n配置要求：\n\n⚠️ 必须创建一个数据库表才能使用！\n\n示例 DDL：\n\n```sql\ncreate table p1gq6ljdsam3x1m.\"N8Err\"  \n(  \nid serial  \nprimary key,  \ncreated_at timestamp,  \nupdated_at timestamp,  \ncreated_by varchar,  \nupdated_by varchar,  \nnc_order numeric,  \ntitle text,  \n\"URL\" text,  \n\"Stack\" text,  \njson json,  \n\"Message\" text,  \n\"LastNode\" text  \n);\n\nalter table p1gq6ljdsam3x1m.\"N8Err\"  \nowner to postgres;\n\ncreate index \"N8Err_order_idx\"  \non p1gq6ljdsam3x1m.\"N8Err\" (nc_order);\n```\n\n作者：Davi Saranszky Mesquita  \n<https://www.linkedin.com/in/mesquitadavi/>",
  "workflow_json_zh": "{\"id\": \"YybYYc430rmZWJPJ\", \"meta\": {\"instanceId\": \"febfa0961d1e55a48938f0337f348b73a50538aa16673607611ead85d95f662c\", \"templateCredsSetupCompleted\": true}, \"name\": \"记录错误并避免发送过多邮件\", \"tags\": [{\"id\": \"7YoU4oTsaGGEtWJj\", \"name\": \"sample\", \"createdAt\": \"2025-01-31T16:41:27.407Z\", \"updatedAt\": \"2025-01-31T16:41:27.407Z\"}], \"nodes\": [{\"id\": \"0e44df4c-00d2-4545-89ae-844a590de369\", \"name\": \"错误触发器\", \"type\": \"n8n-nodes-base.errorTrigger\", \"position\": [-1200, 90], \"parameters\": {}, \"typeVersion\": 1, \"description\": \"\"}, {\"id\": \"7101542a-5146-4917-a1f2-13686cad197e\", \"name\": \"插入日志\", \"type\": \"n8n-nodes-base.postgres\", \"position\": [-980, 40], \"parameters\": {\"table\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"N8Err\", \"cachedResultName\": \"N8Err\"}, \"schema\": {\"__rl\": true, \"mode\": \"name\", \"value\": \"p1gq6ljdsam3x1m\"}, \"columns\": {\"value\": {\"URL\": \"={{ $json.execution.url }}\", \"json\": \"={{ JSON.stringify($json) }}\", \"Stack\": \"={{ $json.execution.error.stack }}\", \"title\": \"={{ $json.workflow.name }}\", \"Message\": \"={{ $json.execution.error.message }}\", \"LastNode\": \"={{ $json.execution.lastNodeExecuted }}\", \"created_at\": \"={{ $now }}\"}, \"schema\": [{\"id\": \"id\", \"type\": \"number\", \"display\": true, \"removed\": true, \"required\": false, \"displayName\": \"id\", \"defaultMatch\": true, \"canBeUsedToMatch\": true}, {\"id\": \"created_at\", \"type\": \"dateTime\", \"display\": true, \"required\": false, \"displayName\": \"created_at\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"updated_at\", \"type\": \"dateTime\", \"display\": true, \"removed\": true, \"required\": false, \"displayName\": \"updated_at\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"created_by\", \"type\": \"string\", \"display\": true, \"removed\": true, \"required\": false, \"displayName\": \"created_by\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"updated_by\", \"type\": \"string\", \"display\": true, \"removed\": true, \"required\": false, \"displayName\": \"updated_by\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"nc_order\", \"type\": \"number\", \"display\": true, \"removed\": true, \"required\": false, \"displayName\": \"nc_order\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"title\", \"type\": \"string\", \"display\": true, \"required\": false, \"displayName\": \"title\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"URL\", \"type\": \"string\", \"display\": true, \"required\": false, \"displayName\": \"URL\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"Stack\", \"type\": \"string\", \"display\": true, \"required\": false, \"displayName\": \"Stack\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"json\", \"type\": \"object\", \"display\": true, \"required\": false, \"displayName\": \"json\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"Message\", \"type\": \"string\", \"display\": true, \"required\": false, \"displayName\": \"Message\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}, {\"id\": \"LastNode\", \"type\": \"string\", \"display\": true, \"required\": false, \"displayName\": \"LastNode\", \"defaultMatch\": false, \"canBeUsedToMatch\": true}], \"mappingMode\": \"defineBelow\", \"matchingColumns\": [\"id\"], \"attemptToConvertTypes\": false, \"convertFieldsToString\": false}, \"options\": {}}, \"credentials\": {\"postgres\": {\"id\": \"2VsRB7eDnG0FA3z2\", \"name\": \"Postgres Nocodb\"}}, \"typeVersion\": 2.6, \"description\": \"\"}, {\"id\": \"8fb1201c-353e-466c-8d08-fd969e6b10b1\", \"name\": \"统计5分钟内的次数\", \"type\": \"n8n-nodes-base.postgres\", \"position\": [-980, -210], \"parameters\": {\"query\": \"SELECT count(*) FROM p1gq6ljdsam3x1m.\\\"N8Err\\\" where created_at >= $1;\\n\", \"options\": {\"queryReplacement\": \"={{ $now.minus(5, 'minutes').toString() }}\"}, \"operation\": \"executeQuery\"}, \"credentials\": {\"postgres\": {\"id\": \"2VsRB7eDnG0FA3z2\", \"name\": \"Postgres Nocodb\"}}, \"typeVersion\": 2.6, \"description\": \"\"}, {\"id\": \"89f836dc-8141-4c20-a758-bf7ff261a87b\", \"name\": \"便签\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-2260, -300], \"parameters\": {\"color\": 5, \"width\": 820, \"height\": 1140, \"content\": \"# Log errors and avoid sending too many emails\\n\\n## Use case\\n\\nMost of the time, it’s necessary to log all errors that occur. However, in some cases, a scheduled task or service consuming excessive resources might trigger a surge of errors.\\n\\nTo address this, we can log all errors but limit alerts to a maximum of one notification every 5 minutes.\\n\\n## What this workflow does\\n\\nThis workflow can be configured to receive error events, or you can integrate it **before your own error-handling logic.**  \\n\\nIf used as the **primary error handler**, note that this flow will **only add a database log entry** and take no further action. You’ll need to add your own alerts (e.g., email or push notifications). Below is an example of a notification setup I prefer to use.  \\n\\nAt the end, there’s an **error cleanup** option. This feature is particularly useful in development environments.  \\n\\nIf you already have an error-handling workflow, you can call this one as a **sub-workflow**. Its final steps include cleanup logic to reset the execution state and terminate the workflow.\\n\\n## Setup\\n\\n**Verify all Postgres nodes and credentials when using the 'Error Handling Sample'**\\n\\n## How to adjust it to your needs\\n\\n1) You can set this workflow as a sub-workflow within your existing error-handling setup.\\n\\n2) Alternatively, you can add the \\\"Error Handling Sample\\\" at the end of this workflow, which sends email and push notifications.\\n\\nConfiguration Requirements:\\n\\n⚠️ You must create a database table for this to work!\\n\\n\\n\\nDDL of this sample:\\n\\ncreate table p1gq6ljdsam3x1m.\\\"N8Err\\\"\\n(\\n    id         serial\\n        primary key,\\n    created_at timestamp,\\n    updated_at timestamp,\\n    created_by varchar,\\n    updated_by varchar,\\n    nc_order   numeric,\\n    title      text,\\n    \\\"URL\\\"      text,\\n    \\\"Stack\\\"    text,\\n    json       json,\\n    \\\"Message\\\"  text,\\n    \\\"LastNode\\\" text\\n);\\n\\nalter table p1gq6ljdsam3x1m.\\\"N8Err\\\"\\n    owner to postgres;\\n\\ncreate index \\\"N8Err_order_idx\\\"\\n    on p1gq6ljdsam3x1m.\\\"N8Err\\\" (nc_order);\\n\\nby Davi Saranszky Mesquita\\nhttps://www.linkedin.com/in/mesquitadavi/\"}, \"typeVersion\": 1, \"description\": \"\"}, {\"id\": \"fba7fec5-5285-46bd-9cc7-270b7dcc8c5f\", \"name\": \"主要电子邮件\", \"type\": \"n8n-nodes-base.emailSend\", \"onError\": \"continueErrorOutput\", \"disabled\": true, \"position\": [-980, 350], \"webhookId\": \"d76d2e82-b0a8-4e35-88f9-1815d4ce6c79\", \"parameters\": {\"text\": \"={{ $(\\\"Error Trigger\\\").item.json.execution.url }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.lastNodeExecuted }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.message }}\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.stack }}\", \"options\": {\"appendAttribution\": false}, \"subject\": \"=Erro -  {{ $(\\\"Error Trigger\\\").item.json.workflow.name }}\", \"toEmail\": \"davimesquita@gmail.com\", \"fromEmail\": \"suporte@ideias.casa\", \"emailFormat\": \"text\"}, \"credentials\": {\"smtp\": {\"id\": \"0YIoKeISQNR2kxwO\", \"name\": \"SMTP Resent\"}}, \"typeVersion\": 2.1, \"description\": \"\"}, {\"id\": \"979d0e82-42e8-450a-95b1-3c204ad61a50\", \"name\": \"备用电子邮件\", \"type\": \"n8n-nodes-base.emailSend\", \"disabled\": true, \"position\": [-760, 350], \"webhookId\": \"d76d2e82-b0a8-4e35-88f9-1815d4ce6c79\", \"parameters\": {\"text\": \"={{ $(\\\"Error Trigger\\\").item.json.execution.url }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.lastNodeExecuted }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.message }}\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.stack }}\", \"options\": {\"appendAttribution\": false}, \"subject\": \"=Erro -  {{ $(\\\"Error Trigger\\\").item.json.workflow.name }}\", \"toEmail\": \"davimesquita@gmail.com\", \"fromEmail\": \"contato@ideias.casa\", \"emailFormat\": \"text\"}, \"credentials\": {\"smtp\": {\"id\": \"UvWloRL7Jyqt8tm9\", \"name\": \"SMTP Contato\"}}, \"typeVersion\": 2.1, \"description\": \"\"}, {\"id\": \"6c073c03-e00e-45b1-8f14-faa29fd58472\", \"name\": \"推送手机通知\", \"type\": \"n8n-nodes-base.pushover\", \"disabled\": true, \"position\": [-980, 550], \"parameters\": {\"message\": \"={{ $(\\\"Error Trigger\\\").item.json.workflow.name }} - {{ $(\\\"Error Trigger\\\").item.json.execution.url }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.lastNodeExecuted }}\\n\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.message }}\\n{{ $(\\\"Error Trigger\\\").item.json.execution.error.stack }}\", \"userKey\": \"=u4RMqXQR9EFdeSQBfaL1riBy1Qd953\", \"additionalFields\": {}}, \"credentials\": {\"pushoverApi\": {\"id\": \"ae8Jsj87n2hSWDbs\", \"name\": \"Pushover account\"}}, \"typeVersion\": 1, \"description\": \"\"}, {\"id\": \"4ca939e4-dcb1-40bd-b5eb-4cd00cb403fb\", \"name\": \"清空日志数据库\", \"type\": \"n8n-nodes-base.postgres\", \"position\": [-980, 810], \"parameters\": {\"table\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"N8Err\", \"cachedResultName\": \"N8Err\"}, \"schema\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"p1gq6ljdsam3x1m\", \"cachedResultName\": \"p1gq6ljdsam3x1m\"}, \"options\": {}, \"operation\": \"deleteTable\", \"restartSequences\": true}, \"credentials\": {\"postgres\": {\"id\": \"2VsRB7eDnG0FA3z2\", \"name\": \"Postgres Nocodb\"}}, \"typeVersion\": 2.6, \"description\": \"\"}, {\"id\": \"1eaf67ca-fb77-4b76-8ee3-ae65d4b79182\", \"name\": \"有时候……只是清理一下\", \"type\": \"n8n-nodes-base.manualTrigger\", \"position\": [-1200, 810], \"parameters\": {}, \"typeVersion\": 1, \"description\": \"\"}, {\"id\": \"01e5a7dd-41a2-43f1-bbf5-241e6791cf18\", \"name\": \"调用此示例 - 添加到你的错误捕获器前\", \"type\": \"n8n-nodes-base.executeWorkflow\", \"disabled\": true, \"position\": [-1200, 450], \"parameters\": {\"options\": {}, \"workflowId\": {\"__rl\": true, \"mode\": \"id\", \"value\": \"\"}}, \"typeVersion\": 1.2, \"description\": \"\"}, {\"id\": \"4386788d-5f10-468a-8a02-cff45a4a7ed5\", \"name\": \"请参阅下方，添加该节点到你的错误处理流程前\", \"type\": \"n8n-nodes-base.executeWorkflowTrigger\", \"position\": [-1200, -260], \"parameters\": {\"inputSource\": \"passthrough\"}, \"typeVersion\": 1.1, \"description\": \"\"}, {\"id\": \"d6aed974-4a36-4edd-809d-867a95d0f6ef\", \"name\": \"如果5分钟内没有日志\", \"type\": \"n8n-nodes-base.if\", \"position\": [-760, -210], \"parameters\": {\"options\": {}, \"conditions\": {\"options\": {\"version\": 2, \"leftValue\": \"\", \"caseSensitive\": true, \"typeValidation\": \"loose\"}, \"combinator\": \"and\", \"conditions\": [{\"id\": \"a17b915d-f581-4774-a78a-48bc386aebc9\", \"operator\": {\"type\": \"number\", \"operation\": \"lte\"}, \"leftValue\": \"={{ $json.count }}\", \"rightValue\": 0}]}, \"looseTypeValidation\": true}, \"typeVersion\": 2.2, \"description\": \"\"}, {\"id\": \"3c49f611-f1a6-409a-a4c6-903dadb27165\", \"name\": \"清理执行记录。如果你要添加这个流程，请参阅下方说明\", \"type\": \"n8n-nodes-base.code\", \"position\": [-540, -10], \"parameters\": {\"jsCode\": \"return [];\"}, \"typeVersion\": 2, \"description\": \"\"}, {\"id\": \"192443fc-c032-4815-acc7-c8cf6040cc34\", \"name\": \"在此之后插入你的错误处理逻辑\", \"type\": \"n8n-nodes-base.noOp\", \"position\": [-540, -260], \"parameters\": {}, \"typeVersion\": 1, \"description\": \"\"}, {\"id\": \"2f87907f-816f-4054-8517-bb713a203131\", \"name\": \"便签1\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-1350, 250], \"parameters\": {\"width\": 840, \"height\": 460, \"content\": \"# Error handling sample\\n\"}, \"typeVersion\": 1, \"description\": \"\"}, {\"id\": \"b173898f-d1d8-4f83-b7b7-ba52cab7651e\", \"name\": \"便签2\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-1610, 630], \"parameters\": {\"width\": 1140, \"height\": 340, \"content\": \"# Database Cleanup: Useful in DEV, but DO NOT run in production\"}, \"typeVersion\": 1, \"description\": \"\"}], \"active\": false, \"pinData\": {\"Error Trigger\": [{\"json\": {\"workflow\": {\"id\": \"1\", \"name\": \"Example Workflow\"}, \"execution\": {\"id\": 231, \"url\": \"https://work.ideias.casa/execution/workflow/1/231\", \"mode\": \"manual\", \"error\": {\"stack\": \"Stacktrace\", \"message\": \"Example Error Message\"}, \"retryOf\": \"34\", \"lastNodeExecuted\": \"Node With Error\"}}}]}, \"settings\": {\"callerPolicy\": \"workflowsFromSameOwner\", \"executionOrder\": \"v1\", \"saveManualExecutions\": false, \"saveExecutionProgress\": false, \"saveDataErrorExecution\": \"all\", \"saveDataSuccessExecution\": \"none\"}, \"versionId\": \"07c6795a-f906-4e22-a15a-4f1984e540a3\", \"connections\": {\"Insert Log\": {\"main\": [[{\"node\": \"CleanUp execution. See below if you will prepend this workflow\", \"type\": \"main\", \"index\": 0}]]}, \"Error Trigger\": {\"main\": [[{\"node\": \"Insert Log\", \"type\": \"main\", \"index\": 0}, {\"node\": \"Count for 5 minutes\", \"type\": \"main\", \"index\": 0}]]}, \"Principal E-Mail\": {\"main\": [[], [{\"node\": \"Fallback E-Mail\", \"type\": \"main\", \"index\": 0}]]}, \"Count for 5 minutes\": {\"main\": [[{\"node\": \"If there is no logs in 5 minutes\", \"type\": \"main\", \"index\": 0}]]}, \"Sometimes... just cleanup\": {\"main\": [[{\"node\": \"Truncate Log Database\", \"type\": \"main\", \"index\": 0}]]}, \"If there is no logs in 5 minutes\": {\"main\": [[{\"node\": \"Insert your error handling logic after this\", \"type\": \"main\", \"index\": 0}], [{\"node\": \"CleanUp execution. See below if you will prepend this workflow\", \"type\": \"main\", \"index\": 0}]]}, \"Call this Sample - Prepend to your error catcher\": {\"main\": [[{\"node\": \"Principal E-Mail\", \"type\": \"main\", \"index\": 0}, {\"node\": \"Push mobile notification\", \"type\": \"main\", \"index\": 0}]]}, \"See below to prepend this at your error handling\": {\"main\": [[{\"node\": \"Insert Log\", \"type\": \"main\", \"index\": 0}, {\"node\": \"Count for 5 minutes\", \"type\": \"main\", \"index\": 0}]]}, \"CleanUp execution. See below if you will prepend this workflow\": {\"main\": [[]]}}, \"description\": \"\"}"
}
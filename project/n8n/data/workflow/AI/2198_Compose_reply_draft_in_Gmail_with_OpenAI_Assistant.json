{
  "title": "Compose reply draft in Gmail with OpenAI Assistant",
  "url": "https://n8n.io/workflows/2198-compose-reply-draft-in-gmail-with-openai-assistant/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "Oskar",
  "publish_date": "Last update 20 days ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"ad5b12df-3bdf-4672-99a7-0034664f29ef\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1180,120],\"parameters\":{\"color\":4,\"width\":420.4803040774015,\"height\":189.69151356225348,\"content\":\"## Reply draft with OpenAI Assistant\\nThis workflow automatically transfers content of incoming email messages with specific labels into OpenAI Assitant and returns reply draft. After draft is composed, trigger label is deleted from the thread.\\n\\n**Please remember to configure your OpenAI Assistant first.**\"},\"typeVersion\":1},{\"id\":\"80a93a48-0576-4dfb-817a-34cbc215307a\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-740,120],\"parameters\":{\"width\":451.41125086385614,\"height\":313.3056033573073,\"content\":\"### Schedule trigger and get emails\\nRun the workflow in equal intervals and check for threads with specific labels (trigger labels).\"},\"typeVersion\":1},{\"id\":\"0dba2603-8012-47d1-8c60-4068924b74cd\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1180,340],\"parameters\":{\"color\":3,\"width\":421.0932411886662,\"height\":257.42916378714597,\"content\":\"## ⚠️ Note\\n\\n1. Complete video guide for this workflow is available [on my YouTube](https://youtu.be/a8Dhj3Zh9vQ). \\n2. Remember to add your credentials and configure nodes (covered in the video guide).\\n3. If you like this workflow, please subscribe to [my YouTube channel](https://www.youtube.com/@workfloows) and/or [my newsletter](https://workfloows.com/).\\n\\n**Thank you for your support!**\"},\"typeVersion\":1},{\"id\":\"4eb67d90-b834-48f6-8d8a-ed0a9d8321fd\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[520,120],\"parameters\":{\"width\":381.6458068293894,\"height\":313.7892229150129,\"content\":\"### Generate reply\\nTransfer email content to OpenAI Assitant and return AI-generated reply.\\n\"},\"typeVersion\":1},{\"id\":\"fdb6e16b-5f42-4872-bf63-b18a14220cdf\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1160,120],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### Create HTML message\\nConvert incoming Markdown from OpenAI Assistant into HTML content.\"},\"typeVersion\":1},{\"id\":\"111e4276-7f63-4b11-92be-fd9de7e23f05\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1400,120],\"parameters\":{\"width\":461.3148409669012,\"height\":314.75072291501283,\"content\":\"### Build and encode message\\nCreate raw message in RFC standard and encode it into base64 string (please see [Gmail API reference](https://developers.google.com/gmail/api/reference/rest/v1/users.drafts/create) for more details).\"},\"typeVersion\":1},{\"id\":\"0d377266-7fa2-43c4-9259-e8611d52df41\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1880,120],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### Insert reply draft\\nAdd reply draft from OpenAI Assistant to specific Gmail thread.\"},\"typeVersion\":1},{\"id\":\"c743486b-82e0-42f4-bd41-fad6115ac520\",\"name\":\"Sticky Note9\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2120,120],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### Remove label\\nDelete trigger label from the Gmail thread.\"},\"typeVersion\":1},{\"id\":\"dfe99c2e-a8e6-48de-a11d-54adaf98a7fe\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[0,0],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### Return message content\\nRetrieve content of the last message in the thread.\"},\"typeVersion\":1},{\"id\":\"6f228048-4067-494a-af44-080237c2555c\",\"name\":\"Sticky Note11\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[0,340],\"parameters\":{\"width\":470.88389496558545,\"height\":314.75072291501283,\"content\":\"### Get last message from thread\\nReturn all messages for a single thread and pass for further processing only the last one.\"},\"typeVersion\":1},{\"id\":\"bea0ea14-6198-4022-8ddc-a0c9f895d46e\",\"name\":\"Remove AI label from email\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[2180,260],\"webhookId\":\"f19c59fe-49bd-4661-aff3-a50e43e5964a\",\"parameters\":{\"resource\":\"thread\",\"threadId\":\"={{ $('Map fields for further processing').item.json[\\\"threadId\\\"] }}\",\"operation\":\"removeLabels\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"dc9b5760-1669-4f29-b28d-73cd417775b4\",\"name\":\"Add email draft to thread\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1940,260],\"parameters\":{\"url\":\"https://www.googleapis.com/gmail/v1/users/me/drafts\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\\"message\\\":{\\\"raw\\\":\\\"{{ $json.encoded }}\\\", \\\"threadId\\\": \\\"{{ $('Map fields for further processing').item.json[\\\"threadId\\\"] }}\\\"}}\",\"sendBody\":true,\"specifyBody\":\"json\"},\"typeVersion\":4.2},{\"id\":\"dbbb607b-701f-49cd-b872-96522abde5b7\",\"name\":\"Convert raw to base64\",\"type\":\"n8n-nodes-base.code\",\"position\":[1680,260],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"const encoded = Buffer.from($json.raw).toString('base64');\\n\\nreturn { encoded };\"},\"typeVersion\":2},{\"id\":\"9114d833-1c6a-47f1-bc8d-12fb8e17218e\",\"name\":\"Build email raw\",\"type\":\"n8n-nodes-base.set\",\"position\":[1480,260],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"6b6ece46-aeef-4ae5-9a0d-f472e7ced464\",\"name\":\"raw\",\"type\":\"string\",\"value\":\"=To: {{ $json.to }}\\nSubject: {{ $json.subject }}\\nContent-Type: text/html; charset=\\\"utf-8\\\"\\n\\n{{ $json.response }}\"}]}},\"typeVersion\":3.4},{\"id\":\"67c1b6ca-d419-45a9-a1d5-2a6ac157454f\",\"name\":\"Convert response to HTML\",\"type\":\"n8n-nodes-base.markdown\",\"position\":[1220,260],\"parameters\":{\"mode\":\"markdownToHtml\",\"options\":{},\"markdown\":\"={{ $json.response }}\"},\"typeVersion\":1},{\"id\":\"97be72d7-20dd-4829-bf1c-f738fb6a8a21\",\"name\":\"Map fields for further processing\",\"type\":\"n8n-nodes-base.set\",\"position\":[980,260],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"d5022255-06d2-4322-b51e-ae80b7f6eef6\",\"name\":\"response\",\"type\":\"string\",\"value\":\"={{ $json.output }}\"},{\"id\":\"f729def0-3905-4c7d-ad1d-86ef7b001e9c\",\"name\":\"threadId\",\"type\":\"string\",\"value\":\"={{ $('Get single message content').item.json[\\\"threadId\\\"] }}\"},{\"id\":\"3ef18ad8-7328-4b97-bd6d-9d395a3c4a48\",\"name\":\"to\",\"type\":\"string\",\"value\":\"={{ $('Get single message content').item.json[\\\"from\\\"][\\\"text\\\"] }}\"},{\"id\":\"b013770d-fce2-4030-b372-8d94f04b51e9\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $('Get single message content').item.json[\\\"subject\\\"] }}\"},{\"id\":\"69cc71b6-614d-4528-a598-69fbde1b5fd9\",\"name\":\"messageId\",\"type\":\"string\",\"value\":\"={{ $('Get threads with specific labels').item.json[\\\"id\\\"] }}\"}]}},\"typeVersion\":3.4},{\"id\":\"545a4296-5307-42ee-8935-2886338e2518\",\"name\":\"Ask OpenAI Assistant\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[580,260],\"parameters\":{\"text\":\"={{ $json.text }}\",\"prompt\":\"define\",\"options\":{},\"resource\":\"assistant\",\"assistantId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"asst_s32wsRpwU1HbLt40wRhghB6Y\",\"cachedResultName\":\"Eva\"}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.8},{\"id\":\"4f326fec-e4bb-42dc-9f26-4a3d8ce86f24\",\"name\":\"Get single message content\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[60,120],\"webhookId\":\"1ddb410c-fcdd-4230-967a-cf7844727877\",\"parameters\":{\"messageId\":\"={{ $json.id }}\",\"operation\":\"get\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"faeb879f-db00-47b7-8995-9fb9025079cf\",\"name\":\"Return last message in thread\",\"type\":\"n8n-nodes-base.limit\",\"position\":[280,460],\"parameters\":{\"keep\":\"lastItems\"},\"typeVersion\":1},{\"id\":\"8085cb54-3c85-4450-9e42-825a9d467d6b\",\"name\":\"Get thread messages\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[60,460],\"webhookId\":\"d53aee55-4233-42e3-b0b7-2b4521956013\",\"parameters\":{\"options\":{},\"resource\":\"thread\",\"threadId\":\"={{ $json.id }}\",\"operation\":\"get\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"8a3c1885-8a05-4357-85ea-03cb9e8b24fa\",\"name\":\"Loop over threads\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[-200,260],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"74197fae-823e-47bc-a1c9-b2fbe90b1171\",\"name\":\"Get threads with specific labels\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[-460,260],\"webhookId\":\"6b7faf91-cc60-482c-b661-dbd702cba2cc\",\"parameters\":{\"filters\":{\"labelIds\":[]},\"resource\":\"thread\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"a3360f69-b8e6-4ef8-933a-352243ab9125\",\"name\":\"Schedule trigger (1 min)\",\"type\":\"n8n-nodes-base.scheduleTrigger\",\"position\":[-680,260],\"parameters\":{\"rule\":{\"interval\":[{\"field\":\"minutes\",\"minutesInterval\":1}]}},\"typeVersion\":1.2}],\"pinData\":{},\"connections\":{\"Build email raw\":{\"main\":[[{\"node\":\"Convert raw to base64\",\"type\":\"main\",\"index\":0}]]},\"Loop over threads\":{\"main\":[[{\"node\":\"Get single message content\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Get thread messages\",\"type\":\"main\",\"index\":0}]]},\"Get thread messages\":{\"main\":[[{\"node\":\"Return last message in thread\",\"type\":\"main\",\"index\":0}]]},\"Ask OpenAI Assistant\":{\"main\":[[{\"node\":\"Map fields for further processing\",\"type\":\"main\",\"index\":0}]]},\"Convert raw to base64\":{\"main\":[[{\"node\":\"Add email draft to thread\",\"type\":\"main\",\"index\":0}]]},\"Convert response to HTML\":{\"main\":[[{\"node\":\"Build email raw\",\"type\":\"main\",\"index\":0}]]},\"Schedule trigger (1 min)\":{\"main\":[[{\"node\":\"Get threads with specific labels\",\"type\":\"main\",\"index\":0}]]},\"Add email draft to thread\":{\"main\":[[{\"node\":\"Remove AI label from email\",\"type\":\"main\",\"index\":0}]]},\"Get single message content\":{\"main\":[[{\"node\":\"Ask OpenAI Assistant\",\"type\":\"main\",\"index\":0}]]},\"Return last message in thread\":{\"main\":[[{\"node\":\"Loop over threads\",\"type\":\"main\",\"index\":0}]]},\"Get threads with specific labels\":{\"main\":[[{\"node\":\"Loop over threads\",\"type\":\"main\",\"index\":0}]]},\"Map fields for further processing\":{\"main\":[[{\"node\":\"Convert response to HTML\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow uses OpenAI Assistant to compose draft replies for labeled email messages. It automatically connects the drafts to Gmail threads.\n\n💡 You can add knowledge base to your OpenAI Assistant and make your reply drafts very customized (e.g. compose response with product information in response to inquiry from customer).\n\n🎬 See this workflow in action [in my YouTube video](https://youtu.be/a8Dhj3Zh9vQ) about automating Gmail.\n\n## How it works?\n\nThe workflow is triggered at regular intervals (default: every 1 minute – you can change this value) to check for messages with a specific label (e.g., \"AI\").\n\nThe content of the retrieved email message is then forwarded to the OpenAI Assistant node, and a reply draft is generated. Next, the response from the Assistant is converted to HTML, and a raw message in RFC standard is composed.\n\n💡 You can learn more about composing drafts with the Gmail API in [the official Google documentation](https://developers.google.com/gmail/api/reference/rest/v1/users.drafts/create).\n\nThe raw email message (reply draft) is encoded and attached to the original thread ID. Finally, the trigger label (in this case: \"AI\") is removed to prevent the workflow from looping.\n\n## Set up steps\n\n  1. Set credentials for Gmail and OpenAI.\n  2. Add new label in Gmail account for messages that should be handled by the workflow (e.g. name it \"AI\").\n  3. Select this label in the first and last Gmail nodes in workflow.\n  4. Create and configure your OpenAI Assistant. Select your assistant in \"OpenAI Assistant\" node.\n  5. Optionally: change trigger interval (by default interval is 1 minute).\n\n\n\nIf you like this workflow, please subscribe to [my YouTube channel](https://www.youtube.com/@workfloows/) and/or [my newsletter](https://workfloows.com/).\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><p>This workflow uses OpenAI Assistant to compose draft replies for labeled email messages. It automatically connects the drafts to Gmail threads.</p>\n<p>💡 You can add knowledge base to your OpenAI Assistant and make your reply drafts very customized (e.g. compose response with product information in response to inquiry from customer).</p>\n<p>🎬 See this workflow in action <a href=\"https://youtu.be/a8Dhj3Zh9vQ\" rel=\"ugc nofollow\" target=\"_blank\">in my YouTube video</a> about automating Gmail.</p>\n<h2>How it works?</h2>\n<p>The workflow is triggered at regular intervals (default: every 1 minute – you can change this value) to check for messages with a specific label (e.g., \"AI\").</p>\n<p>The content of the retrieved email message is then forwarded to the OpenAI Assistant node, and a reply draft is generated. Next, the response from the Assistant is converted to HTML, and a raw message in RFC standard is composed.</p>\n<p>💡 You can learn more about composing drafts with the Gmail API in <a href=\"https://developers.google.com/gmail/api/reference/rest/v1/users.drafts/create\" rel=\"ugc nofollow\" target=\"_blank\">the official Google documentation</a>.</p>\n<p>The raw email message (reply draft) is encoded and attached to the original thread ID. Finally, the trigger label (in this case: \"AI\") is removed to prevent the workflow from looping.</p>\n<h2>Set up steps</h2>\n<ol>\n<li>Set credentials for Gmail and OpenAI.</li>\n<li>Add new label in Gmail account for messages that should be handled by the workflow (e.g. name it \"AI\").</li>\n<li>Select this label in the first and last Gmail nodes in workflow.</li>\n<li>Create and configure your OpenAI Assistant. Select your assistant in \"OpenAI Assistant\" node.</li>\n<li>Optionally: change trigger interval (by default interval is 1 minute).</li>\n</ol>\n<p>If you like this workflow, please subscribe to <a href=\"https://www.youtube.com/@workfloows/\" rel=\"ugc nofollow\" target=\"_blank\">my YouTube channel</a> and/or <a href=\"https://workfloows.com/\" rel=\"ugc nofollow\" target=\"_blank\">my newsletter</a>.</p>\n</div><!--]-->",
  "readme_zh": "该工作流利用OpenAI助手为带标签的邮件撰写回复草稿，并自动将草稿关联至Gmail邮件线程。\n\n💡 您可为OpenAI助手添加知识库，使回复草稿高度定制化（例如根据客户咨询内容整合产品信息进行回复）。\n\n🎬 观看[我的YouTube视频](https://youtu.be/a8Dhj3Zh9vQ)了解该Gmail自动化工作流的实际应用。\n\n## 运作原理\n\n工作流会定时触发（默认每分钟1次，可调整间隔），检查带有特定标签（如\"AI\"）的邮件。\n\n获取邮件内容后，将其传递至OpenAI助手节点生成回复草稿。随后将助手的回复转为HTML格式，并按RFC标准组合成原始邮件格式。\n\n💡 关于通过Gmail API创建草稿的更多信息，可参阅[谷歌官方文档](https://developers.google.com/gmail/api/reference/rest/v1/users.drafts/create)。\n\n原始邮件（回复草稿）经编码后附加至原邮件线程ID。最后移除触发标签（本例为\"AI\"）以防止工作流循环执行。\n\n## 设置步骤\n\n1. 配置Gmail和OpenAI的访问凭证  \n2. 在Gmail账户中为需处理的邮件创建新标签（如命名为\"AI\"）  \n3. 在工作流首尾的Gmail节点中选择该标签  \n4. 创建并配置OpenAI助手，在\"OpenAI助手\"节点中选择您的助手  \n5. 可选：调整触发间隔（默认1分钟）  \n\n若喜欢本工作流，欢迎订阅[我的YouTube频道](https://www.youtube.com/@workfloows/)及[我的电子报](https://workfloows.com/)。",
  "title_zh": "在Gmail中使用OpenAI助手撰写回复草稿",
  "publish_date_absolute": "2025-04-16",
  "publish_date_zh": "上次更新于20天前",
  "workflow_json_zh": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"ad5b12df-3bdf-4672-99a7-0034664f29ef\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1180,120],\"parameters\":{\"color\":4,\"width\":420.4803040774015,\"height\":189.69151356225348,\"content\":\"## 使用OpenAI助手的回复草稿功能\\n该工作流会自动将带有特定标签的接收邮件内容导入OpenAI助手，并生成回复草稿。草稿撰写完成后，系统会自动移除邮件线程上的触发标签。\\n\\n**请务必提前完成OpenAI助手的配置工作。**\"},\"typeVersion\":1},{\"id\":\"80a93a48-0576-4dfb-817a-34cbc215307a\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-740,120],\"parameters\":{\"width\":451.41125086385614,\"height\":313.3056033573073,\"content\":\"### 定时触发并获取邮件\\n以固定间隔运行工作流，并检查带有特定标签（触发标签）的邮件线程。\"},\"typeVersion\":1},{\"id\":\"0dba2603-8012-47d1-8c60-4068924b74cd\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1180,340],\"parameters\":{\"color\":3,\"width\":421.0932411886662,\"height\":257.42916378714597,\"content\":\"## ⚠️ 注意事项\\n\\n1. 本工作流的完整视频教程可在[我的YouTube频道](https://youtu.be/a8Dhj3Zh9vQ)观看。\\n2. 请记得添加您的凭证并配置节点（视频教程中已涵盖）。\\n3. 如果您喜欢这个工作流，欢迎订阅[我的YouTube频道](https://www.youtube.com/@workfloows)和/或[我的电子报](https://workfloows.com/)。\\n\\n**感谢您的支持！**\"},\"typeVersion\":1},{\"id\":\"4eb67d90-b834-48f6-8d8a-ed0a9d8321fd\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[520,120],\"parameters\":{\"width\":381.6458068293894,\"height\":313.7892229150129,\"content\":\"### 生成回复\\n将邮件内容转发至OpenAI助手并返回AI生成的回复。\"},\"typeVersion\":1},{\"id\":\"fdb6e16b-5f42-4872-bf63-b18a14220cdf\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1160,120],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### 创建HTML消息\\n将来自OpenAI助手的Markdown内容转换为HTML格式。\"},\"typeVersion\":1},{\"id\":\"111e4276-7f63-4b11-92be-fd9de7e23f05\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1400,120],\"parameters\":{\"width\":461.3148409669012,\"height\":314.75072291501283,\"content\":\"### 构建并编码邮件  \\n按照RFC标准创建原始邮件内容，并将其编码为base64字符串（更多详情请参阅[Gmail API参考文档](https://developers.google.com/gmail/api/reference/rest/v1/users.drafts/create)）。\"},\"typeVersion\":1},{\"id\":\"0d377266-7fa2-43c4-9259-e8611d52df41\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1880,120],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### 插入回复草稿\\n将OpenAI助手的回复草稿添加到特定的Gmail邮件线程中。\"},\"typeVersion\":1},{\"id\":\"c743486b-82e0-42f4-bd41-fad6115ac520\",\"name\":\"Sticky Note9\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2120,120],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### 移除标签\\n从Gmail会话中删除触发标签。\"},\"typeVersion\":1},{\"id\":\"dfe99c2e-a8e6-48de-a11d-54adaf98a7fe\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[0,0],\"parameters\":{\"width\":219.88389496558554,\"height\":314.75072291501283,\"content\":\"### 返回消息内容\\n获取线程中最后一条消息的内容。\"},\"typeVersion\":1},{\"id\":\"6f228048-4067-494a-af44-080237c2555c\",\"name\":\"Sticky Note11\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[0,340],\"parameters\":{\"width\":470.88389496558545,\"height\":314.75072291501283,\"content\":\"### 从线程获取最后一条消息\\n返回单个线程的所有消息，并仅将最后一条传递至后续处理流程。\"},\"typeVersion\":1},{\"id\":\"bea0ea14-6198-4022-8ddc-a0c9f895d46e\",\"name\":\"Remove AI label from email\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[2180,260],\"webhookId\":\"f19c59fe-49bd-4661-aff3-a50e43e5964a\",\"parameters\":{\"resource\":\"thread\",\"threadId\":\"={{ $('Map fields for further processing').item.json[\\\"threadId\\\"] }}\",\"operation\":\"removeLabels\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"dc9b5760-1669-4f29-b28d-73cd417775b4\",\"name\":\"Add email draft to thread\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1940,260],\"parameters\":{\"url\":\"https://www.googleapis.com/gmail/v1/users/me/drafts\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\\"message\\\":{\\\"raw\\\":\\\"{{ $json.encoded }}\\\", \\\"threadId\\\": \\\"{{ $('Map fields for further processing').item.json[\\\"threadId\\\"] }}\\\"}}\",\"sendBody\":true,\"specifyBody\":\"json\"},\"typeVersion\":4.2},{\"id\":\"dbbb607b-701f-49cd-b872-96522abde5b7\",\"name\":\"Convert raw to base64\",\"type\":\"n8n-nodes-base.code\",\"position\":[1680,260],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"const encoded = Buffer.from($json.raw).toString('base64');\\n\\nreturn { encoded };\"},\"typeVersion\":2},{\"id\":\"9114d833-1c6a-47f1-bc8d-12fb8e17218e\",\"name\":\"Build email raw\",\"type\":\"n8n-nodes-base.set\",\"position\":[1480,260],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"6b6ece46-aeef-4ae5-9a0d-f472e7ced464\",\"name\":\"raw\",\"type\":\"string\",\"value\":\"=To: {{ $json.to }}\\nSubject: {{ $json.subject }}\\nContent-Type: text/html; charset=\\\"utf-8\\\"\\n\\n{{ $json.response }}\"}]}},\"typeVersion\":3.4},{\"id\":\"67c1b6ca-d419-45a9-a1d5-2a6ac157454f\",\"name\":\"Convert response to HTML\",\"type\":\"n8n-nodes-base.markdown\",\"position\":[1220,260],\"parameters\":{\"mode\":\"markdownToHtml\",\"options\":{},\"markdown\":\"={{ $json.response }}\"},\"typeVersion\":1},{\"id\":\"97be72d7-20dd-4829-bf1c-f738fb6a8a21\",\"name\":\"Map fields for further processing\",\"type\":\"n8n-nodes-base.set\",\"position\":[980,260],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"d5022255-06d2-4322-b51e-ae80b7f6eef6\",\"name\":\"response\",\"type\":\"string\",\"value\":\"={{ $json.output }}\"},{\"id\":\"f729def0-3905-4c7d-ad1d-86ef7b001e9c\",\"name\":\"threadId\",\"type\":\"string\",\"value\":\"={{ $('Get single message content').item.json[\\\"threadId\\\"] }}\"},{\"id\":\"3ef18ad8-7328-4b97-bd6d-9d395a3c4a48\",\"name\":\"to\",\"type\":\"string\",\"value\":\"={{ $('Get single message content').item.json[\\\"from\\\"][\\\"text\\\"] }}\"},{\"id\":\"b013770d-fce2-4030-b372-8d94f04b51e9\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $('Get single message content').item.json[\\\"subject\\\"] }}\"},{\"id\":\"69cc71b6-614d-4528-a598-69fbde1b5fd9\",\"name\":\"messageId\",\"type\":\"string\",\"value\":\"={{ $('Get threads with specific labels').item.json[\\\"id\\\"] }}\"}]}},\"typeVersion\":3.4},{\"id\":\"545a4296-5307-42ee-8935-2886338e2518\",\"name\":\"Ask OpenAI Assistant\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[580,260],\"parameters\":{\"text\":\"={{ $json.text }}\",\"prompt\":\"define\",\"options\":{},\"resource\":\"assistant\",\"assistantId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"asst_s32wsRpwU1HbLt40wRhghB6Y\",\"cachedResultName\":\"Eva\"}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.8},{\"id\":\"4f326fec-e4bb-42dc-9f26-4a3d8ce86f24\",\"name\":\"Get single message content\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[60,120],\"webhookId\":\"1ddb410c-fcdd-4230-967a-cf7844727877\",\"parameters\":{\"messageId\":\"={{ $json.id }}\",\"operation\":\"get\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"faeb879f-db00-47b7-8995-9fb9025079cf\",\"name\":\"Return last message in thread\",\"type\":\"n8n-nodes-base.limit\",\"position\":[280,460],\"parameters\":{\"keep\":\"lastItems\"},\"typeVersion\":1},{\"id\":\"8085cb54-3c85-4450-9e42-825a9d467d6b\",\"name\":\"Get thread messages\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[60,460],\"webhookId\":\"d53aee55-4233-42e3-b0b7-2b4521956013\",\"parameters\":{\"options\":{},\"resource\":\"thread\",\"threadId\":\"={{ $json.id }}\",\"operation\":\"get\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"8a3c1885-8a05-4357-85ea-03cb9e8b24fa\",\"name\":\"Loop over threads\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[-200,260],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"74197fae-823e-47bc-a1c9-b2fbe90b1171\",\"name\":\"Get threads with specific labels\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[-460,260],\"webhookId\":\"6b7faf91-cc60-482c-b661-dbd702cba2cc\",\"parameters\":{\"filters\":{\"labelIds\":[]},\"resource\":\"thread\"},\"credentials\":{\"gmailOAuth2\":{\"id\":\"Sf5Gfl9NiFTNXFWb\",\"name\":\"Gmail account\"}},\"typeVersion\":2.1},{\"id\":\"a3360f69-b8e6-4ef8-933a-352243ab9125\",\"name\":\"Schedule trigger (1 min)\",\"type\":\"n8n-nodes-base.scheduleTrigger\",\"position\":[-680,260],\"parameters\":{\"rule\":{\"interval\":[{\"field\":\"minutes\",\"minutesInterval\":1}]}},\"typeVersion\":1.2}],\"pinData\":{},\"connections\":{\"Build email raw\":{\"main\":[[{\"node\":\"Convert raw to base64\",\"type\":\"main\",\"index\":0}]]},\"Loop over threads\":{\"main\":[[{\"node\":\"Get single message content\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Get thread messages\",\"type\":\"main\",\"index\":0}]]},\"Get thread messages\":{\"main\":[[{\"node\":\"Return last message in thread\",\"type\":\"main\",\"index\":0}]]},\"Ask OpenAI Assistant\":{\"main\":[[{\"node\":\"Map fields for further processing\",\"type\":\"main\",\"index\":0}]]},\"Convert raw to base64\":{\"main\":[[{\"node\":\"Add email draft to thread\",\"type\":\"main\",\"index\":0}]]},\"Convert response to HTML\":{\"main\":[[{\"node\":\"Build email raw\",\"type\":\"main\",\"index\":0}]]},\"Schedule trigger (1 min)\":{\"main\":[[{\"node\":\"Get threads with specific labels\",\"type\":\"main\",\"index\":0}]]},\"Add email draft to thread\":{\"main\":[[{\"node\":\"Remove AI label from email\",\"type\":\"main\",\"index\":0}]]},\"Get single message content\":{\"main\":[[{\"node\":\"Ask OpenAI Assistant\",\"type\":\"main\",\"index\":0}]]},\"Return last message in thread\":{\"main\":[[{\"node\":\"Loop over threads\",\"type\":\"main\",\"index\":0}]]},\"Get threads with specific labels\":{\"main\":[[{\"node\":\"Loop over threads\",\"type\":\"main\",\"index\":0}]]},\"Map fields for further processing\":{\"main\":[[{\"node\":\"Convert response to HTML\",\"type\":\"main\",\"index\":0}]]}}}"
}
{
  "title": "Chat with PDF docs using AI (quoting sources)",
  "url": "https://n8n.io/workflows/2165-chat-with-pdf-docs-using-ai-quoting-sources/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "David Roberts",
  "publish_date": "Last update a month ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"e2e61eae-6306-47db-908c-9d82758f6516\",\"name\":\"When clicking \\\"Execute Workflow\\\"\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[-660,40],\"parameters\":{},\"typeVersion\":1},{\"id\":\"a45afcc0-d780-462a-9ed7-27daf01363a7\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-500,-140],\"parameters\":{\"color\":7,\"width\":1086.039382705461,\"height\":728.4168721167887,\"content\":\"## 1. Setup: Fetch file from Google Drive, split it into chunks and insert into a vector database\\nNote that running this part multiple times will insert multiple copies into your DB\"},\"typeVersion\":1},{\"id\":\"a3c56569-0728-4246-8d87-fa106d373566\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-960,-60],\"parameters\":{\"height\":350.7942096493649,\"content\":\"# Try me out\\n1. In Pinecone, create an index with 1536 dimensions and select it in the two vector store nodes\\n2. Populate Pinecone by clicking the 'test workflow' button below\\n3. Click the 'chat' button below and enter the following:\\n\\n_Which email provider does the creator of Bitcoin use?_\"},\"typeVersion\":1},{\"id\":\"c1543b8a-dbea-42a9-a35e-e22ed86f565b\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-500,640],\"parameters\":{\"color\":7,\"width\":1594,\"height\":529,\"content\":\"## 2. Chat with file, getting citations in reponse\"},\"typeVersion\":1},{\"id\":\"5300d5dd-4186-4402-9442-88adab4e9a89\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-480,-40],\"parameters\":{\"color\":7,\"width\":179.58883583572606,\"height\":257.75985739596473,\"content\":\"Will fetch the Bitcoin whitepaper, but you can change this\"},\"typeVersion\":1},{\"id\":\"9f707f2b-6cb2-47b8-88fc-65cfd09b6cae\",\"name\":\"Pinecone Vector Store\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStorePinecone\",\"position\":[80,40],\"parameters\":{\"mode\":\"insert\",\"options\":{},\"pineconeIndex\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"test-index\"}},\"credentials\":{\"pineconeApi\":{\"id\":\"OHDlDbBkaPDgpnOY\",\"name\":\"PineconeApi account\"}},\"typeVersion\":1},{\"id\":\"a32ac59e-efdc-4ff3-92dd-be794c2be7f7\",\"name\":\"When chat message received\",\"type\":\"@n8n/n8n-nodes-langchain.chatTrigger\",\"position\":[-660,760],\"webhookId\":\"cd2703a7-f912-46fe-8787-3fb83ea116ab\",\"parameters\":{\"options\":{}},\"typeVersion\":1.1},{\"id\":\"e14145d2-0c18-4813-9555-263314cb0376\",\"name\":\"OpenAI Chat Model1\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[340,980],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"e6863abd-d3df-4b45-9083-96b82cd46773\",\"name\":\"Set file URL in Google Drive\",\"type\":\"n8n-nodes-base.set\",\"position\":[-440,40],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"dc7a70e3-9b04-404b-8892-ba0fcc4274c2\",\"name\":\"file_url\",\"type\":\"string\",\"value\":\" https://drive.google.com/file/d/11Koq9q53nkk0F5Y8eZgaWJUVR03I4-MM/view\"}]}},\"typeVersion\":3.4},{\"id\":\"80d241f1-7c8a-489e-9255-84bc79ec11c7\",\"name\":\"Download file\",\"type\":\"n8n-nodes-base.googleDrive\",\"position\":[-220,40],\"parameters\":{\"fileId\":{\"__rl\":true,\"mode\":\"url\",\"value\":\"={{ $json.file_url }}\"},\"options\":{},\"operation\":\"download\"},\"credentials\":{\"googleDriveOAuth2Api\":{\"id\":\"yOwz41gMQclOadgu\",\"name\":\"Google Drive account\"}},\"typeVersion\":3},{\"id\":\"8483b283-1ff4-4540-891a-09886c146e16\",\"name\":\"Default Data Loader\",\"type\":\"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\"position\":[180,240],\"parameters\":{\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"file_url\",\"value\":\"={{ $('Set file URL in Google Drive').first().json.file_url }}\"},{\"name\":\"file_name\",\"value\":\"={{ $('Download file').first().binary.data.fileName }}\"}]}},\"dataType\":\"binary\"},\"typeVersion\":1},{\"id\":\"c262df34-b2d9-4f48-b975-d694469e6e5a\",\"name\":\"Embeddings OpenAI2\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[-220,980],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"45c8e8cb-a29e-48ad-985f-e0136065840f\",\"name\":\"Embeddings OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[40,240],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"8c852568-f100-4849-a06f-86e71733512a\",\"name\":\"Recursive Character Text Splitter\",\"type\":\"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\"position\":[260,400],\"parameters\":{\"options\":{},\"chunkSize\":3000,\"chunkOverlap\":200},\"typeVersion\":1},{\"id\":\"319e5b2d-c648-4ef5-8238-7732c62d34f5\",\"name\":\"Set max chunks to send to model\",\"type\":\"n8n-nodes-base.set\",\"position\":[-420,760],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"33f4addf-72f3-4618-a6ba-5b762257d723\",\"name\":\"chunks\",\"type\":\"number\",\"value\":4}]},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"91b9132e-ef51-4044-be1b-f391aeeb467c\",\"name\":\"Get top chunks matching query\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStorePinecone\",\"position\":[-220,760],\"parameters\":{\"mode\":\"load\",\"topK\":\"={{ $json.chunks }}\",\"prompt\":\"={{ $json.chatInput }}\",\"options\":{},\"pineconeIndex\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"test-index\"}},\"credentials\":{\"pineconeApi\":{\"id\":\"OHDlDbBkaPDgpnOY\",\"name\":\"PineconeApi account\"}},\"typeVersion\":1},{\"id\":\"5ad6e0fd-c296-4507-8232-164b5be57f4a\",\"name\":\"Prepare chunks\",\"type\":\"n8n-nodes-base.code\",\"position\":[140,760],\"parameters\":{\"jsCode\":\"let out = \\\"\\\"\\nfor (const i in $input.all()) {\\n  let itemText = \\\"--- CHUNK \\\" + i + \\\" ---\\\\n\\\"\\n  itemText += $input.all()[i].json.document.pageContent + \\\"\\\\n\\\"\\n  itemText += \\\"\\\\n\\\"\\n  out += itemText\\n}\\n\\nreturn {\\n  'context': out\\n};\"},\"typeVersion\":2},{\"id\":\"770b066a-abb2-443e-bcaa-14632c6696f4\",\"name\":\"Answer the query based on chunks\",\"type\":\"@n8n/n8n-nodes-langchain.informationExtractor\",\"position\":[340,760],\"parameters\":{\"text\":\"={{ $json.context }}\\n\\nQuestion: {{ $('When chat message received').first().json.chatInput }}\\nHelpful Answer:\",\"options\":{\"systemPromptTemplate\":\"=Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer. Important: In your response, also include the the indexes of the chunks you used to generate the answer.\"},\"schemaType\":\"manual\",\"inputSchema\":\"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"required\\\": [\\\"answer\\\", \\\"citations\\\"],\\n  \\\"properties\\\": {\\n    \\\"answer\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"citations\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"number\\\"\\n      }\\n    }\\n  }\\n}\"},\"typeVersion\":1},{\"id\":\"e43abc0c-cedf-4e73-a766-7fad57601cfe\",\"name\":\"Compose citations\",\"type\":\"n8n-nodes-base.set\",\"position\":[700,760],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"ace6185e-8b3d-4f89-ae36-dfe0c391a0a9\",\"name\":\"citations\",\"type\":\"array\",\"value\":\"={{ $json.citations.map(i => '[' + $('Get top chunks matching query').all()[$json.citations].json.document.metadata.file_name + ', lines ' + $('Get top chunks matching query').all()[$json.citations].json.document.metadata['loc.lines.from'] + '-' + $('Get top chunks matching query').all()[$json.citations].json.document.metadata['loc.lines.to'] + ']') }}\"}]}},\"typeVersion\":3.4},{\"id\":\"f82df340-42fc-4e92-9e9d-d808f19e0407\",\"name\":\"Generate response\",\"type\":\"n8n-nodes-base.set\",\"position\":[900,760],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"11396286-0378-4c3a-86e1-c9ef51afbfc7\",\"name\":\"text\",\"type\":\"string\",\"value\":\"={{ $json.answer }} {{ $if(!$json.citations.isEmpty(), \\\"\\\\n\\\" + $json.citations.join(\\\"\\\"), '') }}\"}]}},\"typeVersion\":3.4}],\"pinData\":{},\"connections\":{\"Download file\":{\"main\":[[{\"node\":\"Pinecone Vector Store\",\"type\":\"main\",\"index\":0}]]},\"Prepare chunks\":{\"main\":[[{\"node\":\"Answer the query based on chunks\",\"type\":\"main\",\"index\":0}]]},\"Compose citations\":{\"main\":[[{\"node\":\"Generate response\",\"type\":\"main\",\"index\":0}]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"Pinecone Vector Store\",\"type\":\"ai_embedding\",\"index\":0}]]},\"Embeddings OpenAI2\":{\"ai_embedding\":[[{\"node\":\"Get top chunks matching query\",\"type\":\"ai_embedding\",\"index\":0}]]},\"OpenAI Chat Model1\":{\"ai_languageModel\":[[{\"node\":\"Answer the query based on chunks\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Default Data Loader\":{\"ai_document\":[[{\"node\":\"Pinecone Vector Store\",\"type\":\"ai_document\",\"index\":0}]]},\"When chat message received\":{\"main\":[[{\"node\":\"Set max chunks to send to model\",\"type\":\"main\",\"index\":0}]]},\"Set file URL in Google Drive\":{\"main\":[[{\"node\":\"Download file\",\"type\":\"main\",\"index\":0}]]},\"Get top chunks matching query\":{\"main\":[[{\"node\":\"Prepare chunks\",\"type\":\"main\",\"index\":0}]]},\"Set max chunks to send to model\":{\"main\":[[{\"node\":\"Get top chunks matching query\",\"type\":\"main\",\"index\":0}]]},\"Answer the query based on chunks\":{\"main\":[[{\"node\":\"Compose citations\",\"type\":\"main\",\"index\":0}]]},\"When clicking \\\"Execute Workflow\\\"\":{\"main\":[[{\"node\":\"Set file URL in Google Drive\",\"type\":\"main\",\"index\":0}]]},\"Recursive Character Text Splitter\":{\"ai_textSplitter\":[[{\"node\":\"Default Data Loader\",\"type\":\"ai_textSplitter\",\"index\":0}]]}}}",
  "readme": "This workflow allows you to ask questions about a PDF document. The answers are provided by an AI model of your choice, and the answer includes a citation pointing to the information it used.\n\nYou can use n8n’s built-in chat interface to ask the questions, or you could customise this workflow to use another one (e.g. Slack, Teams, etc.)\n\n### Example\n\nThe workflow is set up with the Bitcoin whitepaper. So you could ask things like:\n\n_Question: “Which email provider does the creator of Bitcoin use?“_  \n_Answer: “GMX [Bitcoin whitepaper.pdf, lines 1-35]”_\n\n### Requirements\n\n  1. A Pinecone account (they have a free tier at the time of writing that is easily enough for this workflow)\n  2. Access to a large language model (e.g. an OpenAI account)\n\n\n\n### Customizing this workflow\n\nThe workflow only reads in one document, but you could customise it to read in all the documents in a folder (or more).\n\nThe workflow is set up to use GPT 3.5, but you could swap that out for any other model (including self-hosted ones).\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><p>This workflow allows you to ask questions about a PDF document. The answers are provided by an AI model of your choice, and the answer includes a citation pointing to the information it used.</p>\n<p>You can use n8n’s built-in chat interface to ask the questions, or you could customise this workflow to use another one (e.g. Slack, Teams, etc.)</p>\n<h3>Example</h3>\n<p>The workflow is set up with the Bitcoin whitepaper. So you could ask things like:</p>\n<p><em>Question: “Which email provider does the creator of Bitcoin use?“</em><br>\n<em>Answer: “GMX [Bitcoin whitepaper.pdf, lines 1-35]”</em></p>\n<h3>Requirements</h3>\n<ol>\n<li>A Pinecone account (they have a free tier at the time of writing that is easily enough for this workflow)</li>\n<li>Access to a large language model (e.g. an OpenAI account)</li>\n</ol>\n<h3>Customizing this workflow</h3>\n<p>The workflow only reads in one document, but you could customise it to read in all the documents in a folder (or more).</p>\n<p>The workflow is set up to use GPT 3.5, but you could swap that out for any other model (including self-hosted ones).</p>\n</div><!--]-->",
  "readme_zh": "该工作流支持您对PDF文档进行提问，所选AI模型将提供答案并附带引用来源标注。\n\n您可直接使用n8n内置的聊天界面提问，也可自定义该工作流接入其他平台（如Slack、Teams等）\n\n### 示例\n\n本工作流已预置比特币白皮书作为示例文档，您可以提问例如：\n\n_问题：\"比特币创始人使用哪个邮箱服务商？\"_  \n_回答：\"GMX [比特币白皮书.pdf, 第1-35行]\"_\n\n### 需求条件\n\n1. Pinecone账号（当前免费版即可满足本工作流需求）\n2. 大型语言模型调用权限（如OpenAI账号）\n\n### 自定义设置\n\n当前工作流仅支持单文档读取，但可扩展为读取整个文件夹内的文档\n\n默认配置使用GPT-3.5模型，可替换为任意其他模型（包括自托管模型）",
  "title_zh": "利用AI与PDF文档对话（支持引用来源）",
  "publish_date_absolute": "",
  "publish_date_zh": "上次更新于一个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"e2e61eae-6306-47db-908c-9d82758f6516\",\n      \"name\": \"When clicking \\\"Execute Workflow\\\"\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -660,\n        40\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a45afcc0-d780-462a-9ed7-27daf01363a7\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -500,\n        -140\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1086.039382705461,\n        \"height\": 728.4168721167887,\n        \"content\": \"## 1. 设置：从Google Drive获取文件，将其分割成块并插入向量数据库\\n请注意，多次运行此部分将在数据库中插入多个副本\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a3c56569-0728-4246-8d87-fa106d373566\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -960,\n        -60\n      ],\n      \"parameters\": {\n        \"height\": 350.7942096493649,\n        \"content\": \"# 试试看\\n1. 在Pinecone中创建一个1536维度的索引，并在两个向量存储节点中选择它\\n2. 点击下方的\\\"测试工作流\\\"按钮来填充Pinecone\\n3. 点击下方的\\\"聊天\\\"按钮并输入以下内容：\\n\\n_比特币创始人使用哪个电子邮件服务商？_\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c1543b8a-dbea-42a9-a35e-e22ed86f565b\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -500,\n        640\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1594,\n        \"height\": 529,\n        \"content\": \"## 2. 与文件对话，在回复中获取引用\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5300d5dd-4186-4402-9442-88adab4e9a89\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -480,\n        -40\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 179.58883583572606,\n        \"height\": 257.75985739596473,\n        \"content\": \"将获取比特币白皮书，但您可以更改此内容\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9f707f2b-6cb2-47b8-88fc-65cfd09b6cae\",\n      \"name\": \"Pinecone Vector Store\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStorePinecone\",\n      \"position\": [\n        80,\n        40\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"options\": {},\n        \"pineconeIndex\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"test-index\"\n        }\n      },\n      \"credentials\": {\n        \"pineconeApi\": {\n          \"id\": \"OHDlDbBkaPDgpnOY\",\n          \"name\": \"PineconeApi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a32ac59e-efdc-4ff3-92dd-be794c2be7f7\",\n      \"name\": \"When chat message received\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        -660,\n        760\n      ],\n      \"webhookId\": \"cd2703a7-f912-46fe-8787-3fb83ea116ab\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"e14145d2-0c18-4813-9555-263314cb0376\",\n      \"name\": \"OpenAI Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        340,\n        980\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"e6863abd-d3df-4b45-9083-96b82cd46773\",\n      \"name\": \"Set file URL in Google Drive\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -440,\n        40\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"dc7a70e3-9b04-404b-8892-ba0fcc4274c2\",\n              \"name\": \"file_url\",\n              \"type\": \"string\",\n              \"value\": \" https://drive.google.com/file/d/11Koq9q53nkk0F5Y8eZgaWJUVR03I4-MM/view\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"80d241f1-7c8a-489e-9255-84bc79ec11c7\",\n      \"name\": \"Download file\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        -220,\n        40\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"url\",\n          \"value\": \"={{ $json.file_url }}\"\n        },\n        \"options\": {},\n        \"operation\": \"download\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"yOwz41gMQclOadgu\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"8483b283-1ff4-4540-891a-09886c146e16\",\n      \"name\": \"Default Data Loader\",\n      \"type\": \"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\n      \"position\": [\n        180,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"file_url\",\n                \"value\": \"={{ $('Set file URL in Google Drive').first().json.file_url }}\"\n              },\n              {\n                \"name\": \"file_name\",\n                \"value\": \"={{ $('Download file').first().binary.data.fileName }}\"\n              }\n            ]\n          }\n        },\n        \"dataType\": \"binary\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c262df34-b2d9-4f48-b975-d694469e6e5a\",\n      \"name\": \"Embeddings OpenAI2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        -220,\n        980\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"45c8e8cb-a29e-48ad-985f-e0136065840f\",\n      \"name\": \"Embeddings OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        40,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"8c852568-f100-4849-a06f-86e71733512a\",\n      \"name\": \"Recursive Character Text Splitter\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\n      \"position\": [\n        260,\n        400\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"chunkSize\": 3000,\n        \"chunkOverlap\": 200\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"319e5b2d-c648-4ef5-8238-7732c62d34f5\",\n      \"name\": \"Set max chunks to send to model\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -420,\n        760\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"33f4addf-72f3-4618-a6ba-5b762257d723\",\n              \"name\": \"chunks\",\n              \"type\": \"number\",\n              \"value\": 4\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"91b9132e-ef51-4044-be1b-f391aeeb467c\",\n      \"name\": \"Get top chunks matching query\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStorePinecone\",\n      \"position\": [\n        -220,\n        760\n      ],\n      \"parameters\": {\n        \"mode\": \"load\",\n        \"topK\": \"={{ $json.chunks }}\",\n        \"prompt\": \"={{ $json.chatInput }}\",\n        \"options\": {},\n        \"pineconeIndex\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"test-index\"\n        }\n      },\n      \"credentials\": {\n        \"pineconeApi\": {\n          \"id\": \"OHDlDbBkaPDgpnOY\",\n          \"name\": \"PineconeApi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5ad6e0fd-c296-4507-8232-164b5be57f4a\",\n      \"name\": \"Prepare chunks\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        140,\n        760\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let out = \\\"\\\"\\nfor (const i in $input.all()) {\\n  let itemText = \\\"--- CHUNK \\\" + i + \\\" ---\\\\n\\\"\\n  itemText += $input.all()[i].json.document.pageContent + \\\"\\\\n\\\"\\n  itemText += \\\"\\\\n\\\"\\n  out += itemText\\n}\\n\\nreturn {\\n  'context': out\\n};\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"770b066a-abb2-443e-bcaa-14632c6696f4\",\n      \"name\": \"Answer the query based on chunks\",\n      \"type\": \"@n8n/n8n-nodes-langchain.informationExtractor\",\n      \"position\": [\n        340,\n        760\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $json.context }}\\n\\nQuestion: {{ $('When chat message received').first().json.chatInput }}\\nHelpful Answer:\",\n        \"options\": {\n          \"systemPromptTemplate\": \"=Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer. Important: In your response, also include the the indexes of the chunks you used to generate the answer.\"\n        },\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"required\\\": [\\\"answer\\\", \\\"citations\\\"],\\n  \\\"properties\\\": {\\n    \\\"answer\\\": {\\n      \\\"type\\\": \\\"string\\\"\\n    },\\n    \\\"citations\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"number\\\"\\n      }\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e43abc0c-cedf-4e73-a766-7fad57601cfe\",\n      \"name\": \"Compose citations\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        700,\n        760\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"ace6185e-8b3d-4f89-ae36-dfe0c391a0a9\",\n              \"name\": \"citations\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.citations.map(i => '[' + $('Get top chunks matching query').all()[$json.citations].json.document.metadata.file_name + ', lines ' + $('Get top chunks matching query').all()[$json.citations].json.document.metadata['loc.lines.from'] + '-' + $('Get top chunks matching query').all()[$json.citations].json.document.metadata['loc.lines.to'] + ']') }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"f82df340-42fc-4e92-9e9d-d808f19e0407\",\n      \"name\": \"Generate response\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        900,\n        760\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"11396286-0378-4c3a-86e1-c9ef51afbfc7\",\n              \"name\": \"text\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.answer }} {{ $if(!$json.citations.isEmpty(), \\\"\\\\n\\\" + $json.citations.join(\\\"\\\"), '') }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Download file\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Pinecone Vector Store\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Prepare chunks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Answer the query based on chunks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Compose citations\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate response\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Pinecone Vector Store\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI2\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Get top chunks matching query\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Answer the query based on chunks\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Default Data Loader\": {\n      \"ai_document\": [\n        [\n          {\n            \"node\": \"Pinecone Vector Store\",\n            \"type\": \"ai_document\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When chat message received\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set max chunks to send to model\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set file URL in Google Drive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download file\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get top chunks matching query\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prepare chunks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set max chunks to send to model\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get top chunks matching query\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Answer the query based on chunks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Compose citations\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking \\\"Execute Workflow\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set file URL in Google Drive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Recursive Character Text Splitter\": {\n      \"ai_textSplitter\": [\n        [\n          {\n            \"node\": \"Default Data Loader\",\n            \"type\": \"ai_textSplitter\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
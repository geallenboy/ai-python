{
  "title": "Agentic Telegram AI bot with with LangChain nodes and new tools",
  "url": "https://n8n.io/workflows/2592-agentic-telegram-ai-bot-with-with-langchain-nodes-and-new-tools/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "Yulia",
  "publish_date": "Last update 5 months ago",
  "content": "",
  "workflow_json": "{\"id\":\"U8EOTtZvmZPMYc6m\",\"meta\":{\"instanceId\":\"fb924c73af8f703905bc09c9ee8076f48c17b596ed05b18c0ff86915ef8a7c4a\",\"templateCredsSetupCompleted\":true},\"name\":\"Agentic Telegram AI bot with LangChain nodes and new tools\",\"tags\":[],\"nodes\":[{\"id\":\"13b3488e-af72-4d89-bef4-e9b895e3bf76\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1640,580],\"parameters\":{\"model\":\"gpt-4o\",\"options\":{\"temperature\":0.7,\"frequencyPenalty\":0.2}},\"credentials\":{\"openAiApi\":{\"id\":\"rveqdSfp7pCRON1T\",\"name\":\"Ted's Tech Talks OpenAi\"}},\"typeVersion\":1},{\"id\":\"864937a1-43f6-4055-bdea-61ab07db9903\",\"name\":\"Window Buffer Memory\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[1760,580],\"parameters\":{\"sessionKey\":\"=chat_with_{{ $('Listen for incoming events').first().json.message.chat.id }}\",\"contextWindowLength\":10},\"typeVersion\":1},{\"id\":\"4ef838d4-feaa-4bd3-b2c7-ccd938be4373\",\"name\":\"Listen for incoming events\",\"type\":\"n8n-nodes-base.telegramTrigger\",\"position\":[1580,360],\"webhookId\":\"322dce18-f93e-4f86-b9b1-3305519b7834\",\"parameters\":{\"updates\":[\"*\"],\"additionalFields\":{}},\"credentials\":{\"telegramApi\":{\"id\":\"9dexJXnlVPA6wt8K\",\"name\":\"Chat & Sound\"}},\"typeVersion\":1},{\"id\":\"fed51c41-2846-4a1a-a5f5-ce121ee7fe88\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1460,180],\"parameters\":{\"color\":7,\"width\":926.3188190787038,\"height\":553.452795998601,\"content\":\"## Generate an image with Dall-E-3 and send it via Telegram\"},\"typeVersion\":1},{\"id\":\"1c7a204b-3ed7-47bd-a434-202b05272d18\",\"name\":\"Send final reply\",\"type\":\"n8n-nodes-base.telegram\",\"onError\":\"continueErrorOutput\",\"position\":[2140,360],\"parameters\":{\"text\":\"={{ $json.output }}\",\"chatId\":\"={{ $('Listen for incoming events').first().json.message.from.id }}\",\"additionalFields\":{\"appendAttribution\":false}},\"credentials\":{\"telegramApi\":{\"id\":\"9dexJXnlVPA6wt8K\",\"name\":\"Chat & Sound\"}},\"typeVersion\":1.1},{\"id\":\"bebbe9d4-47ba-4c13-9e1e-d36bfe6e472e\",\"name\":\"Send back an image\",\"type\":\"n8n-nodes-base.telegramTool\",\"position\":[2020,580],\"parameters\":{\"file\":\"={{ $fromAI(\\\"url\\\", \\\"a valid url of an image\\\", \\\"string\\\", \\\" \\\") }}\",\"chatId\":\"={{ $('Listen for incoming events').first().json.message.from.id }}\",\"operation\":\"sendDocument\",\"additionalFields\":{}},\"credentials\":{\"telegramApi\":{\"id\":\"9dexJXnlVPA6wt8K\",\"name\":\"Chat & Sound\"}},\"typeVersion\":1.2},{\"id\":\"38f2410d-bd55-4ddf-8aaa-4e28919de78f\",\"name\":\"Generate image in Dalle\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1880,580],\"parameters\":{\"url\":\"https://api.openai.com/v1/images/generations\",\"method\":\"POST\",\"sendBody\":true,\"authentication\":\"predefinedCredentialType\",\"parametersBody\":{\"values\":[{\"name\":\"model\",\"value\":\"dall-e-3\",\"valueProvider\":\"fieldValue\"},{\"name\":\"prompt\"}]},\"toolDescription\":\"Call this tool to request a Dall-E-3 model, when the user asks to draw something. If you gеt a response from this tool, forward it to the Telegram tool.\",\"nodeCredentialType\":\"openAiApi\"},\"credentials\":{\"openAiApi\":{\"id\":\"rveqdSfp7pCRON1T\",\"name\":\"Ted's Tech Talks OpenAi\"}},\"typeVersion\":1.1},{\"id\":\"34265eab-9f37-475a-a2ae-a6c37c69c595\",\"name\":\"AI Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[1780,360],\"parameters\":{\"text\":\"={{ $json.message.text }}\",\"options\":{\"systemMessage\":\"=You are a helpful assistant. You are communicating with a user named {{ $json.message.from.first_name }}. Address the user by name every time. If the user asks for an image, always send the link to the image in the final reply.\"},\"promptType\":\"define\"},\"typeVersion\":1.7}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"b36989c5-295a-4df6-84e9-776815509bc9\",\"connections\":{\"AI Agent\":{\"main\":[[{\"node\":\"Send final reply\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"AI Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Send back an image\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Window Buffer Memory\":{\"ai_memory\":[[{\"node\":\"AI Agent\",\"type\":\"ai_memory\",\"index\":0}]]},\"Generate image in Dalle\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Listen for incoming events\":{\"main\":[[{\"node\":\"AI Agent\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "Create a Telegram bot that combines advanced AI functionalities with LangChain nodes and new tools.\n\n[Nodes as tools](https://community.n8n.io/t/review-node-as-tools-is-finally-here/57539) and the [HTTP request tool](https://community.n8n.io/t/using-the-http-request-tool-with-ai-agents/50616/3) are a new n8n feature that extend [custom workflow tool](https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.toolworkflow/) and simplify your setup. We used the workflow tool in the [previous Telegram template](https://n8n.io/workflows/2035-telegram-ai-bot-with-langchain-nodes/) to call the Dalle-3 model.\n\nIn the new version, we've achieved similar results using the HTTP Request tool and the Telegram node tool instead. The main difference is that Telegram bot becomes more flexible. The LangChain Agent node can decide which tool to use and when. In the previous version, all steps inside the custom workflow tool were executed sequentially.\n\n⚠️ Note that you'd need to select the Tools Agent to work with new tools.\n\nBefore launching the template, make sure to set up your OpenAI and Telegram credentials.\n\nHere’s how the new Telegram bot works:\n\n  1. Telegram Trigger listens for new messages in a specified Telegram chat. This node activates the rest of the workflow after receiving a message.\n\n  2. AI Tool Agent receives input text, processes it using the OpenAI model and replies to a user. It addresses users by name and sends image links when an image is requested.\n\n  3. The OpenAI GPT-4o model generates context-aware responses. You can configure the model parameters or swap this node entirely.\n\n  4. Window buffer memory helps maintain context across conversations. It stores the last 10 interactions and ensures that the agent can access previous messages within a session. Conversations from different users are stored in different buffers.\n\n  5. The HTTP request tool connects with OpenAI's DALL-E-3 API to generate images based on user prompts. The tool is called when the user asks for an image.\n\n  6. Telegram node tool sends generated images back to the user in a Telegram chat. It retrieves the image from the URL returned by the DALL-E-3 model. This does not happen directly, however. The response from the HTTP request tool is first stored in the Agent’s scratchpad (think of it as a short-term memory). In the next iteration, the Agent sends the updated response to the GPT model once again. The GPT model will then create a new tool request to send the image back to the user. To pass the image URL, the tool uses the [new $fromAI() expression](https://docs.n8n.io/advanced-ai/examples/using-the-fromai-function/).\n\n  7. Send final reply node sends the final response message created by the agent back to the user on Telegram. Even though the image was already passed to the user, the Agent always stops with the final response that comes from dedicated output.\n\n\n\n\n⚠️ Note, that the Agent may not adhere to the same sequence of actions in 100% of situations. For example, sometimes it could skip sending the file via the Telegram node tool and instead just send an URL in the final reply. If you have a longer series of predefined steps, it may be better to use the “old” custom workflow tool.\n\nThis template is perfect as a starting point for building AI agentic workflow. Take a look at another agentic [Telegram AI template that can handle both text and voice messages](https://n8n.io/workflows/2534-telegram-ai-bot-assistant-ready-made-template-for-voice-and-text-messages/).\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><p>Create a Telegram bot that combines advanced AI functionalities with LangChain nodes and new tools.</p>\n<p><a href=\"https://community.n8n.io/t/review-node-as-tools-is-finally-here/57539\" rel=\"ugc nofollow\" target=\"_blank\">Nodes as tools</a> and the <a href=\"https://community.n8n.io/t/using-the-http-request-tool-with-ai-agents/50616/3\" rel=\"ugc nofollow\" target=\"_blank\">HTTP request tool</a> are a new n8n feature that extend <a href=\"https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.toolworkflow/\" rel=\"ugc nofollow\" target=\"_blank\">custom workflow tool</a> and simplify your setup. We used the workflow tool in the <a href=\"https://n8n.io/workflows/2035-telegram-ai-bot-with-langchain-nodes/\" rel=\"ugc nofollow\" target=\"_blank\">previous Telegram template</a> to call the Dalle-3 model.</p>\n<p>In the new version, we've achieved similar results using the HTTP Request tool and the Telegram node tool instead. The main difference is that Telegram bot becomes more flexible. The LangChain Agent node can decide which tool to use and when. In the previous version, all steps inside the custom workflow tool were executed sequentially.</p>\n<p>⚠️ Note that you'd need to select the Tools Agent to work with new tools.</p>\n<p>Before launching the template, make sure to set up your OpenAI and Telegram credentials.</p>\n<p>Here’s how the new Telegram bot works:</p>\n<ol>\n<li>\n<p>Telegram Trigger listens for new messages in a specified Telegram chat. This node activates the rest of the workflow after receiving a message.</p>\n</li>\n<li>\n<p>AI Tool Agent receives input text, processes it using the OpenAI model and replies to a user. It addresses users by name and sends image links when an image is requested.</p>\n</li>\n<li>\n<p>The OpenAI GPT-4o model generates context-aware responses. You can configure the model parameters or swap this node entirely.</p>\n</li>\n<li>\n<p>Window buffer memory helps maintain context across conversations. It stores the last 10 interactions and ensures that the agent can access previous messages within a session. Conversations from different users are stored in different buffers.</p>\n</li>\n<li>\n<p>The HTTP request tool connects with OpenAI's DALL-E-3 API to generate images based on user prompts. The tool is called when the user asks for an image.</p>\n</li>\n<li>\n<p>Telegram node tool sends generated images back to the user in a Telegram chat. It retrieves the image from the URL returned by the DALL-E-3 model. This does not happen directly, however. The response from the HTTP request tool is first stored in the Agent’s scratchpad (think of it as a short-term memory). In the next iteration, the Agent sends the updated response to the GPT model once again. The GPT model will then create a new tool request to send the image back to the user. To pass the image URL, the tool uses the <a href=\"https://docs.n8n.io/advanced-ai/examples/using-the-fromai-function/\" rel=\"ugc nofollow\" target=\"_blank\">new $fromAI() expression</a>.</p>\n</li>\n<li>\n<p>Send final reply node sends the final response message created by the agent back to the user on Telegram. Even though the image was already passed to the user, the Agent always stops with the final response that comes from dedicated output.</p>\n</li>\n</ol>\n<p>⚠️ Note, that the Agent may not adhere to the same sequence of actions in 100% of situations. For example, sometimes it could skip sending the file via the Telegram node tool and instead just send an URL in the final reply. If you have a longer series of predefined steps, it may be better to use the “old” custom workflow tool.</p>\n<p>This template is perfect as a starting point for building AI agentic workflow. Take a look at another agentic <a href=\"https://n8n.io/workflows/2534-telegram-ai-bot-assistant-ready-made-template-for-voice-and-text-messages/\" rel=\"ugc nofollow\" target=\"_blank\">Telegram AI template that can handle both text and voice messages</a>.</p>\n</div><!--]-->",
  "readme_zh": "创建一个结合高级AI功能与LangChain节点及新工具的Telegram机器人。\n\n[节点即工具](https://community.n8n.io/t/review-node-as-tools-is-finally-here/57539)和[HTTP请求工具](https://community.n8n.io/t/using-the-http-request-tool-with-ai-agents/50616/3)是n8n的新特性，它们扩展了[自定义工作流工具](https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.toolworkflow/)并简化了配置。我们在[先前的Telegram模板](https://n8n.io/workflows/2035-telegram-ai-bot-with-langchain-nodes/)中使用工作流工具调用了Dalle-3模型。\n\n新版本中，我们改用HTTP请求工具和Telegram节点工具实现了类似效果。核心区别在于Telegram机器人变得更灵活——LangChain代理节点能自主决定何时使用何种工具。旧版本中，自定义工作流工具内的所有步骤都是顺序执行的。\n\n⚠️ 注意：需选择\"工具代理\"才能使用新工具。\n\n启动模板前，请确保配置好OpenAI和Telegram凭证。\n\n新版Telegram机器人运作流程：\n\n1. **Telegram触发器**监听指定聊天的新消息，接收消息后激活后续工作流  \n2. **AI工具代理**处理输入文本，通过OpenAI模型生成回复。会称呼用户姓名，并在请求图片时发送图片链接  \n3. **OpenAI GPT-4o模型**生成上下文感知响应，参数可调或完全替换  \n4. **窗口缓冲记忆**维持跨对话上下文，存储最近10轮交互，确保代理能访问会话历史（不同用户的对话存储于独立缓冲区）  \n5. **HTTP请求工具**连接DALL-E-3 API生成图片，当用户请求图片时触发  \n6. **Telegram节点工具**将生成图片发送至聊天窗口。图片URL通过DALL-E-3返回后，先存入代理的临时记忆区（scratchpad），经GPT模型二次处理生成新的工具请求来发送图片。此处使用[新版$fromAI()表达式](https://docs.n8n.io/advanced-ai/examples/using-the-fromai-function/)传递图片URL  \n7. **最终回复节点**将代理生成的文字响应发送给用户。即使图片已发送，代理始终会从专用输出端口返回最终文本响应  \n\n⚠️ 注意：代理并非100%遵循固定动作序列。例如有时可能跳过Telegram节点工具直接发送图片URL。若需执行长串预定义步骤，建议使用\"旧版\"自定义工作流工具。\n\n本模板是构建AI代理工作流的理想起点。另推荐查看支持[文字与语音消息的Telegram AI助手模板](https://n8n.io/workflows/2534-telegram-ai-bot-assistant-ready-made-template-for-voice-and-text-messages/)。",
  "title_zh": "具备LangChain节点及新工具的自主Telegram AI机器人",
  "publish_date_absolute": "2024-12-06",
  "publish_date_zh": "最后更新于5个月前",
  "workflow_json_zh": "{\"id\":\"U8EOTtZvmZPMYc6m\",\"meta\":{\"instanceId\":\"fb924c73af8f703905bc09c9ee8076f48c17b596ed05b18c0ff86915ef8a7c4a\",\"templateCredsSetupCompleted\":true},\"name\":\"Agentic Telegram AI bot with LangChain nodes and new tools\",\"tags\":[],\"nodes\":[{\"id\":\"13b3488e-af72-4d89-bef4-e9b895e3bf76\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1640,580],\"parameters\":{\"model\":\"gpt-4o\",\"options\":{\"temperature\":0.7,\"frequencyPenalty\":0.2}},\"credentials\":{\"openAiApi\":{\"id\":\"rveqdSfp7pCRON1T\",\"name\":\"Ted's Tech Talks OpenAi\"}},\"typeVersion\":1},{\"id\":\"864937a1-43f6-4055-bdea-61ab07db9903\",\"name\":\"Window Buffer Memory\",\"type\":\"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\"position\":[1760,580],\"parameters\":{\"sessionKey\":\"=chat_with_{{ $('Listen for incoming events').first().json.message.chat.id }}\",\"contextWindowLength\":10},\"typeVersion\":1},{\"id\":\"4ef838d4-feaa-4bd3-b2c7-ccd938be4373\",\"name\":\"Listen for incoming events\",\"type\":\"n8n-nodes-base.telegramTrigger\",\"position\":[1580,360],\"webhookId\":\"322dce18-f93e-4f86-b9b1-3305519b7834\",\"parameters\":{\"updates\":[\"*\"],\"additionalFields\":{}},\"credentials\":{\"telegramApi\":{\"id\":\"9dexJXnlVPA6wt8K\",\"name\":\"Chat & Sound\"}},\"typeVersion\":1},{\"id\":\"fed51c41-2846-4a1a-a5f5-ce121ee7fe88\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1460,180],\"parameters\":{\"color\":7,\"width\":926.3188190787038,\"height\":553.452795998601,\"content\":\"## 使用Dall-E-3生成图片并通过Telegram发送\"},\"typeVersion\":1},{\"id\":\"1c7a204b-3ed7-47bd-a434-202b05272d18\",\"name\":\"Send final reply\",\"type\":\"n8n-nodes-base.telegram\",\"onError\":\"continueErrorOutput\",\"position\":[2140,360],\"parameters\":{\"text\":\"={{ $json.output }}\",\"chatId\":\"={{ $('Listen for incoming events').first().json.message.from.id }}\",\"additionalFields\":{\"appendAttribution\":false}},\"credentials\":{\"telegramApi\":{\"id\":\"9dexJXnlVPA6wt8K\",\"name\":\"Chat & Sound\"}},\"typeVersion\":1.1},{\"id\":\"bebbe9d4-47ba-4c13-9e1e-d36bfe6e472e\",\"name\":\"Send back an image\",\"type\":\"n8n-nodes-base.telegramTool\",\"position\":[2020,580],\"parameters\":{\"file\":\"={{ $fromAI(\\\"url\\\", \\\"a valid url of an image\\\", \\\"string\\\", \\\" \\\") }}\",\"chatId\":\"={{ $('Listen for incoming events').first().json.message.from.id }}\",\"operation\":\"sendDocument\",\"additionalFields\":{}},\"credentials\":{\"telegramApi\":{\"id\":\"9dexJXnlVPA6wt8K\",\"name\":\"Chat & Sound\"}},\"typeVersion\":1.2},{\"id\":\"38f2410d-bd55-4ddf-8aaa-4e28919de78f\",\"name\":\"Generate image in Dalle\",\"type\":\"@n8n/n8n-nodes-langchain.toolHttpRequest\",\"position\":[1880,580],\"parameters\":{\"url\":\"https://api.openai.com/v1/images/generations\",\"method\":\"POST\",\"sendBody\":true,\"authentication\":\"predefinedCredentialType\",\"parametersBody\":{\"values\":[{\"name\":\"model\",\"value\":\"dall-e-3\",\"valueProvider\":\"fieldValue\"},{\"name\":\"prompt\"}]},\"toolDescription\":\"Call this tool to request a Dall-E-3 model, when the user asks to draw something. If you gеt a response from this tool, forward it to the Telegram tool.\",\"nodeCredentialType\":\"openAiApi\"},\"credentials\":{\"openAiApi\":{\"id\":\"rveqdSfp7pCRON1T\",\"name\":\"Ted's Tech Talks OpenAi\"}},\"typeVersion\":1.1},{\"id\":\"34265eab-9f37-475a-a2ae-a6c37c69c595\",\"name\":\"AI Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[1780,360],\"parameters\":{\"text\":\"={{ $json.message.text }}\",\"options\":{\"systemMessage\":\"=You are a helpful assistant. You are communicating with a user named {{ $json.message.from.first_name }}. Address the user by name every time. If the user asks for an image, always send the link to the image in the final reply.\"},\"promptType\":\"define\"},\"typeVersion\":1.7}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"b36989c5-295a-4df6-84e9-776815509bc9\",\"connections\":{\"AI Agent\":{\"main\":[[{\"node\":\"Send final reply\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"AI Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Send back an image\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Window Buffer Memory\":{\"ai_memory\":[[{\"node\":\"AI Agent\",\"type\":\"ai_memory\",\"index\":0}]]},\"Generate image in Dalle\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Listen for incoming events\":{\"main\":[[{\"node\":\"AI Agent\",\"type\":\"main\",\"index\":0}]]}}}"
}
{
  "title": "ðŸŒ² AI Agent for Sustainability Report Audit with Gmail and GPT-40",
  "url": "https://n8n.io/workflows/3420-ai-agent-for-sustainability-report-audit-with-gmail-and-gpt-40/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "Samir Saci",
  "publish_date": "Last update 14 days ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"=\"},\"nodes\":[{\"id\":\"a2d54127-d1d1-44d2-859e-b89e2e6c3b4d\",\"name\":\"If\",\"type\":\"n8n-nodes-base.if\",\"position\":[260,260],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"=\",\"operator\":{\"type\":\"string\",\"operation\":\"contains\"},\"leftValue\":\"={{ $json.subject }}\",\"rightValue\":\"CSRD Reporting\"}]}},\"typeVersion\":2.2},{\"id\":\"6a664023-ea8c-4973-b3ac-13a9e0664a58\",\"name\":\"Check the format\",\"type\":\"n8n-nodes-base.code\",\"position\":[960,260],\"parameters\":{\"jsCode\":\"const content = $input.first().json.xhtml_content;\\n\\n// Helper to extract tags\\nfunction extractTags(tagName) {\\n  const regex = new RegExp(`<${tagName}[^>]*>(.*?)<\\\\\\\\/${tagName}>`, 'gs');\\n  let matches = [];\\n  let match;\\n  while ((match = regex.exec(content)) !== null) {\\n    matches.push(match[1].trim());\\n  }\\n  return matches;\\n}\\n\\n// Basic Tests\\nconst headerPresent = /<ix:header>/i.test(content);\\nconst governanceTag = /<ix:nonNumeric[^>]*name=\\\"esrs:SustainabilityGovernance\\\"/i.test(content);\\nconst strategyTag = /<ix:nonNumeric[^>]*name=\\\"esrs:StrategySustainability\\\"/i.test(content);\\n\\n// KPI Tags\\nconst kpiTags = [\\\"esrs:GHGScope1Emissions\\\", \\\"esrs:GHGScope2Emissions\\\", \\\"esrs:GHGScope3Emissions\\\"];\\nconst kpiMatches = kpiTags.filter(tag => content.includes(tag));\\n\\n// Check for empty tags\\nconst emptyNonNumeric = (content.match(/<ix:nonNumeric[^>]*>\\\\s*<\\\\/ix:nonNumeric>/g) || []).length;\\n\\n// Check duplicate text\\nconst nonNumericValues = extractTags(\\\"ix:nonNumeric\\\");\\nconst duplicates = [...new Set(nonNumericValues.filter((v, i, arr) => arr.indexOf(v) !== i))];\\n\\n// Final Result\\nreturn [\\n  {\\n    json: {\\n      audit_results:{\\n      total_nonNumeric_tags: nonNumericValues.length,\\n      total_kpis_found: kpiMatches.length,\\n      empty_disclosures: emptyNonNumeric,\\n      governance_check: governanceTag ? \\\"PASS\\\" : \\\"MISSING\\\",\\n      strategy_check: strategyTag ? \\\"PASS\\\" : \\\"MISSING\\\",\\n      header_check: headerPresent ? \\\"PASS\\\" : \\\"MISSING\\\",\\n      duplicate_disclosures: duplicates,\\n      }\\n\\n    }\\n  }\\n];\\n\"},\"typeVersion\":2},{\"id\":\"a16b613e-a7c2-4079-9ff9-46c485019ca3\",\"name\":\"AI Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[1240,260],\"parameters\":{\"text\":\"=Generate an email to the sustainability team summarizing this CSRD XHTML report audit:\\n\\n{{JSON.stringify($json.audit_results, null, 2)}}\\n\\nReturn the output in the following JSON format:\\n\\n{\\n  \\\"subject\\\": \\\"...\\\",\\n  \\\"body\\\": \\\"...\\\"\\n}\",\"options\":{\"systemMessage\":\"=You are LogiGreen CSRD Audit Bot, an ESG compliance assistant writing professional email summaries based on automated XHTML audits for CSRD compliance. Your role is to translate JSON audit results into clear, actionable summaries. Keep a neutral, helpful tone and highlight any risks or missing disclosures. Include key findings and suggest next steps if needed.\\n\\nWrite emails in plain English with no markdown (avoid **, #, ##, etc.).\\nFormat your message with proper line breaks for readability.\\nAlways sign with:\\nBest regards,\\nLogiGreen CSRD Audit Bot\"},\"promptType\":\"define\",\"hasOutputParser\":true},\"typeVersion\":1.8},{\"id\":\"3dcbaf39-58be-465e-9ec2-0b2a9a8c8fe3\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1200,420],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o-mini\"},\"options\":{}},\"typeVersion\":1.2},{\"id\":\"6e742627-f315-4ee2-be1b-023b38103978\",\"name\":\"Structured Output Parser\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[1500,440],\"parameters\":{\"jsonSchemaExample\":\"{\\n  \\\"subject\\\": \\\"CSRD XHTML Report Audit â€“ Key Findings and Next Steps\\\",\\n  \\\"body\\\": \\\"Content of the email\\\"\\n}\"},\"typeVersion\":1.2},{\"id\":\"994e5b98-5bda-4a4f-a3eb-cb521de9d88a\",\"name\":\"Reply\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[1620,260],\"webhookId\":\"=\",\"parameters\":{\"message\":\"={{ $json.output.body }}\",\"options\":{},\"emailType\":\"text\",\"messageId\":\"={{ $('Gmail').item.json.id }}\",\"operation\":\"reply\"},\"notesInFlow\":true,\"typeVersion\":2.1},{\"id\":\"8a7fbdcb-2197-437e-b3ba-126c7942ba4d\",\"name\":\"Extract the HTML\",\"type\":\"n8n-nodes-base.code\",\"position\":[800,260],\"parameters\":{\"jsCode\":\"return [\\n  {\\n    json: {\\n      xhtml_content:$input.first().json.data \\n    }\\n  }\\n];\\n\"},\"typeVersion\":2},{\"id\":\"90f271b9-4b8b-49ef-90cc-d10d8e22a203\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[20,-140],\"parameters\":{\"color\":7,\"width\":380,\"height\":680,\"content\":\"### 1. Workflow Trigger with Gmail Trigger\\nThe workflow is triggered by a new email received in your Gmail mailbox. \\nIf the subject includes the string \\\"CSRD Reporting\\\" we proceed, if not we do nothing.\\n\\n#### How to setup?\\n- **Gmail Trigger Node:** set up your Gmail API credentials\\n[Learn more about the Gmail Trigger Node](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.gmailtrigger)\\n\"},\"typeVersion\":1},{\"id\":\"803a758c-fba4-4f48-818b-1272c4509e81\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[440,-140],\"parameters\":{\"color\":7,\"width\":640,\"height\":680,\"content\":\"### 2. Extract and Process the xHTML report\\nThis block extract the attachment file from the email, process the xHTML and perform the audit of the content.\\n\\n#### How to setup?\\n- **Gmail Node:** set up your Gmail API credentials\\n[Learn more about the Gmail Trigger Node](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.gmailtrigger)\\n\"},\"typeVersion\":1},{\"id\":\"0b72f7d8-23ce-4243-b2e5-e3ff5c7f163e\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1120,-140],\"parameters\":{\"color\":7,\"width\":640,\"height\":680,\"content\":\"### 3. AI Agent write and sends an audit report to the send\\nThis summarize the results of the analysis in an email sent as a reply to the sender.\\n\\n#### How to setup?\\n- **Gmail Node:** set up your Gmail API credentials\\n[Learn more about the Gmail Trigger Node](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.gmailtrigger)\\n- **AI Agent with the Chat Model**:\\n   1. Add a **chat model** with the required credentials *(Example: Open AI 4o-mini)*\\n   2. Adapt the system prompt to the format of emails you want to send\\n  [Learn more about the AI Agent Node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent)\\n\"},\"typeVersion\":1},{\"id\":\"18103fec-6761-4604-872e-dab251211ba0\",\"name\":\"HTML from binary\",\"type\":\"n8n-nodes-base.extractFromFile\",\"position\":[660,260],\"parameters\":{\"options\":{},\"operation\":\"text\",\"binaryPropertyName\":\"attachment_0\"},\"notesInFlow\":true,\"typeVersion\":1},{\"id\":\"5c31c49d-2324-4d08-a5b5-309925266517\",\"name\":\"Email Trigger\",\"type\":\"n8n-nodes-base.gmailTrigger\",\"position\":[40,260],\"parameters\":{\"simple\":false,\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"notesInFlow\":true,\"typeVersion\":1.2},{\"id\":\"bacbd57d-af9b-49c8-82ae-c74aa2898fc8\",\"name\":\"Download Attachment\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[480,260],\"webhookId\":\"=\",\"parameters\":{\"simple\":false,\"options\":{\"downloadAttachments\":true},\"messageId\":\"={{ $json.id }}\",\"operation\":\"get\"},\"notesInFlow\":true,\"typeVersion\":2.1},{\"id\":\"af087293-0c3c-4c96-9523-ddb9ed238e00\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1780,-140],\"parameters\":{\"width\":780,\"height\":540,\"content\":\"### 4. Do you need more details?\\nFind a step-by-step guide in this tutorial\\n![Guide](https://www.samirsaci.com/content/images/2025/04/temp-2.png)\\n[ðŸŽ¥ Watch My Tutorial](https://www.youtube.com/watch?v=npeJZv5U7og)\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"AI Agent\":{\"main\":[[{\"node\":\"Reply\",\"type\":\"main\",\"index\":0}]]},\"Email Trigger\":{\"main\":[[{\"node\":\"If\",\"type\":\"main\",\"index\":0}]]},\"Check the format\":{\"main\":[[{\"node\":\"AI Agent\",\"type\":\"main\",\"index\":0}]]},\"Extract the HTML\":{\"main\":[[{\"node\":\"Check the format\",\"type\":\"main\",\"index\":0}]]},\"HTML from binary\":{\"main\":[[{\"node\":\"Extract the HTML\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"AI Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Structured Output Parser\":{\"ai_outputParser\":[[{\"node\":\"AI Agent\",\"type\":\"ai_outputParser\",\"index\":0}]]}}}",
  "readme": "_Tags: Sustainability, CSRD, Reporting, ESG, Compliance, Automation_\n\n### Context\n\nHey! I'm Samir, a **Supply Chain Engineer and Data Scientist from Paris** , founder of  \n[LogiGreen Consulting](https://www.logi-green.com/)\n\nWe help **companies automate sustainability workflows** using AI, Data Analytics, and No-Code tools like N8N.\n\n> Sustainability Reporting meets Automation with n8n!\n\nðŸ“¬ For business inquiries, you can add me on [Here](https://www.linkedin.com/in/samir-saci)\n\n### What is a CSRD XHTML Report?\n\nUnder the **Corporate Sustainability Reporting Directive (CSRD)** , companies must publish their ESG disclosures in a **machine-readable XHTML format** , embedding **XBRL tags** that make the report structured and standardized.\n\n![What is XHTML](https://www.samirsaci.com/content/images/2025/04/temp.png)\n\nThese files must follow strict formatting and tagging rules to ensure **compliance** , **traceability** , and **accessibility** for both regulators and analysts.\n\n### Who is this template for?\n\nThis workflow is designed for **sustainability teams, ESG consultants** , or **developers** who want to **automatically check the structure and format** of CSRD reports submitted in XHTML.\n\n### How does it work?\n\nThis N8N workflow automates the audit process:\n\n  1. **ðŸ“¤ Input Node** â†’ Uploads or fetches the XHTML file via URL or Webhook.\n  2. **ðŸ§ª Validates Structure** â†’ Uses a custom code node to parse HTML and identify required tags (e.g., `&lt;ix:nonNumeric&gt;`, namespaces).\n  3. **ðŸ“‹ Outputs a Report** â†’ Returns a summary report of errors, warnings, and key metadata (like entity name, reporting period).\n  4. **ðŸ“¤ Export Option** â†’ Save the results in Google Sheets or send via email.\n\n\n\n### Prerequisite\n\n  * A sample XHTML file that you can find in my [GitHub Repository](https://github.com/samirsaci/n8n-templates)\n  * **Google Sheets API** and **OpenAI API** credentials\n\n\n\n### Next Steps\n\nFollow the **sticky notes** inside each node to adjust parsing rules or extend validation to specific XBRL tags relevant to your sector (e.g., GHG emissions, water usage).\n\n**ðŸ“º Check my complete tutorial to understand how to use it: **  \n![CSRD Parser Visual](https://www.samirsaci.com/content/images/2025/04/temp-2.png)  \nðŸŽ¥ [Check My Tutorial](https://youtu.be/npeJZv5U7og)\n\nðŸš€ Interested in combining **CSRD compliance** with **automation and analytics**? Letâ€™s connect on [LinkedIn](https://www.linkedin.com/in/samir-saci)\n\n### Notes\n\n  * This workflow includes an example XHTML file to test the validator.\n  * You can plug this into your internal systems or even extend it with AI to **auto-summarize the sustainability report**.\n\n\n\n_This workflow has been created with N8N 1.82.1_  \n_Submitted: April 3rd, 2025_\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><p><em>Tags: Sustainability, CSRD, Reporting, ESG, Compliance, Automation</em></p>\n<h3>Context</h3>\n<p>Hey! I'm Samir, a <strong>Supply Chain Engineer and Data Scientist from Paris</strong>, founder of<br>\n<a href=\"https://www.logi-green.com/\" rel=\"ugc nofollow\" target=\"_blank\">LogiGreen Consulting</a></p>\n<p>We help <strong>companies automate sustainability workflows</strong> using AI, Data Analytics, and No-Code tools like N8N.</p>\n<blockquote>\n<p>Sustainability Reporting meets Automation with n8n!</p>\n</blockquote>\n<p>ðŸ“¬ For business inquiries, you can add me on <a href=\"https://www.linkedin.com/in/samir-saci\" rel=\"ugc nofollow\" target=\"_blank\">Here</a></p>\n<h3>What is a CSRD XHTML Report?</h3>\n<p>Under the <strong>Corporate Sustainability Reporting Directive (CSRD)</strong>, companies must publish their ESG disclosures in a <strong>machine-readable XHTML format</strong>, embedding <strong>XBRL tags</strong> that make the report structured and standardized.</p>\n<p><img src=\"https://www.samirsaci.com/content/images/2025/04/temp.png\" alt=\"What is XHTML\"></p>\n<p>These files must follow strict formatting and tagging rules to ensure <strong>compliance</strong>, <strong>traceability</strong>, and <strong>accessibility</strong> for both regulators and analysts.</p>\n<h3>Who is this template for?</h3>\n<p>This workflow is designed for <strong>sustainability teams, ESG consultants</strong>, or <strong>developers</strong> who want to <strong>automatically check the structure and format</strong> of CSRD reports submitted in XHTML.</p>\n<h3>How does it work?</h3>\n<p>This N8N workflow automates the audit process:</p>\n<ol>\n<li><strong>ðŸ“¤ Input Node</strong> â†’ Uploads or fetches the XHTML file via URL or Webhook.</li>\n<li><strong>ðŸ§ª Validates Structure</strong> â†’ Uses a custom code node to parse HTML and identify required tags (e.g., <code>&amp;lt;ix:nonNumeric&amp;gt;</code>, namespaces).</li>\n<li><strong>ðŸ“‹ Outputs a Report</strong> â†’ Returns a summary report of errors, warnings, and key metadata (like entity name, reporting period).</li>\n<li><strong>ðŸ“¤ Export Option</strong> â†’ Save the results in Google Sheets or send via email.</li>\n</ol>\n<h3>Prerequisite</h3>\n<ul>\n<li>A sample XHTML file that you can find in my <a href=\"https://github.com/samirsaci/n8n-templates\" rel=\"ugc nofollow\" target=\"_blank\">GitHub Repository</a></li>\n<li><strong>Google Sheets API</strong> and <strong>OpenAI API</strong> credentials</li>\n</ul>\n<h3>Next Steps</h3>\n<p>Follow the <strong>sticky notes</strong> inside each node to adjust parsing rules or extend validation to specific XBRL tags relevant to your sector (e.g., GHG emissions, water usage).</p>\n<p>**ðŸ“º Check my complete tutorial to understand how to use it: **<br>\n<img src=\"https://www.samirsaci.com/content/images/2025/04/temp-2.png\" alt=\"CSRD Parser Visual\"><br>\nðŸŽ¥ <a href=\"https://youtu.be/npeJZv5U7og\" rel=\"ugc nofollow\" target=\"_blank\">Check My Tutorial</a></p>\n<p>ðŸš€ Interested in combining <strong>CSRD compliance</strong> with <strong>automation and analytics</strong>? Letâ€™s connect on <a href=\"https://www.linkedin.com/in/samir-saci\" rel=\"ugc nofollow\" target=\"_blank\">LinkedIn</a></p>\n<h3>Notes</h3>\n<ul>\n<li>This workflow includes an example XHTML file to test the validator.</li>\n<li>You can plug this into your internal systems or even extend it with AI to <strong>auto-summarize the sustainability report</strong>.</li>\n</ul>\n<p><em>This workflow has been created with N8N 1.82.1</em><br>\n<em>Submitted: April 3rd, 2025</em></p>\n</div><!--]-->"
}
{
  "title": "Survey Insights with Qdrant, Python and Information Extractor",
  "url": "https://n8n.io/workflows/2372-survey-insights-with-qdrant-python-and-information-extractor/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "Jimleuk",
  "publish_date": "Last update 8 months ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\"},\"nodes\":[{\"id\":\"0404384b-10b6-4666-84a4-8870db30c607\",\"name\":\"Embeddings OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[1220,280],\"parameters\":{\"model\":\"text-embedding-3-small\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"a6741f04-5a5b-47a9-ac08-eb562f9f6052\",\"name\":\"Default Data Loader\",\"type\":\"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\"position\":[1340,280],\"parameters\":{\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"question\",\"value\":\"={{ $json.question }}\"},{\"name\":\"participant\",\"value\":\"={{ $json.participant }}\"},{\"name\":\"survey\",\"value\":\"={{ $('Get Survey Results').params.documentId.cachedResultName }}\"}]}},\"jsonData\":\"={{ $json.answer }}\",\"jsonMode\":\"expressionData\"},\"typeVersion\":1},{\"id\":\"7663c3dd-f713-4034-bef6-0c000285f54f\",\"name\":\"Convert to Question Answer Pairs\",\"type\":\"n8n-nodes-base.set\",\"position\":[720,160],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"6b593ffb-ffbd-4cf5-a508-cd4f2a6d1004\",\"name\":\"data\",\"type\":\"array\",\"value\":\"={{\\n  Object.keys($json)\\n    .filter(key => !['row_number', 'Participant'].includes(key))\\n  .map(key => ({ question: key, answer: $json[key], participant: $json.Participant }))\\n}}\"}]}},\"typeVersion\":3.4},{\"id\":\"84873f0c-81ce-442f-a33c-d7c6c2efa11b\",\"name\":\"Recursive Character Text Splitter\",\"type\":\"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\"position\":[1340,420],\"parameters\":{\"options\":{}},\"typeVersion\":1},{\"id\":\"da9a8ee8-5e3f-49db-8d1f-26a61ca82344\",\"name\":\"Get Survey Results\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[540,160],\"parameters\":{\"options\":{},\"sheetName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gid=0\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1-168Vm-1kCeHkqGLAs6odha4DhPE93njfHlYIviKE50/edit#gid=0\",\"cachedResultName\":\"Sheet1\"},\"documentId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"1-168Vm-1kCeHkqGLAs6odha4DhPE93njfHlYIviKE50\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1-168Vm-1kCeHkqGLAs6odha4DhPE93njfHlYIviKE50/edit?usp=drivesdk\",\"cachedResultName\":\"Remote Working Survey Responses\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"XHvC7jIRR8A2TlUl\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.4},{\"id\":\"4bad90b2-eefe-49c8-8caa-41cd4cb5e60f\",\"name\":\"Get Survey Headers\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[740,940],\"parameters\":{\"options\":{\"dataLocationOnSheet\":{\"values\":{\"range\":\"A1:Z2\",\"rangeDefinition\":\"specifyRangeA1\"}}},\"sheetName\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Execute Workflow Trigger').first().json.sheetName }}\"},\"documentId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"XHvC7jIRR8A2TlUl\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.4},{\"id\":\"47c64994-9d1f-42ca-a849-3eeab5335b66\",\"name\":\"Extract Questions\",\"type\":\"n8n-nodes-base.set\",\"position\":[940,940],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"d655b165-dfa2-46cb-bc27-140399bc4227\",\"name\":\"question\",\"type\":\"array\",\"value\":\"={{\\n  Object.keys($('Get Survey Headers').item.json)\\n    .filter(key => key.includes('?'))\\n}}\"}]}},\"typeVersion\":3.4},{\"id\":\"c237d523-b290-41ca-b323-4cc7c7f6ff37\",\"name\":\"Questions to List\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[940,1120],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"question\"},\"typeVersion\":1},{\"id\":\"7f44a770-4c5d-4404-ae95-d9dee8348380\",\"name\":\"Find All Answers\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1460,1120],\"parameters\":{\"url\":\"=http://qdrant:6333/collections/{{ $('Set Variables').item.json.collectionName }}/points/scroll\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n  \\\"limit\\\": 500,\\n  \\\"filter\\\":{\\n    \\\"must\\\": [\\n      {\\n        \\\"key\\\": \\\"metadata.question\\\",\\n        \\\"match\\\": { \\\"value\\\": \\\"{{ $('For Each Question...').item.json.question }}\\\" }\\n      },\\n      {\\n        \\\"key\\\": \\\"metadata.survey\\\",\\n        \\\"match\\\": { \\\"value\\\": \\\"{{ $('Set Variables').item.json.surveyName }}\\\" }\\n      }\\n    ]\\n  },\\n  \\\"with_vector\\\":true\\n}\",\"sendBody\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"qdrantApi\"},\"credentials\":{\"qdrantApi\":{\"id\":\"NyinAS3Pgfik66w5\",\"name\":\"QdrantApi account\"}},\"typeVersion\":4.2},{\"id\":\"2b6dc317-f8f3-4201-a9e1-d35ee578e79e\",\"name\":\"Get Payload of Points\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2380,800],\"parameters\":{\"url\":\"=http://qdrant:6333/collections/{{ $('Set Variables').first().json.collectionName }}/points\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={{\\n  {\\n    \\\"ids\\\": $json.points,\\n    \\\"with_payload\\\": true\\n  }\\n}}\",\"sendBody\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"qdrantApi\"},\"credentials\":{\"qdrantApi\":{\"id\":\"NyinAS3Pgfik66w5\",\"name\":\"QdrantApi account\"}},\"typeVersion\":4.2},{\"id\":\"d4a37d97-975a-4243-a7ea-81b3e30558a5\",\"name\":\"Clusters To List\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[2180,800],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"output\"},\"typeVersion\":1},{\"id\":\"c78f1bf6-8390-48ee-88f4-7d1a893a8ade\",\"name\":\"Set Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[200,1060],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"b77c94a0-d865-4bd6-b078-a09b2ddb2a99\",\"name\":\"collectionName\",\"type\":\"string\",\"value\":\"ux_survey_insights\"},{\"id\":\"7b0a4d14-b5f9-4597-84c0-8cfdb363c3d3\",\"name\":\"surveyName\",\"type\":\"string\",\"value\":\"={{ $json.properties.title }}\"},{\"id\":\"45434b3b-3b74-4262-82e0-7ed02155caad\",\"name\":\"insightsSheetName\",\"type\":\"string\",\"value\":\"=Insights-{{ $now.format('yyyyMMdd') }}\"}]}},\"typeVersion\":3.4},{\"id\":\"fbb1f3c3-06ad-44b5-b020-6fc3c8eda7c4\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[2560,980],\"parameters\":{\"model\":\"gpt-4o-mini\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"83d3b413-a661-4c4c-9b8d-6ee395a15348\",\"name\":\"Prep Output For Export\",\"type\":\"n8n-nodes-base.set\",\"position\":[3160,1300],\"parameters\":{\"mode\":\"raw\",\"options\":{},\"jsonOutput\":\"={{ {\\n  ...$json.output,\\n  \\\"Number of Response\\\": $('Get Payload of Points').item.json.result.length,\\n  \\\"Participant IDs\\\": $('Get Payload of Points').item.json.result.map(item =>\\n    item.payload.metadata.participant\\n  ).join(','),\\n  \\\"Raw Responses\\\": $('Get Payload of Points').item.json.result.map(item =>\\n    `Participant ${item.payload.metadata.participant},${item.payload.content.replaceAll('\\\"', '\\\\\\\"')}`\\n   ).join('\\\\n')\\n} }}\\n\"},\"typeVersion\":3.4},{\"id\":\"14784dff-a8ea-4b6b-8379-b0c9051a8f98\",\"name\":\"Export To Sheets\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[3360,1300],\"parameters\":{\"columns\":{\"value\":{},\"schema\":[{\"id\":\"What is your name?\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"What is your name?\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"The responses indicate that two participants have the same name, 'Kwame Nkosi', which suggests a commonality in names or cultural naming traditions among the respondents. This could highlight the importance of understanding cultural context in survey responses.\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"The responses indicate that two participants have the same name, 'Kwame Nkosi', which suggests a commonality in names or cultural naming traditions among the respondents. This could highlight the importance of understanding cultural context in survey responses.\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"neutral\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"neutral\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"3\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"3\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"77,17,54\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"77,17,54\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"Participant 77,Kwame Nkosi\\nParticipant 17,Kwame Nkosi\\nParticipant 54,Kwame Nkansah\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"Participant 77,Kwame Nkosi\\nParticipant 17,Kwame Nkosi\\nParticipant 54,Kwame Nkansah\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"autoMapInputData\",\"matchingColumns\":[]},\"options\":{},\"operation\":\"append\",\"sheetName\":{\"__rl\":true,\"mode\":\"name\",\"value\":\"={{ $('Set Variables').first().json.insightsSheetName }}\"},\"documentId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"XHvC7jIRR8A2TlUl\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.4},{\"id\":\"779b9411-db3e-44f3-ad2a-c9d40a70580d\",\"name\":\"Export To Sheets1\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[2360,1300],\"parameters\":{\"columns\":{\"value\":{},\"schema\":[],\"mappingMode\":\"autoMapInputData\",\"matchingColumns\":[]},\"options\":{},\"operation\":\"append\",\"sheetName\":{\"__rl\":true,\"mode\":\"name\",\"value\":\"={{ $('Set Variables').first().json.insightsSheetName }}\"},\"documentId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"XHvC7jIRR8A2TlUl\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.4},{\"id\":\"a31ab677-f57c-4b78-a290-d4a913ed4f8e\",\"name\":\"For Each Question...\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[1280,940],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"dcfaf927-6ecd-4ebe-aee0-5fb3367b2725\",\"name\":\"Trigger Insights\",\"type\":\"n8n-nodes-base.executeWorkflow\",\"position\":[1980,160],\"parameters\":{\"options\":{},\"workflowId\":\"={{ $workflow.id }}\"},\"typeVersion\":1},{\"id\":\"2579adf0-9c00-4b87-b53e-740044577ab0\",\"name\":\"Prep Values For Trigger\",\"type\":\"n8n-nodes-base.set\",\"position\":[1800,160],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"24dd90ad-390f-444e-ba6c-8c06a41e836e\",\"name\":\"sheetID\",\"type\":\"string\",\"value\":\"={{ $('Get Survey Results').params.documentId.value }}\"},{\"id\":\"90199bbb-3938-411c-a7a8-faa7ccba6059\",\"name\":\"sheetName\",\"type\":\"string\",\"value\":\"={{ $('Get Survey Results').params.sheetName.value }}\"}]}},\"executeOnce\":true,\"typeVersion\":3.4},{\"id\":\"9b29e850-b9d0-4358-af62-92c20ab3b088\",\"name\":\"Execute Workflow Trigger\",\"type\":\"n8n-nodes-base.executeWorkflowTrigger\",\"position\":[20,900],\"parameters\":{},\"typeVersion\":1},{\"id\":\"70a0dcec-9f74-4af2-bd64-0ab762a77e51\",\"name\":\"Create Insights Sheet\",\"type\":\"n8n-nodes-base.googleSheets\",\"position\":[420,900],\"parameters\":{\"title\":\"={{ $('Set Variables').first().json.insightsSheetName }}\",\"options\":{},\"operation\":\"create\",\"documentId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"}},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"XHvC7jIRR8A2TlUl\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.4,\"alwaysOutputData\":true},{\"id\":\"f31400fb-dd7a-4c62-90ec-e9d78bbaa5e8\",\"name\":\"Prep Values For Export\",\"type\":\"n8n-nodes-base.set\",\"position\":[2180,1300],\"parameters\":{\"mode\":\"raw\",\"options\":{},\"jsonOutput\":\"={\\n  \\\"Question\\\": \\\"{{ $('For Each Question...').item.json.question }}\\\",\\n  \\\"Insight\\\": \\\"No Insight Found\\\"\\n}\\n\"},\"typeVersion\":3.4},{\"id\":\"506c20df-5109-422c-8c9e-0eb50fbd3ff9\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[459.27570452141345,-42.168106366729035],\"parameters\":{\"color\":7,\"width\":617.2130261221611,\"height\":420.7389587470384,\"content\":\"## Step 1. Import Survey Responses\\n[Read more about Google Sheets](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlesheets)\\n\\nOur approach requires to import all participant responses as vectors with metadata linking them to the questions being answered. To do this, we'll generate questiona and answer pairs from the survey.\"},\"typeVersion\":1},{\"id\":\"bddcafa8-6f54-4829-93c9-37bbb9e7edf3\",\"name\":\"QA Pairs to List\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[900,160],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"data\"},\"typeVersion\":1},{\"id\":\"8d6e6bf6-c94c-43cb-a29e-5d10207cb8bd\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1100,-102.05898437632061],\"parameters\":{\"color\":7,\"width\":563.8350682199533,\"height\":678.1641960508446,\"content\":\"## Step 2. Vectorize Each Response Into Qdrant\\n[Read more about using Qdrant](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.vectorstoreqdrant)\\n\\nSpecial attention is given to how metadata is captured as it becomes key to this workflow is being able to retrieve subsets of the data for analysis.\"},\"typeVersion\":1},{\"id\":\"613d4a32-a87a-423e-a1d1-ee23db0de6d1\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1680,-30.440883940004255],\"parameters\":{\"color\":7,\"width\":519.6419932444072,\"height\":429.11782776909047,\"content\":\"## Step 3. Trigger Insights SubWorkflow\\n[Learn more about Workflow Triggers](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow)\\n\\nA subworkflow is used to trigger the analysis for the survey. This separation is optional but used here to better demonstrate the two part process.\"},\"typeVersion\":1},{\"id\":\"1e858e4a-b91b-4411-8e2a-6eb76647b796\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-57.47778952966382,710.393394209128],\"parameters\":{\"color\":7,\"width\":668.3083616841852,\"height\":528.2386658883073,\"content\":\"## Step 4. Create Insights Sheet\\n[Learn more about Workflow Triggers](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflowtrigger)\\n\\nTo capture the generated insights, we'll create a new unique sheet within the survey spreadsheet. This is optional and you may want to capture in other datastores depending on your needs.\"},\"typeVersion\":1},{\"id\":\"9170c566-07d3-49dc-aafb-2dbe79940d2c\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[640,683.5153164275844],\"parameters\":{\"color\":7,\"width\":536.9288458983389,\"height\":622.1362463986454,\"content\":\"## Step 5. Get List Of Questions From Survey\\n[Read more about using Google Sheets](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlesheets)\\n\\nNext we'll fetch the survey for metadata and questions, splitting them into separate workflow items. Our intention is to process each question end-to-end before moving to the next. This approach is a little \\\"safer\\\" in the scenario where an interruption occurs we won't lose all our work.\"},\"typeVersion\":1},{\"id\":\"8488df77-055d-41cc-94f1-92ac5d54ef10\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1200,673.291535602609],\"parameters\":{\"color\":7,\"width\":823.147012265536,\"height\":868.2579789328703,\"content\":\"## Step 6. Find Groups of Similar Answers For Each Question\\n[Learn more about using the Code Node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code/)\\n\\nGiving all the responses to an LLM to analyse is the common but naive approach; the summarisation is usually too high level for real insights and loses a lot of detail such as the number and identity of respondants. What we want to do instead is find and group popular answers for each question to ensure all perspectives are considered.\\n\\nOur approach does this by mapping our answer vectors to a 2D grid and then identifying where the vector points are \\\"clustered\\\"; where a group of points are within close proximity to each other.\"},\"typeVersion\":1},{\"id\":\"f4748b6d-5bd8-48cf-942f-3a0dc681078d\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2060,1180],\"parameters\":{\"color\":7,\"width\":536.9288458983389,\"height\":359.90385684071794,\"content\":\"## Step 7b. Skip If No Clusters Found\\nWhere no clusters were found, it means the answers were unique enough to not show any pattern. eg. \\\"What's you name?\\\"\"},\"typeVersion\":1},{\"id\":\"d55d6a47-da8c-46ae-bd10-0eb671dcd121\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2060,611.6915003841909],\"parameters\":{\"color\":7,\"width\":871.451300407926,\"height\":541.1135860445843,\"content\":\"## Step 7a. Summarise the Top Groups of Similar Answers\\n[Read more about using the Information Extractor Node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.information-extractor)\\n\\nEach discovered cluster will return a reference vector which is used to fetch all related answers in the group.\\nThe group is then sent to the LLM to summarise as well as assign a sentiment score.\"},\"typeVersion\":1},{\"id\":\"e5d5f88f-5832-43fc-a5b9-f747d08e7e77\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2620,1180],\"parameters\":{\"color\":7,\"width\":924.2798021207429,\"height\":363.07347551845976,\"content\":\"## Step 8. Write To Insights Sheet\\nFinally, our completed insights to appended to\\nthe Insights Sheet we created earlier in the workflow.\"},\"typeVersion\":1},{\"id\":\"49ac1504-7b43-4fa1-b4ce-15c7a53c9018\",\"name\":\"Sticky Note9\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[460,400],\"parameters\":{\"color\":5,\"width\":323.2987132716669,\"height\":80,\"content\":\"### Run this once! \\nIf for any reason you need to run more than once, be sure to clear the existing data first.\"},\"typeVersion\":1},{\"id\":\"450f89c5-ef0f-4bf8-8db9-6347247c7f4d\",\"name\":\"Has Clusters?\",\"type\":\"n8n-nodes-base.if\",\"position\":[1820,1120],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"40b6bb62-a2d6-4422-8fbb-7ae49898bad9\",\"operator\":{\"type\":\"array\",\"operation\":\"notEmpty\",\"singleValue\":true},\"leftValue\":\"={{ $json.output }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2},{\"id\":\"1652a108-8fb8-4229-a76d-abf9fbcff626\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[20,-400],\"parameters\":{\"width\":400.381109509268,\"height\":679.5610243514676,\"content\":\"## Try It Out!\\n\\n### This workflow generates highly-detailed insights from survey responses. Works best when dealing with a large number of participants.\\n\\n* Import survey responses and vectorise in Qdrant vectorstore.\\n* Identify clusters of popular responses to questions using K-means clustering algorithm. \\n* Each valid cluster is analysed and summarised by LLM.\\n* Export LLM response and cluster results back into sheet.\\n\\nCheck out the reference google sheet here: https://docs.google.com/spreadsheets/d/e/2PACX-1vT6m8XH8JWJTUAfwojc68NAUGC7q0lO7iV738J7aO5fuVjiVzdTRRPkMmT1C4N8TwejaiT0XrmF1Q48/pubhtml\\n\\n### Need Help?\\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\\n\\nHappy Hacking!\"},\"typeVersion\":1},{\"id\":\"6eef981e-b2ce-433c-b71f-78be64812a56\",\"name\":\"Sticky Note11\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1260,1340],\"parameters\":{\"color\":5,\"width\":323.2987132716669,\"height\":110.05160146874424,\"content\":\"### First Time Running?\\nThere is a slight delay on first run because the code node has to download the required packages.\"},\"typeVersion\":1},{\"id\":\"fa0c14be-03f4-4ed2-bd60-e93817382ded\",\"name\":\"When clicking ‘Test workflow’\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[240,100],\"parameters\":{},\"typeVersion\":1},{\"id\":\"30323019-59ba-4a19-a46e-196d469f097d\",\"name\":\"Get Sheet Details\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[200,900],\"parameters\":{\"url\":\"=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.sheetID }}\",\"options\":{},\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"googleSheetsOAuth2Api\"},\"credentials\":{\"googleSheetsOAuth2Api\":{\"id\":\"XHvC7jIRR8A2TlUl\",\"name\":\"Google Sheets account\"}},\"typeVersion\":4.2},{\"id\":\"6ced8012-1dd3-4da3-8c27-e4f4dfc959f6\",\"name\":\"Only Clusters With 3+ points\",\"type\":\"n8n-nodes-base.filter\",\"position\":[2180,960],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"328f806c-0792-4d90-9bee-a1e10049e78f\",\"operator\":{\"type\":\"array\",\"operation\":\"lengthGt\",\"rightType\":\"number\"},\"leftValue\":\"={{ $json.points }}\",\"rightValue\":2}]}},\"typeVersion\":2},{\"id\":\"8ae81a55-75e2-40a3-bef6-0935ff08128f\",\"name\":\"Apply K-means Clustering Algorithm\",\"type\":\"n8n-nodes-base.code\",\"position\":[1640,1120],\"parameters\":{\"language\":\"python\",\"pythonCode\":\"import numpy as np\\nfrom sklearn.cluster import KMeans\\n\\n# get vectors for all answers\\npoint_ids = [item.id for item in _input.first().json.result.points]\\nvectors = [item.vector.to_py() for item in _input.first().json.result.points]\\nvectors_array = np.array(vectors)\\n\\n# apply k-means clustering where n_clusters = 10\\n# this is a max and we'll discard some of these clusters later\\nkmeans = KMeans(n_clusters=min(len(vectors), 10), random_state=42).fit(vectors_array)\\nlabels = kmeans.labels_\\nunique_labels = set(labels)\\n\\n# Extract and print points in each cluster\\nclusters = {}\\nfor label in set(labels):\\n    clusters[label] = vectors_array[labels == label]\\n\\n# return Qdrant point ids for each cluster\\n# we'll use these ids to fetch the payloads from the vector store.\\noutput = []\\nfor cluster_id, cluster_points in clusters.items():\\n    points = [point_ids[i] for i in range(len(labels)) if labels[i] == cluster_id]\\n    output.append({\\n        \\\"id\\\": f\\\"Cluster {cluster_id}\\\",\\n        \\\"total\\\": len(cluster_points),\\n        \\\"points\\\": points\\n    })\\n\\nreturn {\\\"json\\\": {\\\"output\\\": output } }\"},\"typeVersion\":2},{\"id\":\"cbb42384-d46b-471f-a7d8-27e3de042492\",\"name\":\"Qdrant Vector Store\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreQdrant\",\"position\":[1220,100],\"parameters\":{\"mode\":\"insert\",\"options\":{},\"qdrantCollection\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"ux_survey_insights\",\"cachedResultName\":\"ux_survey_insights\"}},\"credentials\":{\"qdrantApi\":{\"id\":\"NyinAS3Pgfik66w5\",\"name\":\"QdrantApi account\"}},\"typeVersion\":1},{\"id\":\"17584901-15d6-421f-ad69-3ba872276055\",\"name\":\"Survey Insights Agent\",\"type\":\"@n8n/n8n-nodes-langchain.informationExtractor\",\"position\":[2580,800],\"parameters\":{\"text\":\"=The {{ $json.result.length }} participant responses were:\\n{{\\n$json.result.map(item =>\\n`* Participant ${item.payload.metadata.participant}: \\\"${item.payload.content.replaceAll('\\\"', '\\\\\\\"')}\\\"`\\n).join('\\\\n')\\n}}\",\"options\":{\"systemPromptTemplate\":\"=You help summarise a selection of participant responses to a specific question for a survey called \\\"{{ $json.result[0].payload.metadata.survey }}\\\".\\nThe question asked was \\\"{{ $json.result[0].payload.metadata.question }}\\\".\\nThe {{ $json.result.length }} participant responses were selected because their answers were similar in context.\\n\\nYour task is to: \\n* summarise the given participant responses into a short paragraph. Provide an insight from this summary and what we could learn from the answers.\\n* determine if the overall sentiment of all the listed responses to be either negative, mildy negative, neutral, mildy positive or positive.\"},\"schemaType\":\"fromJson\",\"jsonSchemaExample\":\"{\\n\\t\\\"Question\\\": \\\"What do you enjoy most about working remotely, and why?\\\",\\n\\t\\\"Insight\\\": \\\"\\\",\\n    \\\"Sentiment\\\": \\\"Positive\\\"\\n}\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Has Clusters?\":{\"main\":[[{\"node\":\"Clusters To List\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Prep Values For Export\",\"type\":\"main\",\"index\":0}]]},\"Set Variables\":{\"main\":[[{\"node\":\"Create Insights Sheet\",\"type\":\"main\",\"index\":0}]]},\"Clusters To List\":{\"main\":[[{\"node\":\"Only Clusters With 3+ points\",\"type\":\"main\",\"index\":0}]]},\"Export To Sheets\":{\"main\":[[{\"node\":\"For Each Question...\",\"type\":\"main\",\"index\":0}]]},\"Find All Answers\":{\"main\":[[{\"node\":\"Apply K-means Clustering Algorithm\",\"type\":\"main\",\"index\":0}]]},\"QA Pairs to List\":{\"main\":[[{\"node\":\"Qdrant Vector Store\",\"type\":\"main\",\"index\":0}]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"Qdrant Vector Store\",\"type\":\"ai_embedding\",\"index\":0}]]},\"Export To Sheets1\":{\"main\":[[{\"node\":\"For Each Question...\",\"type\":\"main\",\"index\":0}]]},\"Extract Questions\":{\"main\":[[{\"node\":\"Questions to List\",\"type\":\"main\",\"index\":0}]]},\"Get Sheet Details\":{\"main\":[[{\"node\":\"Set Variables\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"Survey Insights Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Questions to List\":{\"main\":[[{\"node\":\"For Each Question...\",\"type\":\"main\",\"index\":0}]]},\"Get Survey Headers\":{\"main\":[[{\"node\":\"Extract Questions\",\"type\":\"main\",\"index\":0}]]},\"Get Survey Results\":{\"main\":[[{\"node\":\"Convert to Question Answer Pairs\",\"type\":\"main\",\"index\":0}]]},\"Default Data Loader\":{\"ai_document\":[[{\"node\":\"Qdrant Vector Store\",\"type\":\"ai_document\",\"index\":0}]]},\"Qdrant Vector Store\":{\"main\":[[{\"node\":\"Prep Values For Trigger\",\"type\":\"main\",\"index\":0}]]},\"For Each Question...\":{\"main\":[null,[{\"node\":\"Find All Answers\",\"type\":\"main\",\"index\":0}]]},\"Create Insights Sheet\":{\"main\":[[{\"node\":\"Get Survey Headers\",\"type\":\"main\",\"index\":0}]]},\"Get Payload of Points\":{\"main\":[[{\"node\":\"Survey Insights Agent\",\"type\":\"main\",\"index\":0}]]},\"Survey Insights Agent\":{\"main\":[[{\"node\":\"Prep Output For Export\",\"type\":\"main\",\"index\":0}]]},\"Prep Output For Export\":{\"main\":[[{\"node\":\"Export To Sheets\",\"type\":\"main\",\"index\":0}]]},\"Prep Values For Export\":{\"main\":[[{\"node\":\"Export To Sheets1\",\"type\":\"main\",\"index\":0}]]},\"Prep Values For Trigger\":{\"main\":[[{\"node\":\"Trigger Insights\",\"type\":\"main\",\"index\":0}]]},\"Execute Workflow Trigger\":{\"main\":[[{\"node\":\"Get Sheet Details\",\"type\":\"main\",\"index\":0}]]},\"Only Clusters With 3+ points\":{\"main\":[[{\"node\":\"Get Payload of Points\",\"type\":\"main\",\"index\":0}]]},\"Convert to Question Answer Pairs\":{\"main\":[[{\"node\":\"QA Pairs to List\",\"type\":\"main\",\"index\":0}]]},\"Recursive Character Text Splitter\":{\"ai_textSplitter\":[[{\"node\":\"Default Data Loader\",\"type\":\"ai_textSplitter\",\"index\":0}]]},\"When clicking ‘Test workflow’\":{\"main\":[[{\"node\":\"Get Survey Results\",\"type\":\"main\",\"index\":0}]]},\"Apply K-means Clustering Algorithm\":{\"main\":[[{\"node\":\"Has Clusters?\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This n8n template is one of a 3-part series exploring use-cases for clustering vector embeddings:\n\n  * Survey Insights\n  * Customer Insights\n  * Community Insights\n\n\n\nThis template demonstrates the Survey Insights scenario where survey participant responses can be quickly grouped by similarity and an AI agent can generate insights on those groupings.\n\nWith this workflow, researchers can save days and even weeks of work breaking down cohorts of participants and identify frequently mentioned positives and negatives.\n\nSample Output: <https://docs.google.com/spreadsheets/d/e/2PACX-1vT6m8XH8JWJTUAfwojc68NAUGC7q0lO7iV738J7aO5fuVjiVzdTRRPkMmT1C4N8TwejaiT0XrmF1Q48/pubhtml#>\n\n### How it works\n\n  * All survey questions and responses are imported from a Google Sheet.\n  * Responses are then inserted into a Qdrant collection carefully tagged with the question and survey metadata.\n  * For each question, all relevant response are put through a clustering algorithm using the Python Code node. The Qdrant points are returned in clustered groups.\n  * Each group is looped to fetch the payloads of the points and feed them to the AI agent to summarise and generate insights for.\n  * The resulting insights and raw responses are then saved to the Google Spreadsheet for further analysis by the researcher.\n\n\n\n### Requirements\n\n  * Survey data and format as shown in the attached google sheet.\n  * Qdrant Vectorstore for storing embeddings.\n  * OpenAI account for embeddings and LLM.\n\n\n\n### Customising the Template\n\n  * Adjust clustering parameters which make sense for your data. Add more clusters for open-ended questions and less clusters when responses are multiple choice.\n\n\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><p>This n8n template is one of a 3-part series exploring use-cases for clustering vector embeddings:</p>\n<ul>\n<li>Survey Insights</li>\n<li>Customer Insights</li>\n<li>Community Insights</li>\n</ul>\n<p>This template demonstrates the Survey Insights scenario where survey participant responses can be quickly grouped by similarity and an AI agent can generate insights on those groupings.</p>\n<p>With this workflow, researchers can save days and even weeks of work breaking down cohorts of participants and identify frequently mentioned positives and negatives.</p>\n<p>Sample Output: <a href=\"https://docs.google.com/spreadsheets/d/e/2PACX-1vT6m8XH8JWJTUAfwojc68NAUGC7q0lO7iV738J7aO5fuVjiVzdTRRPkMmT1C4N8TwejaiT0XrmF1Q48/pubhtml#\" rel=\"ugc nofollow\" target=\"_blank\">https://docs.google.com/spreadsheets/d/e/2PACX-1vT6m8XH8JWJTUAfwojc68NAUGC7q0lO7iV738J7aO5fuVjiVzdTRRPkMmT1C4N8TwejaiT0XrmF1Q48/pubhtml#</a></p>\n<h3>How it works</h3>\n<ul>\n<li>All survey questions and responses are imported from a Google Sheet.</li>\n<li>Responses are then inserted into a Qdrant collection carefully tagged with the question and survey metadata.</li>\n<li>For each question, all relevant response are put through a clustering algorithm using the Python Code node. The Qdrant points are returned in clustered groups.</li>\n<li>Each group is looped to fetch the payloads of the points and feed them to the AI agent to summarise and generate insights for.</li>\n<li>The resulting insights and raw responses are then saved to the Google Spreadsheet for further analysis by the researcher.</li>\n</ul>\n<h3>Requirements</h3>\n<ul>\n<li>Survey data and format as shown in the attached google sheet.</li>\n<li>Qdrant Vectorstore for storing embeddings.</li>\n<li>OpenAI account for embeddings and LLM.</li>\n</ul>\n<h3>Customising the Template</h3>\n<ul>\n<li>Adjust clustering parameters which make sense for your data. Add more clusters for open-ended questions and less clusters when responses are multiple choice.</li>\n</ul>\n</div><!--]-->",
  "readme_zh": "此n8n模板是一个探索向量嵌入聚类应用场景的三部曲系列之一：\n\n* 调查洞察\n* 客户洞察\n* 社区洞察\n\n本模板展示\"调查洞察\"场景，可快速按相似性对调查参与者回答进行分组，并由AI智能体生成分组洞见。通过此工作流，研究人员可节省数日甚至数周的人工分类时间，精准识别高频提及的正面与负面评价。\n\n示例输出：<https://docs.google.com/spreadsheets/d/e/2PACX-1vT6m8XH8JWJTUAfwojc68NAUGC7q0lO7iV738J7aO5fuVjiVzdTRRPkMmT1C4N8TwejaiT0XrmF1Q48/pubhtml#>\n\n### 运作原理\n\n* 从Google表格导入所有调查问题及回答\n* 将回答数据存入Qdrant集合，并标注问题与调查元数据\n* 通过Python代码节点对每个问题的回答执行聚类算法，返回Qdrant中的聚类分组\n* 遍历每个聚类组获取数据载荷，交由AI智能体生成摘要与洞察\n* 最终将分析结果与原始回答保存至Google表格供研究人员深度分析\n\n### 环境要求\n\n* 需准备符合示例表格格式的调查数据\n* 需配置Qdrant向量数据库存储嵌入\n* 需开通OpenAI账户用于嵌入生成与大语言模型\n\n### 模板定制\n\n* 根据数据类型调整聚类参数：开放式问题可增加聚类数量，选择题则可减少聚类组",
  "title_zh": "使用Qdrant、Python和信息提取器进行调研洞察",
  "publish_date_absolute": "2024-09-06",
  "publish_date_zh": "最后更新于8个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"0404384b-10b6-4666-84a4-8870db30c607\",\n      \"name\": \"Embeddings OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        1220,\n        280\n      ],\n      \"parameters\": {\n        \"model\": \"text-embedding-3-small\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a6741f04-5a5b-47a9-ac08-eb562f9f6052\",\n      \"name\": \"Default Data Loader\",\n      \"type\": \"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\n      \"position\": [\n        1340,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"question\",\n                \"value\": \"={{ $json.question }}\"\n              },\n              {\n                \"name\": \"participant\",\n                \"value\": \"={{ $json.participant }}\"\n              },\n              {\n                \"name\": \"survey\",\n                \"value\": \"={{ $('Get Survey Results').params.documentId.cachedResultName }}\"\n              }\n            ]\n          }\n        },\n        \"jsonData\": \"={{ $json.answer }}\",\n        \"jsonMode\": \"expressionData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7663c3dd-f713-4034-bef6-0c000285f54f\",\n      \"name\": \"Convert to Question Answer Pairs\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        720,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"6b593ffb-ffbd-4cf5-a508-cd4f2a6d1004\",\n              \"name\": \"data\",\n              \"type\": \"array\",\n              \"value\": \"={{\\n  Object.keys($json)\\n    .filter(key => !['row_number', 'Participant'].includes(key))\\n  .map(key => ({ question: key, answer: $json[key], participant: $json.Participant }))\\n}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"84873f0c-81ce-442f-a33c-d7c6c2efa11b\",\n      \"name\": \"Recursive Character Text Splitter\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\n      \"position\": [\n        1340,\n        420\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"da9a8ee8-5e3f-49db-8d1f-26a61ca82344\",\n      \"name\": \"Get Survey Results\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        540,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1-168Vm-1kCeHkqGLAs6odha4DhPE93njfHlYIviKE50/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1-168Vm-1kCeHkqGLAs6odha4DhPE93njfHlYIviKE50\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1-168Vm-1kCeHkqGLAs6odha4DhPE93njfHlYIviKE50/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Remote Working Survey Responses\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.4\n    },\n    {\n      \"id\": \"4bad90b2-eefe-49c8-8caa-41cd4cb5e60f\",\n      \"name\": \"Get Survey Headers\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        740,\n        940\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"dataLocationOnSheet\": {\n            \"values\": {\n              \"range\": \"A1:Z2\",\n              \"rangeDefinition\": \"specifyRangeA1\"\n            }\n          }\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Execute Workflow Trigger').first().json.sheetName }}\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.4\n    },\n    {\n      \"id\": \"47c64994-9d1f-42ca-a849-3eeab5335b66\",\n      \"name\": \"Extract Questions\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        940,\n        940\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"d655b165-dfa2-46cb-bc27-140399bc4227\",\n              \"name\": \"question\",\n              \"type\": \"array\",\n              \"value\": \"={{\\n  Object.keys($('Get Survey Headers').item.json)\\n    .filter(key => key.includes('?'))\\n}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c237d523-b290-41ca-b323-4cc7c7f6ff37\",\n      \"name\": \"Questions to List\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        940,\n        1120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"question\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7f44a770-4c5d-4404-ae95-d9dee8348380\",\n      \"name\": \"Find All Answers\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1460,\n        1120\n      ],\n      \"parameters\": {\n        \"url\": \"=http://qdrant:6333/collections/{{ $('Set Variables').item.json.collectionName }}/points/scroll\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"limit\\\": 500,\\n  \\\"filter\\\":{\\n    \\\"must\\\": [\\n      {\\n        \\\"key\\\": \\\"metadata.question\\\",\\n        \\\"match\\\": { \\\"value\\\": \\\"{{ $('For Each Question...').item.json.question }}\\\" }\\n      },\\n      {\\n        \\\"key\\\": \\\"metadata.survey\\\",\\n        \\\"match\\\": { \\\"value\\\": \\\"{{ $('Set Variables').item.json.surveyName }}\\\" }\\n      }\\n    ]\\n  },\\n  \\\"with_vector\\\":true\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"qdrantApi\"\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"NyinAS3Pgfik66w5\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"2b6dc317-f8f3-4201-a9e1-d35ee578e79e\",\n      \"name\": \"Get Payload of Points\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2380,\n        800\n      ],\n      \"parameters\": {\n        \"url\": \"=http://qdrant:6333/collections/{{ $('Set Variables').first().json.collectionName }}/points\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{\\n  {\\n    \\\"ids\\\": $json.points,\\n    \\\"with_payload\\\": true\\n  }\\n}}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"qdrantApi\"\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"NyinAS3Pgfik66w5\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"d4a37d97-975a-4243-a7ea-81b3e30558a5\",\n      \"name\": \"Clusters To List\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        2180,\n        800\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"output\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c78f1bf6-8390-48ee-88f4-7d1a893a8ade\",\n      \"name\": \"Set Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        200,\n        1060\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"b77c94a0-d865-4bd6-b078-a09b2ddb2a99\",\n              \"name\": \"collectionName\",\n              \"type\": \"string\",\n              \"value\": \"ux_survey_insights\"\n            },\n            {\n              \"id\": \"7b0a4d14-b5f9-4597-84c0-8cfdb363c3d3\",\n              \"name\": \"surveyName\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.properties.title }}\"\n            },\n            {\n              \"id\": \"45434b3b-3b74-4262-82e0-7ed02155caad\",\n              \"name\": \"insightsSheetName\",\n              \"type\": \"string\",\n              \"value\": \"=Insights-{{ $now.format('yyyyMMdd') }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"fbb1f3c3-06ad-44b5-b020-6fc3c8eda7c4\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        2560,\n        980\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4o-mini\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"83d3b413-a661-4c4c-9b8d-6ee395a15348\",\n      \"name\": \"Prep Output For Export\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        3160,\n        1300\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"options\": {},\n        \"jsonOutput\": \"={{ {\\n  ...$json.output,\\n  \\\"Number of Response\\\": $('Get Payload of Points').item.json.result.length,\\n  \\\"Participant IDs\\\": $('Get Payload of Points').item.json.result.map(item =>\\n    item.payload.metadata.participant\\n  ).join(','),\\n  \\\"Raw Responses\\\": $('Get Payload of Points').item.json.result.map(item =>\\n    `Participant ${item.payload.metadata.participant},${item.payload.content.replaceAll('\\\"', '\\\\\\\"')}`\\n   ).join('\\\\n')\\n} }}\\n\"\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"14784dff-a8ea-4b6b-8379-b0c9051a8f98\",\n      \"name\": \"Export To Sheets\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        3360,\n        1300\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {},\n          \"schema\": [\n            {\n              \"id\": \"What is your name?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"What is your name?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"The responses indicate that two participants have the same name, 'Kwame Nkosi', which suggests a commonality in names or cultural naming traditions among the respondents. This could highlight the importance of understanding cultural context in survey responses.\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"The responses indicate that two participants have the same name, 'Kwame Nkosi', which suggests a commonality in names or cultural naming traditions among the respondents. This could highlight the importance of understanding cultural context in survey responses.\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"neutral\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"neutral\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"3\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"3\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"77,17,54\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"77,17,54\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Participant 77,Kwame Nkosi\\nParticipant 17,Kwame Nkosi\\nParticipant 54,Kwame Nkansah\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Participant 77,Kwame Nkosi\\nParticipant 17,Kwame Nkosi\\nParticipant 54,Kwame Nkansah\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"autoMapInputData\",\n          \"matchingColumns\": []\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"name\",\n          \"value\": \"={{ $('Set Variables').first().json.insightsSheetName }}\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.4\n    },\n    {\n      \"id\": \"779b9411-db3e-44f3-ad2a-c9d40a70580d\",\n      \"name\": \"Export To Sheets1\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        2360,\n        1300\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {},\n          \"schema\": [],\n          \"mappingMode\": \"autoMapInputData\",\n          \"matchingColumns\": []\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"name\",\n          \"value\": \"={{ $('Set Variables').first().json.insightsSheetName }}\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.4\n    },\n    {\n      \"id\": \"a31ab677-f57c-4b78-a290-d4a913ed4f8e\",\n      \"name\": \"For Each Question...\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        1280,\n        940\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"dcfaf927-6ecd-4ebe-aee0-5fb3367b2725\",\n      \"name\": \"Trigger Insights\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        1980,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"workflowId\": \"={{ $workflow.id }}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2579adf0-9c00-4b87-b53e-740044577ab0\",\n      \"name\": \"Prep Values For Trigger\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1800,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"24dd90ad-390f-444e-ba6c-8c06a41e836e\",\n              \"name\": \"sheetID\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get Survey Results').params.documentId.value }}\"\n            },\n            {\n              \"id\": \"90199bbb-3938-411c-a7a8-faa7ccba6059\",\n              \"name\": \"sheetName\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get Survey Results').params.sheetName.value }}\"\n            }\n          ]\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"9b29e850-b9d0-4358-af62-92c20ab3b088\",\n      \"name\": \"Execute Workflow Trigger\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        20,\n        900\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"70a0dcec-9f74-4af2-bd64-0ab762a77e51\",\n      \"name\": \"Create Insights Sheet\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        420,\n        900\n      ],\n      \"parameters\": {\n        \"title\": \"={{ $('Set Variables').first().json.insightsSheetName }}\",\n        \"options\": {},\n        \"operation\": \"create\",\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Execute Workflow Trigger').first().json.sheetID }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.4,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"f31400fb-dd7a-4c62-90ec-e9d78bbaa5e8\",\n      \"name\": \"Prep Values For Export\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2180,\n        1300\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"options\": {},\n        \"jsonOutput\": \"={\\n  \\\"Question\\\": \\\"{{ $('For Each Question...').item.json.question }}\\\",\\n  \\\"Insight\\\": \\\"No Insight Found\\\"\\n}\\n\"\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"506c20df-5109-422c-8c9e-0eb50fbd3ff9\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        459.27570452141345,\n        -42.168106366729035\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 617.2130261221611,\n        \"height\": 420.7389587470384,\n        \"content\": \"## 第一步：导入调查问卷反馈  \\n[进一步了解Google Sheets](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlesheets)  \\n\\n我们的方法需要将所有参与者的反馈作为向量导入，并通过元数据将其与对应的问题关联起来。为此，我们将从调查中生成问题与答案的配对。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bddcafa8-6f54-4829-93c9-37bbb9e7edf3\",\n      \"name\": \"QA Pairs to List\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        900,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8d6e6bf6-c94c-43cb-a29e-5d10207cb8bd\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1100,\n        -102.05898437632061\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 563.8350682199533,\n        \"height\": 678.1641960508446,\n        \"content\": \"## 第二步：将每条回答向量化并存入Qdrant\\n[详细了解Qdrant的使用方法](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.vectorstoreqdrant)\\n\\n需特别注意元数据的捕获方式，因为该工作流的核心在于能够检索数据子集进行分析。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"613d4a32-a87a-423e-a1d1-ee23db0de6d1\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1680,\n        -30.440883940004255\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 519.6419932444072,\n        \"height\": 429.11782776909047,\n        \"content\": \"## 步骤3. 触发洞察子工作流\\n[了解更多关于工作流触发器的信息](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow)\\n\\n此子工作流用于触发调查分析。虽然这种分离是可选的，但此处采用旨在更清晰地展示两阶段流程。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1e858e4a-b91b-4411-8e2a-6eb76647b796\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -57.47778952966382,\n        710.393394209128\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 668.3083616841852,\n        \"height\": 528.2386658883073,\n        \"content\": \"## 步骤4. 创建洞察分析表\\n[详细了解工作流触发器](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflowtrigger)\\n\\n为记录生成的洞察分析结果，我们将在调查表格中新建一个独立工作表。此步骤为可选操作，您也可以根据需求将数据存储至其他数据库。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9170c566-07d3-49dc-aafb-2dbe79940d2c\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        640,\n        683.5153164275844\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 536.9288458983389,\n        \"height\": 622.1362463986454,\n        \"content\": \"## 步骤5. 从调查问卷中获取问题列表\\n[进一步了解如何使用Google表格](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlesheets)\\n\\n接下来我们将获取调查问卷的元数据及问题列表，并将其拆分为独立的工作流项。我们的目标是在处理下一个问题前，先完成当前问题的端到端处理。这种设计能在流程意外中断时提供更高容错性——确保已处理内容不会全部丢失。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8488df77-055d-41cc-94f1-92ac5d54ef10\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1200,\n        673.291535602609\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 823.147012265536,\n        \"height\": 868.2579789328703,\n        \"content\": \"## 第六步：为每个问题找出相似答案组群\\n[详细了解如何使用代码节点](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code/)\\n\\n将所有回答直接交给大语言模型分析是常见但天真的做法——生成的摘要往往过于笼统，难以获得真正洞察，且会丢失回答者数量与身份等关键细节。我们采用的方法是找出每个问题的热门答案组群，通过将答案向量映射到二维网格，识别出向量点形成的\\\"聚类\\\"（即彼此邻近的点群），从而确保所有观点都被纳入考量。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f4748b6d-5bd8-48cf-942f-3a0dc681078d\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2060,\n        1180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 536.9288458983389,\n        \"height\": 359.90385684071794,\n        \"content\": \"## 步骤7b. 若未发现聚类则跳过  \\n当未发现任何聚类时，意味着答案的独特性使其未呈现任何模式。例如：\\\"你叫什么名字？\\\"\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d55d6a47-da8c-46ae-bd10-0eb671dcd121\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2060,\n        611.6915003841909\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 871.451300407926,\n        \"height\": 541.1135860445843,\n        \"content\": \"## 步骤7a. 汇总相似答案的主要群组\\n[详细了解如何使用信息提取器节点](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.information-extractor)\\n\\n每个发现的聚类将返回一个参考向量，用于获取该群组中所有相关的答案。\\n随后将该群组发送给大语言模型进行汇总，并分配情感评分。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e5d5f88f-5832-43fc-a5b9-f747d08e7e77\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2620,\n        1180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 924.2798021207429,\n        \"height\": 363.07347551845976,\n        \"content\": \"## 步骤8. 写入洞察表  \\n最后，我们将完成的洞察内容追加到工作流早期创建的洞察表中。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"49ac1504-7b43-4fa1-b4ce-15c7a53c9018\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        460,\n        400\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 323.2987132716669,\n        \"height\": 80,\n        \"content\": \"### 仅需运行一次！\\n如因任何原因需重复运行，请务必先清除现有数据。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"450f89c5-ef0f-4bf8-8db9-6347247c7f4d\",\n      \"name\": \"Has Clusters?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1820,\n        1120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"40b6bb62-a2d6-4422-8fbb-7ae49898bad9\",\n              \"operator\": {\n                \"type\": \"array\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.output }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"1652a108-8fb8-4229-a76d-abf9fbcff626\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        20,\n        -400\n      ],\n      \"parameters\": {\n        \"width\": 400.381109509268,\n        \"height\": 679.5610243514676,\n        \"content\": \"## 试试看吧！\\n\\n### 该工作流可从调查反馈中生成深度洞察报告，尤其适合处理大规模参与者数据。\\n\\n* 导入调查结果并向量化存储至Qdrant向量数据库  \\n* 通过K-means聚类算法识别问题答案的热门观点集群  \\n* 每个有效集群经由大语言模型分析提炼核心观点  \\n* 将模型分析报告与聚类结果回传至电子表格  \\n\\n参考谷歌表格示例：[点击查看](https://docs.google.com/spreadsheets/d/e/2PACX-1vT6m8XH8JWJTUAfwojc68NAUGC7q0lO7iV738J7aO5fuVjiVzdTRRPkMmT1C4N8TwejaiT0XrmF1Q48/pubhtml)\\n\\n### 需要帮助？  \\n加入[Discord讨论群](https://discord.com/invite/XPKeKXeB7d) 或访问[社区论坛](https://community.n8n.io/)  \\n\\n祝您探索愉快！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6eef981e-b2ce-433c-b71f-78be64812a56\",\n      \"name\": \"Sticky Note11\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1260,\n        1340\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 323.2987132716669,\n        \"height\": 110.05160146874424,\n        \"content\": \"### 首次运行？\\n首次运行时会有短暂延迟，因为代码节点需要下载必要的依赖包。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fa0c14be-03f4-4ed2-bd60-e93817382ded\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        240,\n        100\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"30323019-59ba-4a19-a46e-196d469f097d\",\n      \"name\": \"Get Sheet Details\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        200,\n        900\n      ],\n      \"parameters\": {\n        \"url\": \"=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.sheetID }}\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"googleSheetsOAuth2Api\"\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"6ced8012-1dd3-4da3-8c27-e4f4dfc959f6\",\n      \"name\": \"Only Clusters With 3+ points\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        2180,\n        960\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"328f806c-0792-4d90-9bee-a1e10049e78f\",\n              \"operator\": {\n                \"type\": \"array\",\n                \"operation\": \"lengthGt\",\n                \"rightType\": \"number\"\n              },\n              \"leftValue\": \"={{ $json.points }}\",\n              \"rightValue\": 2\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"8ae81a55-75e2-40a3-bef6-0935ff08128f\",\n      \"name\": \"Apply K-means Clustering Algorithm\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1640,\n        1120\n      ],\n      \"parameters\": {\n        \"language\": \"python\",\n        \"pythonCode\": \"import numpy as np\\nfrom sklearn.cluster import KMeans\\n\\n# get vectors for all answers\\npoint_ids = [item.id for item in _input.first().json.result.points]\\nvectors = [item.vector.to_py() for item in _input.first().json.result.points]\\nvectors_array = np.array(vectors)\\n\\n# apply k-means clustering where n_clusters = 10\\n# this is a max and we'll discard some of these clusters later\\nkmeans = KMeans(n_clusters=min(len(vectors), 10), random_state=42).fit(vectors_array)\\nlabels = kmeans.labels_\\nunique_labels = set(labels)\\n\\n# Extract and print points in each cluster\\nclusters = {}\\nfor label in set(labels):\\n    clusters[label] = vectors_array[labels == label]\\n\\n# return Qdrant point ids for each cluster\\n# we'll use these ids to fetch the payloads from the vector store.\\noutput = []\\nfor cluster_id, cluster_points in clusters.items():\\n    points = [point_ids[i] for i in range(len(labels)) if labels[i] == cluster_id]\\n    output.append({\\n        \\\"id\\\": f\\\"Cluster {cluster_id}\\\",\\n        \\\"total\\\": len(cluster_points),\\n        \\\"points\\\": points\\n    })\\n\\nreturn {\\\"json\\\": {\\\"output\\\": output } }\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"cbb42384-d46b-471f-a7d8-27e3de042492\",\n      \"name\": \"Qdrant Vector Store\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreQdrant\",\n      \"position\": [\n        1220,\n        100\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"options\": {},\n        \"qdrantCollection\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"ux_survey_insights\",\n          \"cachedResultName\": \"ux_survey_insights\"\n        }\n      },\n      \"credentials\": {\n        \"qdrantApi\": {\n          \"id\": \"NyinAS3Pgfik66w5\",\n          \"name\": \"QdrantApi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"17584901-15d6-421f-ad69-3ba872276055\",\n      \"name\": \"Survey Insights Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.informationExtractor\",\n      \"position\": [\n        2580,\n        800\n      ],\n      \"parameters\": {\n        \"text\": \"=The {{ $json.result.length }} participant responses were:\\n{{\\n$json.result.map(item =>\\n`* Participant ${item.payload.metadata.participant}: \\\"${item.payload.content.replaceAll('\\\"', '\\\\\\\"')}\\\"`\\n).join('\\\\n')\\n}}\",\n        \"options\": {\n          \"systemPromptTemplate\": \"=You help summarise a selection of participant responses to a specific question for a survey called \\\"{{ $json.result[0].payload.metadata.survey }}\\\".\\nThe question asked was \\\"{{ $json.result[0].payload.metadata.question }}\\\".\\nThe {{ $json.result.length }} participant responses were selected because their answers were similar in context.\\n\\nYour task is to: \\n* summarise the given participant responses into a short paragraph. Provide an insight from this summary and what we could learn from the answers.\\n* determine if the overall sentiment of all the listed responses to be either negative, mildy negative, neutral, mildy positive or positive.\"\n        },\n        \"schemaType\": \"fromJson\",\n        \"jsonSchemaExample\": \"{\\n\\t\\\"Question\\\": \\\"What do you enjoy most about working remotely, and why?\\\",\\n\\t\\\"Insight\\\": \\\"\\\",\\n    \\\"Sentiment\\\": \\\"Positive\\\"\\n}\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Has Clusters?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Clusters To List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Prep Values For Export\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Insights Sheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Clusters To List\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Only Clusters With 3+ points\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Export To Sheets\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Question...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find All Answers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Apply K-means Clustering Algorithm\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"QA Pairs to List\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Qdrant Vector Store\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Qdrant Vector Store\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Export To Sheets1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Question...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract Questions\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Questions to List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Sheet Details\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Survey Insights Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Questions to List\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Question...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Survey Headers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract Questions\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Survey Results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert to Question Answer Pairs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Default Data Loader\": {\n      \"ai_document\": [\n        [\n          {\n            \"node\": \"Qdrant Vector Store\",\n            \"type\": \"ai_document\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Qdrant Vector Store\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prep Values For Trigger\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"For Each Question...\": {\n      \"main\": [\n        null,\n        [\n          {\n            \"node\": \"Find All Answers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Insights Sheet\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Survey Headers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Payload of Points\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Survey Insights Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Survey Insights Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prep Output For Export\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Prep Output For Export\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Export To Sheets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Prep Values For Export\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Export To Sheets1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Prep Values For Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Trigger Insights\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Execute Workflow Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Sheet Details\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Only Clusters With 3+ points\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Payload of Points\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert to Question Answer Pairs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"QA Pairs to List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Recursive Character Text Splitter\": {\n      \"ai_textSplitter\": [\n        [\n          {\n            \"node\": \"Default Data Loader\",\n            \"type\": \"ai_textSplitter\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Survey Results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Apply K-means Clustering Algorithm\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Has Clusters?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
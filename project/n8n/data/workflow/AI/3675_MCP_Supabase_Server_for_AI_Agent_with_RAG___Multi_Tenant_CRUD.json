{
  "title": "MCP Supabase Server for AI Agent with RAG & Multi-Tenant CRUD",
  "url": "https://n8n.io/workflows/3675-mcp-supabase-server-for-ai-agent-with-rag-and-multi-tenant-crud/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/",
  "author": "Luciano Gutierrez",
  "publish_date": "Last update 3 days ago",
  "content": "",
  "workflow_json": "{\"id\":\"oowUGM7ey6gWxzEG\",\"meta\":{\"instanceId\":\"6d46e25379ef430a7067964d1096b885c773564549240cb3ad4c087f6cf94bd3\",\"templateCredsSetupCompleted\":true},\"name\":\"MCP_SUPABASE_AGENT\",\"tags\":[],\"nodes\":[{\"id\":\"135ceeee-77cd-479f-a0b4-dd72abe23ac4\",\"name\":\"MCP_SUPABASE\",\"type\":\"@n8n/n8n-nodes-langchain.mcpTrigger\",\"position\":[-1460,1180],\"webhookId\":\"affff59c-9c5c-4a07-b531-616c1d631601\",\"parameters\":{\"path\":\"affff59c-9c5c-4a07-b531-616c1d631601\"},\"typeVersion\":1},{\"id\":\"b25040a8-2d70-4d3a-ba58-b8c7164d375e\",\"name\":\"RAG\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"position\":[1240,760],\"parameters\":{\"mode\":\"retrieve-as-tool\",\"topK\":5,\"options\":{},\"toolName\":\"ITERACOES\",\"tableName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"documents\",\"cachedResultName\":\"documents\"},\"toolDescription\":\"lembra das interacoes e consulta as instrucoes do system como assim tambem vai guardando o que aprende\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1.1},{\"id\":\"081035c0-ecc2-4924-8f07-da4cbb69fb06\",\"name\":\"Embeddings OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[1500,960],\"parameters\":{\"model\":\"text-embedding-ada-002\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"zUnIUrOWA279vAoC\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"361e0a74-b386-4e03-9e7b-5f435f0d8c5f\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,120],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## AGENT_MESSAGE\\n\"},\"typeVersion\":1},{\"id\":\"5aafb3a6-edd1-4154-adab-948db9aad8e7\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,720],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## AGENT_TASK\\n\"},\"typeVersion\":1},{\"id\":\"61b75c2e-b472-4597-a12a-f6027caecf4e\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,1320],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## AGENT_STATUS\\n\\n\\n\"},\"typeVersion\":1},{\"id\":\"7adc4cd9-cbac-4922-b928-f0b556d6f839\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,1900],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## AGENT_KNOWLEDGE\\n\\n\"},\"typeVersion\":1},{\"id\":\"7680abd0-d5f1-41db-96ad-d64c1b857032\",\"name\":\"DELETE_ROW_INSCRICOES_CURSOS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,2020],\"parameters\":{\"tableId\":\"agent_knowledge\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"5c752cf4-6dde-49d9-9328-2ed0731c6d7a\",\"name\":\"GET_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,260],\"parameters\":{\"tableId\":\"agent_messages\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"f65e9fd3-a656-473c-a7af-217d9b041aa7\",\"name\":\"CREATE_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,260],\"parameters\":{\"tableId\":\"agent_messages\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"61269957-e6ac-4e5b-adb0-fd610cdff8aa\",\"name\":\"DELETE_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,260],\"parameters\":{\"tableId\":\"agent_messages\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"52db9de5-5610-4b2d-9194-e1551b95a4e6\",\"name\":\"UPDATE_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,260],\"parameters\":{\"tableId\":\"agent_messages\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"b43aaea6-7841-4848-9228-2be6dd07a03f\",\"name\":\"GET_MANY_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,260],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_messages\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"c5347c5e-f9cb-40aa-bca5-249e8c220839\",\"name\":\"CREATE_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,840],\"parameters\":{\"tableId\":\"agent_tasks\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"85e3c8e1-6a75-40ce-a344-4a8fd3a1ae16\",\"name\":\"GET_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,840],\"parameters\":{\"tableId\":\"agent_tasks\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"7dacc138-a3aa-4483-a79c-5f2eee915c72\",\"name\":\"DELETE_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,840],\"parameters\":{\"tableId\":\"agent_tasks\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"cb942ab1-e7f2-4fd7-bc1e-fa9e559480a1\",\"name\":\"UPDATE_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,840],\"parameters\":{\"tableId\":\"agent_tasks\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"ed9cc573-764c-4cda-82f4-796851b16fba\",\"name\":\"GET_MANY_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,840],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_tasks\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"d3412d90-6025-4db5-a845-8b1ea6070ea3\",\"name\":\"CREATE_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,1440],\"parameters\":{\"tableId\":\"agent_status\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"843a2b92-8fb4-4453-9517-b37e07148f52\",\"name\":\"GET_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,1440],\"parameters\":{\"tableId\":\"agent_status\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"9a075b33-23fa-487c-b139-41e7e4794831\",\"name\":\"DELETE_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,1440],\"parameters\":{\"tableId\":\"agent_status\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"a066b99d-15f4-4c3e-bab6-4423b749bb74\",\"name\":\"UPDATE_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,1440],\"parameters\":{\"tableId\":\"agent_status\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"be9930a8-4e01-4823-a0be-4adfd06dd29c\",\"name\":\"GET_MANY_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,1440],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_status\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"01fbbe34-81e7-4017-a10e-ef7137024d6a\",\"name\":\"CREATE_ROW_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,2020],\"parameters\":{\"tableId\":\"agent_knowledge\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"5ba9e5eb-76bb-499c-b93b-5cca7286259b\",\"name\":\"GET_ROW_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,2020],\"parameters\":{\"tableId\":\"agent_knowledge\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"a25cef14-0cf0-4ded-81f0-cde300f74432\",\"name\":\"UPDATE_ROW_INSCRICOES_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,2020],\"parameters\":{\"tableId\":\"agent_knowledge\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"1c1fae2e-97f9-449f-913a-8ac730c1f145\",\"name\":\"GET_MANY_ROW_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,2020],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_knowledge\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"d32edd9b-7508-45a9-adcc-049543647145\",\"connections\":{\"RAG\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"RAG\",\"type\":\"ai_embedding\",\"index\":0}]]},\"GET_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_ROW_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_INSCRICOES_CURSOS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_INSCRICOES_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]}}}",
  "readme": "# Supabase AI Agent with RAG & Multi-Tenant CRUD\n\n**Version** : 1.0.0  \n**n8n Version** : 1.88.0+  \n**Author** : Koresolucoes  \n**License** : MIT\n\n* * *\n\n## Description\n\nA stateful AI agent workflow powered by **Supabase** and **Retrieval-Augmented Generation (RAG)**. Enables persistent memory, dynamic CRUD operations, and multi-tenant data isolation for AI-driven applications like customer support, task orchestration, and knowledge management.\n\n**Key Features** :\n\n  * 🧠 **RAG Integration** : Leverages OpenAI embeddings and Supabase vector search for context-aware responses.\n  * 🗃️ **Full CRUD** : Manage `agent_messages`, `agent_tasks`, `agent_status`, and `agent_knowledge` in real time.\n  * 📤 **Multi-Tenant Ready** : Supports per-user/organization data isolation via dynamic table names and webhooks.\n  * 🔒 **Secure** : Role-based access control via Supabase Row Level Security (RLS).\n\n\n\n* * *\n\n## Use Cases\n\n  1. **Customer Support Chatbots** : Persist conversation history and resolve queries using institutional knowledge.\n  2. **Automated Task Management** : Track and update task statuses dynamically.\n  3. **Knowledge Repositories** : Store and retrieve domain-specific information for AI agents.\n\n\n\n* * *\n\n## Instructions\n\n### 1\\. Import Template\n\n  * Go to **n8n > Templates > Import from File** and upload this workflow.\n\n\n\n### 2\\. Configure Credentials\n\n  * Add your **Supabase** and **OpenAI** API keys under **Settings > Credentials**.\n\n\n\n### 3\\. Set Up Multi-Tenancy (Optional)\n\n  * **Dynamic Webhook Path** :  \nReplace the default webhook path with `/mcp/tool/supabase/:userId` to enable per-user routing.\n  * **Table Names** :  \nUse a **Set Node** to dynamically generate table names (e.g., `agent_messages_{{userId}}`).\n\n\n\n### 4\\. Activate & Test\n\n  * Enable the workflow and send test requests to the webhook URL.\n\n\n\n* * *\n\n## Tags\n\n`AI Agent` `RAG` `Supabase` `CRUD` `Multi-Tenant` `OpenAI` `Automation`\n\n* * *\n\n## Screenshots\n\n![Captura de tela 20250423 124013.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/Captura_de_tela_2025_04_23_124013_16d75760fe.png)  \n![Captura de tela 20250423 123954.png](https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/Captura_de_tela_2025_04_23_123954_07df6d0444.png)\n\n* * *\n\n## License\n\nThis template is licensed under the MIT License.\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><h1>Supabase AI Agent with RAG &amp; Multi-Tenant CRUD</h1>\n<p><strong>Version</strong>: 1.0.0<br>\n<strong>n8n Version</strong>: 1.88.0+<br>\n<strong>Author</strong>: Koresolucoes<br>\n<strong>License</strong>: MIT</p>\n<hr>\n<h2>Description</h2>\n<p>A stateful AI agent workflow powered by <strong>Supabase</strong> and <strong>Retrieval-Augmented Generation (RAG)</strong>. Enables persistent memory, dynamic CRUD operations, and multi-tenant data isolation for AI-driven applications like customer support, task orchestration, and knowledge management.</p>\n<p><strong>Key Features</strong>:</p>\n<ul>\n<li>🧠 <strong>RAG Integration</strong>: Leverages OpenAI embeddings and Supabase vector search for context-aware responses.</li>\n<li>🗃️ <strong>Full CRUD</strong>: Manage <code>agent_messages</code>, <code>agent_tasks</code>, <code>agent_status</code>, and <code>agent_knowledge</code> in real time.</li>\n<li>📤 <strong>Multi-Tenant Ready</strong>: Supports per-user/organization data isolation via dynamic table names and webhooks.</li>\n<li>🔒 <strong>Secure</strong>: Role-based access control via Supabase Row Level Security (RLS).</li>\n</ul>\n<hr>\n<h2>Use Cases</h2>\n<ol>\n<li><strong>Customer Support Chatbots</strong>: Persist conversation history and resolve queries using institutional knowledge.</li>\n<li><strong>Automated Task Management</strong>: Track and update task statuses dynamically.</li>\n<li><strong>Knowledge Repositories</strong>: Store and retrieve domain-specific information for AI agents.</li>\n</ol>\n<hr>\n<h2>Instructions</h2>\n<h3>1. Import Template</h3>\n<ul>\n<li>Go to <strong>n8n &gt; Templates &gt; Import from File</strong> and upload this workflow.</li>\n</ul>\n<h3>2. Configure Credentials</h3>\n<ul>\n<li>Add your <strong>Supabase</strong> and <strong>OpenAI</strong> API keys under <strong>Settings &gt; Credentials</strong>.</li>\n</ul>\n<h3>3. Set Up Multi-Tenancy (Optional)</h3>\n<ul>\n<li><strong>Dynamic Webhook Path</strong>:<br>\nReplace the default webhook path with <code>/mcp/tool/supabase/:userId</code> to enable per-user routing.</li>\n<li><strong>Table Names</strong>:<br>\nUse a <strong>Set Node</strong> to dynamically generate table names (e.g., <code>agent_messages_{{userId}}</code>).</li>\n</ul>\n<h3>4. Activate &amp; Test</h3>\n<ul>\n<li>Enable the workflow and send test requests to the webhook URL.</li>\n</ul>\n<hr>\n<h2>Tags</h2>\n<p><code>AI Agent</code> <code>RAG</code> <code>Supabase</code> <code>CRUD</code> <code>Multi-Tenant</code> <code>OpenAI</code> <code>Automation</code></p>\n<hr>\n<h2>Screenshots</h2>\n<p><img src=\"https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/Captura_de_tela_2025_04_23_124013_16d75760fe.png\" alt=\"Captura de tela 20250423 124013.png\"><br>\n<img src=\"https://n8niostorageaccount.blob.core.windows.net/n8nio-strapi-blobs-prod/assets/Captura_de_tela_2025_04_23_123954_07df6d0444.png\" alt=\"Captura de tela 20250423 123954.png\"></p>\n<hr>\n<h2>License</h2>\n<p>This template is licensed under the MIT License.</p>\n</div><!--]-->",
  "readme_zh": "# 基于Supabase的RAG多租户AI智能体与CRUD功能\n\n**版本**：1.0.0  \n**n8n版本要求**：1.88.0+  \n**作者**：Koresolucoes  \n**许可证**：MIT\n\n* * *\n\n## 功能描述\n\n这是一个由**Supabase**和**检索增强生成(RAG)**技术驱动的有状态AI智能体工作流。支持持久化记忆、动态CRUD操作以及面向AI应用（如客户支持、任务编排和知识管理）的多租户数据隔离。\n\n**核心特性**：\n  * 🧠 **RAG集成**：结合OpenAI嵌入向量与Supabase向量搜索，实现上下文感知响应\n  * 🗃️ **完整CRUD**：实时管理`agent_messages`（消息）、`agent_tasks`（任务）、`agent_status`（状态）和`agent_knowledge`（知识库）\n  * 📤 **多租户支持**：通过动态表名和Webhook实现用户/组织级数据隔离\n  * 🔒 **安全保障**：基于Supabase行级安全策略(RLS)的权限控制\n\n* * *\n\n## 应用场景\n\n  1. **智能客服系统**：保留对话历史记录，利用机构知识库解答问题\n  2. **自动化任务管理**：动态追踪和更新任务状态\n  3. **知识库系统**：为AI智能体存储和检索领域专业知识\n\n* * *\n\n## 使用指南\n\n### 1\\. 导入模板\n\n  * 进入**n8n > 模板 > 从文件导入**，上传本工作流",
  "title_zh": "支持RAG与多租户CRUD的AI代理MCP Supabase服务器",
  "publish_date_absolute": "2025-05-03",
  "publish_date_zh": "上次更新于3天前",
  "workflow_json_zh": "{\"id\":\"oowUGM7ey6gWxzEG\",\"meta\":{\"instanceId\":\"6d46e25379ef430a7067964d1096b885c773564549240cb3ad4c087f6cf94bd3\",\"templateCredsSetupCompleted\":true},\"name\":\"MCP_SUPABASE_AGENT\",\"tags\":[],\"nodes\":[{\"id\":\"135ceeee-77cd-479f-a0b4-dd72abe23ac4\",\"name\":\"MCP_SUPABASE\",\"type\":\"@n8n/n8n-nodes-langchain.mcpTrigger\",\"position\":[-1460,1180],\"webhookId\":\"affff59c-9c5c-4a07-b531-616c1d631601\",\"parameters\":{\"path\":\"affff59c-9c5c-4a07-b531-616c1d631601\"},\"typeVersion\":1},{\"id\":\"b25040a8-2d70-4d3a-ba58-b8c7164d375e\",\"name\":\"RAG\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"position\":[1240,760],\"parameters\":{\"mode\":\"retrieve-as-tool\",\"topK\":5,\"options\":{},\"toolName\":\"ITERACOES\",\"tableName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"documents\",\"cachedResultName\":\"documents\"},\"toolDescription\":\"lembra das interacoes e consulta as instrucoes do system como assim tambem vai guardando o que aprende\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1.1},{\"id\":\"081035c0-ecc2-4924-8f07-da4cbb69fb06\",\"name\":\"Embeddings OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[1500,960],\"parameters\":{\"model\":\"text-embedding-ada-002\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"zUnIUrOWA279vAoC\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"361e0a74-b386-4e03-9e7b-5f435f0d8c5f\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,120],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## 代理消息\"},\"typeVersion\":1},{\"id\":\"5aafb3a6-edd1-4154-adab-948db9aad8e7\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,720],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## 代理任务\"},\"typeVersion\":1},{\"id\":\"61b75c2e-b472-4597-a12a-f6027caecf4e\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,1320],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## 代理状态\"},\"typeVersion\":1},{\"id\":\"7adc4cd9-cbac-4922-b928-f0b556d6f839\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,1900],\"parameters\":{\"width\":1380,\"height\":520,\"content\":\"## 代理知识\"},\"typeVersion\":1},{\"id\":\"7680abd0-d5f1-41db-96ad-d64c1b857032\",\"name\":\"DELETE_ROW_INSCRICOES_CURSOS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,2020],\"parameters\":{\"tableId\":\"agent_knowledge\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"5c752cf4-6dde-49d9-9328-2ed0731c6d7a\",\"name\":\"GET_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,260],\"parameters\":{\"tableId\":\"agent_messages\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"f65e9fd3-a656-473c-a7af-217d9b041aa7\",\"name\":\"CREATE_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,260],\"parameters\":{\"tableId\":\"agent_messages\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"61269957-e6ac-4e5b-adb0-fd610cdff8aa\",\"name\":\"DELETE_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,260],\"parameters\":{\"tableId\":\"agent_messages\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"52db9de5-5610-4b2d-9194-e1551b95a4e6\",\"name\":\"UPDATE_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,260],\"parameters\":{\"tableId\":\"agent_messages\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"b43aaea6-7841-4848-9228-2be6dd07a03f\",\"name\":\"GET_MANY_ROW_AGENT_MESSAGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,260],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_messages\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"c5347c5e-f9cb-40aa-bca5-249e8c220839\",\"name\":\"CREATE_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,840],\"parameters\":{\"tableId\":\"agent_tasks\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"85e3c8e1-6a75-40ce-a344-4a8fd3a1ae16\",\"name\":\"GET_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,840],\"parameters\":{\"tableId\":\"agent_tasks\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"7dacc138-a3aa-4483-a79c-5f2eee915c72\",\"name\":\"DELETE_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,840],\"parameters\":{\"tableId\":\"agent_tasks\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"cb942ab1-e7f2-4fd7-bc1e-fa9e559480a1\",\"name\":\"UPDATE_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,840],\"parameters\":{\"tableId\":\"agent_tasks\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"ed9cc573-764c-4cda-82f4-796851b16fba\",\"name\":\"GET_MANY_ROW_AGENT_TASKS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,840],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_tasks\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"d3412d90-6025-4db5-a845-8b1ea6070ea3\",\"name\":\"CREATE_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,1440],\"parameters\":{\"tableId\":\"agent_status\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"843a2b92-8fb4-4453-9517-b37e07148f52\",\"name\":\"GET_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,1440],\"parameters\":{\"tableId\":\"agent_status\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"9a075b33-23fa-487c-b139-41e7e4794831\",\"name\":\"DELETE_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[260,1440],\"parameters\":{\"tableId\":\"agent_status\",\"operation\":\"delete\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"a066b99d-15f4-4c3e-bab6-4423b749bb74\",\"name\":\"UPDATE_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,1440],\"parameters\":{\"tableId\":\"agent_status\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"be9930a8-4e01-4823-a0be-4adfd06dd29c\",\"name\":\"GET_MANY_ROW_AGENT_STATUS\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,1440],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_status\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"01fbbe34-81e7-4017-a10e-ef7137024d6a\",\"name\":\"CREATE_ROW_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[-100,2020],\"parameters\":{\"tableId\":\"agent_knowledge\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"5ba9e5eb-76bb-499c-b93b-5cca7286259b\",\"name\":\"GET_ROW_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[80,2020],\"parameters\":{\"tableId\":\"agent_knowledge\",\"operation\":\"get\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"a25cef14-0cf0-4ded-81f0-cde300f74432\",\"name\":\"UPDATE_ROW_INSCRICOES_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[440,2020],\"parameters\":{\"tableId\":\"agent_knowledge\",\"operation\":\"update\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1},{\"id\":\"1c1fae2e-97f9-449f-913a-8ac730c1f145\",\"name\":\"GET_MANY_ROW_AGENT_KNOWLEDGE\",\"type\":\"n8n-nodes-base.supabaseTool\",\"position\":[620,2020],\"parameters\":{\"limit\":\"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}\",\"tableId\":\"agent_knowledge\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"yfa6fXRKgmrEx175\",\"name\":\"Supabase account\"}},\"typeVersion\":1}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"d32edd9b-7508-45a9-adcc-049543647145\",\"connections\":{\"RAG\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"RAG\",\"type\":\"ai_embedding\",\"index\":0}]]},\"GET_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_ROW_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_TASKS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_STATUS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"CREATE_ROW_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_MESSAGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"DELETE_ROW_INSCRICOES_CURSOS\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"GET_MANY_ROW_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]},\"UPDATE_ROW_INSCRICOES_AGENT_KNOWLEDGE\":{\"ai_tool\":[[{\"node\":\"MCP_SUPABASE\",\"type\":\"ai_tool\",\"index\":0}]]}}}"
}
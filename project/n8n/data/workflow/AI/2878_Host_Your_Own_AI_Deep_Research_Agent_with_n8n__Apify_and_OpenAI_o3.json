{
  "title": "Host Your Own AI Deep Research Agent with n8n, Apify and OpenAI o3",
  "url": "https://n8n.io/workflows/2878-host-your-own-ai-deep-research-agent-with-n8n-apify-and-openai-o3/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "Jimleuk",
  "publish_date": "Last update a month ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"a342005e-a88e-419b-b929-56ecbba4a936\",\"name\":\"Structured Output Parser\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[1300,1180],\"parameters\":{\"schemaType\":\"manual\",\"inputSchema\":\"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"learnings\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"description\\\": \\\"List of learnings, max of 3.\\\",\\n      \\\"items\\\": { \\\"type\\\": \\\"string\\\" }\\n    },\\n    \\\"followUpQuestions\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"string\\\",\\n        \\\"description\\\": \\\"List of follow-up questions to research the topic further, max of 3.\\\"\\n      }\\n    }\\n  }\\n}\"},\"typeVersion\":1.2},{\"id\":\"126b8151-6d20-43b8-8028-8163112c4c5b\",\"name\":\"Set Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[-1360,-460],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"df28b12e-7c20-4ff5-b5b8-dc773aa14d4b\",\"name\":\"request_id\",\"type\":\"string\",\"value\":\"={{ $execution.id }}\"},{\"id\":\"9362c1e7-717d-444a-8ea2-6b5f958c9f3f\",\"name\":\"prompt\",\"type\":\"string\",\"value\":\"={{ $json['What would you like to research?'] }}\"},{\"id\":\"09094be4-7844-4a9e-af82-cc8e39322398\",\"name\":\"depth\",\"type\":\"number\",\"value\":\"={{\\n!isNaN($json['input-depth'][0].toNumber())\\n  ? $json['input-depth'][0].toNumber()\\n  : 1\\n}}\"},{\"id\":\"3fc30a30-7806-4013-835d-97e27ddd7ae1\",\"name\":\"breadth\",\"type\":\"number\",\"value\":\"={{\\n!isNaN($json['input-breadth'][0].toNumber())\\n  ? $json['input-breadth'][0].toNumber()\\n  : 1\\n}}\"}]}},\"typeVersion\":3.4},{\"id\":\"1d0fb87b-263d-46c2-b016-a29ba1d407ab\",\"name\":\"OpenAI Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1120,1180],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"o3-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"39b300d9-11ba-44f6-8f43-2fe256fe4856\",\"name\":\"OpenAI Chat Model1\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[-860,1760],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"o3-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"018da029-a796-45c5-947c-791e087fe934\",\"name\":\"OpenAI Chat Model2\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[-1060,-300],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"o3-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"525da936-a9eb-4523-b27a-ff6ae7b0e5ef\",\"name\":\"Structured Output Parser1\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[-840,-300],\"parameters\":{\"schemaType\":\"manual\",\"inputSchema\":\"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"questions\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"description\\\": \\\"Follow up questions to clarify the research direction, max of 3.\\\",\\n      \\\"items\\\": {\\n          \\\"type\\\": \\\"string\\\"\\n      }\\n    }\\n  }\\n}\"},\"typeVersion\":1.2},{\"id\":\"e6664883-cff4-4e09-881e-6b6f684f9cac\",\"name\":\"On form submission\",\"type\":\"n8n-nodes-base.formTrigger\",\"position\":[-1760,-460],\"webhookId\":\"026629c8-7644-493c-b830-d9c72eea307d\",\"parameters\":{\"options\":{\"path\":\"deep_research\",\"ignoreBots\":true,\"buttonLabel\":\"Next\"},\"formTitle\":\" DeepResearcher\",\"formFields\":{\"values\":[{\"fieldType\":\"html\"}]},\"formDescription\":\"=DeepResearcher is a multi-step, recursive approach using the internet to solve complex research tasks, accomplishing in tens of minutes what a human would take many hours.\\n\\nTo use, provide a short summary of what the research and how \\\"deep\\\" you'd like the workflow to investigate. Note, the higher the numbers the more time and cost will occur for the research.\\n\\nThe workflow is designed to complete independently and when finished, a report will be saved in a designated Notion Database.\"},\"typeVersion\":2.2},{\"id\":\"6b8ebc08-c0b1-4af8-99cc-79d09eea7316\",\"name\":\"Generate SERP Queries\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[-1040,820],\"parameters\":{\"text\":\"=Given the following prompt from the user, generate a list of SERP queries to research the topic.\\nReduce the number of words in each query to its keywords only.\\nReturn a maximum of {{ $('JobType Router').first().json.data.breadth }} queries, but feel free to return less if the original prompt is clear. Make sure each query is unique and not similar to each other: <prompt>{{ $('JobType Router').first().json.data.query.trim() }}</prompt>\\n\\n{{\\n$('JobType Router').first().json.data.learnings.length\\n  ? `Here are some learnings from previous research, use them to generate more specific queries:\\\\n${$('JobType Router').first().json.data.learnings.map(text => `* ${text}`).join('\\\\n')}`\\n  : ''\\n}}\",\"messages\":{\"messageValues\":[{\"type\":\"HumanMessagePromptTemplate\",\"message\":\"=You are an expert researcher. Today is {{ $now.toLocaleString() }}. Follow these instructions when responding:\\n  - You may be asked to research subjects that is after your knowledge cutoff, assume the user is right when presented with news.\\n  - The user is a highly experienced analyst, no need to simplify it, be as detailed as possible and make sure your response is correct.\\n  - Be highly organized.\\n  - Suggest solutions that I didn't think about.\\n  - Be proactive and anticipate my needs.\\n  - Treat me as an expert in all subject matter.\\n  - Mistakes erode my trust, so be accurate and thorough.\\n  - Provide detailed explanations, I'm comfortable with lots of detail.\\n  - Value good arguments over authorities, the source is irrelevant.\\n  - Consider new technologies and contrarian ideas, not just the conventional wisdom.\\n  - You may use high levels of speculation or prediction, just flag it for me.\"}]},\"promptType\":\"define\",\"hasOutputParser\":true},\"typeVersion\":1.5},{\"id\":\"34e1fa5d-bc0c-4b9e-84a7-35db2b08c772\",\"name\":\"Structured Output Parser2\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[-860,980],\"parameters\":{\"schemaType\":\"manual\",\"inputSchema\":\"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"queries\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"object\\\",\\n        \\\"properties\\\": {\\n          \\\"query\\\": {\\n            \\\"type\\\": \\\"string\\\",\\n            \\\"description\\\": \\\"The SERP query\\\"\\n          },\\n          \\\"researchGoal\\\": {\\n            \\\"type\\\": \\\"string\\\",\\n            \\\"description\\\": \\\"First talk about the goal of the research that this query is meant to accomplish, then go deeper into how to advance the research once the results are found, mention additional research directions. Be as specific as possible, especially for additional research directions.\\\"\\n          }\\n        }\\n      }\\n    }\\n  }\\n}\"},\"typeVersion\":1.2},{\"id\":\"be6dd6a2-aacf-4682-8f13-8ae24c4249a3\",\"name\":\"OpenAI Chat Model3\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[-1040,980],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"o3-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"d5ce6e21-cd07-44fa-b6d0-90bf7531ee01\",\"name\":\"Set Initial Query\",\"type\":\"n8n-nodes-base.set\",\"position\":[-580,180],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"acb41e93-70c6-41a3-be0f-e5a74ec3ec88\",\"name\":\"query\",\"type\":\"string\",\"value\":\"={{ $('JobType Router').first().json.data.query }}\"},{\"id\":\"7fc54063-b610-42bc-a250-b1e8847c4d1e\",\"name\":\"learnings\",\"type\":\"array\",\"value\":\"={{ $('JobType Router').first().json.data.learnings }}\"},{\"id\":\"e8f1c158-56fb-41c8-8d86-96add16289bb\",\"name\":\"breadth\",\"type\":\"number\",\"value\":\"={{ $('JobType Router').first().json.data.breadth }}\"}]}},\"typeVersion\":3.4},{\"id\":\"9de6e4a1-a2b5-4a6f-948e-a0585edcae48\",\"name\":\"SERP to Items\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[-700,820],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"output.queries\"},\"typeVersion\":1},{\"id\":\"2c9c4cdf-942b-494c-83fb-ed5ec37385ee\",\"name\":\"Item Ref\",\"type\":\"n8n-nodes-base.noOp\",\"position\":[-220,1020],\"parameters\":{},\"typeVersion\":1},{\"id\":\"703c57af-de19-4f00-b580-711a272fa5ca\",\"name\":\"Research Goal + Learnings\",\"type\":\"n8n-nodes-base.set\",\"position\":[1460,1160],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"9acec2cc-64c8-4e62-bed4-c3d9ffab1379\",\"name\":\"researchGoal\",\"type\":\"string\",\"value\":\"={{ $('Item Ref').first().json.researchGoal }}\"},{\"id\":\"1b2d2dad-429b-4fc9-96c5-498f572a85c3\",\"name\":\"learnings\",\"type\":\"array\",\"value\":\"={{ $json.output.learnings }}\"},{\"id\":\"7025f533-02ab-4031-9413-43390fb61f05\",\"name\":\"followUpQuestions\",\"type\":\"string\",\"value\":\"={{ $json.output.followUpQuestions }}\"},{\"id\":\"c9e34ea4-5606-46d6-8d66-cb42d772a8b4\",\"name\":\"urls\",\"type\":\"array\",\"value\":\"={{\\n$('Get Markdown + URL')\\n  .all()\\n  .map(item => item.json.url)\\n}}\"}]}},\"typeVersion\":3.4},{\"id\":\"16ed2835-3af4-45e3-b5a7-e4342d571aa0\",\"name\":\"Accumulate Results\",\"type\":\"n8n-nodes-base.set\",\"position\":[-200,180],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"db509e90-9a86-431f-8149-4094d22666cc\",\"name\":\"should_stop\",\"type\":\"boolean\",\"value\":\"={{\\n$runIndex >= ($('JobType Router').first().json.data.depth)\\n}}\"},{\"id\":\"90986e2b-8aca-4a22-a9db-ed8809d6284d\",\"name\":\"all_learnings\",\"type\":\"array\",\"value\":\"={{\\nArray($runIndex+1)\\n  .fill(0)\\n  .flatMap((_,idx) => {\\n    try {\\n      return $('Generate Learnings')\\n        .all(0,idx)\\n        .flatMap(item => item.json.data.flatMap(d => d.learnings))\\n    } catch (e) {\\n      return []\\n    }\\n  })\\n}}\"},{\"id\":\"3eade958-e8ab-4975-aac4-f4a4a983c163\",\"name\":\"all_urls\",\"type\":\"array\",\"value\":\"={{\\nArray($runIndex+1)\\n  .fill(0)\\n  .flatMap((_,idx) => {\\n    try {\\n      return $('Generate Learnings')\\n        .all(0,idx)\\n        .flatMap(item => item.json.data.flatMap(d => d.urls))\\n    } catch (e) {\\n      return []\\n    }\\n  })\\n}}\"}]}},\"executeOnce\":true,\"typeVersion\":3.4},{\"id\":\"0011773e-85c6-4fe1-8554-c23ce50706d0\",\"name\":\"DeepResearch Results\",\"type\":\"n8n-nodes-base.set\",\"position\":[160,360],\"parameters\":{\"mode\":\"raw\",\"options\":{},\"jsonOutput\":\"={{ $('Generate Learnings').item.json }}\"},\"typeVersion\":3.4},{\"id\":\"c0b646d0-1246-4864-8f79-8b7a66e4e083\",\"name\":\"Results to Items\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[320,360],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"data\"},\"typeVersion\":1},{\"id\":\"3c52ec3e-c952-4b5f-ab12-f1b5d02aba74\",\"name\":\"Set Next Queries\",\"type\":\"n8n-nodes-base.set\",\"position\":[480,360],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"d88bfe95-9e73-4d25-b45c-9f164b940b0e\",\"name\":\"query\",\"type\":\"string\",\"value\":\"=Previous research goal: {{ $json.researchGoal }}\\nFollow-up research directions: {{ $json.followUpQuestions.map(q => `\\\\n${q}`).join('') }}\"},{\"id\":\"4aa20690-d998-458a-b1e4-0d72e6a68e6b\",\"name\":\"learnings\",\"type\":\"array\",\"value\":\"={{ $('Accumulate Results').item.json.all_learnings }}\"},{\"id\":\"89acafae-b04a-4d5d-b08b-656e715654e4\",\"name\":\"breadth\",\"type\":\"number\",\"value\":\"={{ $('JobType Router').first().json.data.breadth }}\"}]}},\"typeVersion\":3.4},{\"id\":\"bc59dddc-2b03-481f-91c6-ea8aa378eef0\",\"name\":\"For Each Query...\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[-420,860],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"903c31c4-5fdc-4cb6-8baa-402555997266\",\"name\":\"Feedback to Items\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[-720,-460],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"output.questions\"},\"typeVersion\":1},{\"id\":\"59ff671d-5d4f-42ff-b94f-ed30a8531e55\",\"name\":\"Ask Clarity Questions\",\"type\":\"n8n-nodes-base.form\",\"position\":[-360,-380],\"webhookId\":\"d3375ba6-0008-4fcb-96bc-110374de2603\",\"parameters\":{\"options\":{\"formTitle\":\"DeepResearcher\",\"buttonLabel\":\"Answer\",\"formDescription\":\"=<img\\n  src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw\\\"\\n  width=\\\"100%\\\"\\n  style=\\\"border:1px solid #ccc\\\"\\n/>\\n<p style=\\\"text-align:left\\\">\\nAnswer the following clarification questions to assist the DeepResearcher better under the research topic.\\n</p>\\n<hr style=\\\"display:block;margin-top:16px;margin-bottom:0\\\" />\\n<p style=\\\"text-align:left;font-family:sans-serif;font-weight:700;\\\">\\nTotal {{ $('Feedback to Items').all().length }} questions.\\n</p>\"},\"formFields\":{\"values\":[{\"fieldType\":\"textarea\",\"fieldLabel\":\"={{ $json[\\\"output.questions\\\"] }}\",\"placeholder\":\"=\",\"requiredField\":true}]}},\"typeVersion\":1},{\"id\":\"1c2cf79b-f1a1-4ecc-bb45-3d4460c947bd\",\"name\":\"For Each Question...\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[-540,-460],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"0c9ffa99-2687-4df5-8581-0c5b0b2657a9\",\"name\":\"DeepResearch Subworkflow\",\"type\":\"n8n-nodes-base.executeWorkflowTrigger\",\"position\":[-1880,820],\"parameters\":{\"workflowInputs\":{\"values\":[{\"name\":\"requestId\",\"type\":\"any\"},{\"name\":\"jobType\"},{\"name\":\"data\",\"type\":\"object\"}]}},\"typeVersion\":1.1},{\"id\":\"127ab95d-bf89-4762-bfb5-34521e620ae2\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1140,-680],\"parameters\":{\"color\":7,\"width\":1000,\"height\":560,\"content\":\"## 2. Ask Clarifying Questions\\n[Read more about form nodes](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.form/)\\n\\nTo handle the clarification questions generated by the LLM, I used the same technique found in my \\\"AI Interviewer\\\" template ([link](https://n8n.io/workflows/2566-conversational-interviews-with-ai-agents-and-n8n-forms/)).\\nThis involves a looping of dynamically generated forms to collect answers from the user.\"},\"typeVersion\":1},{\"id\":\"e87c0f19-6002-4aa2-931a-ca7546146a84\",\"name\":\"Clarifying Questions\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[-1040,-460],\"parameters\":{\"text\":\"=Given the following query from the user, ask some follow up questions to clarify the research direction. Return a maximum of 3 questions, but feel free to return less if the original query is clear: <query>{{ $json.prompt }}</query>`\",\"messages\":{\"messageValues\":[{\"type\":\"HumanMessagePromptTemplate\",\"message\":\"=You are an expert researcher. Today is {{ $now.toLocaleString() }}. Follow these instructions when responding:\\n  - You may be asked to research subjects that is after your knowledge cutoff, assume the user is right when presented with news.\\n  - The user is a highly experienced analyst, no need to simplify it, be as detailed as possible and make sure your response is correct.\\n  - Be highly organized.\\n  - Suggest solutions that I didn't think about.\\n  - Be proactive and anticipate my needs.\\n  - Treat me as an expert in all subject matter.\\n  - Mistakes erode my trust, so be accurate and thorough.\\n  - Provide detailed explanations, I'm comfortable with lots of detail.\\n  - Value good arguments over authorities, the source is irrelevant.\\n  - Consider new technologies and contrarian ideas, not just the conventional wisdom.\\n  - You may use high levels of speculation or prediction, just flag it for me.\"}]},\"promptType\":\"define\",\"hasOutputParser\":true},\"typeVersion\":1.5},{\"id\":\"b84f9c4a-c1de-4288-bab2-b7f5ffb8b542\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-660,-60],\"parameters\":{\"color\":7,\"width\":1360,\"height\":640,\"content\":\"## 6. Perform DeepSearch Loop\\n[Learn more about the Looping in n8n](https://docs.n8n.io/flow-logic/looping/#creating-loops)\\n\\nThe key of the Deep Research flow is its extensive data collection capability. In this implementation, this capability is represented by a recursive web search & scrape loop which starts with the original query and extended by AI-generated subqueries. How many subqueries to generate are determined the depth and breadth parameters specified.\\n\\n\\\"Learnings\\\" are generated for each subquery and accumulate on each iteration of the loop. When the loop finishes when depth limit is reached, all learnings are collected and it's these learnings are what we use to generate the report.\"},\"typeVersion\":1},{\"id\":\"0a8c3a01-d4d4-4075-9521-035b7df9aa5a\",\"name\":\"End Form\",\"type\":\"n8n-nodes-base.form\",\"position\":[960,-420],\"webhookId\":\"88f2534b-2b82-4b40-a4bc-97d96384e8fd\",\"parameters\":{\"options\":{},\"operation\":\"completion\",\"completionTitle\":\"=Thank you for using DeepResearcher.\",\"completionMessage\":\"=You may now close this window.\"},\"typeVersion\":1},{\"id\":\"44a3603f-a5a1-4031-8c5f-c748b1007b47\",\"name\":\"Initiate DeepResearch\",\"type\":\"n8n-nodes-base.executeWorkflow\",\"position\":[600,-420],\"parameters\":{\"mode\":\"each\",\"options\":{\"waitForSubWorkflow\":false},\"workflowId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $workflow.id }}\"},\"workflowInputs\":{\"value\":{\"data\":\"={{\\n{\\n  \\\"query\\\": $('Get Initial Query').first().json.query,\\n  \\\"learnings\\\": [],\\n  \\\"depth\\\": $('Set Variables').first().json.depth,\\n  \\\"breadth\\\": $('Set Variables').first().json.breadth,\\n}\\n}}\",\"jobType\":\"deepresearch_initiate\",\"requestId\":\"={{ $('Set Variables').first().json.request_id }}\"},\"schema\":[{\"id\":\"requestId\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"requestId\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"jobType\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"jobType\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"data\",\"type\":\"object\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"data\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[],\"attemptToConvertTypes\":false,\"convertFieldsToString\":true}},\"typeVersion\":1.2},{\"id\":\"b243eb76-9ed9-4327-968f-c21844bc9df4\",\"name\":\"Execution Data\",\"type\":\"n8n-nodes-base.executionData\",\"position\":[-1700,820],\"parameters\":{\"dataToSave\":{\"values\":[{\"key\":\"requestId\",\"value\":\"={{ $json.requestId }}\"},{\"key\":\"=jobType\",\"value\":\"={{ $json.jobType }}\"}]}},\"typeVersion\":1},{\"id\":\"57ca4b22-9349-4b34-8f6b-c502905b5172\",\"name\":\"JobType Router\",\"type\":\"n8n-nodes-base.switch\",\"position\":[-1520,820],\"parameters\":{\"rules\":{\"values\":[{\"outputKey\":\"initiate\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"operator\":{\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.jobType }}\",\"rightValue\":\"deepresearch_initiate\"}]},\"renameOutput\":true},{\"outputKey\":\"learnings\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"ecbfa54d-fc97-48c5-8d3d-f0538b8d727b\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.jobType }}\",\"rightValue\":\"deepresearch_learnings\"}]},\"renameOutput\":true},{\"outputKey\":\"report\",\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"392f9a98-ec22-4e57-9c8e-0e1ed6b7dafa\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.jobType }}\",\"rightValue\":\"deepresearch_report\"}]},\"renameOutput\":true}]},\"options\":{}},\"typeVersion\":3.2},{\"id\":\"1f880fbd-71ba-4e5b-8d99-9654ae0c949f\",\"name\":\"OpenAI Chat Model4\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[-20,-280],\"parameters\":{\"model\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"o3-mini\"},\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"8gccIjcuf3gvaoEr\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.2},{\"id\":\"ea65589b-106f-4ff1-a6f2-763393c2cb07\",\"name\":\"Get Initial Query\",\"type\":\"n8n-nodes-base.set\",\"position\":[-360,-540],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"14b77741-c3c3-4bd2-be6e-37bd09fcea2b\",\"name\":\"query\",\"type\":\"string\",\"value\":\"=Initial query: {{ $('Set Variables').first().json.prompt }}\\nFollow-up Questions and Answers:\\n{{\\n$input.all()\\n  .map(item => {\\n    const q = Object.keys(item.json)[0];\\n    const a = item.json[q];\\n    return `question: ${q}\\\\nanswer: ${a}`;\\n  })\\n  .join('\\\\n')\\n}}\"}]}},\"executeOnce\":true,\"typeVersion\":3.4},{\"id\":\"09a363f2-6300-430d-8c7e-3e1611ab8e68\",\"name\":\"Structured Output Parser4\",\"type\":\"@n8n/n8n-nodes-langchain.outputParserStructured\",\"position\":[160,-280],\"parameters\":{\"schemaType\":\"manual\",\"inputSchema\":\"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"title\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\":\\\" A short title summarising the research topic\\\"\\n    },\\n    \\\"description\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"A short description to summarise the research topic\\\"\\n    }\\n  }\\n}\"},\"typeVersion\":1.2},{\"id\":\"9910804e-8376-4e2e-a011-7d32ca951edf\",\"name\":\"Create Row\",\"type\":\"n8n-nodes-base.notion\",\"position\":[300,-420],\"parameters\":{\"title\":\"={{ $json.output.title }}\",\"options\":{},\"resource\":\"databasePage\",\"databaseId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"19486dd6-0c0c-80da-9cb7-eb1468ea9afd\",\"cachedResultUrl\":\"https://www.notion.so/19486dd60c0c80da9cb7eb1468ea9afd\",\"cachedResultName\":\"n8n DeepResearch\"},\"propertiesUi\":{\"propertyValues\":[{\"key\":\"Description|rich_text\",\"textContent\":\"={{ $json.output.description }}\"},{\"key\":\"Status|status\",\"statusValue\":\"Not started\"},{\"key\":\"Request ID|rich_text\",\"textContent\":\"={{ $('Set Variables').first().json.request_id }}\"},{\"key\":\"Name|title\",\"title\":\"={{ $json.output.title }}\"}]}},\"credentials\":{\"notionApi\":{\"id\":\"iHBHe7ypzz4mZExM\",\"name\":\"Notion account\"}},\"typeVersion\":2.2},{\"id\":\"9f06d9ae-220d-4f5b-bcbf-761b88ba255c\",\"name\":\"Report Page Generator\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[-20,-420],\"parameters\":{\"text\":\"=Create a suitable title for the research report which will be created from the user's query.\\n<query>{{ $json.query }}</query>\",\"promptType\":\"define\",\"hasOutputParser\":true},\"typeVersion\":1.5},{\"id\":\"5b434bdc-e1e7-4348-b03d-dcbb6a485263\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-120,-680],\"parameters\":{\"color\":7,\"width\":600,\"height\":560,\"content\":\"## 3. Create Empty Report Page in Notion\\n[Read more about the Notion node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.notion/)\\n\\nSome thought was given where to upload the final report and Notion was selected due to familiarity. This can be easily changed to whatever wiki tools you prefer.\\n\\nIf you're following along however, here's the Notion database you need to replicate - [Jim's n8n DeepResearcher Database](https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf).\"},\"typeVersion\":1},{\"id\":\"0cfb3548-14a8-4dcc-8362-a7ca1d4c328f\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[500,-680],\"parameters\":{\"color\":7,\"width\":640,\"height\":560,\"content\":\"## 4. Trigger DeepResearch Asynchronously\\n[Learn more about the Execute Trigger node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow/)\\n\\nn8n handles asynchronous jobs by spinning them off as separate executions. This basically means the user doesn't have to wait or keep their browser window open for our researcher to do its job.\\n\\nOnce we initiate the Deepresearcher job, we can close out the onboarding journey for a nice user experience.\"},\"typeVersion\":1},{\"id\":\"b90456d0-fae3-4809-bc13-55649e6e919a\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1160,620],\"parameters\":{\"color\":7,\"width\":620,\"height\":540,\"content\":\"## 7. Generate Search Queries\\n[Learn more about the Basic LLM node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm/)\\n\\nMuch like a human researcher, the DeepResearcher will rely on web search and content as the preferred source of information. To ensure it can cover a wide range of sources, the AI can first generate relevant research queries of which each can be explored separately.\"},\"typeVersion\":1},{\"id\":\"9fd00d55-1c76-425b-8386-7bc5b2bb47ac\",\"name\":\"Is Depth Reached?\",\"type\":\"n8n-nodes-base.if\",\"position\":[-40,180],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"75d18d88-6ba6-43df-bef7-3e8ad99ad8bd\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ $json.should_stop }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"f658537b-4f4c-4427-a66f-56cfd950bffc\",\"name\":\"Get Research Results\",\"type\":\"n8n-nodes-base.set\",\"position\":[160,180],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"90b3da00-dcd5-4289-bd45-953146a3b0ba\",\"name\":\"all_learnings\",\"type\":\"array\",\"value\":\"={{ $json.all_learnings }}\"},{\"id\":\"623dbb3d-83a1-44a9-8ad3-48d92bc42811\",\"name\":\"all_urls\",\"type\":\"array\",\"value\":\"={{ $json.all_urls }}\"}]}},\"typeVersion\":3.4},{\"id\":\"6059f3ba-e4a0-4528-894c-6080eedb91c3\",\"name\":\"Get Existing Row\",\"type\":\"n8n-nodes-base.notion\",\"position\":[-1040,180],\"parameters\":{\"limit\":1,\"filters\":{\"conditions\":[{\"key\":\"Request ID|rich_text\",\"condition\":\"equals\",\"richTextValue\":\"={{ $json.requestId.toString() }}\"}]},\"options\":{},\"resource\":\"databasePage\",\"matchType\":\"allFilters\",\"operation\":\"getAll\",\"databaseId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"19486dd6-0c0c-80da-9cb7-eb1468ea9afd\",\"cachedResultUrl\":\"https://www.notion.so/19486dd60c0c80da9cb7eb1468ea9afd\",\"cachedResultName\":\"n8n DeepResearch\"},\"filterType\":\"manual\"},\"credentials\":{\"notionApi\":{\"id\":\"iHBHe7ypzz4mZExM\",\"name\":\"Notion account\"}},\"typeVersion\":2.2},{\"id\":\"100625bb-bf9a-4993-b387-1c61e486ba6d\",\"name\":\"Set In-Progress\",\"type\":\"n8n-nodes-base.notion\",\"position\":[-840,180],\"parameters\":{\"pageId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $json.id }}\"},\"options\":{},\"resource\":\"databasePage\",\"operation\":\"update\",\"propertiesUi\":{\"propertyValues\":[{\"key\":\"Status|status\",\"statusValue\":\"In progress\"}]}},\"credentials\":{\"notionApi\":{\"id\":\"iHBHe7ypzz4mZExM\",\"name\":\"Notion account\"}},\"typeVersion\":2.2},{\"id\":\"864332ea-dd25-4347-a49d-68ed6495c1a9\",\"name\":\"Set Done\",\"type\":\"n8n-nodes-base.notion\",\"position\":[1680,1600],\"parameters\":{\"pageId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $('Get Existing Row1').first().json.id }}\"},\"options\":{},\"resource\":\"databasePage\",\"operation\":\"update\",\"propertiesUi\":{\"propertyValues\":[{\"key\":\"Status|status\",\"statusValue\":\"Done\"},{\"key\":\"Last Updated|date\",\"date\":\"={{ $now.toISO() }}\"}]}},\"credentials\":{\"notionApi\":{\"id\":\"iHBHe7ypzz4mZExM\",\"name\":\"Notion account\"}},\"executeOnce\":true,\"typeVersion\":2.2},{\"id\":\"6771568a-e6bd-4c89-a535-089fd1c18fc3\",\"name\":\"Tags to Items\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[-60,1600],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"tag\"},\"typeVersion\":1},{\"id\":\"47fce580-7b5b-4bc6-ba52-a8e7af6595b5\",\"name\":\"Convert to HTML\",\"type\":\"n8n-nodes-base.markdown\",\"position\":[-380,1600],\"parameters\":{\"mode\":\"markdownToHtml\",\"options\":{\"tables\":true},\"markdown\":\"={{ $json.text }}\"},\"typeVersion\":1},{\"id\":\"e2fb5a31-9ca5-487b-a7f8-f020759ec53a\",\"name\":\"HTML to Array\",\"type\":\"n8n-nodes-base.set\",\"position\":[-220,1600],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"851b8a3f-c2d3-41ad-bf60-4e0e667f6c58\",\"name\":\"tag\",\"type\":\"array\",\"value\":\"={{ $json.data.match(/<table[\\\\s\\\\S]*?<\\\\/table>|<ul[\\\\s\\\\S]*?<\\\\/ul>|<[^>]+>[^<]*<\\\\/[^>]+>/g) }}\"}]}},\"typeVersion\":3.4},{\"id\":\"5275f9dd-5420-4c59-a330-5f2775b47e51\",\"name\":\"Notion Block Generator\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[100,1600],\"parameters\":{\"text\":\"={{ $json.tag.trim() }}\",\"messages\":{\"messageValues\":[{\"message\":\"=Convert the following html into its equivalent Notion Block as per Notion's API schema.\\n* Ensure the content is always included and remains the same.\\n* Return only a json response.\\n* Generate child-level blocks. Should not define \\\"parent\\\" or \\\"children\\\" property.\\n* Strongly prefer headings, paragraphs, tables and lists type blocks.\\n* available headings are heading_1, heading_2 and heading_3 - h4,h5,h6 should use heading_3 type instead. ensure headings use the rich text definition.\\n* ensure lists blocks include all list items.\\n\\n## Examples\\n\\n1. headings\\n```\\n<h3 id=\\\"references\\\">References</h3>\\n```\\nwould convert to \\n```\\n{\\\"object\\\":  \\\"block\\\", \\\"type\\\": \\\"heading_3\\\", \\\"heading_3\\\": { \\\"rich_text\\\": [{\\\"type\\\": \\\"text\\\",\\\"text\\\": {\\\"content\\\": \\\"References\\\"}}]}}\\n```\\n\\n2. lists\\n```\\n<ul><li>hello</li><li>world</li></ul>\\n```\\nwould convert to\\n```\\n[\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"bulleted_list_item\\\",\\n  \\\"bulleted_list_item\\\": {\\\"rich_text\\\": [{\\\"type\\\": \\\"text\\\",\\\"text\\\": {\\\"content\\\": \\\"hello\\\"}}]}\\n},\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"bulleted_list_item\\\",\\n  \\\"bulleted_list_item\\\": {\\\"rich_text\\\": [{\\\"type\\\": \\\"text\\\",\\\"text\\\": {\\\"content\\\": \\\"world\\\"}}]}\\n}\\n]\\n```\\n\\n3. tables\\n```\\n<table>\\n  <thead>\\n    <tr><th>Technology</th><th>Potential Impact</th></tr>\\n  </thead>\\n  <tbody>\\n    <tr>\\n      <td>5G Connectivity</td><td>Enables faster data speeds and advanced apps</td>\\n    </tr>\\n  </tbody>\\n</table>\\n```\\nwould convert to\\n```\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"table\\\",\\n  \\\"table\\\": {\\n    \\\"table_width\\\": 2,\\n    \\\"has_column_header\\\": true,\\n    \\\"has_row_header\\\": false,\\n    \\\"children\\\": [\\n      {\\n        \\\"object\\\": \\\"block\\\",\\n        \\\"type\\\": \\\"table_row\\\",\\n        \\\"table_row\\\": {\\n          \\\"cells\\\": [\\n            [\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"Technology\\\",\\n                  \\\"link\\\": null\\n                }\\n              },\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"Potential Impact\\\",\\n                  \\\"link\\\": null\\n                }\\n              }\\n            ],\\n            [\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"5G Connectivity\\\",\\n                  \\\"link\\\": null\\n                }\\n              },\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"Enables faster data speeds and advanced apps\\\",\\n                  \\\"link\\\": null\\n                }\\n              }\\n            ]\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n```\\n4. anchor links\\nSince Notion doesn't support anchor links, just convert them to rich text blocks instead.\\n```\\n<a href=\\\"#module-0-pre-course-setup-and-learning-principles\\\">Module 0: Pre-Course Setup and Learning Principles</a>\\n```\\nconverts to\\n```\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"paragraph\\\",\\n  \\\"paragraph\\\": {\\n    \\\"rich_text\\\": [\\n      {\\n        \\\"type\\\": \\\"text\\\",\\n        \\\"text\\\": {\\n          \\\"content\\\": \\\"Module 0: Pre-Course Setup and Learning Principles\\\"\\n        }\\n      }\\n    ]\\n  }\\n}\\n```\\n5. Invalid html parts\\nWhen the html is not syntax valid eg. orphaned closing tags, then just skip the conversion and use an empty rich text block.\\n```\\n</li>\\\\n</ol>\\n```\\ncan be substituted with\\n```\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"paragraph\\\",\\n  \\\"paragraph\\\": {\\n    \\\"rich_text\\\": [\\n      {\\n        \\\"type\\\": \\\"text\\\",\\n        \\\"text\\\": {\\n          \\\"content\\\": \\\" \\\"\\n        }\\n      }\\n    ]\\n  }\\n}\\n```\"}]},\"promptType\":\"define\"},\"typeVersion\":1.5},{\"id\":\"30e73ecf-5994-4229-b7f6-01e043e0e65b\",\"name\":\"Google Gemini Chat Model\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\"position\":[80,1760],\"parameters\":{\"options\":{},\"modelName\":\"models/gemini-2.0-flash\"},\"credentials\":{\"googlePalmApi\":{\"id\":\"dSxo6ns5wn658r8N\",\"name\":\"Google Gemini(PaLM) Api account\"}},\"typeVersion\":1},{\"id\":\"85ce9f7e-0369-41bd-8c31-c4217f400472\",\"name\":\"Parse JSON blocks\",\"type\":\"n8n-nodes-base.set\",\"onError\":\"continueRegularOutput\",\"position\":[420,1600],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"73fcb8a0-2672-4bd5-86de-8075e1e02baf\",\"name\":\"=block\",\"type\":\"array\",\"value\":\"={{\\n(function(){\\n  const block = $json.text\\n    .replace('```json', '')\\n    .replace('```', '')\\n    .trim()\\n    .parseJson();\\n  if (Array.isArray(block)) return block;\\n  if (block.type.startsWith('heading_')) {\\n    const prev = Number(block.type.split('_')[1]);\\n    const next = Math.max(1, prev - 1);\\n    if (next !== prev) {\\n      block.type = `heading_${next}`;\\n      block[`heading_${next}`] = Object.assign({}, block[`heading_${prev}`]);\\n      block[`heading_${prev}`] = undefined;\\n    }\\n  }\\n  return [block];\\n})()\\n}}\"}]}},\"executeOnce\":false,\"typeVersion\":3.4},{\"id\":\"349f4323-d65f-4845-accc-6f51340a84c4\",\"name\":\"Upload to Notion Page\",\"type\":\"n8n-nodes-base.httpRequest\",\"onError\":\"continueRegularOutput\",\"maxTries\":2,\"position\":[1680,1760],\"parameters\":{\"url\":\"=https://api.notion.com/v1/blocks/{{ $('Get Existing Row1').first().json.id }}/children\",\"method\":\"PATCH\",\"options\":{\"timeout\":\"={{ 1000 * 60 }}\"},\"jsonBody\":\"={{\\n{\\n  \\\"children\\\": $json.block\\n}\\n}}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"headerParameters\":{\"parameters\":[{\"name\":\"Notion-Version\",\"value\":\"2022-06-28\"}]},\"nodeCredentialType\":\"notionApi\"},\"credentials\":{\"notionApi\":{\"id\":\"iHBHe7ypzz4mZExM\",\"name\":\"Notion account\"}},\"retryOnFail\":true,\"typeVersion\":4.2,\"waitBetweenTries\":3000},{\"id\":\"44c732a9-b805-432e-8e9c-ba279e4cca46\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-520,620],\"parameters\":{\"color\":7,\"width\":1340,\"height\":740,\"content\":\"## 8. Web Search and Extracting Web Page Contents using [APIFY.com](https://www.apify.com?fpr=414q6)\\n[Read more about the HTTP Request node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/)\\n\\nHere is where I deviated a little from the reference implementation. I opted not to use Firecrawl.ai due to (1) high cost of the service and (2) a regular non-ai crawler would work just as well and probably quicker. Instead I'm using [APIFY.com](https://www.apify.com?fpr=414q6) which is a more performant, cost-effective and reliable web scraper service. If you don't want to use Apify, feel free to swap this out with your preferred service.\\n\\nThis step is the most exciting in terms of improvements and optimisations eg. mix in internal data sources! Add in Perplexity.ai or Jina.ai! Possibilities are endless.\"},\"typeVersion\":1},{\"id\":\"daf2e775-72d3-4366-882b-8c9eb65f11e8\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1140,60],\"parameters\":{\"color\":7,\"width\":460,\"height\":360,\"content\":\"## 5. Set Report to In-Progress\\n[Read more about the Notion node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.notion/)\"},\"typeVersion\":1},{\"id\":\"2d1b394d-8b9a-43fc-a646-c4e05c92da5b\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[860,780],\"parameters\":{\"color\":7,\"width\":800,\"height\":580,\"content\":\"## 9. Compile Learnings with Reasoning Model\\n[Read more about the Basic LLM node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm/)\\n\\nWith our gathered sources, it's now just a case of giving it to our LLM to compile a list of \\\"learnings\\\" from them. For our DeepResearcher, we'll use OpenAI's o3-mini which is the latest reasoning model at time of writing. Reasoning perform better than regular chat models due their chain-of-thought or \\\"thinking\\\" process that they perform.\\n\\nThe \\\"Learnings\\\" are then combined with the generated research goal to complete one loop.\"},\"typeVersion\":1},{\"id\":\"e2c29aa2-ff79-4bdd-b3c7-cf5e5866db8a\",\"name\":\"Get Existing Row1\",\"type\":\"n8n-nodes-base.notion\",\"position\":[-1020,1600],\"parameters\":{\"limit\":1,\"filters\":{\"conditions\":[{\"key\":\"Request ID|rich_text\",\"condition\":\"equals\",\"richTextValue\":\"={{ $json.requestId.toString() }}\"}]},\"options\":{},\"resource\":\"databasePage\",\"matchType\":\"allFilters\",\"operation\":\"getAll\",\"databaseId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"19486dd6-0c0c-80da-9cb7-eb1468ea9afd\",\"cachedResultUrl\":\"https://www.notion.so/19486dd60c0c80da9cb7eb1468ea9afd\",\"cachedResultName\":\"n8n DeepResearch\"},\"filterType\":\"manual\"},\"credentials\":{\"notionApi\":{\"id\":\"iHBHe7ypzz4mZExM\",\"name\":\"Notion account\"}},\"typeVersion\":2.2},{\"id\":\"9dff368e-c282-4fef-8894-e218ea266695\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1140,1400],\"parameters\":{\"color\":7,\"width\":660,\"height\":540,\"content\":\"## 10. Generate DeepSearch Report using Learnings\\n[Read more about the Basic LLM node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm/)\\n\\nFinally! After all learnings have been gathered - which may have taken up to an hour or more on the higher settings! - they are given to our LLM to generate the final research report in markdown format. Technically, the DeepResearch ends here but for this template, we need to push the output to Notion. If you're not using Notion, feel free to ignore the last few steps.\"},\"typeVersion\":1},{\"id\":\"14bfd0fd-6bc4-4dbf-86b2-44ef1c3586f7\",\"name\":\"Sticky Note9\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-460,1400],\"parameters\":{\"color\":7,\"width\":1060,\"height\":540,\"content\":\"## 11. Reformat Report as Notion Blocks\\n[Learn more about the Markdown node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.markdown/)\\n\\nTo write our report to our Notion page, we'll have to convert it to Notion \\\"blocks\\\" - these are specialised json objects which are required by the Notion API. There are quite a number of ways to do this conversion not involving the use of AI but for kicks, I decided to do so anyway. In this step, we first convert to HTML as it allows us to split the report semantically and makes for easier parsing for the LLM.\"},\"typeVersion\":1},{\"id\":\"a2aff56d-78b9-40a4-ac78-bd8380802ea0\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1220,1400],\"parameters\":{\"color\":7,\"width\":800,\"height\":580,\"content\":\"## 13. Update Report in Notion\\n[Read more about the HTTP request node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/)\\n\\nIn this step, we can use the Notion API to add the blocks to our page sequentially. A loop is used due to the unstable Notion API - the loop allows retries for blocks that require it.\"},\"typeVersion\":1},{\"id\":\"b5beeccd-e498-48ed-b6f2-b29d4599e2c9\",\"name\":\"Sticky Note11\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1840,-680],\"parameters\":{\"color\":7,\"width\":680,\"height\":560,\"content\":\"## 1. Let's Research!\\n[Learn more about the form trigger node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.formtrigger)\\n\\nn8n forms are a really nice way to get our frontend up and running quickly and compared to chat, offers a superior user interface for user input. I've gone perhaps a little extra with the custom html fields but I do enjoy adding a little customisation now and then.\"},\"typeVersion\":1},{\"id\":\"533ede84-1138-426c-93df-c2b862e2d063\",\"name\":\"DeepResearch Report\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[-860,1600],\"parameters\":{\"text\":\"=You are are an expert and insightful researcher.\\n* Given the following prompt from the user, write a final report on the topic using the learnings from research.\\n* Make it as as detailed as possible, aim for 3 or more pages, include ALL the learnings from research.\\n* Format the report in markdown. Use headings, lists and tables only and where appropriate.\\n\\n<prompt>{{ $('JobType Router').first().json.data.query }}</prompt>\\n\\nHere are all the learnings from previous research:\\n\\n<learnings>\\n{{\\n$('JobType Router').first().json.data\\n  .all_learnings\\n  .map(item => `<learning>${item}</learning>`)  \\n  .join('\\\\n')\\n}}\\n</learnings>\",\"promptType\":\"define\"},\"typeVersion\":1.5},{\"id\":\"efe47725-7fd5-45e7-97c4-d6c133745e5f\",\"name\":\"DeepResearch Learnings\",\"type\":\"@n8n/n8n-nodes-langchain.chainLlm\",\"position\":[1120,1020],\"parameters\":{\"text\":\"=Given the following contents from a SERP search for the query <query>{{ $('Item Ref').first().json.query }}</query>, generate a list of learnings from the contents. Return a maximum of 3 learnings, but feel free to return less if the contents are clear. Make sure each learning is unique and not similar to each other. The learnings should be concise and to the point, as detailed and infromation dense as possible. Make sure to include any entities like people, places, companies, products, things, etc in the learnings, as well as any exact metrics, numbers, or dates. The learnings will be used to research the topic further.\\n\\n<contents>\\n{{\\n$input\\n  .all()\\n  .map(item =>`<content>\\\\n${item.json.markdown.substr(0, 25_000)}\\\\n</content>`)\\n  .join('\\\\n')\\n}}\\n</contents>\",\"messages\":{\"messageValues\":[{\"type\":\"HumanMessagePromptTemplate\",\"message\":\"=You are an expert researcher. Today is {{ $now.toLocaleString() }}. Follow these instructions when responding:\\n  - You may be asked to research subjects that is after your knowledge cutoff, assume the user is right when presented with news.\\n  - The user is a highly experienced analyst, no need to simplify it, be as detailed as possible and make sure your response is correct.\\n  - Be highly organized.\\n  - Suggest solutions that I didn't think about.\\n  - Be proactive and anticipate my needs.\\n  - Treat me as an expert in all subject matter.\\n  - Mistakes erode my trust, so be accurate and thorough.\\n  - Provide detailed explanations, I'm comfortable with lots of detail.\\n  - Value good arguments over authorities, the source is irrelevant.\\n  - Consider new technologies and contrarian ideas, not just the conventional wisdom.\\n  - You may use high levels of speculation or prediction, just flag it for me.\"}]},\"promptType\":\"define\",\"hasOutputParser\":true},\"executeOnce\":true,\"typeVersion\":1.5},{\"id\":\"d3b42d13-e8ca-4085-ace9-1d9fb53f5e71\",\"name\":\"Generate Report\",\"type\":\"n8n-nodes-base.executeWorkflow\",\"position\":[480,180],\"parameters\":{\"options\":{\"waitForSubWorkflow\":false},\"workflowId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $workflow.id }}\"},\"workflowInputs\":{\"value\":{\"data\":\"={{\\n{\\n  ...Object.assign({}, $json),\\n  query: $('JobType Router').first().json.data.query\\n}\\n}}\",\"jobType\":\"deepresearch_report\",\"requestId\":\"={{ $('JobType Router').first().json.requestId }}\"},\"schema\":[{\"id\":\"requestId\",\"display\":true,\"required\":false,\"displayName\":\"requestId\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"jobType\",\"type\":\"string\",\"display\":true,\"required\":false,\"displayName\":\"jobType\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"data\",\"type\":\"object\",\"display\":true,\"required\":false,\"displayName\":\"data\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[],\"attemptToConvertTypes\":false,\"convertFieldsToString\":true}},\"typeVersion\":1.2},{\"id\":\"2b0314ff-cd82-4b3b-a4a9-5fd8067391eb\",\"name\":\"Generate Learnings\",\"type\":\"n8n-nodes-base.executeWorkflow\",\"position\":[-380,180],\"parameters\":{\"mode\":\"each\",\"options\":{\"waitForSubWorkflow\":true},\"workflowId\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"={{ $workflow.id }}\"},\"workflowInputs\":{\"value\":{\"data\":\"={{ $json }}\",\"jobType\":\"deepresearch_learnings\",\"requestId\":\"={{ $('JobType Router').first().json.requestId }}\"},\"schema\":[{\"id\":\"requestId\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"requestId\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"jobType\",\"type\":\"string\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"jobType\",\"defaultMatch\":false,\"canBeUsedToMatch\":true},{\"id\":\"data\",\"type\":\"object\",\"display\":true,\"removed\":false,\"required\":false,\"displayName\":\"data\",\"defaultMatch\":false,\"canBeUsedToMatch\":true}],\"mappingMode\":\"defineBelow\",\"matchingColumns\":[],\"attemptToConvertTypes\":false,\"convertFieldsToString\":true}},\"typeVersion\":1.2},{\"id\":\"f4457d0b-d708-4bca-9973-46d96ed55826\",\"name\":\"Confirmation\",\"type\":\"n8n-nodes-base.form\",\"position\":[780,-420],\"webhookId\":\"2eb17c47-c887-4e95-8641-1b3796452ab9\",\"parameters\":{\"options\":{\"formTitle\":\"DeepResearcher\",\"buttonLabel\":\"Done\",\"formDescription\":\"=<img\\n  src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw\\\"\\n  width=\\\"100%\\\"\\n  style=\\\"border:1px solid #ccc\\\"\\n/>\\n<p style=\\\"text-align:left\\\">\\n<strong style=\\\"display:block;font-family:sans-serif;font-weight:700;font-size:16px;margin-top:12px;margin-bottom:0;\\\">Your Report Is On Its Way!</strong>\\n<br/>\\nDeepResearcher will now work independently to conduct the research and the compiled report will be uploaded to the following Notion page below when finished.\\n<br/><br/>\\nPlease click the \\\"Done\\\" button to complete the form.\\n</p>\\n<hr style=\\\"display:block;margin-top:16px;margin-bottom:0\\\" />\"},\"formFields\":{\"values\":[{\"html\":\"=<a href=\\\"{{ $json.url }}\\\" style=\\\"text-decoration:none\\\" target=\\\"_blank\\\">\\n<div style=\\\"display:flex;text-align:left;font-family:sans-serif;\\\">\\n  <div style=\\\"width:150px;height:150px;padding:12px;\\\">\\n    <img src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/cajjymprexcoesu4gg9g\\\" width=\\\"100%\\\" />\\n  </div>\\n  <div style=\\\"width:100%;padding:12px;\\\">\\n    <div style=\\\"font-size:14px;font-weight:700\\\">{{ $json.name }}</div>\\n    <div style=\\\"font-size:12px;color:#666\\\">\\n      {{ $json.property_description }}\\n    </div>\\n  </div>\\n</div>\\n</a>\",\"fieldType\":\"html\"}]}},\"typeVersion\":1},{\"id\":\"af8fe17a-4314-4e92-ad8e-8be0be62984b\",\"name\":\"Research Request\",\"type\":\"n8n-nodes-base.form\",\"position\":[-1560,-460],\"webhookId\":\"46142c14-3692-40f6-80e5-f3d976e95191\",\"parameters\":{\"options\":{\"formTitle\":\"DeepResearcher\",\"formDescription\":\"=<img\\n  src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw\\\"\\n  width=\\\"100%\\\"\\n  style=\\\"border:1px solid #ccc\\\"\\n/>\"},\"formFields\":{\"values\":[{\"fieldType\":\"textarea\",\"fieldLabel\":\"What would you like to research?\",\"requiredField\":true},{\"html\":\"<video\\n    style=\\\"display:none\\\"\\n    src=\\\"/when_will_n8n_support_range_sliders.mp4\\\"\\n    onerror='\\n  this.insertAdjacentHTML(`afterend`,\\n  `<div class=\\\"form-group\\\" style=\\\"margin-bottom:16px;\\\">\\n    <label class=\\\"form-label\\\" for=\\\"breadth\\\">\\n      Enter research depth (Default 1)\\n    </label>\\n    <p style=\\\"font-size:12px;color:#666;text-align:left\\\">\\n      This value determines how many sub-queries to generate.\\n    </p>\\n    <input\\n      class=\\\"form-input\\\"\\n      type=\\\"range\\\"\\n      id=\\\"depth\\\"\\n      name=\\\"field-1\\\"\\n      value=\\\"1\\\"\\n      step=\\\"1\\\"\\n      max=\\\"5\\\"\\n      min=\\\"1\\\"\\n      list=\\\"depth-markers\\\"\\n    >\\n    <datalist\\n      id=\\\"depth-markers\\\"\\n      style=\\\"display: flex;\\n      flex-direction: row;\\n      justify-content: space-between;\\n      writing-mode: horizontal-tb;\\n      margin-top: -10px;\\n      text-align: center;\\n      font-size: 10px;\\n      margin-left: 16px;\\n      margin-right: 16px;\\\"\\n    >\\n      <option value=\\\"1\\\" label=\\\"1\\\"></option>\\n      <option value=\\\"2\\\" label=\\\"2\\\"></option>\\n      <option value=\\\"3\\\" label=\\\"3\\\"></option>\\n      <option value=\\\"4\\\" label=\\\"4\\\"></option>\\n      <option value=\\\"5\\\" label=\\\"5\\\"></option>\\n    </datalist>\\n  </div>`)\\n  '\\n/>\",\"fieldType\":\"html\",\"elementName\":\"input-depth\"},{\"html\":\"<video\\n    style=\\\"display:none\\\"\\n    src=\\\"/when_will_n8n_support_range_sliders.mp4\\\"\\n    onerror='\\n  this.insertAdjacentHTML(`afterend`,\\n  `<div class=\\\"form-group\\\" style=\\\"margin-bottom:16px;\\\">\\n    <label class=\\\"form-label\\\" for=\\\"breadth\\\">\\n      Enter research breadth (Default 2)\\n    </label>\\n    <p style=\\\"font-size:12px;color:#666;text-align:left\\\">\\n      This value determines how many sources to explore.\\n    </p>\\n    <input\\n      class=\\\"form-input\\\"\\n      type=\\\"range\\\"\\n      id=\\\"breadth\\\"\\n      name=\\\"field-2\\\"\\n      value=\\\"2\\\"\\n      step=\\\"1\\\"\\n      max=\\\"5\\\"\\n      min=\\\"1\\\"\\n      list=\\\"breadth-markers\\\"\\n    >\\n    <datalist\\n      id=\\\"breadth-markers\\\"\\n      style=\\\"display: flex;\\n      flex-direction: row;\\n      justify-content: space-between;\\n      writing-mode: horizontal-tb;\\n      margin-top: -10px;\\n      text-align: center;\\n      font-size: 10px;\\n      margin-left: 16px;\\n      margin-right: 16px;\\\"\\n    >\\n      <option value=\\\"1\\\" label=\\\"1\\\"></option>\\n      <option value=\\\"2\\\" label=\\\"2\\\"></option>\\n      <option value=\\\"3\\\" label=\\\"3\\\"></option>\\n      <option value=\\\"4\\\" label=\\\"4\\\"></option>\\n      <option value=\\\"5\\\" label=\\\"5\\\"></option>\\n    </datalist>\\n  </div>`)\\n  '\\n/>\\n\",\"fieldType\":\"html\",\"elementName\":\"input-breadth\"},{\"fieldType\":\"dropdown\",\"fieldLabel\":\"={{ \\\"\\\" }}\",\"multiselect\":true,\"fieldOptions\":{\"values\":[{\"option\":\"=I understand higher depth and breath values I've selected may incur longer wait times and higher costs. I acknowledging this and wish to proceed with the research request.\"}]},\"requiredField\":true}]}},\"typeVersion\":1},{\"id\":\"c67a5e5c-f82b-4e8a-9c99-065d16dfa576\",\"name\":\"Valid Blocks\",\"type\":\"n8n-nodes-base.filter\",\"position\":[740,1600],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"f68cefe0-e109-4d41-9aa3-043f3bc6c449\",\"operator\":{\"type\":\"string\",\"operation\":\"notExists\",\"singleValue\":true},\"leftValue\":\"={{ $json.error }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"b89cf700-d955-4de4-bbac-b5c55995a1ee\",\"name\":\"Sticky Note12\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[620,1400],\"parameters\":{\"color\":7,\"width\":580,\"height\":580,\"content\":\"## 12. Append URL Sources List\\n[Read more about the Code node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code)\\n\\nFor our source URLs, we'll manually compose the Notion blocks for them - this is because there's usually a lot of them! We'll then append to the end of the other blocks.\"},\"typeVersion\":1},{\"id\":\"70c898a1-a757-452d-83ef-de1998fe13ae\",\"name\":\"Append Blocks\",\"type\":\"n8n-nodes-base.merge\",\"position\":[1000,1760],\"parameters\":{},\"typeVersion\":3},{\"id\":\"591a3fcd-1748-43f7-9766-bc2059c195a0\",\"name\":\"URL Sources to Lists\",\"type\":\"n8n-nodes-base.code\",\"position\":[740,1760],\"parameters\":{\"jsCode\":\"const urls = Object.values($('JobType Router').first().json.data.all_urls\\n  .reduce((acc, url) => ({ ...acc, [url]: url }),{}));\\nconst chunksize = 50;\\nconst splits = Math.max(1, Math.floor(urls.length/chunksize));\\n\\nconst blocks = Array(splits).fill(0)\\n  .map((_, idx) => {\\n    const block = urls\\n      .slice(\\n        idx * chunksize, \\n        (idx * chunksize) + chunksize - 1\\n      )\\n      .map(url => {\\n        return {\\n          object: \\\"block\\\",\\n          type: \\\"bulleted_list_item\\\",\\n          bulleted_list_item: {\\n            rich_text: [\\n              { type: \\\"text\\\", text: { content: url } }\\n            ]\\n          }\\n        }\\n      });\\n    return { json: { block } }\\n  });\\n\\nreturn [\\n  { json: {\\n    block:[{\\n      \\\"object\\\": \\\"block\\\",\\n      \\\"type\\\": \\\"heading_2\\\",\\n      \\\"heading_2\\\": {\\n        \\\"rich_text\\\": [\\n          {\\n            \\\"type\\\": \\\"text\\\",\\n            \\\"text\\\": {\\n              \\\"content\\\": \\\"Sources\\\"\\n            }\\n          }\\n        ]\\n      }\\n    }]\\n  } },\\n  ...blocks\\n];\"},\"typeVersion\":2},{\"id\":\"e59dbeea-ccf3-4619-9fe1-24874a91bdab\",\"name\":\"Empty Response\",\"type\":\"n8n-nodes-base.set\",\"position\":[640,1160],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"1de40158-338b-4db3-9e22-6fd63b21f825\",\"name\":\"ResearchGoal\",\"type\":\"string\",\"value\":\"={{ $('Item Ref').first().json.researchGoal }}\"},{\"id\":\"9f59a2d4-5e5a-4d0b-8adf-2832ce746f0f\",\"name\":\"learnings\",\"type\":\"array\",\"value\":\"={{ [] }}\"},{\"id\":\"972ab5f5-0537-4755-afcb-d1db4f09ad60\",\"name\":\"followUpQuestions\",\"type\":\"array\",\"value\":\"={{ [] }}\"},{\"id\":\"90cef471-76b0-465d-91a4-a0e256335cd3\",\"name\":\"urls\",\"type\":\"array\",\"value\":\"={{ [] }}\"}]}},\"typeVersion\":3.4},{\"id\":\"34035b2e-eee9-483e-8125-3b6f1f41cd1d\",\"name\":\"Has Content?\",\"type\":\"n8n-nodes-base.if\",\"position\":[480,1020],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"1ef1039a-4792-47f9-860b-d2ffcffd7129\",\"operator\":{\"type\":\"object\",\"operation\":\"notEmpty\",\"singleValue\":true},\"leftValue\":\"={{ $json }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"5e9f80e2-db58-4f89-8aec-a1b8e73e18eb\",\"name\":\"Sticky Note13\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1820,-240],\"parameters\":{\"color\":5,\"width\":300,\"height\":100,\"content\":\"### Not using forms?\\nFeel free ot swap this out for chat or even webhooks to fit your existing workflows.\"},\"typeVersion\":1},{\"id\":\"3e513463-2f4c-4e3e-921d-e5c8ea5ec078\",\"name\":\"Sticky Note14\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1880,540],\"parameters\":{\"color\":5,\"width\":460,\"height\":240,\"content\":\"### 🚏 The Subworkflow Event Pattern \\nIf you're new to n8n, this advanced technique might need some explaining but in gist, we're using subworkflows to run different parts of our DeepResearcher workflow as separate executions.\\n\\n* Necessary to implement the recursive loop mechanism needed to enable this workflow.\\n* Negates the need to split this workflow into multiple templates.\\n* Great generally for building high performance n8n workflows (a topic for a future post!)\"},\"typeVersion\":1},{\"id\":\"fea2568e-86c9-4663-b141-a9b2a36b84f5\",\"name\":\"Sticky Note15\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[720,-60],\"parameters\":{\"color\":5,\"width\":340,\"height\":200,\"content\":\"### Recursive Looping\\nThe recursive looping implemented for this workflow is an advanced item-linking technique. It works by specifically controlling which nodes \\\"execute once\\\" vs\\\" execute for each item\\\" because of this becareful of ermoving nodes! Always check the settings of the node you're replacing and ensure the settings match. \"},\"typeVersion\":1},{\"id\":\"fd3fec73-4b1a-4882-8c5a-d4825d9038ad\",\"name\":\"Combine & Send back to Loop\",\"type\":\"n8n-nodes-base.aggregate\",\"position\":[-220,860],\"parameters\":{\"options\":{},\"aggregate\":\"aggregateAllItemData\"},\"typeVersion\":1},{\"id\":\"7c183897-e2ce-46da-90bd-0a39122b85f2\",\"name\":\"For Each Block...\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[1440,1600],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"bc04462a-780c-48e9-bc38-8eaf8ac1175c\",\"name\":\"Sticky Note16\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-2420,-920],\"parameters\":{\"width\":520,\"height\":1060,\"content\":\"## n8n DeepResearcher\\n### This template attempts to replicate OpenAI's DeepResearch feature which, at time of writing, is only available to their pro subscribers.\\n\\nThough the inner workings of DeepResearch have not been made public, it is presumed the feature relies on the ability to deep search the web, scrape web content and invoking reasoning models to generate reports. All of which n8n is really good at!\\n\\n### How it works\\n* A form is used to first capture the user's research query and how deep they'd like the researcher to go.\\n* Once submitted, a blank Notion page is created which will later hold the final report and the researcher gets to work.\\n* The user's query goes through a recursive series of web serches and web scraping to collect data on the research topic to generate partial learnings.\\n* Once complete, all learnings are combined and given to a reasoning LLM to generate the final report.\\n* The report is then written to the placeholder Notion page created earlier. \\n\\n### How to use\\n* Duplicate this Notion database to use with this template: https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf\\n* Sign-up for [APIFY.com](https://www.apify.com?fpr=414q6) API Key for web search and scraping services.\\n* Ensure you have access to OpenAI's o3-mini model. Alternatively, switch this out for o1 series.\\n* You must publish this workflow and ensure the form url is publically accessible.\\n\\n### On Depth & Breadth Configuration\\nFor more detailed reports, increase depth and breadth but be warned the workflow will take a exponentially more time and money to complete. The defaults are usually good enough.\\n\\nDepth=1 & Breadth=2 - will take about 5 - 10mins.\\nDepth=1 & Breadth=3 - will take about 15 - 20mins.\\nDpeth=3 & Breadth=5 - will take about 2+ hours!\\n\\n### Need Help?\\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\\n\\nHappy Hacking!\"},\"typeVersion\":1},{\"id\":\"654362c8-bc85-47d1-b277-50630f6f3999\",\"name\":\"Sticky Note17\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-2420,-1180],\"parameters\":{\"color\":7,\"width\":520,\"height\":240,\"content\":\"![](https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw#full-width)\"},\"typeVersion\":1},{\"id\":\"c2ddbec3-4579-4d4e-81bf-293c9eee9b73\",\"name\":\"Sticky Note18\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-80,1000],\"parameters\":{\"width\":180,\"height\":260,\"content\":\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### UPDATE APIFY CREDENTIAL HERE!\"},\"typeVersion\":1},{\"id\":\"43461d7d-1a04-424a-b2b0-4a4cbc46f1c2\",\"name\":\"Sticky Note20\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1640,1740],\"parameters\":{\"width\":180,\"height\":260,\"content\":\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### UPDATE NOTION CREDENTIAL HERE!\"},\"typeVersion\":1},{\"id\":\"48b83b0f-94e7-44e2-8bd4-0addddd62264\",\"name\":\"Valid Results\",\"type\":\"n8n-nodes-base.filter\",\"position\":[300,1020],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"f44691e4-f753-47b0-b66a-068a723b6beb\",\"operator\":{\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.crawl.requestStatus }}\",\"rightValue\":\"handled\"},{\"id\":\"8e05df2b-0d4a-47da-9aab-da7e8907cbca\",\"operator\":{\"type\":\"string\",\"operation\":\"notEmpty\",\"singleValue\":true},\"leftValue\":\"={{ $json.markdown }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2,\"alwaysOutputData\":true},{\"id\":\"6124becb-2584-472d-8354-b714d9f1e858\",\"name\":\"RAG Web Browser\",\"type\":\"n8n-nodes-base.httpRequest\",\"onError\":\"continueRegularOutput\",\"position\":[-40,1020],\"parameters\":{\"url\":\"https://api.apify.com/v2/acts/apify~rag-web-browser/run-sync-get-dataset-items\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"sendQuery\":true,\"authentication\":\"genericCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"query\",\"value\":\"={{\\n`${$json.query} -filetype:pdf (-site:tiktok.com OR -site:instagram.com OR -site:youtube.com OR -site:linkedin.com OR -site:reddit.com)`\\n}}\"}]},\"genericAuthType\":\"httpHeaderAuth\",\"queryParameters\":{\"parameters\":[{\"name\":\"memory\",\"value\":\"4096\"},{\"name\":\"timeout\",\"value\":\"180\"}]}},\"credentials\":{\"httpQueryAuth\":{\"id\":\"cO2w8RDNOZg8DRa8\",\"name\":\"Apify API\"},\"httpHeaderAuth\":{\"id\":\"SV9BDKc1cRbZBeoL\",\"name\":\"Apify.com (personal token)\"}},\"typeVersion\":4.2},{\"id\":\"749a5d4d-85ae-4ee3-a79b-6659af666a3a\",\"name\":\"Get Markdown + URL\",\"type\":\"n8n-nodes-base.set\",\"position\":[940,1020],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"c41592db-f9f0-4228-b6d8-0514c9a21fca\",\"name\":\"markdown\",\"type\":\"string\",\"value\":\"={{ $json.markdown }}\"},{\"id\":\"5579a411-94dc-4b10-a276-24adf775be1d\",\"name\":\"url\",\"type\":\"string\",\"value\":\"={{ $json.searchResult.url }}\"}]}},\"typeVersion\":3.4},{\"id\":\"4a5ad2e4-b274-4a2f-bc0f-15d067ad469c\",\"name\":\"Is Apify Auth Error?\",\"type\":\"n8n-nodes-base.if\",\"position\":[140,1020],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"8722e13a-d788-4145-8bea-5bc0ce0a83f8\",\"operator\":{\"type\":\"number\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.error.status }}\",\"rightValue\":401}]}},\"typeVersion\":2.2},{\"id\":\"54118cbc-6466-448d-8832-91ad62a931e2\",\"name\":\"Stop and Error\",\"type\":\"n8n-nodes-base.stopAndError\",\"position\":[300,860],\"parameters\":{\"errorMessage\":\"=Apify Auth Error! Check your API token is valid and make sure you put \\\"Bearer <api_key>\\\" if using HeaderAuth.\"},\"typeVersion\":1},{\"id\":\"aae46fd1-70bc-4629-8a47-6ae75ce8afb1\",\"name\":\"Sticky Note19\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-460,1960],\"parameters\":{\"color\":5,\"width\":560,\"height\":300,\"content\":\"### Self-hosting n8n? Consider using one of these to upload to Notion!\\nThis template uses an LLM to convert markdown to Notion which isn't the most efficient but it's \\\"easier\\\" because doesn't require installing other software. To speed this up and reduce errors in the conversation, consider the following options to replace this flow if you're able to install them yourself.\\n\\n* [Notion ⇄ Markdown Conversion Community Node](https://community.n8n.io/t/now-available-notion-markdown-conversion-community-node/59087)\\n* [tryfabric/martian: Markdown to Notion: Convert Markdown and GitHub Flavoured Markdown to Notion API Blocks and RichText 🔀📝](https://github.com/tryfabric/martian)\\n* [brittonhayes/notionmd: 🪄 Convert Markdown into Notion Blocks](https://github.com/brittonhayes/notionmd)\\n\\n\\n**Note**: Recommendation onl, requires due diligence and use at your own risk!\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Item Ref\":{\"main\":[[{\"node\":\"RAG Web Browser\",\"type\":\"main\",\"index\":0}]]},\"Create Row\":{\"main\":[[{\"node\":\"Initiate DeepResearch\",\"type\":\"main\",\"index\":0}]]},\"Confirmation\":{\"main\":[[{\"node\":\"End Form\",\"type\":\"main\",\"index\":0}]]},\"Has Content?\":{\"main\":[[{\"node\":\"Get Markdown + URL\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Empty Response\",\"type\":\"main\",\"index\":0}]]},\"Valid Blocks\":{\"main\":[[{\"node\":\"Append Blocks\",\"type\":\"main\",\"index\":0}]]},\"Append Blocks\":{\"main\":[[{\"node\":\"For Each Block...\",\"type\":\"main\",\"index\":0}]]},\"HTML to Array\":{\"main\":[[{\"node\":\"Tags to Items\",\"type\":\"main\",\"index\":0}]]},\"SERP to Items\":{\"main\":[[{\"node\":\"For Each Query...\",\"type\":\"main\",\"index\":0}]]},\"Set Variables\":{\"main\":[[{\"node\":\"Clarifying Questions\",\"type\":\"main\",\"index\":0}]]},\"Tags to Items\":{\"main\":[[{\"node\":\"Notion Block Generator\",\"type\":\"main\",\"index\":0}]]},\"Valid Results\":{\"main\":[[{\"node\":\"Has Content?\",\"type\":\"main\",\"index\":0}]]},\"Empty Response\":{\"main\":[[{\"node\":\"For Each Query...\",\"type\":\"main\",\"index\":0}]]},\"Execution Data\":{\"main\":[[{\"node\":\"JobType Router\",\"type\":\"main\",\"index\":0}]]},\"JobType Router\":{\"main\":[[{\"node\":\"Get Existing Row\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Generate SERP Queries\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Get Existing Row1\",\"type\":\"main\",\"index\":0}]]},\"Convert to HTML\":{\"main\":[[{\"node\":\"HTML to Array\",\"type\":\"main\",\"index\":0}]]},\"RAG Web Browser\":{\"main\":[[{\"node\":\"Is Apify Auth Error?\",\"type\":\"main\",\"index\":0}]]},\"Set In-Progress\":{\"main\":[[{\"node\":\"Set Initial Query\",\"type\":\"main\",\"index\":0}]]},\"Get Existing Row\":{\"main\":[[{\"node\":\"Set In-Progress\",\"type\":\"main\",\"index\":0}]]},\"Research Request\":{\"main\":[[{\"node\":\"Set Variables\",\"type\":\"main\",\"index\":0}]]},\"Results to Items\":{\"main\":[[{\"node\":\"Set Next Queries\",\"type\":\"main\",\"index\":0}]]},\"Set Next Queries\":{\"main\":[[{\"node\":\"Generate Learnings\",\"type\":\"main\",\"index\":0}]]},\"Feedback to Items\":{\"main\":[[{\"node\":\"For Each Question...\",\"type\":\"main\",\"index\":0}]]},\"For Each Block...\":{\"main\":[[{\"node\":\"Set Done\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Upload to Notion Page\",\"type\":\"main\",\"index\":0}]]},\"For Each Query...\":{\"main\":[[{\"node\":\"Combine & Send back to Loop\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Item Ref\",\"type\":\"main\",\"index\":0}]]},\"Get Existing Row1\":{\"main\":[[{\"node\":\"DeepResearch Report\",\"type\":\"main\",\"index\":0}]]},\"Get Initial Query\":{\"main\":[[{\"node\":\"Report Page Generator\",\"type\":\"main\",\"index\":0}]]},\"Is Depth Reached?\":{\"main\":[[{\"node\":\"Get Research Results\",\"type\":\"main\",\"index\":0}],[{\"node\":\"DeepResearch Results\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model\":{\"ai_languageModel\":[[{\"node\":\"DeepResearch Learnings\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Parse JSON blocks\":{\"main\":[[{\"node\":\"Valid Blocks\",\"type\":\"main\",\"index\":0},{\"node\":\"URL Sources to Lists\",\"type\":\"main\",\"index\":0}]]},\"Set Initial Query\":{\"main\":[[{\"node\":\"Generate Learnings\",\"type\":\"main\",\"index\":0}]]},\"Accumulate Results\":{\"main\":[[{\"node\":\"Is Depth Reached?\",\"type\":\"main\",\"index\":0}]]},\"Generate Learnings\":{\"main\":[[{\"node\":\"Accumulate Results\",\"type\":\"main\",\"index\":0}]]},\"Get Markdown + URL\":{\"main\":[[{\"node\":\"DeepResearch Learnings\",\"type\":\"main\",\"index\":0}]]},\"On form submission\":{\"main\":[[{\"node\":\"Research Request\",\"type\":\"main\",\"index\":0}]]},\"OpenAI Chat Model1\":{\"ai_languageModel\":[[{\"node\":\"DeepResearch Report\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"OpenAI Chat Model2\":{\"ai_languageModel\":[[{\"node\":\"Clarifying Questions\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"OpenAI Chat Model3\":{\"ai_languageModel\":[[{\"node\":\"Generate SERP Queries\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"OpenAI Chat Model4\":{\"ai_languageModel\":[[{\"node\":\"Report Page Generator\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"DeepResearch Report\":{\"main\":[[{\"node\":\"Convert to HTML\",\"type\":\"main\",\"index\":0}]]},\"Clarifying Questions\":{\"main\":[[{\"node\":\"Feedback to Items\",\"type\":\"main\",\"index\":0}]]},\"DeepResearch Results\":{\"main\":[[{\"node\":\"Results to Items\",\"type\":\"main\",\"index\":0}]]},\"For Each Question...\":{\"main\":[[{\"node\":\"Get Initial Query\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Ask Clarity Questions\",\"type\":\"main\",\"index\":0}]]},\"Get Research Results\":{\"main\":[[{\"node\":\"Generate Report\",\"type\":\"main\",\"index\":0}]]},\"Is Apify Auth Error?\":{\"main\":[[{\"node\":\"Stop and Error\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Valid Results\",\"type\":\"main\",\"index\":0}]]},\"URL Sources to Lists\":{\"main\":[[{\"node\":\"Append Blocks\",\"type\":\"main\",\"index\":1}]]},\"Ask Clarity Questions\":{\"main\":[[{\"node\":\"For Each Question...\",\"type\":\"main\",\"index\":0}]]},\"Generate SERP Queries\":{\"main\":[[{\"node\":\"SERP to Items\",\"type\":\"main\",\"index\":0}]]},\"Initiate DeepResearch\":{\"main\":[[{\"node\":\"Confirmation\",\"type\":\"main\",\"index\":0}]]},\"Report Page Generator\":{\"main\":[[{\"node\":\"Create Row\",\"type\":\"main\",\"index\":0}]]},\"Upload to Notion Page\":{\"main\":[[{\"node\":\"For Each Block...\",\"type\":\"main\",\"index\":0}],[]]},\"DeepResearch Learnings\":{\"main\":[[{\"node\":\"Research Goal + Learnings\",\"type\":\"main\",\"index\":0}]]},\"Notion Block Generator\":{\"main\":[[{\"node\":\"Parse JSON blocks\",\"type\":\"main\",\"index\":0}]]},\"DeepResearch Subworkflow\":{\"main\":[[{\"node\":\"Execution Data\",\"type\":\"main\",\"index\":0}]]},\"Google Gemini Chat Model\":{\"ai_languageModel\":[[{\"node\":\"Notion Block Generator\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Structured Output Parser\":{\"ai_outputParser\":[[{\"node\":\"DeepResearch Learnings\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"Research Goal + Learnings\":{\"main\":[[{\"node\":\"For Each Query...\",\"type\":\"main\",\"index\":0}]]},\"Structured Output Parser1\":{\"ai_outputParser\":[[{\"node\":\"Clarifying Questions\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"Structured Output Parser2\":{\"ai_outputParser\":[[{\"node\":\"Generate SERP Queries\",\"type\":\"ai_outputParser\",\"index\":0}]]},\"Structured Output Parser4\":{\"ai_outputParser\":[[{\"node\":\"Report Page Generator\",\"type\":\"ai_outputParser\",\"index\":0}]]}}}",
  "readme": "**This template attempts to replicate OpenAI's DeepResearch feature which, at time of writing, is only available to their pro subscribers.**\n\n> An agent that uses reasoning to synthesize large amount of online information and complete multi-step research tasks for you.  \n>  [Source](https://openai.com/index/introducing-deep-research/)\n\nThough the inner workings of DeepResearch have not been made public, it is presumed the feature relies on the ability to deep search the web, scrape web content and invoking reasoning models to generate reports. All of which n8n is really good at!\n\nUsing this workflow, n8n users can enjoy a variation of the Deep Research experience for themselves and their teams at a fraction of the cost. Better yet, learn and customise this Deep Research template for their businesses and/or organisations.\n\n**Check out the generated reports here:** <https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf>\n\n## How it works\n\n  * A form is used to first capture the user's research query and how deep they'd like the researcher to go.\n  * Once submitted, a blank Notion page is created which will later hold the final report and the researcher gets to work.\n  * The user's query goes through a recursive series of web serches and web scraping to collect data on the research topic to generate partial learnings.\n  * Once complete, all learnings are combined and given to a reasoning LLM to generate the final report.\n  * The report is then written to the placeholder Notion page created earlier.\n\n\n\n## How to use\n\n  * Duplicate this [Notion database template](https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf) and make sure all Notion related nodes point to it.\n  * Sign-up for [APIFY.com](https://www.apify.com?fpr=414q6) API Key for web search and scraping services.\n  * Ensure you have access to OpenAI's o3-mini model. Alternatively, switch this out for o1 series.\n  * You must publish this workflow and ensure the form url is publically accessible.\n\n\n\n## On depth & breadth configuration\n\nFor more detailed reports, increase depth and breadth but be warned the workflow will take exponentially longer and cost more to complete. The recommended defaults are usually good enough.\n\nDepth=1 & Breadth=2 - will take about 5 - 10mins.  \nDepth=1 & Breadth=3 - will take about 15 - 20mins.  \nDpeth=3 & Breadth=5 - will take about 2+ hours!\n\n## Customising this workflow\n\n  * I deliberately chose not to use AI-powered scrapers like Firecrawl as I felt these were quite costly and quotas would be quickly exhausted. However, feel free to switch web search and scraping services which suit your environment.\n  * Maybe you don't decide to source the web and instead, data collection comes from internal documents instead. This template gives you freedom to change this.\n  * Experiment with different Reasoning/Thinking models such as Deepseek and Google's Gemini 2.0.\n  * Finally, the LLM prompts could definitely be improved. Refine them to fit your use-case.\n\n\n\n### Credits\n\n  * This template is largely based off the work by David Zhang (dzhng) and his open source implementation of Deep Research: <https://github.com/dzhng/deep-research>\n\n\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><p><strong>This template attempts to replicate OpenAI's DeepResearch feature which, at time of writing, is only available to their pro subscribers.</strong></p>\n<blockquote>\n<p>An agent that uses reasoning to synthesize large amount of online information and complete multi-step research tasks for you.<br>\n<a href=\"https://openai.com/index/introducing-deep-research/\" rel=\"ugc nofollow\" target=\"_blank\">Source</a></p>\n</blockquote>\n<p>Though the inner workings of DeepResearch have not been made public, it is presumed the feature relies on the ability to deep search the web, scrape web content and invoking reasoning models to generate reports. All of which n8n is really good at!</p>\n<p>Using this workflow, n8n users can enjoy a variation of the Deep Research experience for themselves and their teams at a fraction of the cost. Better yet, learn and customise this Deep Research template for their businesses and/or organisations.</p>\n<p><strong>Check out the generated reports here:</strong> <a href=\"https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf\" rel=\"ugc nofollow\" target=\"_blank\">https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf</a></p>\n<h2>How it works</h2>\n<ul>\n<li>A form is used to first capture the user's research query and how deep they'd like the researcher to go.</li>\n<li>Once submitted, a blank Notion page is created which will later hold the final report and the researcher gets to work.</li>\n<li>The user's query goes through a recursive series of web serches and web scraping to collect data on the research topic to generate partial learnings.</li>\n<li>Once complete, all learnings are combined and given to a reasoning LLM to generate the final report.</li>\n<li>The report is then written to the placeholder Notion page created earlier.</li>\n</ul>\n<h2>How to use</h2>\n<ul>\n<li>Duplicate this <a href=\"https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf\" rel=\"ugc nofollow\" target=\"_blank\">Notion database template</a> and make sure all Notion related nodes point to it.</li>\n<li>Sign-up for <a href=\"https://www.apify.com?fpr=414q6\" rel=\"ugc nofollow\" target=\"_blank\">APIFY.com</a> API Key for web search and scraping services.</li>\n<li>Ensure you have access to OpenAI's o3-mini model. Alternatively, switch this out for o1 series.</li>\n<li>You must publish this workflow and ensure the form url is publically accessible.</li>\n</ul>\n<h2>On depth &amp; breadth configuration</h2>\n<p>For more detailed reports, increase depth and breadth but be warned the workflow will take exponentially longer and cost more to complete. The recommended defaults are usually good enough.</p>\n<p>Depth=1 &amp; Breadth=2 - will take about 5 - 10mins.<br>\nDepth=1 &amp; Breadth=3 - will take about 15 - 20mins.<br>\nDpeth=3 &amp; Breadth=5 - will take about 2+ hours!</p>\n<h2>Customising this workflow</h2>\n<ul>\n<li>I deliberately chose not to use AI-powered scrapers like Firecrawl as I felt these were quite costly and quotas would be quickly exhausted. However, feel free to switch web search and scraping services which suit your environment.</li>\n<li>Maybe you don't decide to source the web and instead, data collection comes from internal documents instead. This template gives you freedom to change this.</li>\n<li>Experiment with different Reasoning/Thinking models such as Deepseek and Google's Gemini 2.0.</li>\n<li>Finally, the LLM prompts could definitely be improved. Refine them to fit your use-case.</li>\n</ul>\n<h3>Credits</h3>\n<ul>\n<li>This template is largely based off the work by David Zhang (dzhng) and his open source implementation of Deep Research: <a href=\"https://github.com/dzhng/deep-research\" rel=\"ugc nofollow\" target=\"_blank\">https://github.com/dzhng/deep-research</a></li>\n</ul>\n</div><!--]-->",
  "readme_zh": "**该模板尝试复现OpenAI的DeepResearch功能（截至撰写时仅限专业版用户使用）。**\n\n> 一个能通过逻辑推理整合海量网络信息，并为您完成多步骤研究任务的智能代理。  \n> [来源](https://openai.com/index/introducing-deep-research/)\n\n虽然DeepResearch的内部机制尚未公开，但推测其依赖深度网络搜索、网页内容抓取及推理模型生成报告的能力——而这正是n8n的强项！\n\n通过此工作流，n8n用户能以极低成本为自己和团队体验类DeepResearch功能。更棒的是，您可以为自身业务或组织学习并定制这套深度研究模板。\n\n**查看生成报告示例：** <https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf>\n\n## 运作原理\n\n* 首先通过表单收集用户的研究主题及所需研究深度\n* 提交后自动创建空白Notion页面作为报告容器，研究程序随即启动\n* 通过递归式网络搜索与内容抓取收集研究数据，生成阶段性结论\n* 整合所有发现后，交由推理型大语言模型生成最终报告\n* 报告将写入预先创建的Notion页面\n\n## 使用指南\n\n* 复制此[Notion数据库模板](https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf)，确保所有Notion相关节点指向该库\n* 注册[APIFY.com](https://www.apify.com?fpr=414q6)获取网络搜索与抓取服务的API密钥\n* 确保可使用OpenAI的o3-mini模型，或替换为o1系列模型\n* 必须发布此工作流并确保表单URL可公开访问\n\n## 深度与广度设置说明\n\n更高深度/广度值会产生更详细报告，但将呈指数级增加耗时与成本。默认推荐值通常已足够：\n\n深度=1 & 广度=2：约5-10分钟  \n深度=1 & 广度=3：约15-20分钟  \n深度=3 & 广度=5：可能超过2小时！\n\n## 定制建议\n\n* 未采用Firecrawl等AI抓取工具是因其成本较高且易耗尽配额，但您可自由替换适合自身环境的网络服务\n* 可改为从内部文档而非网络获取数据源\n* 尝试Deepseek、Gemini 2.0等不同推理模型\n* 现有大模型提示词仍有优化空间，请根据需求调整\n\n### 致谢\n\n* 本模板主要基于David Zhang(dzhng)的开源Deep Research实现：<https://github.com/dzhng/deep-research>",
  "title_zh": "使用n8n、Apify和OpenAI o3托管您自己的AI深度研究代理",
  "publish_date_absolute": "",
  "publish_date_zh": "上次更新于一个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"a342005e-a88e-419b-b929-56ecbba4a936\",\n      \"name\": \"Structured Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        1300,\n        1180\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"learnings\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"description\\\": \\\"List of learnings, max of 3.\\\",\\n      \\\"items\\\": { \\\"type\\\": \\\"string\\\" }\\n    },\\n    \\\"followUpQuestions\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"string\\\",\\n        \\\"description\\\": \\\"List of follow-up questions to research the topic further, max of 3.\\\"\\n      }\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"126b8151-6d20-43b8-8028-8163112c4c5b\",\n      \"name\": \"Set Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -1360,\n        -460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"df28b12e-7c20-4ff5-b5b8-dc773aa14d4b\",\n              \"name\": \"request_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $execution.id }}\"\n            },\n            {\n              \"id\": \"9362c1e7-717d-444a-8ea2-6b5f958c9f3f\",\n              \"name\": \"prompt\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json['What would you like to research?'] }}\"\n            },\n            {\n              \"id\": \"09094be4-7844-4a9e-af82-cc8e39322398\",\n              \"name\": \"depth\",\n              \"type\": \"number\",\n              \"value\": \"={{\\n!isNaN($json['input-depth'][0].toNumber())\\n  ? $json['input-depth'][0].toNumber()\\n  : 1\\n}}\"\n            },\n            {\n              \"id\": \"3fc30a30-7806-4013-835d-97e27ddd7ae1\",\n              \"name\": \"breadth\",\n              \"type\": \"number\",\n              \"value\": \"={{\\n!isNaN($json['input-breadth'][0].toNumber())\\n  ? $json['input-breadth'][0].toNumber()\\n  : 1\\n}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"1d0fb87b-263d-46c2-b016-a29ba1d407ab\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1120,\n        1180\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"o3-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"39b300d9-11ba-44f6-8f43-2fe256fe4856\",\n      \"name\": \"OpenAI Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        -860,\n        1760\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"o3-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"018da029-a796-45c5-947c-791e087fe934\",\n      \"name\": \"OpenAI Chat Model2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        -1060,\n        -300\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"o3-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"525da936-a9eb-4523-b27a-ff6ae7b0e5ef\",\n      \"name\": \"Structured Output Parser1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        -840,\n        -300\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"questions\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"description\\\": \\\"Follow up questions to clarify the research direction, max of 3.\\\",\\n      \\\"items\\\": {\\n          \\\"type\\\": \\\"string\\\"\\n      }\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"e6664883-cff4-4e09-881e-6b6f684f9cac\",\n      \"name\": \"On form submission\",\n      \"type\": \"n8n-nodes-base.formTrigger\",\n      \"position\": [\n        -1760,\n        -460\n      ],\n      \"webhookId\": \"026629c8-7644-493c-b830-d9c72eea307d\",\n      \"parameters\": {\n        \"options\": {\n          \"path\": \"deep_research\",\n          \"ignoreBots\": true,\n          \"buttonLabel\": \"Next\"\n        },\n        \"formTitle\": \" DeepResearcher\",\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldType\": \"html\"\n            }\n          ]\n        },\n        \"formDescription\": \"=DeepResearcher is a multi-step, recursive approach using the internet to solve complex research tasks, accomplishing in tens of minutes what a human would take many hours.\\n\\nTo use, provide a short summary of what the research and how \\\"deep\\\" you'd like the workflow to investigate. Note, the higher the numbers the more time and cost will occur for the research.\\n\\nThe workflow is designed to complete independently and when finished, a report will be saved in a designated Notion Database.\"\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"6b8ebc08-c0b1-4af8-99cc-79d09eea7316\",\n      \"name\": \"Generate SERP Queries\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        -1040,\n        820\n      ],\n      \"parameters\": {\n        \"text\": \"=Given the following prompt from the user, generate a list of SERP queries to research the topic.\\nReduce the number of words in each query to its keywords only.\\nReturn a maximum of {{ $('JobType Router').first().json.data.breadth }} queries, but feel free to return less if the original prompt is clear. Make sure each query is unique and not similar to each other: <prompt>{{ $('JobType Router').first().json.data.query.trim() }}</prompt>\\n\\n{{\\n$('JobType Router').first().json.data.learnings.length\\n  ? `Here are some learnings from previous research, use them to generate more specific queries:\\\\n${$('JobType Router').first().json.data.learnings.map(text => `* ${text}`).join('\\\\n')}`\\n  : ''\\n}}\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"type\": \"HumanMessagePromptTemplate\",\n              \"message\": \"=You are an expert researcher. Today is {{ $now.toLocaleString() }}. Follow these instructions when responding:\\n  - You may be asked to research subjects that is after your knowledge cutoff, assume the user is right when presented with news.\\n  - The user is a highly experienced analyst, no need to simplify it, be as detailed as possible and make sure your response is correct.\\n  - Be highly organized.\\n  - Suggest solutions that I didn't think about.\\n  - Be proactive and anticipate my needs.\\n  - Treat me as an expert in all subject matter.\\n  - Mistakes erode my trust, so be accurate and thorough.\\n  - Provide detailed explanations, I'm comfortable with lots of detail.\\n  - Value good arguments over authorities, the source is irrelevant.\\n  - Consider new technologies and contrarian ideas, not just the conventional wisdom.\\n  - You may use high levels of speculation or prediction, just flag it for me.\"\n            }\n          ]\n        },\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"34e1fa5d-bc0c-4b9e-84a7-35db2b08c772\",\n      \"name\": \"Structured Output Parser2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        -860,\n        980\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"queries\\\": {\\n      \\\"type\\\": \\\"array\\\",\\n      \\\"items\\\": {\\n        \\\"type\\\": \\\"object\\\",\\n        \\\"properties\\\": {\\n          \\\"query\\\": {\\n            \\\"type\\\": \\\"string\\\",\\n            \\\"description\\\": \\\"The SERP query\\\"\\n          },\\n          \\\"researchGoal\\\": {\\n            \\\"type\\\": \\\"string\\\",\\n            \\\"description\\\": \\\"First talk about the goal of the research that this query is meant to accomplish, then go deeper into how to advance the research once the results are found, mention additional research directions. Be as specific as possible, especially for additional research directions.\\\"\\n          }\\n        }\\n      }\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"be6dd6a2-aacf-4682-8f13-8ae24c4249a3\",\n      \"name\": \"OpenAI Chat Model3\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        -1040,\n        980\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"o3-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"d5ce6e21-cd07-44fa-b6d0-90bf7531ee01\",\n      \"name\": \"Set Initial Query\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -580,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"acb41e93-70c6-41a3-be0f-e5a74ec3ec88\",\n              \"name\": \"query\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('JobType Router').first().json.data.query }}\"\n            },\n            {\n              \"id\": \"7fc54063-b610-42bc-a250-b1e8847c4d1e\",\n              \"name\": \"learnings\",\n              \"type\": \"array\",\n              \"value\": \"={{ $('JobType Router').first().json.data.learnings }}\"\n            },\n            {\n              \"id\": \"e8f1c158-56fb-41c8-8d86-96add16289bb\",\n              \"name\": \"breadth\",\n              \"type\": \"number\",\n              \"value\": \"={{ $('JobType Router').first().json.data.breadth }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"9de6e4a1-a2b5-4a6f-948e-a0585edcae48\",\n      \"name\": \"SERP to Items\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -700,\n        820\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"output.queries\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2c9c4cdf-942b-494c-83fb-ed5ec37385ee\",\n      \"name\": \"Item Ref\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        -220,\n        1020\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"703c57af-de19-4f00-b580-711a272fa5ca\",\n      \"name\": \"Research Goal + Learnings\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1460,\n        1160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"9acec2cc-64c8-4e62-bed4-c3d9ffab1379\",\n              \"name\": \"researchGoal\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Item Ref').first().json.researchGoal }}\"\n            },\n            {\n              \"id\": \"1b2d2dad-429b-4fc9-96c5-498f572a85c3\",\n              \"name\": \"learnings\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.output.learnings }}\"\n            },\n            {\n              \"id\": \"7025f533-02ab-4031-9413-43390fb61f05\",\n              \"name\": \"followUpQuestions\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output.followUpQuestions }}\"\n            },\n            {\n              \"id\": \"c9e34ea4-5606-46d6-8d66-cb42d772a8b4\",\n              \"name\": \"urls\",\n              \"type\": \"array\",\n              \"value\": \"={{\\n$('Get Markdown + URL')\\n  .all()\\n  .map(item => item.json.url)\\n}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"16ed2835-3af4-45e3-b5a7-e4342d571aa0\",\n      \"name\": \"Accumulate Results\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -200,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"db509e90-9a86-431f-8149-4094d22666cc\",\n              \"name\": \"should_stop\",\n              \"type\": \"boolean\",\n              \"value\": \"={{\\n$runIndex >= ($('JobType Router').first().json.data.depth)\\n}}\"\n            },\n            {\n              \"id\": \"90986e2b-8aca-4a22-a9db-ed8809d6284d\",\n              \"name\": \"all_learnings\",\n              \"type\": \"array\",\n              \"value\": \"={{\\nArray($runIndex+1)\\n  .fill(0)\\n  .flatMap((_,idx) => {\\n    try {\\n      return $('Generate Learnings')\\n        .all(0,idx)\\n        .flatMap(item => item.json.data.flatMap(d => d.learnings))\\n    } catch (e) {\\n      return []\\n    }\\n  })\\n}}\"\n            },\n            {\n              \"id\": \"3eade958-e8ab-4975-aac4-f4a4a983c163\",\n              \"name\": \"all_urls\",\n              \"type\": \"array\",\n              \"value\": \"={{\\nArray($runIndex+1)\\n  .fill(0)\\n  .flatMap((_,idx) => {\\n    try {\\n      return $('Generate Learnings')\\n        .all(0,idx)\\n        .flatMap(item => item.json.data.flatMap(d => d.urls))\\n    } catch (e) {\\n      return []\\n    }\\n  })\\n}}\"\n            }\n          ]\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0011773e-85c6-4fe1-8554-c23ce50706d0\",\n      \"name\": \"DeepResearch Results\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        160,\n        360\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"options\": {},\n        \"jsonOutput\": \"={{ $('Generate Learnings').item.json }}\"\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c0b646d0-1246-4864-8f79-8b7a66e4e083\",\n      \"name\": \"Results to Items\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        320,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3c52ec3e-c952-4b5f-ab12-f1b5d02aba74\",\n      \"name\": \"Set Next Queries\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        480,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"d88bfe95-9e73-4d25-b45c-9f164b940b0e\",\n              \"name\": \"query\",\n              \"type\": \"string\",\n              \"value\": \"=Previous research goal: {{ $json.researchGoal }}\\nFollow-up research directions: {{ $json.followUpQuestions.map(q => `\\\\n${q}`).join('') }}\"\n            },\n            {\n              \"id\": \"4aa20690-d998-458a-b1e4-0d72e6a68e6b\",\n              \"name\": \"learnings\",\n              \"type\": \"array\",\n              \"value\": \"={{ $('Accumulate Results').item.json.all_learnings }}\"\n            },\n            {\n              \"id\": \"89acafae-b04a-4d5d-b08b-656e715654e4\",\n              \"name\": \"breadth\",\n              \"type\": \"number\",\n              \"value\": \"={{ $('JobType Router').first().json.data.breadth }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"bc59dddc-2b03-481f-91c6-ea8aa378eef0\",\n      \"name\": \"For Each Query...\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        -420,\n        860\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"903c31c4-5fdc-4cb6-8baa-402555997266\",\n      \"name\": \"Feedback to Items\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -720,\n        -460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"output.questions\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"59ff671d-5d4f-42ff-b94f-ed30a8531e55\",\n      \"name\": \"Ask Clarity Questions\",\n      \"type\": \"n8n-nodes-base.form\",\n      \"position\": [\n        -360,\n        -380\n      ],\n      \"webhookId\": \"d3375ba6-0008-4fcb-96bc-110374de2603\",\n      \"parameters\": {\n        \"options\": {\n          \"formTitle\": \"DeepResearcher\",\n          \"buttonLabel\": \"Answer\",\n          \"formDescription\": \"=<img\\n  src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw\\\"\\n  width=\\\"100%\\\"\\n  style=\\\"border:1px solid #ccc\\\"\\n/>\\n<p style=\\\"text-align:left\\\">\\nAnswer the following clarification questions to assist the DeepResearcher better under the research topic.\\n</p>\\n<hr style=\\\"display:block;margin-top:16px;margin-bottom:0\\\" />\\n<p style=\\\"text-align:left;font-family:sans-serif;font-weight:700;\\\">\\nTotal {{ $('Feedback to Items').all().length }} questions.\\n</p>\"\n        },\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldType\": \"textarea\",\n              \"fieldLabel\": \"={{ $json[\\\"output.questions\\\"] }}\",\n              \"placeholder\": \"=\",\n              \"requiredField\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1c2cf79b-f1a1-4ecc-bb45-3d4460c947bd\",\n      \"name\": \"For Each Question...\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        -540,\n        -460\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"0c9ffa99-2687-4df5-8581-0c5b0b2657a9\",\n      \"name\": \"DeepResearch Subworkflow\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        -1880,\n        820\n      ],\n      \"parameters\": {\n        \"workflowInputs\": {\n          \"values\": [\n            {\n              \"name\": \"requestId\",\n              \"type\": \"any\"\n            },\n            {\n              \"name\": \"jobType\"\n            },\n            {\n              \"name\": \"data\",\n              \"type\": \"object\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"127ab95d-bf89-4762-bfb5-34521e620ae2\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1140,\n        -680\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1000,\n        \"height\": 560,\n        \"content\": \"## 2. 提出澄清性问题\\n[详细了解表单节点](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.form/)\\n\\n为了处理由大语言模型生成的澄清问题，我采用了与\\\"AI面试官\\\"模板相同的技术（[链接](https://n8n.io/workflows/2566-conversational-interviews-with-ai-agents-and-n8n-forms/)）。该技术通过循环动态生成的表单来收集用户的回答。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e87c0f19-6002-4aa2-931a-ca7546146a84\",\n      \"name\": \"Clarifying Questions\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        -1040,\n        -460\n      ],\n      \"parameters\": {\n        \"text\": \"=Given the following query from the user, ask some follow up questions to clarify the research direction. Return a maximum of 3 questions, but feel free to return less if the original query is clear: <query>{{ $json.prompt }}</query>`\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"type\": \"HumanMessagePromptTemplate\",\n              \"message\": \"=You are an expert researcher. Today is {{ $now.toLocaleString() }}. Follow these instructions when responding:\\n  - You may be asked to research subjects that is after your knowledge cutoff, assume the user is right when presented with news.\\n  - The user is a highly experienced analyst, no need to simplify it, be as detailed as possible and make sure your response is correct.\\n  - Be highly organized.\\n  - Suggest solutions that I didn't think about.\\n  - Be proactive and anticipate my needs.\\n  - Treat me as an expert in all subject matter.\\n  - Mistakes erode my trust, so be accurate and thorough.\\n  - Provide detailed explanations, I'm comfortable with lots of detail.\\n  - Value good arguments over authorities, the source is irrelevant.\\n  - Consider new technologies and contrarian ideas, not just the conventional wisdom.\\n  - You may use high levels of speculation or prediction, just flag it for me.\"\n            }\n          ]\n        },\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"b84f9c4a-c1de-4288-bab2-b7f5ffb8b542\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -660,\n        -60\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1360,\n        \"height\": 640,\n        \"content\": \"## 6. 执行深度搜索循环\\n[了解更多关于n8n中的循环操作](https://docs.n8n.io/flow-logic/looping/#creating-loops)\\n\\n深度研究流程的核心在于其强大的数据收集能力。在本实现方案中，该能力通过递归式网络搜索与抓取循环体现——该循环以初始查询为起点，并通过AI生成的子查询不断扩展。具体生成多少子查询由用户指定的深度（depth）和广度（breadth）参数决定。\\n\\n系统会为每个子查询生成\\\"知识片段\\\"，这些片段会在每次循环迭代中持续累积。当达到预设的深度限制时循环终止，此时所有积累的知识片段将被汇总，最终用于生成研究报告。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0a8c3a01-d4d4-4075-9521-035b7df9aa5a\",\n      \"name\": \"End Form\",\n      \"type\": \"n8n-nodes-base.form\",\n      \"position\": [\n        960,\n        -420\n      ],\n      \"webhookId\": \"88f2534b-2b82-4b40-a4bc-97d96384e8fd\",\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"completion\",\n        \"completionTitle\": \"=Thank you for using DeepResearcher.\",\n        \"completionMessage\": \"=You may now close this window.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"44a3603f-a5a1-4031-8c5f-c748b1007b47\",\n      \"name\": \"Initiate DeepResearch\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        600,\n        -420\n      ],\n      \"parameters\": {\n        \"mode\": \"each\",\n        \"options\": {\n          \"waitForSubWorkflow\": false\n        },\n        \"workflowId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $workflow.id }}\"\n        },\n        \"workflowInputs\": {\n          \"value\": {\n            \"data\": \"={{\\n{\\n  \\\"query\\\": $('Get Initial Query').first().json.query,\\n  \\\"learnings\\\": [],\\n  \\\"depth\\\": $('Set Variables').first().json.depth,\\n  \\\"breadth\\\": $('Set Variables').first().json.breadth,\\n}\\n}}\",\n            \"jobType\": \"deepresearch_initiate\",\n            \"requestId\": \"={{ $('Set Variables').first().json.request_id }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"requestId\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"requestId\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"jobType\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"jobType\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"data\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"data\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": true\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"b243eb76-9ed9-4327-968f-c21844bc9df4\",\n      \"name\": \"Execution Data\",\n      \"type\": \"n8n-nodes-base.executionData\",\n      \"position\": [\n        -1700,\n        820\n      ],\n      \"parameters\": {\n        \"dataToSave\": {\n          \"values\": [\n            {\n              \"key\": \"requestId\",\n              \"value\": \"={{ $json.requestId }}\"\n            },\n            {\n              \"key\": \"=jobType\",\n              \"value\": \"={{ $json.jobType }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"57ca4b22-9349-4b34-8f6b-c502905b5172\",\n      \"name\": \"JobType Router\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        -1520,\n        820\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"initiate\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.jobType }}\",\n                    \"rightValue\": \"deepresearch_initiate\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"learnings\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"ecbfa54d-fc97-48c5-8d3d-f0538b8d727b\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.jobType }}\",\n                    \"rightValue\": \"deepresearch_learnings\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"report\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"392f9a98-ec22-4e57-9c8e-0e1ed6b7dafa\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.jobType }}\",\n                    \"rightValue\": \"deepresearch_report\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"1f880fbd-71ba-4e5b-8d99-9654ae0c949f\",\n      \"name\": \"OpenAI Chat Model4\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        -20,\n        -280\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"o3-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"ea65589b-106f-4ff1-a6f2-763393c2cb07\",\n      \"name\": \"Get Initial Query\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -360,\n        -540\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"14b77741-c3c3-4bd2-be6e-37bd09fcea2b\",\n              \"name\": \"query\",\n              \"type\": \"string\",\n              \"value\": \"=Initial query: {{ $('Set Variables').first().json.prompt }}\\nFollow-up Questions and Answers:\\n{{\\n$input.all()\\n  .map(item => {\\n    const q = Object.keys(item.json)[0];\\n    const a = item.json[q];\\n    return `question: ${q}\\\\nanswer: ${a}`;\\n  })\\n  .join('\\\\n')\\n}}\"\n            }\n          ]\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"09a363f2-6300-430d-8c7e-3e1611ab8e68\",\n      \"name\": \"Structured Output Parser4\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        160,\n        -280\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"title\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\":\\\" A short title summarising the research topic\\\"\\n    },\\n    \\\"description\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"A short description to summarise the research topic\\\"\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"9910804e-8376-4e2e-a011-7d32ca951edf\",\n      \"name\": \"Create Row\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        300,\n        -420\n      ],\n      \"parameters\": {\n        \"title\": \"={{ $json.output.title }}\",\n        \"options\": {},\n        \"resource\": \"databasePage\",\n        \"databaseId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"19486dd6-0c0c-80da-9cb7-eb1468ea9afd\",\n          \"cachedResultUrl\": \"https://www.notion.so/19486dd60c0c80da9cb7eb1468ea9afd\",\n          \"cachedResultName\": \"n8n DeepResearch\"\n        },\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Description|rich_text\",\n              \"textContent\": \"={{ $json.output.description }}\"\n            },\n            {\n              \"key\": \"Status|status\",\n              \"statusValue\": \"Not started\"\n            },\n            {\n              \"key\": \"Request ID|rich_text\",\n              \"textContent\": \"={{ $('Set Variables').first().json.request_id }}\"\n            },\n            {\n              \"key\": \"Name|title\",\n              \"title\": \"={{ $json.output.title }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"iHBHe7ypzz4mZExM\",\n          \"name\": \"Notion account\"\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"9f06d9ae-220d-4f5b-bcbf-761b88ba255c\",\n      \"name\": \"Report Page Generator\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        -20,\n        -420\n      ],\n      \"parameters\": {\n        \"text\": \"=Create a suitable title for the research report which will be created from the user's query.\\n<query>{{ $json.query }}</query>\",\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"5b434bdc-e1e7-4348-b03d-dcbb6a485263\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -120,\n        -680\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 600,\n        \"height\": 560,\n        \"content\": \"## 3. 在Notion中创建空白报告页面\\n[了解更多关于Notion节点的信息](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.notion/)\\n\\n关于最终报告的上传位置经过考量，由于熟悉度选择了Notion。您可以根据偏好轻松更改为任何wiki工具。\\n\\n若您正跟随操作，以下是需要复制的Notion数据库模板 - [Jim的n8n深度研究数据库](https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd?v=19486dd60c0c805c8e0c000ce8c87acf)。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0cfb3548-14a8-4dcc-8362-a7ca1d4c328f\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        500,\n        -680\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 640,\n        \"height\": 560,\n        \"content\": \"## 4. 异步触发深度研究\\n[了解更多关于执行触发器节点的信息](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow/)\\n\\nn8n通过将异步任务拆分为独立执行来处理这类作业。这意味着用户无需保持浏览器窗口开启等待研究人员完成工作。\\n\\n当我们启动深度研究任务后，即可关闭引导流程以提供流畅的用户体验。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b90456d0-fae3-4809-bc13-55649e6e919a\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1160,\n        620\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 620,\n        \"height\": 540,\n        \"content\": \"## 7. 生成搜索查询\\n[深入了解基础LLM节点](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm/)\\n\\n与人类研究者类似，深度研究器（DeepResearcher）将依赖网络搜索和内容作为首选信息来源。为确保能够覆盖广泛的来源，人工智能可首先生成相关研究查询，每个查询均可单独展开探索。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9fd00d55-1c76-425b-8386-7bc5b2bb47ac\",\n      \"name\": \"Is Depth Reached?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -40,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"75d18d88-6ba6-43df-bef7-3e8ad99ad8bd\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.should_stop }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"f658537b-4f4c-4427-a66f-56cfd950bffc\",\n      \"name\": \"Get Research Results\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        160,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"90b3da00-dcd5-4289-bd45-953146a3b0ba\",\n              \"name\": \"all_learnings\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.all_learnings }}\"\n            },\n            {\n              \"id\": \"623dbb3d-83a1-44a9-8ad3-48d92bc42811\",\n              \"name\": \"all_urls\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.all_urls }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"6059f3ba-e4a0-4528-894c-6080eedb91c3\",\n      \"name\": \"Get Existing Row\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        -1040,\n        180\n      ],\n      \"parameters\": {\n        \"limit\": 1,\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"key\": \"Request ID|rich_text\",\n              \"condition\": \"equals\",\n              \"richTextValue\": \"={{ $json.requestId.toString() }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"resource\": \"databasePage\",\n        \"matchType\": \"allFilters\",\n        \"operation\": \"getAll\",\n        \"databaseId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"19486dd6-0c0c-80da-9cb7-eb1468ea9afd\",\n          \"cachedResultUrl\": \"https://www.notion.so/19486dd60c0c80da9cb7eb1468ea9afd\",\n          \"cachedResultName\": \"n8n DeepResearch\"\n        },\n        \"filterType\": \"manual\"\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"iHBHe7ypzz4mZExM\",\n          \"name\": \"Notion account\"\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"100625bb-bf9a-4993-b387-1c61e486ba6d\",\n      \"name\": \"Set In-Progress\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        -840,\n        180\n      ],\n      \"parameters\": {\n        \"pageId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.id }}\"\n        },\n        \"options\": {},\n        \"resource\": \"databasePage\",\n        \"operation\": \"update\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Status|status\",\n              \"statusValue\": \"In progress\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"iHBHe7ypzz4mZExM\",\n          \"name\": \"Notion account\"\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"864332ea-dd25-4347-a49d-68ed6495c1a9\",\n      \"name\": \"Set Done\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1680,\n        1600\n      ],\n      \"parameters\": {\n        \"pageId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Get Existing Row1').first().json.id }}\"\n        },\n        \"options\": {},\n        \"resource\": \"databasePage\",\n        \"operation\": \"update\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Status|status\",\n              \"statusValue\": \"Done\"\n            },\n            {\n              \"key\": \"Last Updated|date\",\n              \"date\": \"={{ $now.toISO() }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"iHBHe7ypzz4mZExM\",\n          \"name\": \"Notion account\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"6771568a-e6bd-4c89-a535-089fd1c18fc3\",\n      \"name\": \"Tags to Items\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -60,\n        1600\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"tag\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"47fce580-7b5b-4bc6-ba52-a8e7af6595b5\",\n      \"name\": \"Convert to HTML\",\n      \"type\": \"n8n-nodes-base.markdown\",\n      \"position\": [\n        -380,\n        1600\n      ],\n      \"parameters\": {\n        \"mode\": \"markdownToHtml\",\n        \"options\": {\n          \"tables\": true\n        },\n        \"markdown\": \"={{ $json.text }}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e2fb5a31-9ca5-487b-a7f8-f020759ec53a\",\n      \"name\": \"HTML to Array\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -220,\n        1600\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"851b8a3f-c2d3-41ad-bf60-4e0e667f6c58\",\n              \"name\": \"tag\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.data.match(/<table[\\\\s\\\\S]*?<\\\\/table>|<ul[\\\\s\\\\S]*?<\\\\/ul>|<[^>]+>[^<]*<\\\\/[^>]+>/g) }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"5275f9dd-5420-4c59-a330-5f2775b47e51\",\n      \"name\": \"Notion Block Generator\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        100,\n        1600\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $json.tag.trim() }}\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"=Convert the following html into its equivalent Notion Block as per Notion's API schema.\\n* Ensure the content is always included and remains the same.\\n* Return only a json response.\\n* Generate child-level blocks. Should not define \\\"parent\\\" or \\\"children\\\" property.\\n* Strongly prefer headings, paragraphs, tables and lists type blocks.\\n* available headings are heading_1, heading_2 and heading_3 - h4,h5,h6 should use heading_3 type instead. ensure headings use the rich text definition.\\n* ensure lists blocks include all list items.\\n\\n## Examples\\n\\n1. headings\\n```\\n<h3 id=\\\"references\\\">References</h3>\\n```\\nwould convert to \\n```\\n{\\\"object\\\":  \\\"block\\\", \\\"type\\\": \\\"heading_3\\\", \\\"heading_3\\\": { \\\"rich_text\\\": [{\\\"type\\\": \\\"text\\\",\\\"text\\\": {\\\"content\\\": \\\"References\\\"}}]}}\\n```\\n\\n2. lists\\n```\\n<ul><li>hello</li><li>world</li></ul>\\n```\\nwould convert to\\n```\\n[\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"bulleted_list_item\\\",\\n  \\\"bulleted_list_item\\\": {\\\"rich_text\\\": [{\\\"type\\\": \\\"text\\\",\\\"text\\\": {\\\"content\\\": \\\"hello\\\"}}]}\\n},\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"bulleted_list_item\\\",\\n  \\\"bulleted_list_item\\\": {\\\"rich_text\\\": [{\\\"type\\\": \\\"text\\\",\\\"text\\\": {\\\"content\\\": \\\"world\\\"}}]}\\n}\\n]\\n```\\n\\n3. tables\\n```\\n<table>\\n  <thead>\\n    <tr><th>Technology</th><th>Potential Impact</th></tr>\\n  </thead>\\n  <tbody>\\n    <tr>\\n      <td>5G Connectivity</td><td>Enables faster data speeds and advanced apps</td>\\n    </tr>\\n  </tbody>\\n</table>\\n```\\nwould convert to\\n```\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"table\\\",\\n  \\\"table\\\": {\\n    \\\"table_width\\\": 2,\\n    \\\"has_column_header\\\": true,\\n    \\\"has_row_header\\\": false,\\n    \\\"children\\\": [\\n      {\\n        \\\"object\\\": \\\"block\\\",\\n        \\\"type\\\": \\\"table_row\\\",\\n        \\\"table_row\\\": {\\n          \\\"cells\\\": [\\n            [\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"Technology\\\",\\n                  \\\"link\\\": null\\n                }\\n              },\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"Potential Impact\\\",\\n                  \\\"link\\\": null\\n                }\\n              }\\n            ],\\n            [\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"5G Connectivity\\\",\\n                  \\\"link\\\": null\\n                }\\n              },\\n              {\\n                \\\"type\\\": \\\"text\\\",\\n                \\\"text\\\": {\\n                  \\\"content\\\": \\\"Enables faster data speeds and advanced apps\\\",\\n                  \\\"link\\\": null\\n                }\\n              }\\n            ]\\n          ]\\n        }\\n      }\\n    ]\\n  }\\n}\\n```\\n4. anchor links\\nSince Notion doesn't support anchor links, just convert them to rich text blocks instead.\\n```\\n<a href=\\\"#module-0-pre-course-setup-and-learning-principles\\\">Module 0: Pre-Course Setup and Learning Principles</a>\\n```\\nconverts to\\n```\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"paragraph\\\",\\n  \\\"paragraph\\\": {\\n    \\\"rich_text\\\": [\\n      {\\n        \\\"type\\\": \\\"text\\\",\\n        \\\"text\\\": {\\n          \\\"content\\\": \\\"Module 0: Pre-Course Setup and Learning Principles\\\"\\n        }\\n      }\\n    ]\\n  }\\n}\\n```\\n5. Invalid html parts\\nWhen the html is not syntax valid eg. orphaned closing tags, then just skip the conversion and use an empty rich text block.\\n```\\n</li>\\\\n</ol>\\n```\\ncan be substituted with\\n```\\n{\\n  \\\"object\\\": \\\"block\\\",\\n  \\\"type\\\": \\\"paragraph\\\",\\n  \\\"paragraph\\\": {\\n    \\\"rich_text\\\": [\\n      {\\n        \\\"type\\\": \\\"text\\\",\\n        \\\"text\\\": {\\n          \\\"content\\\": \\\" \\\"\\n        }\\n      }\\n    ]\\n  }\\n}\\n```\"\n            }\n          ]\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"30e73ecf-5994-4229-b7f6-01e043e0e65b\",\n      \"name\": \"Google Gemini Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        80,\n        1760\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"dSxo6ns5wn658r8N\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"85ce9f7e-0369-41bd-8c31-c4217f400472\",\n      \"name\": \"Parse JSON blocks\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        420,\n        1600\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"73fcb8a0-2672-4bd5-86de-8075e1e02baf\",\n              \"name\": \"=block\",\n              \"type\": \"array\",\n              \"value\": \"={{\\n(function(){\\n  const block = $json.text\\n    .replace('```json', '')\\n    .replace('```', '')\\n    .trim()\\n    .parseJson();\\n  if (Array.isArray(block)) return block;\\n  if (block.type.startsWith('heading_')) {\\n    const prev = Number(block.type.split('_')[1]);\\n    const next = Math.max(1, prev - 1);\\n    if (next !== prev) {\\n      block.type = `heading_${next}`;\\n      block[`heading_${next}`] = Object.assign({}, block[`heading_${prev}`]);\\n      block[`heading_${prev}`] = undefined;\\n    }\\n  }\\n  return [block];\\n})()\\n}}\"\n            }\n          ]\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"349f4323-d65f-4845-accc-6f51340a84c4\",\n      \"name\": \"Upload to Notion Page\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueRegularOutput\",\n      \"maxTries\": 2,\n      \"position\": [\n        1680,\n        1760\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.notion.com/v1/blocks/{{ $('Get Existing Row1').first().json.id }}/children\",\n        \"method\": \"PATCH\",\n        \"options\": {\n          \"timeout\": \"={{ 1000 * 60 }}\"\n        },\n        \"jsonBody\": \"={{\\n{\\n  \\\"children\\\": $json.block\\n}\\n}}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Notion-Version\",\n              \"value\": \"2022-06-28\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"notionApi\"\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"iHBHe7ypzz4mZExM\",\n          \"name\": \"Notion account\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 4.2,\n      \"waitBetweenTries\": 3000\n    },\n    {\n      \"id\": \"44c732a9-b805-432e-8e9c-ba279e4cca46\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -520,\n        620\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1340,\n        \"height\": 740,\n        \"content\": \"## 8. 使用[APIFY.com](https://www.apify.com?fpr=414q6)进行网页搜索与内容抓取\\n[详细了解HTTP请求节点](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/)\\n\\n此处我略微调整了参考实现方案。考虑到（1）服务成本过高（2）常规非AI爬虫同样有效且可能更快，我选择不使用Firecrawl.ai，转而采用性能更优、性价比更高且更可靠的网页抓取服务[APIFY.com](https://www.apify.com?fpr=414q6)。当然，您完全可以根据偏好替换为其他服务。\\n\\n这个环节在优化改进方面最具想象空间——例如混入内部数据源！整合Perplexity.ai或Jina.ai！可能性是无限的。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"daf2e775-72d3-4366-882b-8c9eb65f11e8\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1140,\n        60\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 460,\n        \"height\": 360,\n        \"content\": \"## 5. 将报告状态设为进行中\\n[了解更多关于Notion节点的信息](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.notion/)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2d1b394d-8b9a-43fc-a646-c4e05c92da5b\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        860,\n        780\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 800,\n        \"height\": 580,\n        \"content\": \"## 9. 使用推理模型整合学习成果\\n[详细了解基础LLM节点](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm/)\\n\\n收集完所有资料来源后，现在只需将其输入大型语言模型（LLM）来整理出一份\\\"学习成果\\\"清单。我们的DeepResearcher将采用OpenAI最新推出的o3-mini推理模型（截至本文撰写时）。由于具备思维链（chain-of-thought）或\\\"思考\\\"处理机制，推理模型的性能优于常规聊天模型。\\n\\n最终，这些\\\"学习成果\\\"将与生成的研究目标相结合，从而完成一个完整的研究闭环。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e2c29aa2-ff79-4bdd-b3c7-cf5e5866db8a\",\n      \"name\": \"Get Existing Row1\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        -1020,\n        1600\n      ],\n      \"parameters\": {\n        \"limit\": 1,\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"key\": \"Request ID|rich_text\",\n              \"condition\": \"equals\",\n              \"richTextValue\": \"={{ $json.requestId.toString() }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"resource\": \"databasePage\",\n        \"matchType\": \"allFilters\",\n        \"operation\": \"getAll\",\n        \"databaseId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"19486dd6-0c0c-80da-9cb7-eb1468ea9afd\",\n          \"cachedResultUrl\": \"https://www.notion.so/19486dd60c0c80da9cb7eb1468ea9afd\",\n          \"cachedResultName\": \"n8n DeepResearch\"\n        },\n        \"filterType\": \"manual\"\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"iHBHe7ypzz4mZExM\",\n          \"name\": \"Notion account\"\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"9dff368e-c282-4fef-8894-e218ea266695\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1140,\n        1400\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 660,\n        \"height\": 540,\n        \"content\": \"## 10. 运用学习成果生成深度搜索报告\\n[详细了解基础LLM节点](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm/)\\n\\n终于！在收集完所有学习成果后——使用较高配置时可能需要耗时一小时甚至更久！——我们将这些成果输入大型语言模型，最终生成一份Markdown格式的研究报告。从技术上讲，深度研究到此结束，但在此模板中，我们还需将输出内容推送至Notion。若您不使用Notion，可直接忽略后续步骤。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"14bfd0fd-6bc4-4dbf-86b2-44ef1c3586f7\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -460,\n        1400\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1060,\n        \"height\": 540,\n        \"content\": \"## 11. 将报告重构为Notion区块格式\\n[了解更多关于Markdown节点的信息](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.markdown/)\\n\\n为了将报告写入Notion页面，我们需要将其转换为Notion特有的\\\"区块\\\"格式——这些是由Notion API要求的特定JSON对象。虽然存在多种无需借助AI即可完成此转换的方法，但出于兴趣，我还是决定采用AI处理。在此步骤中，我们首先将报告转换为HTML格式，这样既能按语义分割内容，也便于大型语言模型进行解析。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a2aff56d-78b9-40a4-ac78-bd8380802ea0\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1220,\n        1400\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 800,\n        \"height\": 580,\n        \"content\": \"## 13. 在Notion中更新报告\\n[了解更多关于HTTP请求节点的信息](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/)\\n\\n在此步骤中，我们可以利用Notion API将内容块依次添加到页面。由于Notion API的不稳定性，这里采用了循环机制——该循环允许对需要重试的块进行多次尝试。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b5beeccd-e498-48ed-b6f2-b29d4599e2c9\",\n      \"name\": \"Sticky Note11\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1840,\n        -680\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 680,\n        \"height\": 560,\n        \"content\": \"## 1. 一起来研究吧！\\n[了解更多表单触发节点的信息](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.formtrigger)\\n\\nn8n表单能让我们快速搭建起前端界面，与聊天功能相比，它为用户的输入提供了更优秀的用户界面。虽然我在自定义HTML字段上可能有些过度发挥，但我确实喜欢时不时添加一些个性化元素。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"533ede84-1138-426c-93df-c2b862e2d063\",\n      \"name\": \"DeepResearch Report\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        -860,\n        1600\n      ],\n      \"parameters\": {\n        \"text\": \"=You are are an expert and insightful researcher.\\n* Given the following prompt from the user, write a final report on the topic using the learnings from research.\\n* Make it as as detailed as possible, aim for 3 or more pages, include ALL the learnings from research.\\n* Format the report in markdown. Use headings, lists and tables only and where appropriate.\\n\\n<prompt>{{ $('JobType Router').first().json.data.query }}</prompt>\\n\\nHere are all the learnings from previous research:\\n\\n<learnings>\\n{{\\n$('JobType Router').first().json.data\\n  .all_learnings\\n  .map(item => `<learning>${item}</learning>`)  \\n  .join('\\\\n')\\n}}\\n</learnings>\",\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"efe47725-7fd5-45e7-97c4-d6c133745e5f\",\n      \"name\": \"DeepResearch Learnings\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        1120,\n        1020\n      ],\n      \"parameters\": {\n        \"text\": \"=Given the following contents from a SERP search for the query <query>{{ $('Item Ref').first().json.query }}</query>, generate a list of learnings from the contents. Return a maximum of 3 learnings, but feel free to return less if the contents are clear. Make sure each learning is unique and not similar to each other. The learnings should be concise and to the point, as detailed and infromation dense as possible. Make sure to include any entities like people, places, companies, products, things, etc in the learnings, as well as any exact metrics, numbers, or dates. The learnings will be used to research the topic further.\\n\\n<contents>\\n{{\\n$input\\n  .all()\\n  .map(item =>`<content>\\\\n${item.json.markdown.substr(0, 25_000)}\\\\n</content>`)\\n  .join('\\\\n')\\n}}\\n</contents>\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"type\": \"HumanMessagePromptTemplate\",\n              \"message\": \"=You are an expert researcher. Today is {{ $now.toLocaleString() }}. Follow these instructions when responding:\\n  - You may be asked to research subjects that is after your knowledge cutoff, assume the user is right when presented with news.\\n  - The user is a highly experienced analyst, no need to simplify it, be as detailed as possible and make sure your response is correct.\\n  - Be highly organized.\\n  - Suggest solutions that I didn't think about.\\n  - Be proactive and anticipate my needs.\\n  - Treat me as an expert in all subject matter.\\n  - Mistakes erode my trust, so be accurate and thorough.\\n  - Provide detailed explanations, I'm comfortable with lots of detail.\\n  - Value good arguments over authorities, the source is irrelevant.\\n  - Consider new technologies and contrarian ideas, not just the conventional wisdom.\\n  - You may use high levels of speculation or prediction, just flag it for me.\"\n            }\n          ]\n        },\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"d3b42d13-e8ca-4085-ace9-1d9fb53f5e71\",\n      \"name\": \"Generate Report\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        480,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"waitForSubWorkflow\": false\n        },\n        \"workflowId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $workflow.id }}\"\n        },\n        \"workflowInputs\": {\n          \"value\": {\n            \"data\": \"={{\\n{\\n  ...Object.assign({}, $json),\\n  query: $('JobType Router').first().json.data.query\\n}\\n}}\",\n            \"jobType\": \"deepresearch_report\",\n            \"requestId\": \"={{ $('JobType Router').first().json.requestId }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"requestId\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"requestId\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"jobType\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"jobType\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"data\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"data\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": true\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"2b0314ff-cd82-4b3b-a4a9-5fd8067391eb\",\n      \"name\": \"Generate Learnings\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        -380,\n        180\n      ],\n      \"parameters\": {\n        \"mode\": \"each\",\n        \"options\": {\n          \"waitForSubWorkflow\": true\n        },\n        \"workflowId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $workflow.id }}\"\n        },\n        \"workflowInputs\": {\n          \"value\": {\n            \"data\": \"={{ $json }}\",\n            \"jobType\": \"deepresearch_learnings\",\n            \"requestId\": \"={{ $('JobType Router').first().json.requestId }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"requestId\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"requestId\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"jobType\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"jobType\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"data\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"data\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": true\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"f4457d0b-d708-4bca-9973-46d96ed55826\",\n      \"name\": \"Confirmation\",\n      \"type\": \"n8n-nodes-base.form\",\n      \"position\": [\n        780,\n        -420\n      ],\n      \"webhookId\": \"2eb17c47-c887-4e95-8641-1b3796452ab9\",\n      \"parameters\": {\n        \"options\": {\n          \"formTitle\": \"DeepResearcher\",\n          \"buttonLabel\": \"Done\",\n          \"formDescription\": \"=<img\\n  src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw\\\"\\n  width=\\\"100%\\\"\\n  style=\\\"border:1px solid #ccc\\\"\\n/>\\n<p style=\\\"text-align:left\\\">\\n<strong style=\\\"display:block;font-family:sans-serif;font-weight:700;font-size:16px;margin-top:12px;margin-bottom:0;\\\">Your Report Is On Its Way!</strong>\\n<br/>\\nDeepResearcher will now work independently to conduct the research and the compiled report will be uploaded to the following Notion page below when finished.\\n<br/><br/>\\nPlease click the \\\"Done\\\" button to complete the form.\\n</p>\\n<hr style=\\\"display:block;margin-top:16px;margin-bottom:0\\\" />\"\n        },\n        \"formFields\": {\n          \"values\": [\n            {\n              \"html\": \"=<a href=\\\"{{ $json.url }}\\\" style=\\\"text-decoration:none\\\" target=\\\"_blank\\\">\\n<div style=\\\"display:flex;text-align:left;font-family:sans-serif;\\\">\\n  <div style=\\\"width:150px;height:150px;padding:12px;\\\">\\n    <img src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/cajjymprexcoesu4gg9g\\\" width=\\\"100%\\\" />\\n  </div>\\n  <div style=\\\"width:100%;padding:12px;\\\">\\n    <div style=\\\"font-size:14px;font-weight:700\\\">{{ $json.name }}</div>\\n    <div style=\\\"font-size:12px;color:#666\\\">\\n      {{ $json.property_description }}\\n    </div>\\n  </div>\\n</div>\\n</a>\",\n              \"fieldType\": \"html\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"af8fe17a-4314-4e92-ad8e-8be0be62984b\",\n      \"name\": \"Research Request\",\n      \"type\": \"n8n-nodes-base.form\",\n      \"position\": [\n        -1560,\n        -460\n      ],\n      \"webhookId\": \"46142c14-3692-40f6-80e5-f3d976e95191\",\n      \"parameters\": {\n        \"options\": {\n          \"formTitle\": \"DeepResearcher\",\n          \"formDescription\": \"=<img\\n  src=\\\"https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw\\\"\\n  width=\\\"100%\\\"\\n  style=\\\"border:1px solid #ccc\\\"\\n/>\"\n        },\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldType\": \"textarea\",\n              \"fieldLabel\": \"What would you like to research?\",\n              \"requiredField\": true\n            },\n            {\n              \"html\": \"<video\\n    style=\\\"display:none\\\"\\n    src=\\\"/when_will_n8n_support_range_sliders.mp4\\\"\\n    onerror='\\n  this.insertAdjacentHTML(`afterend`,\\n  `<div class=\\\"form-group\\\" style=\\\"margin-bottom:16px;\\\">\\n    <label class=\\\"form-label\\\" for=\\\"breadth\\\">\\n      Enter research depth (Default 1)\\n    </label>\\n    <p style=\\\"font-size:12px;color:#666;text-align:left\\\">\\n      This value determines how many sub-queries to generate.\\n    </p>\\n    <input\\n      class=\\\"form-input\\\"\\n      type=\\\"range\\\"\\n      id=\\\"depth\\\"\\n      name=\\\"field-1\\\"\\n      value=\\\"1\\\"\\n      step=\\\"1\\\"\\n      max=\\\"5\\\"\\n      min=\\\"1\\\"\\n      list=\\\"depth-markers\\\"\\n    >\\n    <datalist\\n      id=\\\"depth-markers\\\"\\n      style=\\\"display: flex;\\n      flex-direction: row;\\n      justify-content: space-between;\\n      writing-mode: horizontal-tb;\\n      margin-top: -10px;\\n      text-align: center;\\n      font-size: 10px;\\n      margin-left: 16px;\\n      margin-right: 16px;\\\"\\n    >\\n      <option value=\\\"1\\\" label=\\\"1\\\"></option>\\n      <option value=\\\"2\\\" label=\\\"2\\\"></option>\\n      <option value=\\\"3\\\" label=\\\"3\\\"></option>\\n      <option value=\\\"4\\\" label=\\\"4\\\"></option>\\n      <option value=\\\"5\\\" label=\\\"5\\\"></option>\\n    </datalist>\\n  </div>`)\\n  '\\n/>\",\n              \"fieldType\": \"html\",\n              \"elementName\": \"input-depth\"\n            },\n            {\n              \"html\": \"<video\\n    style=\\\"display:none\\\"\\n    src=\\\"/when_will_n8n_support_range_sliders.mp4\\\"\\n    onerror='\\n  this.insertAdjacentHTML(`afterend`,\\n  `<div class=\\\"form-group\\\" style=\\\"margin-bottom:16px;\\\">\\n    <label class=\\\"form-label\\\" for=\\\"breadth\\\">\\n      Enter research breadth (Default 2)\\n    </label>\\n    <p style=\\\"font-size:12px;color:#666;text-align:left\\\">\\n      This value determines how many sources to explore.\\n    </p>\\n    <input\\n      class=\\\"form-input\\\"\\n      type=\\\"range\\\"\\n      id=\\\"breadth\\\"\\n      name=\\\"field-2\\\"\\n      value=\\\"2\\\"\\n      step=\\\"1\\\"\\n      max=\\\"5\\\"\\n      min=\\\"1\\\"\\n      list=\\\"breadth-markers\\\"\\n    >\\n    <datalist\\n      id=\\\"breadth-markers\\\"\\n      style=\\\"display: flex;\\n      flex-direction: row;\\n      justify-content: space-between;\\n      writing-mode: horizontal-tb;\\n      margin-top: -10px;\\n      text-align: center;\\n      font-size: 10px;\\n      margin-left: 16px;\\n      margin-right: 16px;\\\"\\n    >\\n      <option value=\\\"1\\\" label=\\\"1\\\"></option>\\n      <option value=\\\"2\\\" label=\\\"2\\\"></option>\\n      <option value=\\\"3\\\" label=\\\"3\\\"></option>\\n      <option value=\\\"4\\\" label=\\\"4\\\"></option>\\n      <option value=\\\"5\\\" label=\\\"5\\\"></option>\\n    </datalist>\\n  </div>`)\\n  '\\n/>\\n\",\n              \"fieldType\": \"html\",\n              \"elementName\": \"input-breadth\"\n            },\n            {\n              \"fieldType\": \"dropdown\",\n              \"fieldLabel\": \"={{ \\\"\\\" }}\",\n              \"multiselect\": true,\n              \"fieldOptions\": {\n                \"values\": [\n                  {\n                    \"option\": \"=I understand higher depth and breath values I've selected may incur longer wait times and higher costs. I acknowledging this and wish to proceed with the research request.\"\n                  }\n                ]\n              },\n              \"requiredField\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c67a5e5c-f82b-4e8a-9c99-065d16dfa576\",\n      \"name\": \"Valid Blocks\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        740,\n        1600\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"f68cefe0-e109-4d41-9aa3-043f3bc6c449\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notExists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.error }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"b89cf700-d955-4de4-bbac-b5c55995a1ee\",\n      \"name\": \"Sticky Note12\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        620,\n        1400\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 580,\n        \"height\": 580,\n        \"content\": \"## 12. 附加URL来源列表\\n[进一步了解代码节点](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code)\\n\\n对于我们的来源URL，我们将手动为它们构建Notion模块——这通常是因为数量庞大！随后，我们会将这些模块附加到其他模块的末尾。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"70c898a1-a757-452d-83ef-de1998fe13ae\",\n      \"name\": \"Append Blocks\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1000,\n        1760\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"591a3fcd-1748-43f7-9766-bc2059c195a0\",\n      \"name\": \"URL Sources to Lists\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        740,\n        1760\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const urls = Object.values($('JobType Router').first().json.data.all_urls\\n  .reduce((acc, url) => ({ ...acc, [url]: url }),{}));\\nconst chunksize = 50;\\nconst splits = Math.max(1, Math.floor(urls.length/chunksize));\\n\\nconst blocks = Array(splits).fill(0)\\n  .map((_, idx) => {\\n    const block = urls\\n      .slice(\\n        idx * chunksize, \\n        (idx * chunksize) + chunksize - 1\\n      )\\n      .map(url => {\\n        return {\\n          object: \\\"block\\\",\\n          type: \\\"bulleted_list_item\\\",\\n          bulleted_list_item: {\\n            rich_text: [\\n              { type: \\\"text\\\", text: { content: url } }\\n            ]\\n          }\\n        }\\n      });\\n    return { json: { block } }\\n  });\\n\\nreturn [\\n  { json: {\\n    block:[{\\n      \\\"object\\\": \\\"block\\\",\\n      \\\"type\\\": \\\"heading_2\\\",\\n      \\\"heading_2\\\": {\\n        \\\"rich_text\\\": [\\n          {\\n            \\\"type\\\": \\\"text\\\",\\n            \\\"text\\\": {\\n              \\\"content\\\": \\\"Sources\\\"\\n            }\\n          }\\n        ]\\n      }\\n    }]\\n  } },\\n  ...blocks\\n];\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"e59dbeea-ccf3-4619-9fe1-24874a91bdab\",\n      \"name\": \"Empty Response\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        640,\n        1160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"1de40158-338b-4db3-9e22-6fd63b21f825\",\n              \"name\": \"ResearchGoal\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Item Ref').first().json.researchGoal }}\"\n            },\n            {\n              \"id\": \"9f59a2d4-5e5a-4d0b-8adf-2832ce746f0f\",\n              \"name\": \"learnings\",\n              \"type\": \"array\",\n              \"value\": \"={{ [] }}\"\n            },\n            {\n              \"id\": \"972ab5f5-0537-4755-afcb-d1db4f09ad60\",\n              \"name\": \"followUpQuestions\",\n              \"type\": \"array\",\n              \"value\": \"={{ [] }}\"\n            },\n            {\n              \"id\": \"90cef471-76b0-465d-91a4-a0e256335cd3\",\n              \"name\": \"urls\",\n              \"type\": \"array\",\n              \"value\": \"={{ [] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"34035b2e-eee9-483e-8125-3b6f1f41cd1d\",\n      \"name\": \"Has Content?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        480,\n        1020\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"1ef1039a-4792-47f9-860b-d2ffcffd7129\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"5e9f80e2-db58-4f89-8aec-a1b8e73e18eb\",\n      \"name\": \"Sticky Note13\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1820,\n        -240\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 300,\n        \"height\": 100,\n        \"content\": \"### 不使用表单？\\n随意替换为聊天功能或甚至网络钩子，以适应您现有的工作流程。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3e513463-2f4c-4e3e-921d-e5c8ea5ec078\",\n      \"name\": \"Sticky Note14\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1880,\n        540\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 460,\n        \"height\": 240,\n        \"content\": \"### 🚏 子工作流事件模式  \\n如果你是n8n的新手，这个高级技巧可能需要一些解释，但简而言之，我们正在使用子工作流来将DeepResearcher工作流的不同部分作为独立的执行来运行。\\n\\n* 必须实现递归循环机制以支持此工作流。  \\n* 无需将此工作流拆分为多个模板。  \\n* 通常非常适合构建高性能的n8n工作流（这是未来文章的主题！）\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fea2568e-86c9-4663-b141-a9b2a36b84f5\",\n      \"name\": \"Sticky Note15\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        720,\n        -60\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 340,\n        \"height\": 200,\n        \"content\": \"### 递归循环\\n本工作流实现的递归循环是一种高级项目链接技术。其核心原理在于精确控制节点\\\"单次执行\\\"与\\\"逐项执行\\\"的模式切换，因此移除节点时需格外谨慎！替换节点时务必核对原始节点的配置参数，确保新旧设置完全匹配。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fd3fec73-4b1a-4882-8c5a-d4825d9038ad\",\n      \"name\": \"Combine & Send back to Loop\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        -220,\n        860\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7c183897-e2ce-46da-90bd-0a39122b85f2\",\n      \"name\": \"For Each Block...\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        1440,\n        1600\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"bc04462a-780c-48e9-bc38-8eaf8ac1175c\",\n      \"name\": \"Sticky Note16\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -2420,\n        -920\n      ],\n      \"parameters\": {\n        \"width\": 520,\n        \"height\": 1060,\n        \"content\": \"## n8n深度研究模板  \\n### 本模板试图复现OpenAI的DeepResearch功能（该功能目前仅限专业版用户使用）  \\n\\n虽然DeepResearch的内部机制尚未公开，但推测其依赖深度网络搜索、网页内容抓取及推理模型调用来生成报告——这些恰恰是n8n的强项！  \\n\\n### 运作原理  \\n* 通过表单收集用户的研究主题及所需研究深度  \\n* 提交后自动创建空白Notion页面作为报告容器，并启动研究流程  \\n* 对用户查询进行递归式网络搜索和内容抓取，生成阶段性研究成果  \\n* 整合所有发现后，交由推理型大语言模型生成最终报告  \\n* 报告将写入预先创建的Notion页面  \\n\\n### 使用指南  \\n* 复制此Notion数据库模板：https://jimleuk.notion.site/19486dd60c0c80da9cb7eb1468ea9afd  \\n* 注册[APIFY.com](https://www.apify.com?fpr=414q6)获取网页搜索与抓取API密钥  \\n* 确保有权使用OpenAI的o3-mini模型（可替换为o1系列）  \\n* 必须发布工作流并确保表单URL可公开访问  \\n\\n### 深度与广度参数说明  \\n提升参数值可获得更详尽的报告，但将导致耗时和成本呈指数级增长（默认值通常已足够）：  \\n- 深度1 & 广度2：约5-10分钟  \\n- 深度1 & 广度3：约15-20分钟  \\n- 深度3 & 广度5：可能超过2小时！  \\n\\n### 获取帮助  \\n加入[Discord讨论组](https://discord.com/invite/XPKeKXeB7d)或访问[官方论坛](https://community.n8n.io/)  \\n\\n祝您探索愉快！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"654362c8-bc85-47d1-b277-50630f6f3999\",\n      \"name\": \"Sticky Note17\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -2420,\n        -1180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 520,\n        \"height\": 240,\n        \"content\": \"![](https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto/v1/n8n-workflows/o4wqztloz3j6okfxpeyw#full-width)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c2ddbec3-4579-4d4e-81bf-293c9eee9b73\",\n      \"name\": \"Sticky Note18\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -80,\n        1000\n      ],\n      \"parameters\": {\n        \"width\": 180,\n        \"height\": 260,\n        \"content\": \"### 更新APIFY凭证在此处！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"43461d7d-1a04-424a-b2b0-4a4cbc46f1c2\",\n      \"name\": \"Sticky Note20\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1640,\n        1740\n      ],\n      \"parameters\": {\n        \"width\": 180,\n        \"height\": 260,\n        \"content\": \"更新Notion凭证信息！\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"48b83b0f-94e7-44e2-8bd4-0addddd62264\",\n      \"name\": \"Valid Results\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        300,\n        1020\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"f44691e4-f753-47b0-b66a-068a723b6beb\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.crawl.requestStatus }}\",\n              \"rightValue\": \"handled\"\n            },\n            {\n              \"id\": \"8e05df2b-0d4a-47da-9aab-da7e8907cbca\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.markdown }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"6124becb-2584-472d-8354-b714d9f1e858\",\n      \"name\": \"RAG Web Browser\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        -40,\n        1020\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.apify.com/v2/acts/apify~rag-web-browser/run-sync-get-dataset-items\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"query\",\n              \"value\": \"={{\\n`${$json.query} -filetype:pdf (-site:tiktok.com OR -site:instagram.com OR -site:youtube.com OR -site:linkedin.com OR -site:reddit.com)`\\n}}\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"memory\",\n              \"value\": \"4096\"\n            },\n            {\n              \"name\": \"timeout\",\n              \"value\": \"180\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpQueryAuth\": {\n          \"id\": \"cO2w8RDNOZg8DRa8\",\n          \"name\": \"Apify API\"\n        },\n        \"httpHeaderAuth\": {\n          \"id\": \"SV9BDKc1cRbZBeoL\",\n          \"name\": \"Apify.com (personal token)\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"749a5d4d-85ae-4ee3-a79b-6659af666a3a\",\n      \"name\": \"Get Markdown + URL\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        940,\n        1020\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"c41592db-f9f0-4228-b6d8-0514c9a21fca\",\n              \"name\": \"markdown\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.markdown }}\"\n            },\n            {\n              \"id\": \"5579a411-94dc-4b10-a276-24adf775be1d\",\n              \"name\": \"url\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.searchResult.url }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4a5ad2e4-b274-4a2f-bc0f-15d067ad469c\",\n      \"name\": \"Is Apify Auth Error?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        140,\n        1020\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"8722e13a-d788-4145-8bea-5bc0ce0a83f8\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.error.status }}\",\n              \"rightValue\": 401\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"54118cbc-6466-448d-8832-91ad62a931e2\",\n      \"name\": \"Stop and Error\",\n      \"type\": \"n8n-nodes-base.stopAndError\",\n      \"position\": [\n        300,\n        860\n      ],\n      \"parameters\": {\n        \"errorMessage\": \"=Apify Auth Error! Check your API token is valid and make sure you put \\\"Bearer <api_key>\\\" if using HeaderAuth.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"aae46fd1-70bc-4629-8a47-6ae75ce8afb1\",\n      \"name\": \"Sticky Note19\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -460,\n        1960\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 560,\n        \"height\": 300,\n        \"content\": \"### 自托管n8n？试试这些工具上传到Notion吧！\\n本模板使用LLM将Markdown转换为Notion格式，虽然操作简单（无需安装其他软件），但效率并非最优。若您能自主安装软件，建议采用以下替代方案以加速流程并减少转换错误：\\n\\n* [Notion⇄Markdown转换社区节点](https://community.n8n.io/t/now-available-notion-markdown-conversion-community-node/59087)\\n* [tryfabric/martian：Markdown转Notion工具](https://github.com/tryfabric/martian)（支持将Markdown/GitHub风味Markdown转换为Notion API区块和富文本）\\n* [brittonhayes/notionmd：Markdown转Notion区块工具](https://github.com/brittonhayes/notionmd)\\n\\n**注意**：以上推荐仅供参考，请自行评估风险后使用！\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Item Ref\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"RAG Web Browser\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Row\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Initiate DeepResearch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Confirmation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"End Form\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Has Content?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Markdown + URL\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Empty Response\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Valid Blocks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Append Blocks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Append Blocks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Block...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"HTML to Array\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Tags to Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SERP to Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Query...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Clarifying Questions\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Tags to Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Notion Block Generator\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Valid Results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Has Content?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Empty Response\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Query...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Execution Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"JobType Router\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"JobType Router\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Existing Row\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Generate SERP Queries\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get Existing Row1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert to HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTML to Array\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"RAG Web Browser\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Apify Auth Error?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set In-Progress\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Initial Query\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Existing Row\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set In-Progress\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Research Request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Results to Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Next Queries\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Next Queries\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Learnings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Feedback to Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Question...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"For Each Block...\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Done\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Upload to Notion Page\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"For Each Query...\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combine & Send back to Loop\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Item Ref\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Existing Row1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"DeepResearch Report\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Initial Query\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Report Page Generator\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is Depth Reached?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Research Results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"DeepResearch Results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"DeepResearch Learnings\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parse JSON blocks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Valid Blocks\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"URL Sources to Lists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Initial Query\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Learnings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Accumulate Results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Depth Reached?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Generate Learnings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Accumulate Results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Markdown + URL\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"DeepResearch Learnings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On form submission\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Research Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"DeepResearch Report\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model2\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Clarifying Questions\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model3\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Generate SERP Queries\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model4\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Report Page Generator\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"DeepResearch Report\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert to HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Clarifying Questions\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Feedback to Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"DeepResearch Results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Results to Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"For Each Question...\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Initial Query\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Ask Clarity Questions\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Research Results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Report\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is Apify Auth Error?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Stop and Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Valid Results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"URL Sources to Lists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Append Blocks\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Ask Clarity Questions\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Question...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Generate SERP Queries\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SERP to Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Initiate DeepResearch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Confirmation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Report Page Generator\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Row\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload to Notion Page\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Block...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        []\n      ]\n    },\n    \"DeepResearch Learnings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Research Goal + Learnings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Notion Block Generator\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parse JSON blocks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"DeepResearch Subworkflow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Execution Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Gemini Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Notion Block Generator\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"DeepResearch Learnings\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Research Goal + Learnings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"For Each Query...\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser1\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Clarifying Questions\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser2\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Generate SERP Queries\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser4\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Report Page Generator\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
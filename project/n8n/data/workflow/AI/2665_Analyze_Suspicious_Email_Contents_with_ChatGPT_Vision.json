{
  "title": "Analyze Suspicious Email Contents with ChatGPT Vision",
  "url": "https://n8n.io/workflows/2665-analyze-suspicious-email-contents-with-chatgpt-vision/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "Angel Menendez",
  "publish_date": "Last update 4 months ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"},\"nodes\":[{\"id\":\"1bad6bfc-9ec9-48a5-b8f7-73c4de3d08cf\",\"name\":\"Gmail Trigger\",\"type\":\"n8n-nodes-base.gmailTrigger\",\"position\":[1480,160],\"parameters\":{\"simple\":false,\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"gmailOAuth2\":{\"id\":\"kkhNhqKpZt6IUZd0\",\"name\":\" Gmail\"}},\"typeVersion\":1.2},{\"id\":\"9ac747a1-4fd8-46ba-b4c1-75fd17aab2ed\",\"name\":\"Microsoft Outlook Trigger\",\"type\":\"n8n-nodes-base.microsoftOutlookTrigger\",\"disabled\":true,\"position\":[1480,720],\"parameters\":{\"fields\":[\"body\",\"toRecipients\",\"subject\",\"bodyPreview\"],\"output\":\"fields\",\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":1},{\"id\":\"5bf9b0e8-b84e-44a2-aad2-45dde3e4ab1b\",\"name\":\"Screenshot HTML\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2520,480],\"parameters\":{\"url\":\"https://hcti.io/v1/image\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"sendQuery\":true,\"authentication\":\"genericCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"html\",\"value\":\"={{ $json.htmlBody }}\"}]},\"genericAuthType\":\"httpBasicAuth\",\"queryParameters\":{\"parameters\":[{}]}},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"fc770d1d-6c18-4d14-8344-1dc042464df6\",\"name\":\"Retrieve Screenshot\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2700,480],\"parameters\":{\"url\":\"={{ $json.url }}\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpBasicAuth\"},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"2f3e5cc0-24e8-450a-898b-71e2d6f7bb58\",\"name\":\"Set Outlook Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2020,720],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"},{\"id\":\"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json}}\"},{\"id\":\"20566ad4-7eb7-42b1-8a0d-f8b759610f10\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"},{\"id\":\"7171998f-a5a2-4e23-946a-9c1ad75710e7\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"},{\"id\":\"cc262634-2470-4524-8319-abe2518a6335\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $('Retrieve Headers of Email').item.json.body.content }}\"}]}},\"typeVersion\":3.4},{\"id\":\"374e5b16-a666-4706-9fd2-762b2927012d\",\"name\":\"Set Gmail Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2040,160],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $json.html }}\"},{\"id\":\"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json.headers }}\"},{\"id\":\"1d690098-be2a-4604-baf8-62f314930929\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $json.subject }}\"},{\"id\":\"8009f00a-547f-4eb1-b52d-2e7305248885\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $json.to.text }}\"},{\"id\":\"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $json.text }}\"}]}},\"typeVersion\":3.4},{\"id\":\"3166738e-d0a3-475b-8b19-51afd519ee3a\",\"name\":\"Retrieve Headers of Email\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1680,720],\"parameters\":{\"url\":\"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\",\"options\":{},\"sendHeaders\":true,\"authentication\":\"predefinedCredentialType\",\"headerParameters\":{\"parameters\":[{\"name\":\"Accept\",\"value\":\"application/json\"},{\"name\":\"Prefer\",\"value\":\"outlook.body-content-type=\\\"text\\\"\"}]},\"nodeCredentialType\":\"microsoftOutlookOAuth2Api\"},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":4.2},{\"id\":\"25ae222c-088f-4565-98d6-803c8c1b0826\",\"name\":\"Format Headers\",\"type\":\"n8n-nodes-base.code\",\"position\":[1860,720],\"parameters\":{\"jsCode\":\"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"},\"typeVersion\":2},{\"id\":\"8f14f267-1074-43ea-968d-26a6ab36fd7b\",\"name\":\"Set Email Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2360,480],\"parameters\":{\"options\":{},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"45d156aa-91f4-483c-91d4-c9de4a4f595d\",\"name\":\"ChatGPT Analysis\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[3100,480],\"parameters\":{\"text\":\"=Describe this image. Determine if the email could be a phishing email. The message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response.\",\"modelId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"chatgpt-4o-latest\",\"cachedResultName\":\"CHATGPT-4O-LATEST\"},\"options\":{\"maxTokens\":1500},\"resource\":\"image\",\"inputType\":\"base64\",\"operation\":\"analyze\"},\"credentials\":{\"openAiApi\":{\"id\":\"76\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.6},{\"id\":\"62ca591b-6627-496c-96a7-95cb0081480d\",\"name\":\"Create Jira Ticket\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3500,480],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10001\",\"cachedResultName\":\"Support\"},\"summary\":\"=Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10008\",\"cachedResultName\":\"Task\"},\"additionalFields\":{\"description\":\"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\" and body:\\n{{ $('Set Email Variables').item.json.textBody }}\\n\\\\\\\\\\n\\\\\\\\\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.content }}\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"071380c8-8070-4f8f-86c6-87c4ee3bc261\",\"name\":\"Rename Screenshot\",\"type\":\"n8n-nodes-base.code\",\"position\":[3680,480],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"$('Retrieve Screenshot').item.binary.data.fileName = 'emailScreenshot.png'\\n\\nreturn $('Retrieve Screenshot').item;\"},\"typeVersion\":2},{\"id\":\"05c57490-c1ee-48f0-9e38-244c9a995e22\",\"name\":\"Upload Screenshot of Email to Jira\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3860,480],\"parameters\":{\"issueKey\":\"={{ $('Create Jira Ticket').item.json.key }}\",\"resource\":\"issueAttachment\"},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"be02770d-a943-41f5-98a9-5c433a6a3dbf\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1420,-107.36679523834897],\"parameters\":{\"color\":7,\"width\":792.3026315789474,\"height\":426.314163659402,\"content\":\"![Gmail](https://uploads.n8n.io/templates/gmail.png)\\n## Gmail Integration and Data Extraction\\n\\nThis section of the workflow connects to a Gmail account using the **Gmail Trigger** node, capturing incoming emails in real-time, with checks performed every minute. Once an email is detected, its key components—such as the subject, recipient, body, and headers—are extracted and assigned to variables using the **Set Gmail Variables** node. These variables are structured for subsequent analysis and processing in later steps.\"},\"typeVersion\":1},{\"id\":\"c1d2f691-669a-46de-9ef8-59ce4e6980c5\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1420,380.6918768014301],\"parameters\":{\"color\":7,\"width\":792.3026315789474,\"height\":532.3344389880435,\"content\":\"![Gmail](https://uploads.n8n.io/templates/outlook.png)\\n## Microsoft Outlook Integration and Email Header Processing\\n\\nThis section connects to a Microsoft Outlook account to monitor incoming emails using the **Microsoft Outlook Trigger** node, which checks for new messages every minute. Emails are then processed to retrieve detailed headers and body content via the **Retrieve Headers of Email** node. The headers are structured into a user-friendly format using the **Format Headers** code node, ensuring clarity for further analysis. Key details, including the email's subject, recipient, and body content, are assigned to variables with the **Set Outlook Variables** node for streamlined integration into subsequent workflow steps.\"},\"typeVersion\":1},{\"id\":\"c189e2e0-9f51-4bc0-a483-8b7f0528be70\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2287.3684210526317,46.18421052631584],\"parameters\":{\"color\":7,\"width\":580.4605263157906,\"height\":615.460526315789,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/hctiapi.png)\\n## HTML Screenshot Generation and Email Visualization\\n\\nThis section processes an email’s HTML content to create a visual representation, useful for documentation or phishing detection workflows. The **Set Email Variables** node organizes the email's HTML body into a format ready for processing. The **Screenshot HTML** node sends this HTML content to the **hcti.io** API, which generates a screenshot of the email's layout. The **Retrieve Screenshot** node then fetches the image URL for further use in the workflow. This setup ensures that the email's appearance is preserved in a visually accessible format, simplifying review and reporting. Keep in mind however that this exposes the email content to a third party. If you self host n8n, you can deploy a cli tool to rasterize locally instead.\"},\"typeVersion\":1},{\"id\":\"9076f9e9-f4fb-409a-9580-1ae459094c31\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2880,123.72476075009968],\"parameters\":{\"color\":7,\"width\":507.82894736842223,\"height\":537.9199760920052,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## AI-Powered Email Analysis with ChatGPT\\n\\nThis section leverages AI to analyze email content and headers for phishing indicators. The **ChatGPT Analysis** node utilizes the ChatGPT-4 model to review the email screenshot and associated metadata, including message headers. It generates a detailed report indicating whether the email might be a phishing attempt. The output is formatted specifically for Jira’s wiki-style renderer, making it ready for seamless integration into ticketing workflows. This ensures thorough and automated email threat assessments.\"},\"typeVersion\":1},{\"id\":\"ca2488af-e787-4675-802a-8b4f2d845376\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3400,122.88662032580646],\"parameters\":{\"color\":7,\"width\":692.434210526317,\"height\":529.5475902005091,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## Automated Jira Ticket Creation for Phishing Reports\\n\\nThis section streamlines the process of reporting phishing emails by automatically creating detailed Jira tickets. The **Create Jira Ticket** node compiles email information, including the subject, recipient, body text, and ChatGPT's phishing analysis, into a structured ticket. The **Rename Screenshot** node ensures that the email screenshot file is appropriately labeled for attachment. Finally, the **Upload Screenshot of Email to Jira** node attaches the email’s visual representation to the ticket, providing additional context for the security team. This integration ensures that phishing reports are logged with all necessary details, enabling efficient tracking and resolution.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Gmail Trigger\":{\"main\":[[{\"node\":\"Set Gmail Variables\",\"type\":\"main\",\"index\":0}]]},\"Format Headers\":{\"main\":[[{\"node\":\"Set Outlook Variables\",\"type\":\"main\",\"index\":0}]]},\"Screenshot HTML\":{\"main\":[[{\"node\":\"Retrieve Screenshot\",\"type\":\"main\",\"index\":0}]]},\"ChatGPT Analysis\":{\"main\":[[{\"node\":\"Create Jira Ticket\",\"type\":\"main\",\"index\":0}]]},\"Rename Screenshot\":{\"main\":[[{\"node\":\"Upload Screenshot of Email to Jira\",\"type\":\"main\",\"index\":0}]]},\"Create Jira Ticket\":{\"main\":[[{\"node\":\"Rename Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Screenshot\":{\"main\":[[{\"node\":\"ChatGPT Analysis\",\"type\":\"main\",\"index\":0}]]},\"Set Email Variables\":{\"main\":[[{\"node\":\"Screenshot HTML\",\"type\":\"main\",\"index\":0}]]},\"Set Gmail Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Set Outlook Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Microsoft Outlook Trigger\":{\"main\":[[{\"node\":\"Retrieve Headers of Email\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Headers of Email\":{\"main\":[[{\"node\":\"Format Headers\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Phishing Email Detection and Reporting with n8n\n\n#### Who is this for?\n\nThis workflow is designed for IT teams, security professionals, and managed service providers (MSPs) looking to automate the process of detecting, analyzing, and reporting phishing emails.\n\n#### What problem is this workflow solving?\n\nPhishing emails are a significant cybersecurity threat, and manually detecting and reporting them is time-consuming and prone to errors. This workflow streamlines the process by automating email analysis, generating detailed reports, and logging incidents in a centralized system like Jira.\n\n#### What this workflow does\n\nThis workflow automates phishing email detection and reporting by integrating Gmail and Microsoft Outlook email triggers, analyzing the content and headers of incoming emails, and generating Jira tickets for flagged phishing emails. Here’s what happens:\n\n  1. **Email Triggers** : Captures incoming emails from Gmail or Microsoft Outlook.\n  2. **Email Analysis** : Extracts email content, headers, and metadata for analysis.\n  3. **HTML Screenshot** : Converts the email’s HTML body into a visual screenshot.\n  4. **AI Phishing Detection** : Leverages ChatGPT to analyze the email and detect potential phishing indicators.\n  5. **Jira Integration** : Automatically creates a Jira ticket with detailed analysis and attaches the email screenshot for review by the security team.\n  6. **Customizable Reports** : Includes options to customize ticket descriptions and adapt the workflow to organizational needs.\n\n\n\n#### Setup\n\n  1. **Authentication** : Set up Gmail and Microsoft Outlook OAuth credentials in n8n to access your email accounts securely.\n  2. **API Keys** : Add API credentials for the HTML screenshot service (`hcti.io`) and ChatGPT.\n  3. **Jira Integration** : Configure your Jira project and issue types in the workflow.\n  4. **Workflow Configuration** : Update sticky notes and nodes to include any additional setup or configuration details unique to your system.\n\n\n\n#### How to customize this workflow to your needs\n\n  * **Email Filters** : Modify email triggers to filter specific subjects or sender addresses.\n  * **Analysis Scope** : Adjust the ChatGPT prompt to refine phishing detection logic.\n  * **Integration** : Replace Jira with your preferred ticketing system or modify the ticket fields to include additional information.\n\n\n\nThis workflow provides an end-to-end automated solution for phishing email management, enhancing efficiency and reducing security risks. It’s perfect for teams looking to minimize manual effort and improve incident response times.\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><h3>Phishing Email Detection and Reporting with n8n</h3>\n<h4>Who is this for?</h4>\n<p>This workflow is designed for IT teams, security professionals, and managed service providers (MSPs) looking to automate the process of detecting, analyzing, and reporting phishing emails.</p>\n<h4>What problem is this workflow solving?</h4>\n<p>Phishing emails are a significant cybersecurity threat, and manually detecting and reporting them is time-consuming and prone to errors. This workflow streamlines the process by automating email analysis, generating detailed reports, and logging incidents in a centralized system like Jira.</p>\n<h4>What this workflow does</h4>\n<p>This workflow automates phishing email detection and reporting by integrating Gmail and Microsoft Outlook email triggers, analyzing the content and headers of incoming emails, and generating Jira tickets for flagged phishing emails. Here’s what happens:</p>\n<ol>\n<li><strong>Email Triggers</strong>: Captures incoming emails from Gmail or Microsoft Outlook.</li>\n<li><strong>Email Analysis</strong>: Extracts email content, headers, and metadata for analysis.</li>\n<li><strong>HTML Screenshot</strong>: Converts the email’s HTML body into a visual screenshot.</li>\n<li><strong>AI Phishing Detection</strong>: Leverages ChatGPT to analyze the email and detect potential phishing indicators.</li>\n<li><strong>Jira Integration</strong>: Automatically creates a Jira ticket with detailed analysis and attaches the email screenshot for review by the security team.</li>\n<li><strong>Customizable Reports</strong>: Includes options to customize ticket descriptions and adapt the workflow to organizational needs.</li>\n</ol>\n<h4>Setup</h4>\n<ol>\n<li><strong>Authentication</strong>: Set up Gmail and Microsoft Outlook OAuth credentials in n8n to access your email accounts securely.</li>\n<li><strong>API Keys</strong>: Add API credentials for the HTML screenshot service (<code>hcti.io</code>) and ChatGPT.</li>\n<li><strong>Jira Integration</strong>: Configure your Jira project and issue types in the workflow.</li>\n<li><strong>Workflow Configuration</strong>: Update sticky notes and nodes to include any additional setup or configuration details unique to your system.</li>\n</ol>\n<h4>How to customize this workflow to your needs</h4>\n<ul>\n<li><strong>Email Filters</strong>: Modify email triggers to filter specific subjects or sender addresses.</li>\n<li><strong>Analysis Scope</strong>: Adjust the ChatGPT prompt to refine phishing detection logic.</li>\n<li><strong>Integration</strong>: Replace Jira with your preferred ticketing system or modify the ticket fields to include additional information.</li>\n</ul>\n<p>This workflow provides an end-to-end automated solution for phishing email management, enhancing efficiency and reducing security risks. It’s perfect for teams looking to minimize manual effort and improve incident response times.</p>\n</div><!--]-->",
  "readme_zh": "### 利用n8n实现钓鱼邮件检测与上报\n\n#### 适用对象\n本工作流专为IT团队、安全运维人员及托管服务提供商（MSP）设计，旨在实现钓鱼邮件的自动化检测、分析与上报。\n\n#### 解决痛点\n钓鱼邮件是重大网络安全威胁，人工检测与上报不仅耗时且易出错。本工作流通过自动化邮件分析、生成详细报告并将事件记录至Jira等中央系统，显著提升处理效率。\n\n#### 核心功能\n该工作流通过集成Gmail和Microsoft Outlook邮件触发器，自动分析邮件内容与标头，并为标记的钓鱼邮件创建Jira工单：\n  1. **邮件触发**：捕获Gmail或Microsoft Outlook的入站邮件\n  2. **内容解析**：提取邮件正文、标头及元数据进行深度分析\n  3. **可视化存档**：将HTML邮件正文转换为可视化截图\n  4. **AI检测**：调用ChatGPT分析邮件内容识别钓鱼特征\n  5. **工单创建**：自动生成含详细分析的Jira工单，并附邮件截图供安全团队审查\n  6. **灵活报告**：支持自定义工单描述，可适配不同组织需求\n\n#### 部署指南\n  1. **身份验证**：在n8n中配置Gmail和Microsoft Outlook的OAuth凭证\n  2. **API配置**：添加HTML截图服务（hcti.io）及ChatGPT的API密钥\n  3. **系统对接**：在工作流中设置Jira项目与工单类型\n  4. **流程调优**：根据实际需求修改便签注释和节点配置\n\n#### 定制化建议\n  * **邮件过滤**：调整触发器规则筛选特定主题/发件人\n  * **检测精度**：优化ChatGPT提示词提升识别准确率\n  * **系统集成**：可替换Jira为其他工单系统，或扩展字段信息\n\n本方案提供钓鱼邮件管理的全流程自动化解决方案，在提升安全运维效率的同时有效降低风险，特别适合需要缩短事件响应周期、减少人工操作的团队。",
  "title_zh": "利用ChatGPT Vision分析可疑邮件内容",
  "publish_date_absolute": "2025-01-07",
  "publish_date_zh": "最后更新于4个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"1bad6bfc-9ec9-48a5-b8f7-73c4de3d08cf\",\n      \"name\": \"Gmail Trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        1480,\n        160\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {},\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"kkhNhqKpZt6IUZd0\",\n          \"name\": \" Gmail\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"9ac747a1-4fd8-46ba-b4c1-75fd17aab2ed\",\n      \"name\": \"Microsoft Outlook Trigger\",\n      \"type\": \"n8n-nodes-base.microsoftOutlookTrigger\",\n      \"disabled\": true,\n      \"position\": [\n        1480,\n        720\n      ],\n      \"parameters\": {\n        \"fields\": [\n          \"body\",\n          \"toRecipients\",\n          \"subject\",\n          \"bodyPreview\"\n        ],\n        \"output\": \"fields\",\n        \"filters\": {},\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"microsoftOutlookOAuth2Api\": {\n          \"id\": \"vTCK0oVQ0WjFrI5H\",\n          \"name\": \" Outlook Credential\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5bf9b0e8-b84e-44a2-aad2-45dde3e4ab1b\",\n      \"name\": \"Screenshot HTML\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2520,\n        480\n      ],\n      \"parameters\": {\n        \"url\": \"https://hcti.io/v1/image\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"html\",\n              \"value\": \"={{ $json.htmlBody }}\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpBasicAuth\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {}\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"8tm8mUWmPvtmPFPk\",\n          \"name\": \"hcti.io\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"fc770d1d-6c18-4d14-8344-1dc042464df6\",\n      \"name\": \"Retrieve Screenshot\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2700,\n        480\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.url }}\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpBasicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"8tm8mUWmPvtmPFPk\",\n          \"name\": \"hcti.io\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"2f3e5cc0-24e8-450a-898b-71e2d6f7bb58\",\n      \"name\": \"Set Outlook Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2020,\n        720\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\n              \"name\": \"htmlBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"\n            },\n            {\n              \"id\": \"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\",\n              \"name\": \"headers\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json}}\"\n            },\n            {\n              \"id\": \"20566ad4-7eb7-42b1-8a0d-f8b759610f10\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"\n            },\n            {\n              \"id\": \"7171998f-a5a2-4e23-946a-9c1ad75710e7\",\n              \"name\": \"recipient\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"\n            },\n            {\n              \"id\": \"cc262634-2470-4524-8319-abe2518a6335\",\n              \"name\": \"textBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Retrieve Headers of Email').item.json.body.content }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"374e5b16-a666-4706-9fd2-762b2927012d\",\n      \"name\": \"Set Gmail Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2040,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\n              \"name\": \"htmlBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.html }}\"\n            },\n            {\n              \"id\": \"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\",\n              \"name\": \"headers\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.headers }}\"\n            },\n            {\n              \"id\": \"1d690098-be2a-4604-baf8-62f314930929\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.subject }}\"\n            },\n            {\n              \"id\": \"8009f00a-547f-4eb1-b52d-2e7305248885\",\n              \"name\": \"recipient\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.to.text }}\"\n            },\n            {\n              \"id\": \"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\",\n              \"name\": \"textBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.text }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"3166738e-d0a3-475b-8b19-51afd519ee3a\",\n      \"name\": \"Retrieve Headers of Email\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1680,\n        720\n      ],\n      \"parameters\": {\n        \"url\": \"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Accept\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"Prefer\",\n              \"value\": \"outlook.body-content-type=\\\"text\\\"\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"microsoftOutlookOAuth2Api\"\n      },\n      \"credentials\": {\n        \"microsoftOutlookOAuth2Api\": {\n          \"id\": \"vTCK0oVQ0WjFrI5H\",\n          \"name\": \" Outlook Credential\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"25ae222c-088f-4565-98d6-803c8c1b0826\",\n      \"name\": \"Format Headers\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1860,\n        720\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"8f14f267-1074-43ea-968d-26a6ab36fd7b\",\n      \"name\": \"Set Email Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2360,\n        480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"45d156aa-91f4-483c-91d4-c9de4a4f595d\",\n      \"name\": \"ChatGPT Analysis\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"position\": [\n        3100,\n        480\n      ],\n      \"parameters\": {\n        \"text\": \"=Describe this image. Determine if the email could be a phishing email. The message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response.\",\n        \"modelId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"chatgpt-4o-latest\",\n          \"cachedResultName\": \"CHATGPT-4O-LATEST\"\n        },\n        \"options\": {\n          \"maxTokens\": 1500\n        },\n        \"resource\": \"image\",\n        \"inputType\": \"base64\",\n        \"operation\": \"analyze\"\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"76\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.6\n    },\n    {\n      \"id\": \"62ca591b-6627-496c-96a7-95cb0081480d\",\n      \"name\": \"Create Jira Ticket\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        3500,\n        480\n      ],\n      \"parameters\": {\n        \"project\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10001\",\n          \"cachedResultName\": \"Support\"\n        },\n        \"summary\": \"=Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\n        \"issueType\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10008\",\n          \"cachedResultName\": \"Task\"\n        },\n        \"additionalFields\": {\n          \"description\": \"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\" and body:\\n{{ $('Set Email Variables').item.json.textBody }}\\n\\\\\\\\\\n\\\\\\\\\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.content }}\"\n        }\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"071380c8-8070-4f8f-86c6-87c4ee3bc261\",\n      \"name\": \"Rename Screenshot\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        3680,\n        480\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"$('Retrieve Screenshot').item.binary.data.fileName = 'emailScreenshot.png'\\n\\nreturn $('Retrieve Screenshot').item;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"05c57490-c1ee-48f0-9e38-244c9a995e22\",\n      \"name\": \"Upload Screenshot of Email to Jira\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        3860,\n        480\n      ],\n      \"parameters\": {\n        \"issueKey\": \"={{ $('Create Jira Ticket').item.json.key }}\",\n        \"resource\": \"issueAttachment\"\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"be02770d-a943-41f5-98a9-5c433a6a3dbf\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1420,\n        -107.36679523834897\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 792.3026315789474,\n        \"height\": 426.314163659402,\n        \"content\": \"![Gmail](https://uploads.n8n.io/templates/gmail.png)\\n## Gmail集成与数据提取\\n\\n该工作流环节通过**Gmail触发器**节点连接至Gmail账户，实时捕获新进邮件（每分钟执行一次检查）。当检测到邮件时，系统会使用**设置Gmail变量**节点提取邮件的关键要素——包括主题、收件人、正文及标头——并将其赋值给相应变量。这些经过结构化的变量将为后续步骤的分析与处理提供数据支持。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c1d2f691-669a-46de-9ef8-59ce4e6980c5\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1420,\n        380.6918768014301\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 792.3026315789474,\n        \"height\": 532.3344389880435,\n        \"content\": \"![Gmail](https://uploads.n8n.io/templates/outlook.png)\\n## Microsoft Outlook集成与邮件标头处理\\n\\n本模块通过**Microsoft Outlook触发器节点**连接Microsoft Outlook账户，每分钟检测新邮件。随后经由**检索邮件标头节点**获取详细标头与正文内容，并通过**格式化标头代码节点**将标头结构化呈现，确保清晰可读以便后续分析。关键信息（包括邮件主题、收件人及正文内容）由**设置Outlook变量节点**分配至相应变量，为后续工作流环节提供无缝集成支持。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c189e2e0-9f51-4bc0-a483-8b7f0528be70\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2287.3684210526317,\n        46.18421052631584\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 580.4605263157906,\n        \"height\": 615.460526315789,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/hctiapi.png)\\n## HTML截图生成与邮件可视化\\n\\n本模块通过处理邮件的HTML内容生成可视化呈现，适用于文档记录或钓鱼检测工作流。**设置邮件变量**节点将邮件HTML正文整理为待处理格式，**HTML截图**节点将该内容发送至**hcti.io** API生成邮件布局截图，**获取截图**节点随后提取图像URL供后续工作流使用。该方案能完整保留邮件的视觉呈现，简化审阅与报告流程。但需注意：此操作会将邮件内容暴露给第三方服务。若您自行托管n8n，可部署本地命令行工具实现栅格化处理以规避此风险。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9076f9e9-f4fb-409a-9580-1ae459094c31\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2880,\n        123.72476075009968\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 507.82894736842223,\n        \"height\": 537.9199760920052,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## 基于ChatGPT的AI邮件分析\\n\\n本模块运用人工智能技术分析邮件内容及标头，检测网络钓鱼特征。**ChatGPT分析节点**采用ChatGPT-4模型，对邮件截图及相关元数据（包括消息标头）进行全面审查，生成详细评估报告，判定邮件是否存在钓鱼企图。输出内容专为Jira维基风格渲染器优化，可直接无缝接入工单处理流程，实现高效自动化的邮件威胁评估。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ca2488af-e787-4675-802a-8b4f2d845376\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        3400,\n        122.88662032580646\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 692.434210526317,\n        \"height\": 529.5475902005091,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## 钓鱼邮件报告的自动化Jira工单创建\\n\\n本节通过自动生成详尽的Jira工单，优化钓鱼邮件上报流程。**创建Jira工单**节点将邮件主题、收件人、正文内容及ChatGPT的钓鱼分析结果整合为结构化工单。**重命名截图**节点确保邮件截图文件被正确标注以便附加。最后，**上传邮件截图至Jira**节点将邮件的可视化呈现附加至工单，为安全团队提供额外上下文。该集成方案确保钓鱼报告能完整记录所有必要细节，实现高效追踪与问题解决。\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Gmail Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Gmail Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Format Headers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Outlook Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Screenshot HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ChatGPT Analysis\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Jira Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Rename Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload Screenshot of Email to Jira\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Jira Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Rename Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ChatGPT Analysis\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Email Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Screenshot HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Gmail Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Outlook Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Microsoft Outlook Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Headers of Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Headers of Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Format Headers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
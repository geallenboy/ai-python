{
  "title": "create e-mail responses with fastmail and OpenAI",
  "url": "https://n8n.io/workflows/2441-create-e-mail-responses-with-fastmail-and-openai/",
  "category": "AI",
  "category_url": "https://n8n.io/workflows/categories/ai/?count=20",
  "author": "Vitali",
  "publish_date": "Last update 7 months ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"04ab549d8bbb435ec33b81e4e29965c46cf6f0f9e7afe631018b5e34c8eead58\"},\"nodes\":[{\"id\":\"082d1828-72b1-48c0-8426-c8051c29f0db\",\"name\":\"Session\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-20,-20],\"parameters\":{\"url\":\"https://api.fastmail.com/jmap/session\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\"},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"3IRsYkeB2ofrwQjv\",\"name\":\"Fastmail\"}},\"typeVersion\":4.2},{\"id\":\"d7dc4c50-c8fc-4999-918d-5d357567ed14\",\"name\":\"Get Mailbox IDs\",\"type\":\"n8n-nodes-base.httpRequest\",\"notes\":\"https://api.fastmail.com/.well-known/jmap\\n\\nhttps://api.fastmail.com/jmap/session\",\"position\":[200,-20],\"parameters\":{\"url\":\"https://api.fastmail.com/jmap/api/\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n    \\\"using\\\": [\\\"urn:ietf:params:jmap:core\\\", \\\"urn:ietf:params:jmap:mail\\\"],\\n    \\\"methodCalls\\\": [\\n      [\\n        \\\"Mailbox/get\\\",\\n        {\\n          \\\"accountId\\\": \\\"{{ $('Session').item.json.primaryAccounts['urn:ietf:params:jmap:mail'] }}\\\"\\n        },\\n        \\\"c0\\\"\\n      ]\\n    ]\\n  }\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Accept\",\"value\":\"application/json\"}]}},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"3IRsYkeB2ofrwQjv\",\"name\":\"Fastmail\"}},\"typeVersion\":4.2},{\"id\":\"31be3c1c-f4c5-4309-92b3-2fd0a3fcecc6\",\"name\":\"Split Out\",\"type\":\"n8n-nodes-base.splitOut\",\"position\":[400,-20],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"methodResponses[0][1].list\"},\"typeVersion\":1},{\"id\":\"93de4dad-70d6-4e16-b351-7c540c3a4bfa\",\"name\":\"Email Trigger (IMAP)\",\"type\":\"n8n-nodes-base.emailReadImap\",\"position\":[-20,-240],\"parameters\":{\"options\":{\"customEmailConfig\":\"[\\\"UNSEEN\\\"]\"},\"postProcessAction\":\"nothing\",\"downloadAttachments\":true},\"credentials\":{\"imap\":{\"id\":\"vFzz9hU9rTHVHs3I\",\"name\":\"IMAP\"}},\"typeVersion\":2},{\"id\":\"41e77a60-622f-426c-a50c-e0df03c53208\",\"name\":\"Get fields from source email\",\"type\":\"n8n-nodes-base.set\",\"position\":[200,-240],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"a9d425bd-e576-4e38-a251-b462240d3e2d\",\"name\":\"textPlain\",\"type\":\"string\",\"value\":\"={{ $json.textPlain }}\"},{\"id\":\"7071a252-fcad-4aa1-953f-205c3e403497\",\"name\":\"from\",\"type\":\"string\",\"value\":\"={{ $json.from }}\"},{\"id\":\"c4b0ed1b-590c-4d7f-b494-a0f34304cc1a\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $json.subject }}\"},{\"id\":\"7e0badd1-02be-4149-b9ff-286f0943f051\",\"name\":\"metadata['message-id']\",\"type\":\"string\",\"value\":\"={{ $json.metadata['message-id'] }}\"},{\"id\":\"f87c7c15-c1d3-4696-bcd4-6677e5ddb240\",\"name\":\"metadata['reply-to']\",\"type\":\"string\",\"value\":\"={{ $json.metadata['reply-to'] }}\"}]}},\"typeVersion\":3.4},{\"id\":\"f9d1a529-1377-456b-8357-d37fb3fe74f9\",\"name\":\"OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[400,-240],\"parameters\":{\"modelId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o\",\"cachedResultName\":\"GPT-4O\"},\"options\":{},\"messages\":{\"values\":[{\"content\":\"=Please analyze the following personal email and draft a casual response based solely on its content. Return only the response text without any additional introductions or formatting. The response should include appropriate greetings (e.g., \\\"Hi\\\", \\\"Hallo\\\", \\\"Moin\\\" in German or \\\"Hi\\\", \\\"Hello\\\" in English) and sign-offs (e.g., \\\"Gruß\\\", \\\"Lieben Gruß\\\" in German or \\\"Regards\\\" in English). Add a thanks if appropriate. Use \\\"Du\\\" only if appropriate; if the email contains \\\"Sie\\\", maintain the same formality.\\n\\nSubject: {{ $json.subject }}\\nEmail Content: {{ $json.textPlain }}\"}]}},\"credentials\":{\"openAiApi\":{\"id\":\"iW0ItIt1ZxCQrBqk\",\"name\":\"OpenAI\"}},\"typeVersion\":1.5},{\"id\":\"c421ddc9-b230-499c-a11d-a20a68d30c5b\",\"name\":\"Filter for drafts folder\",\"type\":\"n8n-nodes-base.filter\",\"position\":[560,-20],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"4e4c63d1-40fe-4314-bfe7-4fee62c78b88\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $json.role }}\",\"rightValue\":\"drafts\"}]}},\"typeVersion\":2.2},{\"id\":\"ef19fde4-cf8c-4e19-912e-822611c18056\",\"name\":\"upload draft email\",\"type\":\"n8n-nodes-base.httpRequest\",\"notes\":\"https://api.fastmail.com/.well-known/jmap\\n\\nhttps://api.fastmail.com/jmap/session\",\"position\":[1000,-120],\"parameters\":{\"url\":\"https://api.fastmail.com/jmap/api/\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n  \\\"using\\\": [\\\"urn:ietf:params:jmap:core\\\", \\\"urn:ietf:params:jmap:mail\\\"],\\n  \\\"methodCalls\\\": [\\n    [\\n      \\\"Email/set\\\",\\n      {\\n        \\\"accountId\\\": \\\"{{ $('Session').item.json.primaryAccounts['urn:ietf:params:jmap:mail'] }}\\\",\\n        \\\"create\\\": {\\n          \\\"newDraft\\\": {\\n            \\\"mailboxIds\\\": {\\n              \\\"{{ $json.draftsId }}\\\": true\\n            },\\n           \\\"keywords\\\": {\\n              \\\"$draft\\\": true\\n            },\\n            \\\"inReplyTo\\\": [\\\"{{ $json.metadata['message-id'] }}\\\"],\\n            \\\"references\\\": [\\\"{{ $json.metadata['message-id'] }}\\\"],\\n            \\\"from\\\": [{\\n              \\\"name\\\": \\\"\\\",\\n              \\\"email\\\": \\\"{{ $('Session').item.json.username }}\\\"\\n            }],\\n            \\\"to\\\": [{\\n              \\\"name\\\": \\\"{{ $json['to-friendly'] }}\\\",\\n              \\\"email\\\": \\\"{{ $json.to }}\\\"\\n            }],\\n            \\\"subject\\\": \\\"{{ $json.subject }}\\\",\\n            \\\"bodyValues\\\": {\\n              \\\"textBody\\\": {\\n                \\\"value\\\": \\\"{{ $json.message.content.replace(/\\\\n/g, '\\\\\\\\n') }}\\\"\\n              }\\n            },\\n            \\\"bodyStructure\\\": {\\n              \\\"partId\\\": \\\"textBody\\\"\\n            }\\n          }\\n        }\\n      },\\n      \\\"c1\\\"\\n    ]\\n  ]\\n}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Accept\",\"value\":\"application/json\"}]}},\"credentials\":{\"httpHeaderAuth\":{\"id\":\"3IRsYkeB2ofrwQjv\",\"name\":\"Fastmail\"}},\"typeVersion\":4.2},{\"id\":\"f4ecb64a-c978-4aa3-943e-c4a7f0592b91\",\"name\":\"gather data for draft email\",\"type\":\"n8n-nodes-base.set\",\"position\":[800,-120],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"78885ad0-fa62-407e-82de-f297190265be\",\"name\":\"draftsId\",\"type\":\"string\",\"value\":\"={{ $json.id }}\"},{\"id\":\"fcb31dde-0881-4b98-8bc2-e3e215148a5c\",\"name\":\"to-friendly\",\"type\":\"string\",\"value\":\"={{ $('Get fields from source email').item.json.from.match(/[^<]+/)[0].trim().replaceAll(/\\\\\\\"/g, \\\"\\\") }}\"},{\"id\":\"84c80af6-68dd-44bd-97ba-fde78a42e88a\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"=Re: {{ $('Get fields from source email').item.json.subject }}\"},{\"id\":\"590e9856-9c6f-4d23-af42-8a0a1384ac00\",\"name\":\"message.content\",\"type\":\"string\",\"value\":\"={{ $('OpenAI').item.json.message.content }}\"},{\"id\":\"4f24e071-24e3-4101-a423-ad5bbcca9fc7\",\"name\":\"metadata['message-id']\",\"type\":\"string\",\"value\":\"={{ $('Get fields from source email').item.json.metadata['message-id'] }}\"},{\"id\":\"80c92734-0296-4299-9f98-15cc62e93d44\",\"name\":\"to\",\"type\":\"string\",\"value\":\"={{ $('Get fields from source email').item.json.metadata['reply-to'].match(/<([^>]+)>/)[1] ?? $('Get fields from source email').item.json.from.match(/<([^>]+)>/)[1] }}\"}]}},\"typeVersion\":3.4},{\"id\":\"ca868672-85bd-4e2e-b2c6-6c6c69b78b24\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-580,-560],\"parameters\":{\"width\":493.9330818092735,\"height\":695.2489786026621,\"content\":\"## Workflow Description:\\nThis n8n workflow automates the drafting of email replies for Fastmail using OpenAI's GPT-4 model. Here’s the overall process:\\n\\n1. **Email Monitoring**: The workflow continuously monitors a specified IMAP inbox for new, unread emails.\\n2. **Email Data Extraction**: When a new email is detected, it extracts relevant details such as the sender, subject, email body, and metadata.\\n3. **AI Response Generation**: The extracted email content is sent to OpenAI's GPT-4, which generates a personalized draft response.\\n4. **Get Fastmail Session and Mailbox IDs**: Connects to the Fastmail API to retrieve necessary session details and mailbox IDs.\\n5. **Draft Identification**: Identifies the \\\"Drafts\\\" folder in the mailbox.\\n6. **Draft Preparation**: Compiles all the necessary information to create the draft, including the generated response, original email details, and specified recipient.\\n7. **Draft Uploading**: Uploads the prepared draft email to the \\\"Drafts\\\" folder in the Fastmail mailbox.\"},\"typeVersion\":1},{\"id\":\"c4273cc2-1ac2-43f4-bcd1-7f42d3109373\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-40,-560],\"parameters\":{\"color\":3,\"width\":722.928660826031,\"height\":285.5319148936168,\"content\":\"## Prerequisites:\\n1. **IMAP Email Account**: You need to configure an IMAP email account in n8n to monitor incoming emails.\\n2. **Fastmail API Credentials**: A Fastmail account with JMAP API enabled. You should set up HTTP Header authentication in n8n with your Fastmail API credentials.\\n3. **OpenAI API Key**: An API key from OpenAI to access GPT-4. Make sure to configure the OpenAI credentials in n8n.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"OpenAI\":{\"main\":[[{\"node\":\"Session\",\"type\":\"main\",\"index\":0}]]},\"Session\":{\"main\":[[{\"node\":\"Get Mailbox IDs\",\"type\":\"main\",\"index\":0}]]},\"Split Out\":{\"main\":[[{\"node\":\"Filter for drafts folder\",\"type\":\"main\",\"index\":0}]]},\"Get Mailbox IDs\":{\"main\":[[{\"node\":\"Split Out\",\"type\":\"main\",\"index\":0}]]},\"Email Trigger (IMAP)\":{\"main\":[[{\"node\":\"Get fields from source email\",\"type\":\"main\",\"index\":0}]]},\"Filter for drafts folder\":{\"main\":[[{\"node\":\"gather data for draft email\",\"type\":\"main\",\"index\":0}]]},\"gather data for draft email\":{\"main\":[[{\"node\":\"upload draft email\",\"type\":\"main\",\"index\":0}]]},\"Get fields from source email\":{\"main\":[[{\"node\":\"OpenAI\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Workflow Description:\n\nThis n8n workflow automates the drafting of email replies for Fastmail using OpenAI's GPT-4 model. Here’s the overall process:\n\n  1. **Email Monitoring** : The workflow continuously monitors a specified IMAP inbox for new, unread emails.\n  2. **Email Data Extraction** : When a new email is detected, it extracts relevant details such as the sender, subject, email body, and metadata.\n  3. **AI Response Generation** : The extracted email content is sent to OpenAI's GPT-4, which generates a personalized draft response.\n  4. **Get Fastmail Session and Mailbox IDs** : Connects to the Fastmail API to retrieve necessary session details and mailbox IDs.\n  5. **Draft Identification** : Identifies the \"Drafts\" folder in the mailbox.\n  6. **Draft Preparation** : Compiles all the necessary information to create the draft, including the generated response, original email details, and specified recipient.\n  7. **Draft Uploading** : Uploads the prepared draft email to the \"Drafts\" folder in the Fastmail mailbox.\n\n\n\n### Prerequisites:\n\n  1. **IMAP Email Account** : You need to configure an IMAP email account in n8n to monitor incoming emails.\n  2. **Fastmail API Credentials** : A Fastmail account with JMAP API enabled. You should set up HTTP Header authentication in n8n with your Fastmail API credentials.\n  3. **OpenAI API Key** : An API key from OpenAI to access GPT-4. Make sure to configure the OpenAI credentials in n8n.\n\n\n\n### Configuration Steps:\n\n  1. **Email Trigger (IMAP) Node** :\n\n     * Provide your email server settings and credentials to monitor emails.\n  2. **HTTP Request Nodes for Fastmail** :\n\n     * Set up HTTP Header authentication in n8n using your Fastmail API credentials.\n     * Replace the `httpHeaderAuth` credential IDs with your configured credential IDs.\n  3. **OpenAI Node** :\n\n     * Configure the OpenAI API key in n8n.\n     * Replace the `openAiApi` credential ID with your configured credential ID.\n\n\n\nBy following these steps and setting up the necessary credentials, you can seamlessly automate the creation of email drafts in response to new emails using AI-generated content. This workflow helps improve productivity and ensures timely, personalized communication.\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><h3>Workflow Description:</h3>\n<p>This n8n workflow automates the drafting of email replies for Fastmail using OpenAI's GPT-4 model. Here’s the overall process:</p>\n<ol>\n<li><strong>Email Monitoring</strong>: The workflow continuously monitors a specified IMAP inbox for new, unread emails.</li>\n<li><strong>Email Data Extraction</strong>: When a new email is detected, it extracts relevant details such as the sender, subject, email body, and metadata.</li>\n<li><strong>AI Response Generation</strong>: The extracted email content is sent to OpenAI's GPT-4, which generates a personalized draft response.</li>\n<li><strong>Get Fastmail Session and Mailbox IDs</strong>: Connects to the Fastmail API to retrieve necessary session details and mailbox IDs.</li>\n<li><strong>Draft Identification</strong>: Identifies the \"Drafts\" folder in the mailbox.</li>\n<li><strong>Draft Preparation</strong>: Compiles all the necessary information to create the draft, including the generated response, original email details, and specified recipient.</li>\n<li><strong>Draft Uploading</strong>: Uploads the prepared draft email to the \"Drafts\" folder in the Fastmail mailbox.</li>\n</ol>\n<h3>Prerequisites:</h3>\n<ol>\n<li><strong>IMAP Email Account</strong>: You need to configure an IMAP email account in n8n to monitor incoming emails.</li>\n<li><strong>Fastmail API Credentials</strong>: A Fastmail account with JMAP API enabled. You should set up HTTP Header authentication in n8n with your Fastmail API credentials.</li>\n<li><strong>OpenAI API Key</strong>: An API key from OpenAI to access GPT-4. Make sure to configure the OpenAI credentials in n8n.</li>\n</ol>\n<h3>Configuration Steps:</h3>\n<ol>\n<li>\n<p><strong>Email Trigger (IMAP) Node</strong>:</p>\n<ul>\n<li>Provide your email server settings and credentials to monitor emails.</li>\n</ul>\n</li>\n<li>\n<p><strong>HTTP Request Nodes for Fastmail</strong>:</p>\n<ul>\n<li>Set up HTTP Header authentication in n8n using your Fastmail API credentials.</li>\n<li>Replace the <code>httpHeaderAuth</code> credential IDs with your configured credential IDs.</li>\n</ul>\n</li>\n<li>\n<p><strong>OpenAI Node</strong>:</p>\n<ul>\n<li>Configure the OpenAI API key in n8n.</li>\n<li>Replace the <code>openAiApi</code> credential ID with your configured credential ID.</li>\n</ul>\n</li>\n</ol>\n<p>By following these steps and setting up the necessary credentials, you can seamlessly automate the creation of email drafts in response to new emails using AI-generated content. This workflow helps improve productivity and ensures timely, personalized communication.</p>\n</div><!--]-->",
  "readme_zh": "### 工作流描述：\n\n本n8n工作流利用OpenAI的GPT-4模型实现Fastmail邮件自动回复草稿生成，具体流程如下：\n\n  1. **邮件监控**：持续监测指定IMAP收件箱中的未读新邮件\n  2. **邮件数据提取**：发现新邮件时，提取发件人、主题、正文及元数据等关键信息\n  3. **AI回复生成**：将邮件内容发送至OpenAI GPT-4模型，生成个性化回复草稿\n  4. **获取Fastmail会话及邮箱ID**：通过Fastmail API获取必要会话参数和邮箱标识\n  5. **草稿箱识别**：定位邮箱中的\"草稿箱\"文件夹\n  6. **草稿准备**：整合AI回复内容、原始邮件信息及指定收件人数据\n  7. **草稿上传**：将完整邮件草稿上传至Fastmail草稿箱",
  "title_zh": "使用Fastmail和OpenAI创建电子邮件回复",
  "publish_date_absolute": "2024-09-29",
  "publish_date_zh": "最后更新于7个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"04ab549d8bbb435ec33b81e4e29965c46cf6f0f9e7afe631018b5e34c8eead58\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"082d1828-72b1-48c0-8426-c8051c29f0db\",\n      \"name\": \"Session\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -20,\n        -20\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.fastmail.com/jmap/session\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"3IRsYkeB2ofrwQjv\",\n          \"name\": \"Fastmail\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"d7dc4c50-c8fc-4999-918d-5d357567ed14\",\n      \"name\": \"Get Mailbox IDs\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"notes\": \"https://api.fastmail.com/.well-known/jmap\\n\\nhttps://api.fastmail.com/jmap/session\",\n      \"position\": [\n        200,\n        -20\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.fastmail.com/jmap/api/\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n    \\\"using\\\": [\\\"urn:ietf:params:jmap:core\\\", \\\"urn:ietf:params:jmap:mail\\\"],\\n    \\\"methodCalls\\\": [\\n      [\\n        \\\"Mailbox/get\\\",\\n        {\\n          \\\"accountId\\\": \\\"{{ $('Session').item.json.primaryAccounts['urn:ietf:params:jmap:mail'] }}\\\"\\n        },\\n        \\\"c0\\\"\\n      ]\\n    ]\\n  }\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"Accept\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"3IRsYkeB2ofrwQjv\",\n          \"name\": \"Fastmail\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"31be3c1c-f4c5-4309-92b3-2fd0a3fcecc6\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        400,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"methodResponses[0][1].list\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"93de4dad-70d6-4e16-b351-7c540c3a4bfa\",\n      \"name\": \"Email Trigger (IMAP)\",\n      \"type\": \"n8n-nodes-base.emailReadImap\",\n      \"position\": [\n        -20,\n        -240\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"customEmailConfig\": \"[\\\"UNSEEN\\\"]\"\n        },\n        \"postProcessAction\": \"nothing\",\n        \"downloadAttachments\": true\n      },\n      \"credentials\": {\n        \"imap\": {\n          \"id\": \"vFzz9hU9rTHVHs3I\",\n          \"name\": \"IMAP\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"41e77a60-622f-426c-a50c-e0df03c53208\",\n      \"name\": \"Get fields from source email\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        200,\n        -240\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a9d425bd-e576-4e38-a251-b462240d3e2d\",\n              \"name\": \"textPlain\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.textPlain }}\"\n            },\n            {\n              \"id\": \"7071a252-fcad-4aa1-953f-205c3e403497\",\n              \"name\": \"from\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.from }}\"\n            },\n            {\n              \"id\": \"c4b0ed1b-590c-4d7f-b494-a0f34304cc1a\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.subject }}\"\n            },\n            {\n              \"id\": \"7e0badd1-02be-4149-b9ff-286f0943f051\",\n              \"name\": \"metadata['message-id']\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.metadata['message-id'] }}\"\n            },\n            {\n              \"id\": \"f87c7c15-c1d3-4696-bcd4-6677e5ddb240\",\n              \"name\": \"metadata['reply-to']\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.metadata['reply-to'] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"f9d1a529-1377-456b-8357-d37fb3fe74f9\",\n      \"name\": \"OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"position\": [\n        400,\n        -240\n      ],\n      \"parameters\": {\n        \"modelId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o\",\n          \"cachedResultName\": \"GPT-4O\"\n        },\n        \"options\": {},\n        \"messages\": {\n          \"values\": [\n            {\n              \"content\": \"=Please analyze the following personal email and draft a casual response based solely on its content. Return only the response text without any additional introductions or formatting. The response should include appropriate greetings (e.g., \\\"Hi\\\", \\\"Hallo\\\", \\\"Moin\\\" in German or \\\"Hi\\\", \\\"Hello\\\" in English) and sign-offs (e.g., \\\"Gruß\\\", \\\"Lieben Gruß\\\" in German or \\\"Regards\\\" in English). Add a thanks if appropriate. Use \\\"Du\\\" only if appropriate; if the email contains \\\"Sie\\\", maintain the same formality.\\n\\nSubject: {{ $json.subject }}\\nEmail Content: {{ $json.textPlain }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"iW0ItIt1ZxCQrBqk\",\n          \"name\": \"OpenAI\"\n        }\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"c421ddc9-b230-499c-a11d-a20a68d30c5b\",\n      \"name\": \"Filter for drafts folder\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        560,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"4e4c63d1-40fe-4314-bfe7-4fee62c78b88\",\n              \"operator\": {\n                \"name\": \"filter.operator.equals\",\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.role }}\",\n              \"rightValue\": \"drafts\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"ef19fde4-cf8c-4e19-912e-822611c18056\",\n      \"name\": \"upload draft email\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"notes\": \"https://api.fastmail.com/.well-known/jmap\\n\\nhttps://api.fastmail.com/jmap/session\",\n      \"position\": [\n        1000,\n        -120\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.fastmail.com/jmap/api/\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"using\\\": [\\\"urn:ietf:params:jmap:core\\\", \\\"urn:ietf:params:jmap:mail\\\"],\\n  \\\"methodCalls\\\": [\\n    [\\n      \\\"Email/set\\\",\\n      {\\n        \\\"accountId\\\": \\\"{{ $('Session').item.json.primaryAccounts['urn:ietf:params:jmap:mail'] }}\\\",\\n        \\\"create\\\": {\\n          \\\"newDraft\\\": {\\n            \\\"mailboxIds\\\": {\\n              \\\"{{ $json.draftsId }}\\\": true\\n            },\\n           \\\"keywords\\\": {\\n              \\\"$draft\\\": true\\n            },\\n            \\\"inReplyTo\\\": [\\\"{{ $json.metadata['message-id'] }}\\\"],\\n            \\\"references\\\": [\\\"{{ $json.metadata['message-id'] }}\\\"],\\n            \\\"from\\\": [{\\n              \\\"name\\\": \\\"\\\",\\n              \\\"email\\\": \\\"{{ $('Session').item.json.username }}\\\"\\n            }],\\n            \\\"to\\\": [{\\n              \\\"name\\\": \\\"{{ $json['to-friendly'] }}\\\",\\n              \\\"email\\\": \\\"{{ $json.to }}\\\"\\n            }],\\n            \\\"subject\\\": \\\"{{ $json.subject }}\\\",\\n            \\\"bodyValues\\\": {\\n              \\\"textBody\\\": {\\n                \\\"value\\\": \\\"{{ $json.message.content.replace(/\\\\n/g, '\\\\\\\\n') }}\\\"\\n              }\\n            },\\n            \\\"bodyStructure\\\": {\\n              \\\"partId\\\": \\\"textBody\\\"\\n            }\\n          }\\n        }\\n      },\\n      \\\"c1\\\"\\n    ]\\n  ]\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"Accept\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"3IRsYkeB2ofrwQjv\",\n          \"name\": \"Fastmail\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"f4ecb64a-c978-4aa3-943e-c4a7f0592b91\",\n      \"name\": \"gather data for draft email\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        800,\n        -120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"78885ad0-fa62-407e-82de-f297190265be\",\n              \"name\": \"draftsId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.id }}\"\n            },\n            {\n              \"id\": \"fcb31dde-0881-4b98-8bc2-e3e215148a5c\",\n              \"name\": \"to-friendly\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get fields from source email').item.json.from.match(/[^<]+/)[0].trim().replaceAll(/\\\\\\\"/g, \\\"\\\") }}\"\n            },\n            {\n              \"id\": \"84c80af6-68dd-44bd-97ba-fde78a42e88a\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"=Re: {{ $('Get fields from source email').item.json.subject }}\"\n            },\n            {\n              \"id\": \"590e9856-9c6f-4d23-af42-8a0a1384ac00\",\n              \"name\": \"message.content\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('OpenAI').item.json.message.content }}\"\n            },\n            {\n              \"id\": \"4f24e071-24e3-4101-a423-ad5bbcca9fc7\",\n              \"name\": \"metadata['message-id']\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get fields from source email').item.json.metadata['message-id'] }}\"\n            },\n            {\n              \"id\": \"80c92734-0296-4299-9f98-15cc62e93d44\",\n              \"name\": \"to\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get fields from source email').item.json.metadata['reply-to'].match(/<([^>]+)>/)[1] ?? $('Get fields from source email').item.json.from.match(/<([^>]+)>/)[1] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"ca868672-85bd-4e2e-b2c6-6c6c69b78b24\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -580,\n        -560\n      ],\n      \"parameters\": {\n        \"width\": 493.9330818092735,\n        \"height\": 695.2489786026621,\n        \"content\": \"## 工作流描述：\\n该n8n工作流利用OpenAI的GPT-4模型实现了Fastmail邮件回复草稿的自动生成。整体流程如下：\\n\\n1. **邮件监控**：持续监测指定IMAP收件箱中的未读新邮件\\n2. **邮件数据提取**：发现新邮件时，提取发件人、主题、正文及元数据等关键信息\\n3. **AI回复生成**：将邮件内容发送至OpenAI的GPT-4模型，生成个性化回复草稿\\n4. **获取Fastmail会话及邮箱ID**：连接Fastmail API获取必要的会话详情和邮箱标识\\n5. **草稿箱识别**：定位邮箱中的\\\"草稿\\\"文件夹\\n6. **草稿准备**：整合生成的回复内容、原始邮件详情及指定收件人等信息\\n7. **草稿上传**：将准备好的邮件草稿上传至Fastmail邮箱的\\\"草稿\\\"文件夹\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c4273cc2-1ac2-43f4-bcd1-7f42d3109373\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -40,\n        -560\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 722.928660826031,\n        \"height\": 285.5319148936168,\n        \"content\": \"## 前提条件：\\n1. **IMAP邮箱账户**：你需要在n8n中配置一个IMAP邮箱账户来监控收到的邮件。\\n2. **Fastmail API凭证**：一个启用了JMAP API的Fastmail账户。你应在n8n中使用Fastmail API凭证设置HTTP头部认证。\\n3. **OpenAI API密钥**：来自OpenAI的API密钥，用于访问GPT-4。确保在n8n中配置好OpenAI的凭证。\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"OpenAI\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Session\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Session\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Mailbox IDs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter for drafts folder\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Mailbox IDs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Email Trigger (IMAP)\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get fields from source email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter for drafts folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"gather data for draft email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"gather data for draft email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"upload draft email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get fields from source email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"OpenAI\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
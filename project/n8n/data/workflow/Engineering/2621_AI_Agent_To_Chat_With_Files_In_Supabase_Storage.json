{
  "title": "AI Agent To Chat With Files In Supabase Storage",
  "url": "https://n8n.io/workflows/2621-ai-agent-to-chat-with-files-in-supabase-storage/",
  "category": "Engineering",
  "category_url": "https://n8n.io/workflows/categories/engineering/?count=20",
  "author": "Mark Shcherbakov",
  "publish_date": "Last update 2 months ago",
  "publish_date_absolute": "2025-03-07",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"6a2a7715680b8313f7cb4676321c5baa46680adfb913072f089f2766f42e43bd\"},\"nodes\":[{\"id\":\"f577f6bd-b1a4-48ec-9329-7bccc3fc1463\",\"name\":\"Get All files\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[400,-100],\"parameters\":{\"url\":\"=https://yqtvdcvjboenlblgcivl.supabase.co/storage/v1/object/list/private\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n  \\\"prefix\\\": \\\"\\\",\\n  \\\"limit\\\": 100,\\n  \\\"offset\\\": 0,\\n  \\\"sortBy\\\": {\\n    \\\"column\\\": \\\"name\\\",\\n    \\\"order\\\": \\\"asc\\\"\\n  }\\n}\",\"sendBody\":true,\"specifyBody\":\"json\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\"},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account My Airtable Gen\"}},\"typeVersion\":4.2},{\"id\":\"10693bc8-560d-4cf6-8bd0-2fe3f4d863d1\",\"name\":\"Default Data Loader\",\"type\":\"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\"position\":[1780,100],\"parameters\":{\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"=file_id\",\"value\":\"={{ $json.id }}\"}]}},\"jsonData\":\"={{ $('Merge').item.json.data ?? $('Merge').item.json.text }}\",\"jsonMode\":\"expressionData\"},\"typeVersion\":1},{\"id\":\"49428060-e707-4269-8344-77b301f56f7c\",\"name\":\"Recursive Character Text Splitter\",\"type\":\"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\"position\":[1780,280],\"parameters\":{\"options\":{},\"chunkSize\":500,\"chunkOverlap\":200},\"typeVersion\":1},{\"id\":\"08742063-e235-4874-a128-b352786b19ce\",\"name\":\"Extract Document PDF\",\"type\":\"n8n-nodes-base.extractFromFile\",\"position\":[1240,0],\"parameters\":{\"options\":{},\"operation\":\"pdf\"},\"typeVersion\":1,\"alwaysOutputData\":false},{\"id\":\"21f19360-d7ce-4106-ae5a-aa0f15b7c4aa\",\"name\":\"Embeddings OpenAI\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[1600,80],\"parameters\":{\"model\":\"text-embedding-3-small\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"fLfRtaXbR0EVD0pl\",\"name\":\"OpenAi account\"}},\"typeVersion\":1},{\"id\":\"4147409f-8686-418f-b979-04f8c8e7fe42\",\"name\":\"Create File record2\",\"type\":\"n8n-nodes-base.supabase\",\"position\":[1540,-100],\"parameters\":{\"tableId\":\"files\",\"fieldsUi\":{\"fieldValues\":[{\"fieldId\":\"name\",\"fieldValue\":\"={{ $('Loop Over Items').item.json.name }}\"},{\"fieldId\":\"storage_id\",\"fieldValue\":\"={{ $('Loop Over Items').item.json.id }}\"}]}},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account My Airtable Gen\"}},\"typeVersion\":1},{\"id\":\"016f1afe-172b-4609-b451-8d67609214d3\",\"name\":\"If\",\"type\":\"n8n-nodes-base.if\",\"position\":[720,-100],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"9b14e306-a04d-40f7-bc5b-b8eda8d8f7f2\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ \\n    !$('Aggregate').item.json.data || \\n    !Array.isArray($('Aggregate').item.json.data) || \\n    !$('Aggregate').item.json.data.some(item => \\n        item.storage_id === $('Loop Over Items').item.json.id \\n    ) \\n}}\",\"rightValue\":\"\"},{\"id\":\"c3c0af88-9aea-4539-8948-1b69e601c27c\",\"operator\":{\"type\":\"string\",\"operation\":\"notEquals\"},\"leftValue\":\"={{ $json.name }}\",\"rightValue\":\".emptyFolderPlaceholder\"}]}},\"typeVersion\":2.2},{\"id\":\"75e8a7db-8c4a-4ad8-b902-062cbc93e1eb\",\"name\":\"Get All Files\",\"type\":\"n8n-nodes-base.supabase\",\"position\":[20,-100],\"parameters\":{\"tableId\":\"files\",\"operation\":\"getAll\"},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account My Airtable Gen\"}},\"typeVersion\":1,\"alwaysOutputData\":true},{\"id\":\"b22a3bab-f615-4d8a-8832-ce25b1a385fe\",\"name\":\"Download\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[900,-100],\"parameters\":{\"url\":\"=https://yqtvdcvjboenlblgcivl.supabase.co/storage/v1/object/private/{{ $json.name }}\",\"options\":{},\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\"},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account My Airtable Gen\"}},\"typeVersion\":4.2},{\"id\":\"50d1fede-4bd0-4cd4-b74a-7d689fe211cc\",\"name\":\"Loop Over Items\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[560,-100],\"parameters\":{\"options\":{},\"batchSize\":\"=1\"},\"typeVersion\":3},{\"id\":\"f9c23b5e-0b40-4886-b54f-59fb46132d3f\",\"name\":\"When clicking ‘Test workflow’\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[-160,-100],\"parameters\":{},\"typeVersion\":1},{\"id\":\"0a0ec290-2c3d-40ba-8d03-6abf75202e73\",\"name\":\"Aggregate\",\"type\":\"n8n-nodes-base.aggregate\",\"position\":[220,-100],\"parameters\":{\"options\":{},\"aggregate\":\"aggregateAllItemData\"},\"typeVersion\":1,\"alwaysOutputData\":true},{\"id\":\"32b3e2e1-2d25-4dd1-93e8-3f693beb7b6f\",\"name\":\"When chat message received\",\"type\":\"@n8n/n8n-nodes-langchain.chatTrigger\",\"position\":[800,-1020],\"webhookId\":\"3c40d311-7996-4ed4-b2fa-c73bea5f4cf5\",\"parameters\":{\"options\":{}},\"typeVersion\":1.1},{\"id\":\"79073b5c-a4ad-45a6-bbfa-e900a05bfde3\",\"name\":\"OpenAI Chat Model1\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[940,-820],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"zJhr5piyEwVnWtaI\",\"name\":\"OpenAi club\"}},\"typeVersion\":1},{\"id\":\"f8663483-76d5-4fc8-ad07-7eec815ff7a6\",\"name\":\"Embeddings OpenAI2\",\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"position\":[1020,-540],\"parameters\":{\"model\":\"text-embedding-3-small\",\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"SphXAX7rlwRLkiox\",\"name\":\"Test club key\"}},\"typeVersion\":1},{\"id\":\"a1458799-d379-46de-93e6-a5ba0c665163\",\"name\":\"OpenAI Chat Model2\",\"type\":\"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\"position\":[1300,-680],\"parameters\":{\"options\":{}},\"credentials\":{\"openAiApi\":{\"id\":\"SphXAX7rlwRLkiox\",\"name\":\"Test club key\"}},\"typeVersion\":1},{\"id\":\"d6eeda2f-c984-406d-a625-726840308413\",\"name\":\"Vector Store Tool1\",\"type\":\"@n8n/n8n-nodes-langchain.toolVectorStore\",\"position\":[1100,-820],\"parameters\":{\"name\":\"knowledge_base\",\"topK\":8,\"description\":\"Retrieve data about user request\"},\"typeVersion\":1},{\"id\":\"e1d9a348-7d44-4ad1-adbd-2c9a31e06876\",\"name\":\"Switch\",\"type\":\"n8n-nodes-base.switch\",\"position\":[1060,-100],\"parameters\":{\"rules\":{\"values\":[{\"outputKey\":\"txt\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{$binary.data?.fileExtension == undefined }}\",\"rightValue\":\"txt\"}]},\"renameOutput\":true},{\"outputKey\":\"pdf\",\"conditions\":{\"options\":{\"version\":1,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"bf04cbec-dd86-4607-988f-4c96b6fd4b58\",\"operator\":{\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{$binary.data.fileExtension  }}\",\"rightValue\":\"pdf\"}]},\"renameOutput\":true}]},\"options\":{}},\"typeVersion\":3.1},{\"id\":\"d38afb92-87ae-4e2a-a712-ec24b1efd105\",\"name\":\"Insert into Supabase Vectorstore\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"position\":[1700,-100],\"parameters\":{\"mode\":\"insert\",\"options\":{\"queryName\":\"match_documents\"},\"tableName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"documents\",\"cachedResultName\":\"documents\"}},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account My Airtable Gen\"}},\"typeVersion\":1},{\"id\":\"1a903b2e-cab0-4798-b820-ec08d6a71ddd\",\"name\":\"Merge\",\"type\":\"n8n-nodes-base.merge\",\"position\":[1380,-100],\"parameters\":{},\"typeVersion\":3},{\"id\":\"3afd552e-4995-493e-9cd5-ef496dfe359f\",\"name\":\"AI Agent\",\"type\":\"@n8n/n8n-nodes-langchain.agent\",\"position\":[1020,-1020],\"parameters\":{\"options\":{}},\"typeVersion\":1.7},{\"id\":\"d9688acc-311b-42fd-afa8-2c0e493be34b\",\"name\":\"Supabase Vector Store\",\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"position\":[1020,-660],\"parameters\":{\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"file_id\",\"value\":\"300b0128-0955-4058-b0d3-a9aefe728432\"}]}},\"tableName\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"documents\",\"cachedResultName\":\"documents\"}},\"credentials\":{\"supabaseApi\":{\"id\":\"t8AQJzvZvrOMDLec\",\"name\":\"Supabase account My Airtable Gen\"}},\"typeVersion\":1},{\"id\":\"66df007c-0418-4551-950e-32e7d79840bd\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[340,-220],\"parameters\":{\"height\":89.3775420487804,\"content\":\"### Replace Storage name, database ID and credentials.\"},\"typeVersion\":1},{\"id\":\"b164b520-20dd-44a4-aa3b-647391786b20\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-20,-220],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"8688c219-5af4-4e54-9fd1-91851829445b\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1540,-220],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"45c6ece4-f849-4496-8149-31385f5e36a4\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[840,-220],\"parameters\":{\"height\":89.3775420487804,\"content\":\"### Replace Storage name, database ID and credentials.\"},\"typeVersion\":1},{\"id\":\"2ca07cb0-b5f4-4761-b954-faf2131872d9\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1500,220],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"8d682dae-6f88-42f0-a717-affffd37d882\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1140,-520],\"parameters\":{\"height\":80,\"content\":\"### Replace credentials.\"},\"typeVersion\":1},{\"id\":\"796b5dca-d60e-43a9-afe8-194244643557\",\"name\":\"Sticky Note9\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-520,-940],\"parameters\":{\"color\":7,\"width\":330.5152611046425,\"height\":239.5888196628349,\"content\":\"### ... or watch set up video [10 min]\\n[![Youtube Thumbnail](https://res.cloudinary.com/de9jgixzm/image/upload/v1739773273/Youtube%20Thumbs/Chat%20With%20FIles.png)](https://www.youtube.com/watch?v=glWUkdZe_3w)\\n\"},\"typeVersion\":1},{\"id\":\"eba121de-a3f7-4ba5-8396-f7d64e648322\",\"name\":\"Sticky Note7\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-820,-1460],\"parameters\":{\"color\":7,\"width\":636.2128494576581,\"height\":497.1532689930921,\"content\":\"![5min Logo](https://res.cloudinary.com/de9jgixzm/image/upload/v1739773200/Skool%20Assets/ejm3hqnvhgwpnu2fv92s.png)\\n## AI Agent To Chat With Files In Supabase Storage\\n**Made by [Mark Shcherbakov](https://www.linkedin.com/in/marklowcoding/) from community [5minAI](https://www.skool.com/5minai-2861)**\\n\\nManually retrieving and analyzing specific information from large document repositories is time-consuming and inefficient. This workflow automates the process by vectorizing documents and enabling AI-powered interactions, making it easy to query and retrieve context-based information from uploaded files.\\n\\nThe workflow integrates Supabase with an AI-powered chatbot to process, store, and query text and PDF files. The steps include:\\n- Fetching and comparing files to avoid duplicate processing.\\n- Handling file downloads and extracting content based on the file type.\\n- Converting documents into vectorized data for contextual information retrieval.\\n- Storing and querying vectorized data from a Supabase vector store.\\n\\n\"},\"typeVersion\":1},{\"id\":\"df054036-d6b9-4f53-86cb-85ad96f07d0e\",\"name\":\"Sticky Note6\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-820,-940],\"parameters\":{\"color\":7,\"width\":280.2462120317618,\"height\":545.9087885077763,\"content\":\"### Set up steps\\n\\n1. **Fetch File List from Supabase**:\\n   - Use Supabase to retrieve the stored file list from a specified bucket.\\n   - Add logic to manage empty folder placeholders returned by Supabase, avoiding incorrect processing.\\n\\n2. **Compare and Filter Files**:\\n   - Aggregate the files retrieved from storage and compare them to the existing list in the Supabase `files` table.\\n   - Exclude duplicates and skip placeholder files to ensure only unprocessed files are handled.\\n\\n3. **Handle File Downloads**:\\n   - Download new files using detailed storage configurations for public/private access.\\n   - Adjust the storage settings and GET requests to match your Supabase setup.\\n\\n4. **File Type Processing**:\\n   - Use a Switch node to target specific file types (e.g., PDFs or text files).\\n   - Employ relevant tools to process the content:\\n     - For PDFs, extract embedded content.\\n     - For text files, directly process the text data.\\n\\n5. **Content Chunking**:\\n   - Break large text data into smaller chunks using the Text Splitter node.\\n   - Define chunk size (default: 500 tokens) and overlap to retain necessary context across chunks.\\n\\n6. **Vector Embedding Creation**:\\n   - Generate vectorized embeddings for the processed content using OpenAI's embedding tools.\\n   - Ensure metadata, such as file ID, is included for easy data retrieval.\\n\\n7. **Store Vectorized Data**:\\n   - Save the vectorized information into a dedicated Supabase vector store.\\n   - Use the default schema and table provided by Supabase for seamless setup.\\n\\n8. **AI Chatbot Integration**:\\n   - Add a chatbot node to handle user input and retrieve relevant document chunks.\\n   - Use metadata like file ID for targeted queries, especially when multiple documents are involved.\"},\"typeVersion\":1},{\"id\":\"450a1e49-4be9-451a-9d05-2860e29c3695\",\"name\":\"Sticky Note8\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[540,-1160],\"parameters\":{\"color\":5,\"width\":951.7421645394404,\"height\":809.7437181509877,\"content\":\"## Scenario 2 - AI agent\"},\"typeVersion\":1},{\"id\":\"c3814c5d-8881-4598-897e-268019bee1bc\",\"name\":\"Sticky Note10\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,-280],\"parameters\":{\"color\":5,\"width\":2304.723519246249,\"height\":739.2522526116408,\"content\":\"## Scenario 1 - Flow for adding new files from Supabase storage\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"If\":{\"main\":[[{\"node\":\"Download\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Merge\":{\"main\":[[{\"node\":\"Create File record2\",\"type\":\"main\",\"index\":0}]]},\"Switch\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Extract Document PDF\",\"type\":\"main\",\"index\":0}]]},\"Download\":{\"main\":[[{\"node\":\"Switch\",\"type\":\"main\",\"index\":0}]]},\"Aggregate\":{\"main\":[[{\"node\":\"Get All files\",\"type\":\"main\",\"index\":0}]]},\"Get All Files\":{\"main\":[[{\"node\":\"Aggregate\",\"type\":\"main\",\"index\":0}]]},\"Get All files\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Loop Over Items\":{\"main\":[null,[{\"node\":\"If\",\"type\":\"main\",\"index\":0}]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"Insert into Supabase Vectorstore\",\"type\":\"ai_embedding\",\"index\":0}]]},\"Embeddings OpenAI2\":{\"ai_embedding\":[[{\"node\":\"Supabase Vector Store\",\"type\":\"ai_embedding\",\"index\":0}]]},\"OpenAI Chat Model1\":{\"ai_languageModel\":[[{\"node\":\"AI Agent\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"OpenAI Chat Model2\":{\"ai_languageModel\":[[{\"node\":\"Vector Store Tool1\",\"type\":\"ai_languageModel\",\"index\":0}]]},\"Vector Store Tool1\":{\"ai_tool\":[[{\"node\":\"AI Agent\",\"type\":\"ai_tool\",\"index\":0}]]},\"Create File record2\":{\"main\":[[{\"node\":\"Insert into Supabase Vectorstore\",\"type\":\"main\",\"index\":0}]]},\"Default Data Loader\":{\"ai_document\":[[{\"node\":\"Insert into Supabase Vectorstore\",\"type\":\"ai_document\",\"index\":0}]]},\"Extract Document PDF\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"Supabase Vector Store\":{\"ai_vectorStore\":[[{\"node\":\"Vector Store Tool1\",\"type\":\"ai_vectorStore\",\"index\":0}]]},\"When chat message received\":{\"main\":[[{\"node\":\"AI Agent\",\"type\":\"main\",\"index\":0}]]},\"Insert into Supabase Vectorstore\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Recursive Character Text Splitter\":{\"ai_textSplitter\":[[{\"node\":\"Default Data Loader\",\"type\":\"ai_textSplitter\",\"index\":0}]]},\"When clicking ‘Test workflow’\":{\"main\":[[{\"node\":\"Get All Files\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Video Guide\n\nI prepared a detailed guide explaining how to set up and implement this scenario, enabling you to chat with your documents stored in Supabase using n8n.\n\n[![Youtube Thumbnail](https://res.cloudinary.com/de9jgixzm/image/upload/v1739773273/Youtube%20Thumbs/Chat%20With%20FIles.png)](https://www.youtube.com/watch?v=glWUkdZe_3w)\n\n[Youtube Link](https://www.youtube.com/watch?v=glWUkdZe_3w)\n\n### Who is this for?\n\nThis workflow is ideal for researchers, analysts, business owners, or anyone managing a large collection of documents. It's particularly beneficial for those who need quick contextual information retrieval from text-heavy files stored in Supabase, without needing additional services like Google Drive.\n\n### What problem does this workflow solve?\n\nManually retrieving and analyzing specific information from large document repositories is time-consuming and inefficient. This workflow automates the process by vectorizing documents and enabling AI-powered interactions, making it easy to query and retrieve context-based information from uploaded files.\n\n### What this workflow does\n\nThe workflow integrates Supabase with an AI-powered chatbot to process, store, and query text and PDF files. The steps include:\n\n  * Fetching and comparing files to avoid duplicate processing.\n  * Handling file downloads and extracting content based on the file type.\n  * Converting documents into vectorized data for contextual information retrieval.\n  * Storing and querying vectorized data from a Supabase vector store.\n\n\n  1. **File Extraction and Processing** : Automates handling of multiple file formats (e.g., PDFs, text files), and extracts document content.\n  2. **Vectorized Embeddings Creation** : Generates embeddings for processed data to enable AI-driven interactions.\n  3. **Dynamic Data Querying** : Allows users to query their document repository conversationally using a chatbot.\n\n\n\n### Setup\n\n#### N8N Workflow\n\n  1. **Fetch File List from Supabase** :\n\n     * Use Supabase to retrieve the stored file list from a specified bucket.\n     * Add logic to manage empty folder placeholders returned by Supabase, avoiding incorrect processing.\n  2. **Compare and Filter Files** :\n\n     * Aggregate the files retrieved from storage and compare them to the existing list in the Supabase `files` table.\n     * Exclude duplicates and skip placeholder files to ensure only unprocessed files are handled.\n  3. **Handle File Downloads** :\n\n     * Download new files using detailed storage configurations for public/private access.\n     * Adjust the storage settings and GET requests to match your Supabase setup.\n  4. **File Type Processing** :\n\n     * Use a Switch node to target specific file types (e.g., PDFs or text files).\n     * Employ relevant tools to process the content: \n       * For PDFs, extract embedded content.\n       * For text files, directly process the text data.\n  5. **Content Chunking** :\n\n     * Break large text data into smaller chunks using the Text Splitter node.\n     * Define chunk size (default: 500 tokens) and overlap to retain necessary context across chunks.\n  6. **Vector Embedding Creation** :\n\n     * Generate vectorized embeddings for the processed content using OpenAI's embedding tools.\n     * Ensure metadata, such as file ID, is included for easy data retrieval.\n  7. **Store Vectorized Data** :\n\n     * Save the vectorized information into a dedicated Supabase vector store.\n     * Use the default schema and table provided by Supabase for seamless setup.\n  8. **AI Chatbot Integration** :\n\n     * Add a chatbot node to handle user input and retrieve relevant document chunks.\n     * Use metadata like file ID for targeted queries, especially when multiple documents are involved.\n\n\n\n### Testing\n\n  * Upload sample files to your Supabase bucket.\n  * Verify if files are processed and stored successfully in the vector store.\n  * Ask simple conversational questions about your documents using the chatbot (e.g., \"What does Chapter 1 say about the Roman Empire?\").\n  * Test for accuracy and contextual relevance of retrieved results.\n\n\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><h3>Video Guide</h3>\n<p>I prepared a detailed guide explaining how to set up and implement this scenario, enabling you to chat with your documents stored in Supabase using n8n.</p>\n<p><a href=\"https://www.youtube.com/watch?v=glWUkdZe_3w\" rel=\"ugc nofollow\" target=\"_blank\"><img src=\"https://res.cloudinary.com/de9jgixzm/image/upload/v1739773273/Youtube%20Thumbs/Chat%20With%20FIles.png\" alt=\"Youtube Thumbnail\"></a></p>\n<p><a href=\"https://www.youtube.com/watch?v=glWUkdZe_3w\" rel=\"ugc nofollow\" target=\"_blank\">Youtube Link</a></p>\n<h3>Who is this for?</h3>\n<p>This workflow is ideal for researchers, analysts, business owners, or anyone managing a large collection of documents. It's particularly beneficial for those who need quick contextual information retrieval from text-heavy files stored in Supabase, without needing additional services like Google Drive.</p>\n<h3>What problem does this workflow solve?</h3>\n<p>Manually retrieving and analyzing specific information from large document repositories is time-consuming and inefficient. This workflow automates the process by vectorizing documents and enabling AI-powered interactions, making it easy to query and retrieve context-based information from uploaded files.</p>\n<h3>What this workflow does</h3>\n<p>The workflow integrates Supabase with an AI-powered chatbot to process, store, and query text and PDF files. The steps include:</p>\n<ul>\n<li>Fetching and comparing files to avoid duplicate processing.</li>\n<li>Handling file downloads and extracting content based on the file type.</li>\n<li>Converting documents into vectorized data for contextual information retrieval.</li>\n<li>Storing and querying vectorized data from a Supabase vector store.</li>\n</ul>\n<ol>\n<li><strong>File Extraction and Processing</strong>: Automates handling of multiple file formats (e.g., PDFs, text files), and extracts document content.</li>\n<li><strong>Vectorized Embeddings Creation</strong>: Generates embeddings for processed data to enable AI-driven interactions.</li>\n<li><strong>Dynamic Data Querying</strong>: Allows users to query their document repository conversationally using a chatbot.</li>\n</ol>\n<h3>Setup</h3>\n<h4>N8N Workflow</h4>\n<ol>\n<li>\n<p><strong>Fetch File List from Supabase</strong>:</p>\n<ul>\n<li>Use Supabase to retrieve the stored file list from a specified bucket.</li>\n<li>Add logic to manage empty folder placeholders returned by Supabase, avoiding incorrect processing.</li>\n</ul>\n</li>\n<li>\n<p><strong>Compare and Filter Files</strong>:</p>\n<ul>\n<li>Aggregate the files retrieved from storage and compare them to the existing list in the Supabase <code>files</code> table.</li>\n<li>Exclude duplicates and skip placeholder files to ensure only unprocessed files are handled.</li>\n</ul>\n</li>\n<li>\n<p><strong>Handle File Downloads</strong>:</p>\n<ul>\n<li>Download new files using detailed storage configurations for public/private access.</li>\n<li>Adjust the storage settings and GET requests to match your Supabase setup.</li>\n</ul>\n</li>\n<li>\n<p><strong>File Type Processing</strong>:</p>\n<ul>\n<li>Use a Switch node to target specific file types (e.g., PDFs or text files).</li>\n<li>Employ relevant tools to process the content:\n<ul>\n<li>For PDFs, extract embedded content.</li>\n<li>For text files, directly process the text data.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Content Chunking</strong>:</p>\n<ul>\n<li>Break large text data into smaller chunks using the Text Splitter node.</li>\n<li>Define chunk size (default: 500 tokens) and overlap to retain necessary context across chunks.</li>\n</ul>\n</li>\n<li>\n<p><strong>Vector Embedding Creation</strong>:</p>\n<ul>\n<li>Generate vectorized embeddings for the processed content using OpenAI's embedding tools.</li>\n<li>Ensure metadata, such as file ID, is included for easy data retrieval.</li>\n</ul>\n</li>\n<li>\n<p><strong>Store Vectorized Data</strong>:</p>\n<ul>\n<li>Save the vectorized information into a dedicated Supabase vector store.</li>\n<li>Use the default schema and table provided by Supabase for seamless setup.</li>\n</ul>\n</li>\n<li>\n<p><strong>AI Chatbot Integration</strong>:</p>\n<ul>\n<li>Add a chatbot node to handle user input and retrieve relevant document chunks.</li>\n<li>Use metadata like file ID for targeted queries, especially when multiple documents are involved.</li>\n</ul>\n</li>\n</ol>\n<h3>Testing</h3>\n<ul>\n<li>Upload sample files to your Supabase bucket.</li>\n<li>Verify if files are processed and stored successfully in the vector store.</li>\n<li>Ask simple conversational questions about your documents using the chatbot (e.g., \"What does Chapter 1 say about the Roman Empire?\").</li>\n<li>Test for accuracy and contextual relevance of retrieved results.</li>\n</ul>\n</div><!--]-->",
  "readme_zh": "### 视频指南\n\n我制作了一份详细教程，讲解如何配置并实现这一场景，让您能够通过n8n与存储在Supabase中的文档进行对话。\n\n[![YouTube缩略图](https://res.cloudinary.com/de9jgixzm/image/upload/v1739773273/Youtube%20Thumbs/Chat%20With%20FIles.png)](https://www.youtube.com/watch?v=glWUkdZe_3w)\n\n[YouTube视频链接](https://www.youtube.com/watch?v=glWUkdZe_3w)\n\n### 适用人群\n\n本工作流特别适合研究人员、分析师、企业主或需要管理大量文档的用户。对于需要从Supabase存储的文本密集型文件中快速获取上下文信息，且不希望依赖Google Drive等额外服务的用户尤为实用。\n\n### 解决什么问题？\n\n从海量文档库中手动检索分析特定信息既耗时又低效。本工作流通过向量化文档和AI对话功能实现自动化处理，让用户能轻松查询并获取上传文件中的上下文关联信息。\n\n### 功能说明\n\n该工作流将Supabase与AI聊天机器人集成，实现文本/PDF文件的处理、存储和查询。主要步骤包括：\n\n  * 获取并比对文件避免重复处理\n  * 根据文件类型下载并提取内容\n  * 将文档转化为向量数据实现上下文检索\n  * 在Supabase向量数据库中存储和查询数据\n\n三大核心功能：\n1. **文件提取处理**：自动处理多格式文件（如PDF/文本），提取文档内容\n2. **向量嵌入生成**：为处理后的数据创建嵌入，支持AI驱动交互\n3. **动态数据查询**：通过聊天机器人以对话形式查询文档库\n\n### 配置说明\n\n#### N8N工作流配置\n\n1. **从Supabase获取文件列表**：\n   - 从指定存储桶获取已存文件列表\n   - 添加逻辑处理Supabase返回的空文件夹占位符，避免误处理\n\n2. **文件比对筛选**：\n   - 聚合存储桶文件并与Supabase的files表比对\n   - 排除重复项和占位文件，确保仅处理新文件\n\n3. **文件下载处理**：\n   - 根据公开/私有访问配置下载新文件\n   - 调整存储设置和GET请求以匹配您的Supabase配置\n\n4. **文件类型处理**：\n   - 使用Switch节点区分处理PDF/文本等文件类型\n   - PDF使用嵌入式内容提取，文本文件直接处理\n\n5. **内容分块处理**：\n   - 用Text Splitter节点将大文本分割为500字符的块（可调）\n   - 设置重叠量保持上下文连贯性\n\n6. **向量嵌入生成**：\n   - 通过OpenAI工具生成内容向量\n   - 包含文件ID等元数据便于检索\n\n7. **向量数据存储**：\n   - 将向量数据存入Supabase专用向量存储\n   - 使用Supabase提供的默认模式和表\n\n8. **AI聊天机器人集成**：\n   - 添加聊天节点处理用户查询\n   - 利用文件ID等元数据进行精准查询（多文档场景尤需）\n\n### 测试验证\n\n1. 上传样本文件至Supabase存储桶\n2. 确认文件是否成功处理并存入向量库\n3. 通过聊天机器人提问测试（如\"第一章关于罗马帝国有哪些论述？\"）\n4. 验证返回结果的准确性和上下文相关性",
  "title_zh": "Supabase存储中与文件对话的AI代理",
  "publish_date_zh": "Last update 2 months ago",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"6a2a7715680b8313f7cb4676321c5baa46680adfb913072f089f2766f42e43bd\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"f577f6bd-b1a4-48ec-9329-7bccc3fc1463\",\n      \"name\": \"Get All files\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        400,\n        -100\n      ],\n      \"parameters\": {\n        \"url\": \"=https://yqtvdcvjboenlblgcivl.supabase.co/storage/v1/object/list/private\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"prefix\\\": \\\"\\\",\\n  \\\"limit\\\": 100,\\n  \\\"offset\\\": 0,\\n  \\\"sortBy\\\": {\\n    \\\"column\\\": \\\"name\\\",\\n    \\\"order\\\": \\\"asc\\\"\\n  }\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"supabaseApi\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account My Airtable Gen\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"10693bc8-560d-4cf6-8bd0-2fe3f4d863d1\",\n      \"name\": \"Default Data Loader\",\n      \"type\": \"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\n      \"position\": [\n        1780,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"=file_id\",\n                \"value\": \"={{ $json.id }}\"\n              }\n            ]\n          }\n        },\n        \"jsonData\": \"={{ $('Merge').item.json.data ?? $('Merge').item.json.text }}\",\n        \"jsonMode\": \"expressionData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"49428060-e707-4269-8344-77b301f56f7c\",\n      \"name\": \"Recursive Character Text Splitter\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter\",\n      \"position\": [\n        1780,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"chunkSize\": 500,\n        \"chunkOverlap\": 200\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"08742063-e235-4874-a128-b352786b19ce\",\n      \"name\": \"Extract Document PDF\",\n      \"type\": \"n8n-nodes-base.extractFromFile\",\n      \"position\": [\n        1240,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"pdf\"\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"21f19360-d7ce-4106-ae5a-aa0f15b7c4aa\",\n      \"name\": \"Embeddings OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        1600,\n        80\n      ],\n      \"parameters\": {\n        \"model\": \"text-embedding-3-small\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"fLfRtaXbR0EVD0pl\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4147409f-8686-418f-b979-04f8c8e7fe42\",\n      \"name\": \"Create File record2\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        1540,\n        -100\n      ],\n      \"parameters\": {\n        \"tableId\": \"files\",\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"name\",\n              \"fieldValue\": \"={{ $('Loop Over Items').item.json.name }}\"\n            },\n            {\n              \"fieldId\": \"storage_id\",\n              \"fieldValue\": \"={{ $('Loop Over Items').item.json.id }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account My Airtable Gen\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"016f1afe-172b-4609-b451-8d67609214d3\",\n      \"name\": \"If\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        720,\n        -100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"9b14e306-a04d-40f7-bc5b-b8eda8d8f7f2\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ \\n    !$('Aggregate').item.json.data || \\n    !Array.isArray($('Aggregate').item.json.data) || \\n    !$('Aggregate').item.json.data.some(item => \\n        item.storage_id === $('Loop Over Items').item.json.id \\n    ) \\n}}\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"c3c0af88-9aea-4539-8948-1b69e601c27c\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEquals\"\n              },\n              \"leftValue\": \"={{ $json.name }}\",\n              \"rightValue\": \".emptyFolderPlaceholder\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"75e8a7db-8c4a-4ad8-b902-062cbc93e1eb\",\n      \"name\": \"Get All Files\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        20,\n        -100\n      ],\n      \"parameters\": {\n        \"tableId\": \"files\",\n        \"operation\": \"getAll\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account My Airtable Gen\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"b22a3bab-f615-4d8a-8832-ce25b1a385fe\",\n      \"name\": \"Download\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        900,\n        -100\n      ],\n      \"parameters\": {\n        \"url\": \"=https://yqtvdcvjboenlblgcivl.supabase.co/storage/v1/object/private/{{ $json.name }}\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"supabaseApi\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account My Airtable Gen\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"50d1fede-4bd0-4cd4-b74a-7d689fe211cc\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        560,\n        -100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"batchSize\": \"=1\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"f9c23b5e-0b40-4886-b54f-59fb46132d3f\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -160,\n        -100\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0a0ec290-2c3d-40ba-8d03-6abf75202e73\",\n      \"name\": \"Aggregate\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        220,\n        -100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\"\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"32b3e2e1-2d25-4dd1-93e8-3f693beb7b6f\",\n      \"name\": \"When chat message received\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        800,\n        -1020\n      ],\n      \"webhookId\": \"3c40d311-7996-4ed4-b2fa-c73bea5f4cf5\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"79073b5c-a4ad-45a6-bbfa-e900a05bfde3\",\n      \"name\": \"OpenAI Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        940,\n        -820\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"zJhr5piyEwVnWtaI\",\n          \"name\": \"OpenAi club\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f8663483-76d5-4fc8-ad07-7eec815ff7a6\",\n      \"name\": \"Embeddings OpenAI2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        1020,\n        -540\n      ],\n      \"parameters\": {\n        \"model\": \"text-embedding-3-small\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"SphXAX7rlwRLkiox\",\n          \"name\": \"Test club key\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a1458799-d379-46de-93e6-a5ba0c665163\",\n      \"name\": \"OpenAI Chat Model2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1300,\n        -680\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"SphXAX7rlwRLkiox\",\n          \"name\": \"Test club key\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d6eeda2f-c984-406d-a625-726840308413\",\n      \"name\": \"Vector Store Tool1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolVectorStore\",\n      \"position\": [\n        1100,\n        -820\n      ],\n      \"parameters\": {\n        \"name\": \"knowledge_base\",\n        \"topK\": 8,\n        \"description\": \"Retrieve data about user request\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e1d9a348-7d44-4ad1-adbd-2c9a31e06876\",\n      \"name\": \"Switch\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        1060,\n        -100\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"txt\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"operator\": {\n                      \"type\": \"boolean\",\n                      \"operation\": \"true\",\n                      \"singleValue\": true\n                    },\n                    \"leftValue\": \"={{$binary.data?.fileExtension == undefined }}\",\n                    \"rightValue\": \"txt\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"pdf\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"bf04cbec-dd86-4607-988f-4c96b6fd4b58\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{$binary.data.fileExtension  }}\",\n                    \"rightValue\": \"pdf\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.1\n    },\n    {\n      \"id\": \"d38afb92-87ae-4e2a-a712-ec24b1efd105\",\n      \"name\": \"Insert into Supabase Vectorstore\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\n      \"position\": [\n        1700,\n        -100\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"options\": {\n          \"queryName\": \"match_documents\"\n        },\n        \"tableName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"documents\",\n          \"cachedResultName\": \"documents\"\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account My Airtable Gen\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1a903b2e-cab0-4798-b820-ec08d6a71ddd\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1380,\n        -100\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"3afd552e-4995-493e-9cd5-ef496dfe359f\",\n      \"name\": \"AI Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        1020,\n        -1020\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"d9688acc-311b-42fd-afa8-2c0e493be34b\",\n      \"name\": \"Supabase Vector Store\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\n      \"position\": [\n        1020,\n        -660\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"file_id\",\n                \"value\": \"300b0128-0955-4058-b0d3-a9aefe728432\"\n              }\n            ]\n          }\n        },\n        \"tableName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"documents\",\n          \"cachedResultName\": \"documents\"\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"t8AQJzvZvrOMDLec\",\n          \"name\": \"Supabase account My Airtable Gen\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"66df007c-0418-4551-950e-32e7d79840bd\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        340,\n        -220\n      ],\n      \"parameters\": {\n        \"height\": 89.3775420487804,\n        \"content\": \"### Replace Storage name, database ID and credentials.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b164b520-20dd-44a4-aa3b-647391786b20\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -20,\n        -220\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 更换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8688c219-5af4-4e54-9fd1-91851829445b\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1540,\n        -220\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 更换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"45c6ece4-f849-4496-8149-31385f5e36a4\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        840,\n        -220\n      ],\n      \"parameters\": {\n        \"height\": 89.3775420487804,\n        \"content\": \"### 替换存储名称、数据库ID和凭据。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2ca07cb0-b5f4-4761-b954-faf2131872d9\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1500,\n        220\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 更换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8d682dae-6f88-42f0-a717-affffd37d882\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1140,\n        -520\n      ],\n      \"parameters\": {\n        \"height\": 80,\n        \"content\": \"### 更换凭据\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"796b5dca-d60e-43a9-afe8-194244643557\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -520,\n        -940\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 330.5152611046425,\n        \"height\": 239.5888196628349,\n        \"content\": \"### ...或观看安装视频 [10分钟]\\n[![YouTube缩略图](https://res.cloudinary.com/de9jgixzm/image/upload/v1739773273/Youtube%20Thumbs/Chat%20With%20FIles.png)](https://www.youtube.com/watch?v=glWUkdZe_3w)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"eba121de-a3f7-4ba5-8396-f7d64e648322\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -820,\n        -1460\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 636.2128494576581,\n        \"height\": 497.1532689930921,\n        \"content\": \"![5min 标志](https://res.cloudinary.com/de9jgixzm/image/upload/v1739773200/Skool%20Assets/ejm3hqnvhgwpnu2fv92s.png)  \\n## 基于Supabase存储的AI文件对话助手  \\n**由[5minAI社区](https://www.skool.com/5minai-2861)的[Mark Shcherbakov](https://www.linkedin.com/in/marklowcoding/)开发**  \\n\\n传统人工检索和分析海量文档库中的特定信息耗时低效。本工作流通过文档向量化与AI智能交互实现流程自动化，可轻松查询并获取上传文件中的上下文关联信息。  \\n\\n该工作流将Supabase与AI聊天机器人深度集成，支持文本及PDF文件的处理、存储与智能查询。主要步骤包括：  \\n- 文件抓取与比对，避免重复处理  \\n- 多格式文件下载与内容提取  \\n- 文档向量化转换，实现上下文感知检索  \\n- Supabase矢量数据库的存储与查询\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"df054036-d6b9-4f53-86cb-85ad96f07d0e\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -820,\n        -940\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 280.2462120317618,\n        \"height\": 545.9087885077763,\n        \"content\": \"### 设置步骤\\n\\n1. **从Supabase获取文件列表**：\\n   - 使用Supabase从指定存储桶中检索已存储的文件列表。\\n   - 添加逻辑处理Supabase返回的空文件夹占位符，避免错误处理。\\n\\n2. **比较并筛选文件**：\\n   - 汇总从存储中检索到的文件，并与Supabase的`files`表中现有列表进行对比。\\n   - 排除重复项并跳过占位符文件，确保仅处理未处理的文件。\\n\\n3. **处理文件下载**：\\n   - 使用详细的存储配置（公共/私有访问权限）下载新文件。\\n   - 根据Supabase设置调整存储参数和GET请求。\\n\\n4. **文件类型处理**：\\n   - 使用Switch节点针对特定文件类型（如PDF或文本文件）。\\n   - 采用相应工具处理内容：\\n     - 对于PDF，提取嵌入内容。\\n     - 对于文本文件，直接处理文本数据。\\n\\n5. **内容分块**：\\n   - 使用文本分割器节点将大段文本数据切分为更小的块。\\n   - 定义分块大小（默认500个词元）和重叠部分，以保留跨分块的必要上下文。\\n\\n6. **创建向量嵌入**：\\n   - 使用OpenAI的嵌入工具为处理后的内容生成向量化嵌入。\\n   - 确保包含元数据（如文件ID），以便轻松检索数据。\\n\\n7. **存储向量化数据**：\\n   - 将向量化信息保存到专用的Supabase向量存储中。\\n   - 使用Supabase提供的默认模式和表以实现无缝设置。\\n\\n8. **集成AI聊天机器人**：\\n   - 添加聊天机器人节点以处理用户输入并检索相关文档块。\\n   - 利用文件ID等元数据进行定向查询，特别是在涉及多文档时。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"450a1e49-4be9-451a-9d05-2860e29c3695\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        540,\n        -1160\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 951.7421645394404,\n        \"height\": 809.7437181509877,\n        \"content\": \"## 场景二 - AI代理\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c3814c5d-8881-4598-897e-268019bee1bc\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -260,\n        -280\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 2304.723519246249,\n        \"height\": 739.2522526116408,\n        \"content\": \"## 场景一 - 从Supabase存储添加新文件的流程\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create File record2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Extract Document PDF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Aggregate\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get All files\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get All Files\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Aggregate\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get All files\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        null,\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI2\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Supabase Vector Store\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model2\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Vector Store Tool1\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Vector Store Tool1\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create File record2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Default Data Loader\": {\n      \"ai_document\": [\n        [\n          {\n            \"node\": \"Insert into Supabase Vectorstore\",\n            \"type\": \"ai_document\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract Document PDF\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Supabase Vector Store\": {\n      \"ai_vectorStore\": [\n        [\n          {\n            \"node\": \"Vector Store Tool1\",\n            \"type\": \"ai_vectorStore\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When chat message received\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Insert into Supabase Vectorstore\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Recursive Character Text Splitter\": {\n      \"ai_textSplitter\": [\n        [\n          {\n            \"node\": \"Default Data Loader\",\n            \"type\": \"ai_textSplitter\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get All Files\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
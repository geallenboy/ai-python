{
  "title": "Git backup of workflows and credentials",
  "url": "https://n8n.io/workflows/1053-git-backup-of-workflows-and-credentials/",
  "category": "Engineering",
  "category_url": "https://n8n.io/workflows/categories/engineering/",
  "author": "Allan Daemon",
  "publish_date": "Last update 9 months ago",
  "publish_date_absolute": "",
  "content": "",
  "workflow_json": "{\"id\":\"15\",\"name\":\"Tools / Backup Gitlab\",\"nodes\":[{\"name\":\"On clicking 'execute'\",\"type\":\"n8n-nodes-base.manualTrigger\",\"position\":[250,400],\"parameters\":{},\"typeVersion\":1},{\"name\":\"Export Workflows\",\"type\":\"n8n-nodes-base.executeCommand\",\"position\":[450,300],\"parameters\":{\"command\":\"npx n8n export:workflow --backup --output repo/workflows/\"},\"typeVersion\":1},{\"name\":\"Export Credentials\",\"type\":\"n8n-nodes-base.executeCommand\",\"position\":[600,300],\"parameters\":{\"command\":\"npx n8n export:credentials --backup --output repo/credentials/\"},\"typeVersion\":1},{\"name\":\"git add\",\"type\":\"n8n-nodes-base.executeCommand\",\"position\":[750,300],\"parameters\":{\"command\":\"git -C repo add .\"},\"typeVersion\":1},{\"name\":\"git commit\",\"type\":\"n8n-nodes-base.executeCommand\",\"position\":[900,300],\"parameters\":{\"command\":\"=git -C repo commit -m \\\"Auto backup ({{ new Date().toISOString() }})\\\"\"},\"typeVersion\":1},{\"name\":\"git push\",\"type\":\"n8n-nodes-base.executeCommand\",\"position\":[1050,300],\"parameters\":{\"command\":\"git -C repo push\"},\"typeVersion\":1},{\"name\":\"Cron\",\"type\":\"n8n-nodes-base.cron\",\"position\":[250,200],\"parameters\":{\"triggerTimes\":{\"item\":[{\"hour\":0},{\"hour\":12},{\"hour\":6},{\"hour\":18}]}},\"typeVersion\":1}],\"active\":true,\"settings\":{},\"connections\":{\"Cron\":{\"main\":[[{\"node\":\"Export Workflows\",\"type\":\"main\",\"index\":0}]]},\"git add\":{\"main\":[[{\"node\":\"git commit\",\"type\":\"main\",\"index\":0}]]},\"git commit\":{\"main\":[[{\"node\":\"git push\",\"type\":\"main\",\"index\":0}]]},\"Export Workflows\":{\"main\":[[{\"node\":\"Export Credentials\",\"type\":\"main\",\"index\":0}]]},\"Export Credentials\":{\"main\":[[{\"node\":\"git add\",\"type\":\"main\",\"index\":0}]]},\"On clicking 'execute'\":{\"main\":[[{\"node\":\"Export Workflows\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This creates a git backup of the workflows and credentials.\n\nIt uses the n8n export command with git diff, so you can run as many times as you want, but only when there are changes they will create a commit.\n\n# Setup\n\n_You need some access to the server._\n\nCreate a repository in some remote place to host your project, like Github, Gitlab, or your favorite private repo.\n\nClone the repository in the server in a place that the n8n has access. In the example, it's the `.`, and the repository name is `repo`. Change it in the commands _and in the workflow commands_ (you can set it as a variable in the wokflow). Checkout to another branch if you won't use the master one.\n    \n    \n    cd .\n    git clone repository\n    \n\nOr you could `git init` and then add the remote (`git remote add origin YOUR_REPO_URL`), whatever pleases you more.\n\nAs the server, check if everything is ok for beeing able to commit. Very likely you'll need to setup the user email and name. Try to create a commit, and push it to upstream, and everything you need (like config a user to comit) will appear in way. I strong suggest testing with exporting the commands to garantee it will work too.\n    \n    \n    cd ./repo\n    \n    git commit -c \"Initial commmit\" --allow-empty\n    \n\n-u is the same as --set-upstream\n    \n    \n    git push -u origin master \n    \n\nTesting to push to upstream with the first exported data\n    \n    \n    npx n8n export:workflow --backup --output ./repo/workflows/\n    npx n8n export:credentials --backup --output repo/credentials/\n    \n    cd ./repo\n    git add .\n    git commit -c \"manual backup: first export\"\n    git push\n    \n\nAfter that, if everything is ok, the workflow should work just fine.\n\n## Adjustments\n\nAdjust the path in used in the workflow. See the the `git -C PATH` command is the same as `cd PATH; git ...`.\n\nAlso, adjust the cron to run as you need. As I said in the beginning, you can run it even for every minute, but it will create commits only when there are changes.\n\n### Credentials encryption\n\nThe default for exporting the credentials is to do them encrypted. You can add the flag `--decrypted` to the `n8n export:credentials` command if you need to save them in plain. But as general rule, it's better to save the encryption key, that you only need to do that once, and them export it safely encrypted.\n",
  "readme_html": "<!--[--><div data-v-50766329=\"\"><p>This creates a git backup of the workflows and credentials.</p>\n<p>It uses the n8n export command with git diff, so you can run as many times as you want, but only when there are changes they will create a commit.</p>\n<h1>Setup</h1>\n<p><em>You need some access to the server.</em></p>\n<p>Create a repository in some remote place to host your project, like Github, Gitlab, or your favorite private repo.</p>\n<p>Clone the repository in the server in a place that the n8n has access. In the example, it's the <code>.</code>, and the repository name is <code>repo</code>. Change it in the commands <em>and in the workflow commands</em> (you can set it as a variable in the wokflow). Checkout to another branch if you won't use the master one.</p>\n<pre><code>cd .\ngit clone repository\n</code></pre>\n<p>Or you could <code>git init</code> and then add the remote (<code>git remote add origin YOUR_REPO_URL</code>), whatever pleases you more.</p>\n<p>As the server, check if everything is ok for beeing able to commit. Very likely you'll need to setup the user email and name. Try to create a commit, and push it to upstream, and everything you need (like config a user to comit) will appear in way. I strong suggest testing with exporting the commands to garantee it will work too.</p>\n<pre><code>cd ./repo\n\ngit commit -c \"Initial commmit\" --allow-empty\n</code></pre>\n<p>-u is the same as --set-upstream</p>\n<pre><code>git push -u origin master \n</code></pre>\n<p>Testing to push to upstream with the first exported data</p>\n<pre><code>npx n8n export:workflow --backup --output ./repo/workflows/\nnpx n8n export:credentials --backup --output repo/credentials/\n\ncd ./repo\ngit add .\ngit commit -c \"manual backup: first export\"\ngit push\n</code></pre>\n<p>After that, if everything is ok, the workflow should work just fine.</p>\n<h2>Adjustments</h2>\n<p>Adjust the path in used in the workflow. See the the <code>git -C PATH</code> command is the same as <code>cd PATH; git ...</code>.</p>\n<p>Also, adjust the cron to run as you need. As I said in the beginning, you can run it even for every minute, but it will create commits only when there are changes.</p>\n<h3>Credentials encryption</h3>\n<p>The default for exporting the credentials is to do them encrypted. You can add the flag <code>--decrypted</code> to the <code>n8n export:credentials</code> command if you need to save them in plain. But as general rule, it's better to save the encryption key, that you only need to do that once, and them export it safely encrypted.</p>\n</div><!--]-->"
}
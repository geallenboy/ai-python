{
  "title": "MFA Multi-factor authentication (Voice call and Email) with ClickSend and SMTP",
  "url": "https://n8n.io/workflows/3142-mfa-multi-factor-authentication-voice-call-and-email-with-clicksend-and-smtp/",
  "category": "SecOps",
  "category_url": "https://n8n.io/workflows/categories/secops/?count=20",
  "author": "Davide",
  "publish_date": "Last update a month ago",
  "content": "",
  "workflow_json": "{\"id\":\"1g8EAij2RwhNN70t\",\"meta\":{\"instanceId\":\"a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462\",\"templateCredsSetupCompleted\":true},\"name\":\"xSend and check TTS (Text-to-speech) voice calls end email verification\",\"tags\":[],\"nodes\":[{\"id\":\"56842e20-266b-4770-b4cd-3106418caefa\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-480,-740],\"parameters\":{\"width\":440,\"height\":180,\"content\":\"## STEP 1\\n[Register here to ClickSend](https://clicksend.com/?u=586989) and obtain your API Key and 2 € of free credits\\n\\nIn the node \\\"Send Voice\\\" create a \\\"Basic Auth\\\" with the username you registered and the API Key provided as your password\"},\"typeVersion\":1},{\"id\":\"9dfff5ae-fc04-4957-a7b6-6866e8ab0854\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-480,-320],\"parameters\":{\"width\":440,\"content\":\"## STEP 3\\n\\nSubmit the form and you will receive a call to the phone number you entered where the selected voice will tell you the content of the text you wrote.\"},\"typeVersion\":1},{\"id\":\"914666e8-1dc3-4d71-abf7-408b66a4508c\",\"name\":\"Send Voice\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[260,0],\"parameters\":{\"url\":\"https://rest.clicksend.com/v3/voice/send\",\"method\":\"POST\",\"options\":{},\"jsonBody\":\"={\\n  \\\"messages\\\": [\\n    {\\n      \\\"source\\\": \\\"n8n\\\",\\n      \\\"body\\\": \\\"Your verification number is {{ $json.Code }}\\\",\\n      \\\"to\\\": \\\"{{ $('On form submission').item.json.To }}\\\",\\n      \\\"voice\\\": \\\"{{ $('On form submission').item.json.Voice }}\\\",\\n      \\\"lang\\\": \\\"{{ $('On form submission').item.json.Lang }}\\\",\\n      \\\"machine_detection\\\": 1\\n    }\\n  ]\\n}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpBasicAuth\",\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\" application/json\"},{}]}},\"credentials\":{\"httpBasicAuth\":{\"id\":\"UwsDe2JxT39eWIvY\",\"name\":\"ClickSend API\"}},\"typeVersion\":4.2},{\"id\":\"838266ee-33aa-4380-9335-5290cad30504\",\"name\":\"On form submission\",\"type\":\"n8n-nodes-base.formTrigger\",\"position\":[-440,0],\"webhookId\":\"194f453a-1d86-4222-bd4d-117f03005560\",\"parameters\":{\"options\":{},\"formTitle\":\"Send Voice Message\",\"formFields\":{\"values\":[{\"fieldLabel\":\"To\",\"placeholder\":\"+39xxxx\",\"requiredField\":true},{\"fieldType\":\"dropdown\",\"fieldLabel\":\"Voice\",\"fieldOptions\":{\"values\":[{\"option\":\"male\"},{\"option\":\"female\"}]},\"requiredField\":true},{\"fieldType\":\"dropdown\",\"fieldLabel\":\"Lang\",\"fieldOptions\":{\"values\":[{\"option\":\"en-us \\t\"},{\"option\":\"it-it\"},{\"option\":\"en-au\"},{\"option\":\"en-gb\"},{\"option\":\"de-de\"},{\"option\":\"es-es\"},{\"option\":\"fr-fr\"},{\"option\":\"is-is\"},{\"option\":\"da-dk\"},{\"option\":\"nl-nl\"},{\"option\":\"pl-pl\"},{\"option\":\"pt-br\"},{\"option\":\"ru-ru\"}]},\"requiredField\":true},{\"fieldType\":\"email\",\"fieldLabel\":\"Email\",\"placeholder\":\"Email\",\"requiredField\":true},{\"fieldLabel\":\"Nome \",\"placeholder\":\"Nome\",\"requiredField\":true}]}},\"typeVersion\":2.2},{\"id\":\"aab0e353-0af0-4867-9178-4195c6ed045b\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-480,-1020],\"parameters\":{\"color\":3,\"width\":440,\"height\":240,\"content\":\"## Send and Check TTS (Text-to-Speech) Voice Calls with Email Verification\\n\\nThis workflow automates the process of sending voice calls for verification purposes and combines it with email verification. It uses the ClickSend API for voice calls and integrates with SMTP for email verification. \\n\"},\"typeVersion\":1},{\"id\":\"f4c3e305-be7e-43e7-a874-2767a0411624\",\"name\":\"Send Email\",\"type\":\"n8n-nodes-base.emailSend\",\"position\":[1180,-100],\"webhookId\":\"92aa0a80-8bea-47b7-86ef-bebc90435526\",\"parameters\":{\"html\":\"=Hi {{ $('On form submission').item.json['Nome '] }},<br>\\nThe email verification code is <b>{{ $json['Code Email'] }}</b>\",\"options\":{},\"subject\":\"Verify your code\",\"toEmail\":\"={{ $('On form submission').item.json['Email'] }}\",\"fromEmail\":\"EMAIL\"},\"credentials\":{\"smtp\":{\"id\":\"hRjP3XbDiIQqvi7x\",\"name\":\"SMTP info@n3witalia.com\"}},\"typeVersion\":2.1},{\"id\":\"5a3ff941-6d25-4479-bedc-c3cfa7c75e36\",\"name\":\"Code for voice\",\"type\":\"n8n-nodes-base.code\",\"position\":[40,0],\"parameters\":{\"jsCode\":\"// Loop over input items and modify the 'Code' field to add spaces between characters\\nfor (const item of $input.all()) {\\n  const code = item.json.Code;\\n\\n  const spacedCode = code.split('').join(' ');\\n\\n  item.json.Code = spacedCode;\\n}\\n\\nreturn $input.all();\"},\"typeVersion\":2},{\"id\":\"14ccfe99-8fbd-4cde-9ca3-c73e541086b3\",\"name\":\"Set voice code\",\"type\":\"n8n-nodes-base.set\",\"position\":[-220,0],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"89fb63af-790e-4388-9495-5f1e517ee486\",\"name\":\"Code\",\"type\":\"string\",\"value\":\"12345\"}]}},\"typeVersion\":3.4},{\"id\":\"b01e3604-5ca9-45cb-8a59-4f86f33d169b\",\"name\":\"Verify voice code\",\"type\":\"n8n-nodes-base.form\",\"position\":[480,0],\"webhookId\":\"b4356cb9-4185-4c65-b7c4-1f1e00a50ce0\",\"parameters\":{\"options\":{},\"formFields\":{\"values\":[{\"fieldLabel\":\"Verify\",\"placeholder\":\"Verify\",\"requiredField\":true}]}},\"typeVersion\":1},{\"id\":\"9c013995-ce9d-4c65-9c19-2f1a410ada38\",\"name\":\"Fail voice code\",\"type\":\"n8n-nodes-base.form\",\"position\":[940,100],\"webhookId\":\"330b8918-7890-485c-a4fb-b0a917c14edb\",\"parameters\":{\"options\":{},\"operation\":\"completion\",\"completionTitle\":\"Oh no!\",\"completionMessage\":\"Sorry, the code entered is invalid. Verification has not been completed\"},\"typeVersion\":1},{\"id\":\"3abbb31d-2ad0-4c2e-8891-e65e484e2ae4\",\"name\":\"Set email code\",\"type\":\"n8n-nodes-base.set\",\"position\":[940,-100],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"33438b85-27f4-4264-ab88-e1d3ec8b1ae8\",\"name\":\"Code Email\",\"type\":\"string\",\"value\":\"56789\"}]}},\"typeVersion\":3.4},{\"id\":\"3e453956-0056-4532-a096-a0a6de9702ae\",\"name\":\"Verify email code\",\"type\":\"n8n-nodes-base.form\",\"position\":[1440,-100],\"webhookId\":\"db9965d4-7660-4775-a5c6-772de7927e85\",\"parameters\":{\"options\":{},\"formFields\":{\"values\":[{\"fieldLabel\":\"Verify email\",\"placeholder\":\"Verify email code\",\"requiredField\":true}]}},\"typeVersion\":1},{\"id\":\"964528b3-f25f-4591-b5fe-6b405aaed0d2\",\"name\":\"Is email code correct?\",\"type\":\"n8n-nodes-base.if\",\"position\":[1680,-100],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"14ee5cfc-2a21-413d-9099-e63ce12da323\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{ $('Set email code').item.json['Code Email'] }}\",\"rightValue\":\"={{ $json['Verify email'] }}\"}]}},\"typeVersion\":2.2},{\"id\":\"df8f62cc-8f45-462e-84bf-0121cbf650c7\",\"name\":\"Is voice code correct?\",\"type\":\"n8n-nodes-base.if\",\"position\":[700,0],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"5aaaf956-3693-4930-b63e-dceb51857716\",\"operator\":{\"name\":\"filter.operator.equals\",\"type\":\"string\",\"operation\":\"equals\"},\"leftValue\":\"={{$('Set voice code').item.json.Code}}\",\"rightValue\":\"={{ $json.Verify }}\"}]}},\"typeVersion\":2.2},{\"id\":\"1f7ff94c-9b29-481b-99cf-cef63714995c\",\"name\":\"Success\",\"type\":\"n8n-nodes-base.form\",\"position\":[1920,-200],\"webhookId\":\"3dfd4429-927f-4695-9b64-87f53b52c3f6\",\"parameters\":{\"options\":{},\"operation\":\"completion\",\"completionTitle\":\"Great!\",\"completionMessage\":\"Your mobile number and email address have been verified successfully. Thank you!\"},\"typeVersion\":1},{\"id\":\"2c6fbd06-30f9-47b8-afa0-042439ff92c6\",\"name\":\"Fail email code\",\"type\":\"n8n-nodes-base.form\",\"position\":[1920,0],\"webhookId\":\"a26fc536-f976-4719-bb11-43111f7ec330\",\"parameters\":{\"options\":{},\"operation\":\"completion\",\"completionTitle\":\"Oh no!\",\"completionMessage\":\"Sorry, the code entered is invalid. Verification has not been completed\"},\"typeVersion\":1},{\"id\":\"632e4253-f4d1-4255-93d8-b7c3b8571e36\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-260,-80],\"parameters\":{\"width\":180,\"height\":240,\"content\":\"Set the code that will be spoken in the verification phone call\"},\"typeVersion\":1},{\"id\":\"37f3d155-cbb8-4c03-b8ae-43df4eec06d1\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[900,-180],\"parameters\":{\"width\":180,\"height\":240,\"content\":\"Set the code that will be sent in the verification email\"},\"typeVersion\":1},{\"id\":\"4c3a01a0-927f-499f-8bf2-e402b77050c4\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-480,-520],\"parameters\":{\"width\":440,\"content\":\"## STEP 2\\n\\nSet the verification code for this explanatory flow that will be set in the voice call and verification email.\\n\\nIn the node \\\"Send Email\\\" set the sender.\"},\"typeVersion\":1}],\"active\":false,\"pinData\":{},\"settings\":{\"executionOrder\":\"v1\"},\"versionId\":\"3e26e024-4da6-4449-bc3f-8604c837396a\",\"connections\":{\"Send Email\":{\"main\":[[{\"node\":\"Verify email code\",\"type\":\"main\",\"index\":0}]]},\"Send Voice\":{\"main\":[[{\"node\":\"Verify voice code\",\"type\":\"main\",\"index\":0}]]},\"Code for voice\":{\"main\":[[{\"node\":\"Send Voice\",\"type\":\"main\",\"index\":0}]]},\"Set email code\":{\"main\":[[{\"node\":\"Send Email\",\"type\":\"main\",\"index\":0}]]},\"Set voice code\":{\"main\":[[{\"node\":\"Code for voice\",\"type\":\"main\",\"index\":0}]]},\"Verify email code\":{\"main\":[[{\"node\":\"Is email code correct?\",\"type\":\"main\",\"index\":0}]]},\"Verify voice code\":{\"main\":[[{\"node\":\"Is voice code correct?\",\"type\":\"main\",\"index\":0}]]},\"On form submission\":{\"main\":[[{\"node\":\"Set voice code\",\"type\":\"main\",\"index\":0}]]},\"Is email code correct?\":{\"main\":[[{\"node\":\"Success\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Fail email code\",\"type\":\"main\",\"index\":0}]]},\"Is voice code correct?\":{\"main\":[[{\"node\":\"Set email code\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Fail voice code\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This workflow automates the process of sending **voice calls** for verification purposes and combines it with **email verification**. It uses the **ClickSend API** for voice calls and integrates with **SMTP** for email verification.\n\nThis workflow is a powerful tool for automating phone and email verification, ensuring a seamless and secure user verification process.\n\nBelow is a breakdown of the workflow:\n\n* * *\n\n#### **1\\. How It Works**\n\nThe workflow is designed to verify a user's phone number and email address through a combination of voice calls and email verification. Here's how it works:\n\n  1. **Form Submission** :\n\n     * The workflow starts with a **Form Trigger** node, where users submit a form with the following fields: \n       * **To** : The recipient's phone number (including the international prefix, e.g., +1xxxx).\n       * **Voice** : The voice type (male or female).\n       * **Lang** : The language for the voice call (e.g., en-us, it-it, fr-fr, etc.).\n       * **Email** : The recipient's email address.\n       * **Name** : The recipient's name.\n  2. **Set Voice Code** :\n\n     * The **Set Voice Code** node defines the verification code that will be spoken during the voice call.\n  3. **Format Code for Voice** :\n\n     * The **Code for Voice** node formats the verification code by adding spaces between characters for better clarity during the voice call.\n  4. **Send Voice Call** :\n\n     * The call includes the verification code, which is read aloud to the recipient.\n  5. **Verify Voice Code** :\n\n     * The **Verify Voice Code** node prompts the user to enter the code they received via the voice call.\n     * The **Is Voice Code Correct?** node checks if the entered code matches the predefined code. \n       * If correct, the workflow proceeds to email verification.\n       * If incorrect, the user is notified of the failure.\n  6. **Set Email Code** :\n\n     * The **Set Email Code** node defines the verification code that will be sent via email.\n  7. **Send Email** :\n\n     * The **Send Email** node sends an email to the recipient with the verification code using **SMTP**.\n  8. **Verify Email Code** :\n\n     * The **Verify Email Code** node prompts the user to enter the code they received via email.\n     * The **Is Email Code Correct?** node checks if the entered code matches the predefined code. \n       * If correct, the user is notified of successful verification.\n       * If incorrect, the user is notified of the failure.\n\n\n\n* * *\n\n#### **2\\. Set Up Steps**\n\nTo set up and use this workflow in n8n, follow these steps:\n\n  1. **ClickSend API Key** :\n\n     * Create an account on [ClickSend](https://clicksend.com/?u=586989) and obtain your **API Key**.\n     * In the **Send Voice** node, set up **HTTP Basic Authentication** : \n       * **Username** : Use the username you registered with on ClickSend.\n       * **Password** : Use the **API Key** provided by ClickSend.\n  2. **SMTP Configuration** :\n\n     * Set up **SMTP** credentials in n8n for the **Send Email** node.\n     * Ensure the SMTP server is configured to send emails from the specified email address.\n  3. **Form Configuration** :\n\n     * The **Form Trigger** node is pre-configured with fields for: \n       * **To** : The recipient's phone number.\n       * **Voice** : Choose between male or female voice.\n       * **Lang** : Select the language for the voice call.\n       * **Email** : The recipient's email address.\n       * **Name** : The recipient's name.\n     * Customize the form fields if needed.\n  4. **Set Verification Codes** :\n\n     * In the **Set Voice Code** node, define the verification code that will be spoken during the voice call.\n     * In the **Set Email Code** node, define the verification code that will be sent via email.\n  5. **Test the Workflow** :\n\n     * Submit the form with the required details (phone number, voice, language, email, and name).\n     * The workflow will: \n       * Send a voice call with the verification code.\n       * Prompt the user to verify the code.\n       * Send an email with the verification code.\n       * Prompt the user to verify the email code.\n       * Notify the user of success or failure.\n\n\n\n* * *\n\n### **Need help customizing?**\n\n[Contact me](mailto:info@n3w.it) for consulting and support or add me on [Linkedin](https://www.linkedin.com/in/davideboizza/).\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><p>This workflow automates the process of sending <strong>voice calls</strong> for verification purposes and combines it with <strong>email verification</strong>. It uses the <strong>ClickSend API</strong> for voice calls and integrates with <strong>SMTP</strong> for email verification.</p>\n<p>This workflow is a powerful tool for automating phone and email verification, ensuring a seamless and secure user verification process.</p>\n<p>Below is a breakdown of the workflow:</p>\n<hr>\n<h4><strong>1. How It Works</strong></h4>\n<p>The workflow is designed to verify a user's phone number and email address through a combination of voice calls and email verification. Here's how it works:</p>\n<ol>\n<li>\n<p><strong>Form Submission</strong>:</p>\n<ul>\n<li>The workflow starts with a <strong>Form Trigger</strong> node, where users submit a form with the following fields:\n<ul>\n<li><strong>To</strong>: The recipient's phone number (including the international prefix, e.g., +1xxxx).</li>\n<li><strong>Voice</strong>: The voice type (male or female).</li>\n<li><strong>Lang</strong>: The language for the voice call (e.g., en-us, it-it, fr-fr, etc.).</li>\n<li><strong>Email</strong>: The recipient's email address.</li>\n<li><strong>Name</strong>: The recipient's name.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Set Voice Code</strong>:</p>\n<ul>\n<li>The <strong>Set Voice Code</strong> node defines the verification code that will be spoken during the voice call.</li>\n</ul>\n</li>\n<li>\n<p><strong>Format Code for Voice</strong>:</p>\n<ul>\n<li>The <strong>Code for Voice</strong> node formats the verification code by adding spaces between characters for better clarity during the voice call.</li>\n</ul>\n</li>\n<li>\n<p><strong>Send Voice Call</strong>:</p>\n<ul>\n<li>The call includes the verification code, which is read aloud to the recipient.</li>\n</ul>\n</li>\n<li>\n<p><strong>Verify Voice Code</strong>:</p>\n<ul>\n<li>The <strong>Verify Voice Code</strong> node prompts the user to enter the code they received via the voice call.</li>\n<li>The <strong>Is Voice Code Correct?</strong> node checks if the entered code matches the predefined code.\n<ul>\n<li>If correct, the workflow proceeds to email verification.</li>\n<li>If incorrect, the user is notified of the failure.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Set Email Code</strong>:</p>\n<ul>\n<li>The <strong>Set Email Code</strong> node defines the verification code that will be sent via email.</li>\n</ul>\n</li>\n<li>\n<p><strong>Send Email</strong>:</p>\n<ul>\n<li>The <strong>Send Email</strong> node sends an email to the recipient with the verification code using <strong>SMTP</strong>.</li>\n</ul>\n</li>\n<li>\n<p><strong>Verify Email Code</strong>:</p>\n<ul>\n<li>The <strong>Verify Email Code</strong> node prompts the user to enter the code they received via email.</li>\n<li>The <strong>Is Email Code Correct?</strong> node checks if the entered code matches the predefined code.\n<ul>\n<li>If correct, the user is notified of successful verification.</li>\n<li>If incorrect, the user is notified of the failure.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h4><strong>2. Set Up Steps</strong></h4>\n<p>To set up and use this workflow in n8n, follow these steps:</p>\n<ol>\n<li>\n<p><strong>ClickSend API Key</strong>:</p>\n<ul>\n<li>Create an account on <a href=\"https://clicksend.com/?u=586989\" rel=\"ugc nofollow\" target=\"_blank\">ClickSend</a> and obtain your <strong>API Key</strong>.</li>\n<li>In the <strong>Send Voice</strong> node, set up <strong>HTTP Basic Authentication</strong>:\n<ul>\n<li><strong>Username</strong>: Use the username you registered with on ClickSend.</li>\n<li><strong>Password</strong>: Use the <strong>API Key</strong> provided by ClickSend.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>SMTP Configuration</strong>:</p>\n<ul>\n<li>Set up <strong>SMTP</strong> credentials in n8n for the <strong>Send Email</strong> node.</li>\n<li>Ensure the SMTP server is configured to send emails from the specified email address.</li>\n</ul>\n</li>\n<li>\n<p><strong>Form Configuration</strong>:</p>\n<ul>\n<li>The <strong>Form Trigger</strong> node is pre-configured with fields for:\n<ul>\n<li><strong>To</strong>: The recipient's phone number.</li>\n<li><strong>Voice</strong>: Choose between male or female voice.</li>\n<li><strong>Lang</strong>: Select the language for the voice call.</li>\n<li><strong>Email</strong>: The recipient's email address.</li>\n<li><strong>Name</strong>: The recipient's name.</li>\n</ul>\n</li>\n<li>Customize the form fields if needed.</li>\n</ul>\n</li>\n<li>\n<p><strong>Set Verification Codes</strong>:</p>\n<ul>\n<li>In the <strong>Set Voice Code</strong> node, define the verification code that will be spoken during the voice call.</li>\n<li>In the <strong>Set Email Code</strong> node, define the verification code that will be sent via email.</li>\n</ul>\n</li>\n<li>\n<p><strong>Test the Workflow</strong>:</p>\n<ul>\n<li>Submit the form with the required details (phone number, voice, language, email, and name).</li>\n<li>The workflow will:\n<ul>\n<li>Send a voice call with the verification code.</li>\n<li>Prompt the user to verify the code.</li>\n<li>Send an email with the verification code.</li>\n<li>Prompt the user to verify the email code.</li>\n<li>Notify the user of success or failure.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>Need help customizing?</strong></h3>\n<p><a href=\"mailto:info@n3w.it\" rel=\"ugc nofollow\">Contact me</a> for consulting and support or add me on <a href=\"https://www.linkedin.com/in/davideboizza/\" rel=\"ugc nofollow\" target=\"_blank\">Linkedin</a>.</p>\n</div><!--]-->",
  "readme_zh": "该工作流自动化了发送**语音通话**进行验证的流程，并与**邮件验证**相结合。它使用**ClickSend API**实现语音呼叫功能，并通过**SMTP**集成完成邮件验证。\n\n此工作流是自动化手机和邮箱验证的强大工具，能确保用户验证流程顺畅安全。\n\n以下是工作流分解说明：\n\n* * *\n\n#### **1. 运作原理**\n\n本工作流通过语音通话与邮件验证的组合来验证用户手机号和邮箱地址，具体流程如下：\n\n  1. **表单提交**：\n     * 流程始于**表单触发节点**，用户需提交包含以下字段的表单：\n       * **收件号码**：带国际区号的手机号（如+1xxxx）\n       * **语音类型**：男声/女声选项\n       * **语言**：语音通话语言（如en-us、it-it、fr-fr等）\n       * **邮箱地址**：收件人邮箱\n       * **姓名**：收件人名称\n  2. **设置语音验证码**：\n     * **语音验证码设置节点**定义将通过语音播报的验证码\n  3. **格式化语音验证码**：\n     * **语音码格式化节点**会在字符间添加空格以提升语音播报清晰度\n  4. **发送语音呼叫**：\n     * 通话中将朗读包含验证码的内容\n  5. **验证语音码**：\n     * **语音验证码校验节点**要求用户输入收到的语音验证码\n     * **验证码核对节点**会校验输入是否正确：\n       * 正确则进入邮件验证环节\n       * 错误则通知用户验证失败\n  6. **设置邮件验证码**：\n     * **邮件验证码设置节点**定义将通过邮件发送的验证码\n  7. **发送邮件**：\n     * **邮件发送节点**通过**SMTP**向收件人发送含验证码的邮件\n  8. **验证邮件码**：\n     * **邮件验证码校验节点**要求用户输入收到的邮件验证码\n     * **验证码核对节点**会校验输入是否正确：\n       * 正确则通知用户验证成功\n       * 错误则通知验证失败\n\n* * *\n\n#### **2. 配置步骤**\n\n在n8n中配置使用本工作流的步骤：\n\n  1. **ClickSend API密钥**：\n     * 在[ClickSend](https://clicksend.com/?u=586989)注册并获取**API密钥**\n     * 在**语音发送节点**配置**HTTP基础认证**：\n       * **用户名**：ClickSend注册邮箱\n       * **密码**：ClickSend提供的API密钥\n  2. **SMTP配置**：\n     * 在n8n中为**邮件发送节点**配置SMTP凭证\n     * 确保SMTP服务器支持从指定邮箱发件\n  3. **表单配置**：\n     * **表单触发节点**已预置以下字段：\n       * **收件号码**：用户手机号\n       * **语音类型**：男声/女声选择\n       * **语言**：语音通话语言选择\n       * **邮箱地址**：用户邮箱\n       * **姓名**：用户姓名\n     * 可根据需要自定义字段\n  4. **设置验证码**：\n     * 在**语音验证码设置节点**定义语音播报的验证码\n     * 在**邮件验证码设置节点**定义邮件发送的验证码\n  5. **测试工作流**：\n     * 提交包含必填信息（手机号、语音类型、语言、邮箱、姓名）的表单\n     * 工作流将依次执行：\n       * 发送含验证码的语音通话\n       * 要求用户验证语音码\n       * 发送含验证码的邮件\n       * 要求用户验证邮件码\n       * 反馈最终验证结果\n\n* * *\n\n### **需要定制帮助？**\n\n如需咨询或支持，请[邮件联系](mailto:info@n3w.it)或通过[Linkedin](https://www.linkedin.com/in/davideboizza/)添加我。",
  "title_zh": "MFA多因素认证（语音通话与电子邮件）通过ClickSend和SMTP实现",
  "publish_date_zh": "最后一次更新于一个月前",
  "workflow_json_zh": "{\"id\": \"1g8EAij2RwhNN70t\", \"meta\": {\"instanceId\": \"a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462\", \"templateCredsSetupCompleted\": true}, \"name\": \"发送并检查TTS（文本转语音）语音通话及邮件验证\", \"tags\": [], \"nodes\": [{\"id\": \"56842e20-266b-4770-b4cd-3106418caefa\", \"name\": \"便利贴\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-480, -740], \"parameters\": {\"width\": 440, \"height\": 180, \"content\": \"## 第一步  \\n[点击此处注册ClickSend账号](https://clicksend.com/?u=586989)，获取您的API密钥及2欧元免费额度  \\n\\n在\\\"发送语音\\\"节点中，使用您注册的用户名和API密钥（作为密码）创建\\\"Basic Auth\\\"认证\"}, \"typeVersion\": 1}, {\"id\": \"9dfff5ae-fc04-4957-a7b6-6866e8ab0854\", \"name\": \"便利贴1\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-480, -320], \"parameters\": {\"width\": 440, \"content\": \"## 第三步\\n\\n提交表单后，您所填写的电话号码将会接到一通来电，届时您选择的语音将为您朗读所输入的文本内容。\"}, \"typeVersion\": 1}, {\"id\": \"914666e8-1dc3-4d71-abf7-408b66a4508c\", \"name\": \"发送语音\", \"type\": \"n8n-nodes-base.httpRequest\", \"position\": [260, 0], \"parameters\": {\"url\": \"https://rest.clicksend.com/v3/voice/send\", \"method\": \"邮政\", \"options\": {}, \"jsonBody\": \"{\\n  \\\"messages\\\": [\\n    {\\n      \\\"source\\\": \\\"n8n\\\",\\n      \\\"body\\\": \\\"您的验证码是 {{ $json.Code }}\\\",\\n      \\\"to\\\": \\\"{{ $('On form submission').item.json.To }}\\\",\\n      \\\"voice\\\": \\\"{{ $('On form submission').item.json.Voice }}\\\",\\n      \\\"lang\\\": \\\"{{ $('On form submission').item.json.Lang }}\\\",\\n      \\\"machine_detection\\\": 1\\n    }\\n  ]\\n}\", \"sendBody\": true, \"sendHeaders\": true, \"specifyBody\": \"JSON\", \"authentication\": \"通用凭证类型\", \"genericAuthType\": \"HTTP基本认证\", \"headerParameters\": {\"parameters\": [{\"name\": \"Content-Type\", \"value\": \" application/json\"}, {}]}}, \"credentials\": {\"httpBasicAuth\": {\"id\": \"UwsDe2JxT39eWIvY\", \"name\": \"ClickSend API\"}}, \"typeVersion\": 4.2}, {\"id\": \"838266ee-33aa-4380-9335-5290cad30504\", \"name\": \"表单提交时\", \"type\": \"n8n-nodes-base.formTrigger\", \"position\": [-440, 0], \"webhookId\": \"194f453a-1d86-4222-bd4d-117f03005560\", \"parameters\": {\"options\": {}, \"formTitle\": \"发送语音消息\", \"formFields\": {\"values\": [{\"fieldLabel\": \"To\", \"placeholder\": \"+39xxxx\", \"requiredField\": true}, {\"fieldType\": \"dropdown\", \"fieldLabel\": \"Voice\", \"fieldOptions\": {\"values\": [{\"option\": \"male\"}, {\"option\": \"female\"}]}, \"requiredField\": true}, {\"fieldType\": \"dropdown\", \"fieldLabel\": \"Lang\", \"fieldOptions\": {\"values\": [{\"option\": \"en-us \\t\"}, {\"option\": \"it-it\"}, {\"option\": \"en-au\"}, {\"option\": \"en-gb\"}, {\"option\": \"de-de\"}, {\"option\": \"es-es\"}, {\"option\": \"fr-fr\"}, {\"option\": \"is-is\"}, {\"option\": \"da-dk\"}, {\"option\": \"nl-nl\"}, {\"option\": \"pl-pl\"}, {\"option\": \"pt-br\"}, {\"option\": \"ru-ru\"}]}, \"requiredField\": true}, {\"fieldType\": \"email\", \"fieldLabel\": \"Email\", \"placeholder\": \"Email\", \"requiredField\": true}, {\"fieldLabel\": \"Nome \", \"placeholder\": \"Nome\", \"requiredField\": true}]}}, \"typeVersion\": 2.2}, {\"id\": \"aab0e353-0af0-4867-9178-4195c6ed045b\", \"name\": \"便利贴2\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-480, -1020], \"parameters\": {\"color\": 3, \"width\": 440, \"height\": 240, \"content\": \"## 通过邮件验证发送并检查TTS（文本转语音）语音通话\\n\\n该工作流自动化了发送验证用途语音通话的流程，并将其与邮件验证相结合。系统利用ClickSend API实现语音呼叫功能，并通过SMTP集成完成邮件验证。\"}, \"typeVersion\": 1}, {\"id\": \"f4c3e305-be7e-43e7-a874-2767a0411624\", \"name\": \"发送邮件\", \"type\": \"n8n-nodes-base.emailSend\", \"position\": [1180, -100], \"webhookId\": \"92aa0a80-8bea-47b7-86ef-bebc90435526\", \"parameters\": {\"html\": \"=你好 {{ $('提交表单时').item.json['姓名'] }},<br>\\n邮箱验证码为 <b>{{ $json['邮箱验证码'] }}</b>\", \"options\": {}, \"subject\": \"验证您的代码\", \"toEmail\": \"=提交表单时的电子邮件\", \"fromEmail\": \"电子邮件\"}, \"credentials\": {\"smtp\": {\"id\": \"hRjP3XbDiIQqvi7x\", \"name\": \"SMTP info@n3witalia.com\"}}, \"typeVersion\": 2.1}, {\"id\": \"5a3ff941-6d25-4479-bedc-c3cfa7c75e36\", \"name\": \"语音代码\", \"type\": \"n8n-nodes-base.code\", \"position\": [40, 0], \"parameters\": {\"jsCode\": \"// 遍历输入项并修改'Code'字段，在字符间添加空格\\nfor (const item of $input.all()) {\\n  const code = item.json.Code;\\n\\n  const spacedCode = code.split('').join(' ');\\n\\n  item.json.Code = spacedCode;\\n}\\n\\nreturn $input.all();\"}, \"typeVersion\": 2}, {\"id\": \"14ccfe99-8fbd-4cde-9ca3-c73e541086b3\", \"name\": \"设置语音代码\", \"type\": \"n8n-nodes-base.set\", \"position\": [-220, 0], \"parameters\": {\"options\": {}, \"assignments\": {\"assignments\": [{\"id\": \"89fb63af-790e-4388-9495-5f1e517ee486\", \"name\": \"Code\", \"type\": \"string\", \"value\": \"12345\"}]}}, \"typeVersion\": 3.4}, {\"id\": \"b01e3604-5ca9-45cb-8a59-4f86f33d169b\", \"name\": \"验证语音代码\", \"type\": \"n8n-nodes-base.form\", \"position\": [480, 0], \"webhookId\": \"b4356cb9-4185-4c65-b7c4-1f1e00a50ce0\", \"parameters\": {\"options\": {}, \"formFields\": {\"values\": [{\"fieldLabel\": \"Verify\", \"placeholder\": \"Verify\", \"requiredField\": true}]}}, \"typeVersion\": 1}, {\"id\": \"9c013995-ce9d-4c65-9c19-2f1a410ada38\", \"name\": \"失败语音代码\", \"type\": \"n8n-nodes-base.form\", \"position\": [940, 100], \"webhookId\": \"330b8918-7890-485c-a4fb-b0a917c14edb\", \"parameters\": {\"options\": {}, \"operation\": \"完成\", \"completionTitle\": \"哎呀！\", \"completionMessage\": \"抱歉，输入的代码无效。验证未完成。\"}, \"typeVersion\": 1}, {\"id\": \"3abbb31d-2ad0-4c2e-8891-e65e484e2ae4\", \"name\": \"设置邮箱验证码\", \"type\": \"n8n-nodes-base.set\", \"position\": [940, -100], \"parameters\": {\"options\": {}, \"assignments\": {\"assignments\": [{\"id\": \"33438b85-27f4-4264-ab88-e1d3ec8b1ae8\", \"name\": \"Code Email\", \"type\": \"string\", \"value\": \"56789\"}]}}, \"typeVersion\": 3.4}, {\"id\": \"3e453956-0056-4532-a096-a0a6de9702ae\", \"name\": \"验证邮箱验证码\", \"type\": \"n8n-nodes-base.form\", \"position\": [1440, -100], \"webhookId\": \"db9965d4-7660-4775-a5c6-772de7927e85\", \"parameters\": {\"options\": {}, \"formFields\": {\"values\": [{\"fieldLabel\": \"Verify email\", \"placeholder\": \"Verify email code\", \"requiredField\": true}]}}, \"typeVersion\": 1}, {\"id\": \"964528b3-f25f-4591-b5fe-6b405aaed0d2\", \"name\": \"邮箱验证码正确吗？\", \"type\": \"n8n-nodes-base.if\", \"position\": [1680, -100], \"parameters\": {\"options\": {}, \"conditions\": {\"options\": {\"version\": 2, \"leftValue\": \"\", \"caseSensitive\": true, \"typeValidation\": \"strict\"}, \"combinator\": \"and\", \"conditions\": [{\"id\": \"14ee5cfc-2a21-413d-9099-e63ce12da323\", \"operator\": {\"name\": \"filter.operator.equals\", \"type\": \"string\", \"operation\": \"equals\"}, \"leftValue\": \"={{ $('Set email code').item.json['Code Email'] }}\", \"rightValue\": \"={{ $json['Verify email'] }}\"}]}}, \"typeVersion\": 2.2}, {\"id\": \"df8f62cc-8f45-462e-84bf-0121cbf650c7\", \"name\": \"语音代码是否正确？\", \"type\": \"n8n-nodes-base.if\", \"position\": [700, 0], \"parameters\": {\"options\": {}, \"conditions\": {\"options\": {\"version\": 2, \"leftValue\": \"\", \"caseSensitive\": true, \"typeValidation\": \"strict\"}, \"combinator\": \"and\", \"conditions\": [{\"id\": \"5aaaf956-3693-4930-b63e-dceb51857716\", \"operator\": {\"name\": \"filter.operator.equals\", \"type\": \"string\", \"operation\": \"equals\"}, \"leftValue\": \"={{$('Set voice code').item.json.Code}}\", \"rightValue\": \"={{ $json.Verify }}\"}]}}, \"typeVersion\": 2.2}, {\"id\": \"1f7ff94c-9b29-481b-99cf-cef63714995c\", \"name\": \"成功\", \"type\": \"n8n-nodes-base.form\", \"position\": [1920, -200], \"webhookId\": \"3dfd4429-927f-4695-9b64-87f53b52c3f6\", \"parameters\": {\"options\": {}, \"operation\": \"完成\", \"completionTitle\": \"太好了！\", \"completionMessage\": \"您的手机号码和电子邮箱地址已成功验证。感谢！\"}, \"typeVersion\": 1}, {\"id\": \"2c6fbd06-30f9-47b8-afa0-042439ff92c6\", \"name\": \"失败邮件代码\", \"type\": \"n8n-nodes-base.form\", \"position\": [1920, 0], \"webhookId\": \"a26fc536-f976-4719-bb11-43111f7ec330\", \"parameters\": {\"options\": {}, \"operation\": \"完成\", \"completionTitle\": \"哎呀！\", \"completionMessage\": \"抱歉，输入的代码无效。验证未完成。\"}, \"typeVersion\": 1}, {\"id\": \"632e4253-f4d1-4255-93d8-b7c3b8571e36\", \"name\": \"便利贴3\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-260, -80], \"parameters\": {\"width\": 180, \"height\": 240, \"content\": \"设置将在验证电话中播报的代码\"}, \"typeVersion\": 1}, {\"id\": \"37f3d155-cbb8-4c03-b8ae-43df4eec06d1\", \"name\": \"便利贴4\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [900, -180], \"parameters\": {\"width\": 180, \"height\": 240, \"content\": \"设置验证邮件中将要发送的代码\"}, \"typeVersion\": 1}, {\"id\": \"4c3a01a0-927f-499f-8bf2-e402b77050c4\", \"name\": \"便利贴5\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [-480, -520], \"parameters\": {\"width\": 440, \"content\": \"## 步骤二\\n\\n为此说明流程设置验证码，该验证码将通过语音通话和验证邮件发送。\\n\\n在“发送邮件”节点中设置发件人。\"}, \"typeVersion\": 1}], \"active\": false, \"pinData\": {}, \"settings\": {\"executionOrder\": \"v1\"}, \"versionId\": \"3e26e024-4da6-4449-bc3f-8604c837396a\", \"connections\": {\"Send Email\": {\"main\": [[{\"node\": \"Verify email code\", \"type\": \"main\", \"index\": 0}]]}, \"Send Voice\": {\"main\": [[{\"node\": \"Verify voice code\", \"type\": \"main\", \"index\": 0}]]}, \"Code for voice\": {\"main\": [[{\"node\": \"Send Voice\", \"type\": \"main\", \"index\": 0}]]}, \"Set email code\": {\"main\": [[{\"node\": \"Send Email\", \"type\": \"main\", \"index\": 0}]]}, \"Set voice code\": {\"main\": [[{\"node\": \"Code for voice\", \"type\": \"main\", \"index\": 0}]]}, \"Verify email code\": {\"main\": [[{\"node\": \"Is email code correct?\", \"type\": \"main\", \"index\": 0}]]}, \"Verify voice code\": {\"main\": [[{\"node\": \"Is voice code correct?\", \"type\": \"main\", \"index\": 0}]]}, \"On form submission\": {\"main\": [[{\"node\": \"Set voice code\", \"type\": \"main\", \"index\": 0}]]}, \"Is email code correct?\": {\"main\": [[{\"node\": \"Success\", \"type\": \"main\", \"index\": 0}], [{\"node\": \"Fail email code\", \"type\": \"main\", \"index\": 0}]]}, \"Is voice code correct?\": {\"main\": [[{\"node\": \"Set email code\", \"type\": \"main\", \"index\": 0}], [{\"node\": \"Fail voice code\", \"type\": \"main\", \"index\": 0}]]}}}"
}
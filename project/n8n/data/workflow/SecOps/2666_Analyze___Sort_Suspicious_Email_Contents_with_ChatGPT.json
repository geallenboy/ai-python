{
  "title": "Analyze & Sort Suspicious Email Contents with ChatGPT",
  "url": "https://n8n.io/workflows/2666-analyze-and-sort-suspicious-email-contents-with-chatgpt/",
  "category": "SecOps",
  "category_url": "https://n8n.io/workflows/categories/secops/?count=20",
  "author": "Angel Menendez",
  "publish_date": "Last update 4 months ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"},\"nodes\":[{\"id\":\"94dd7f48-0013-4fb5-89c4-826ecd7f2d66\",\"name\":\"Gmail Trigger\",\"type\":\"n8n-nodes-base.gmailTrigger\",\"position\":[1460,120],\"parameters\":{\"simple\":false,\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"gmailOAuth2\":{\"id\":\"kkhNhqKpZt6IUZd0\",\"name\":\"Gmail\"}},\"typeVersion\":1.2},{\"id\":\"ca2023fa-ceca-4923-80e4-a3843803536c\",\"name\":\"Microsoft Outlook Trigger\",\"type\":\"n8n-nodes-base.microsoftOutlookTrigger\",\"disabled\":true,\"position\":[1480,680],\"parameters\":{\"fields\":[\"body\",\"toRecipients\",\"subject\",\"bodyPreview\"],\"output\":\"fields\",\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":1},{\"id\":\"1f011214-91a0-4cfa-9d9e-29864937c0a3\",\"name\":\"Screenshot HTML\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2620,420],\"parameters\":{\"url\":\"https://hcti.io/v1/image\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"sendQuery\":true,\"authentication\":\"genericCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"html\",\"value\":\"={{ $('Set Email Variables').item.json.htmlBody }}\"}]},\"genericAuthType\":\"httpBasicAuth\",\"queryParameters\":{\"parameters\":[{}]}},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"64f4789f-9de8-414f-af62-ddc339f0d0ac\",\"name\":\"Retrieve Screenshot\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2800,420],\"parameters\":{\"url\":\"={{ $json.url }}\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpBasicAuth\"},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"db707bd9-6abc-4ab7-8ffa-ad25c5e8adc4\",\"name\":\"Set Outlook Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2040,680],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"},{\"id\":\"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json}}\"},{\"id\":\"20566ad4-7eb7-42b1-8a0d-f8b759610f10\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"},{\"id\":\"7171998f-a5a2-4e23-946a-9c1ad75710e7\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"},{\"id\":\"cc262634-2470-4524-8319-abe2518a6335\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $('Retrieve Headers of Email').item.json.body.content }}\"}]}},\"typeVersion\":3.4},{\"id\":\"7a3622c0-6949-4ea3-ae13-46a1ee26de7b\",\"name\":\"Set Gmail Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2020,120],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $json.html }}\"},{\"id\":\"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json.headers }}\"},{\"id\":\"1d690098-be2a-4604-baf8-62f314930929\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $json.subject }}\"},{\"id\":\"8009f00a-547f-4eb1-b52d-2e7305248885\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $json.to.text }}\"},{\"id\":\"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $json.text }}\"}]}},\"typeVersion\":3.4},{\"id\":\"4b4c6b34-f74c-4402-91a1-4d002e02a3bd\",\"name\":\"Retrieve Headers of Email\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1700,680],\"parameters\":{\"url\":\"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\",\"options\":{},\"sendHeaders\":true,\"authentication\":\"predefinedCredentialType\",\"headerParameters\":{\"parameters\":[{\"name\":\"Accept\",\"value\":\"application/json\"},{\"name\":\"Prefer\",\"value\":\"outlook.body-content-type=\\\"text\\\"\"}]},\"nodeCredentialType\":\"microsoftOutlookOAuth2Api\"},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":4.2},{\"id\":\"0c9883b5-3eb7-45db-9803-d1b30166a3b5\",\"name\":\"Format Headers\",\"type\":\"n8n-nodes-base.code\",\"position\":[1880,680],\"parameters\":{\"jsCode\":\"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"},\"typeVersion\":2},{\"id\":\"c21a976c-00e5-4823-bd94-4c95a7d60438\",\"name\":\"Analyze Email with ChatGPT\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[3000,420],\"parameters\":{\"modelId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o\",\"cachedResultName\":\"GPT-4O\"},\"options\":{},\"messages\":{\"values\":[{\"content\":\"=Describe the following email using the HTML body and headers. Determine if the email could be a phishing email. \\n\\nHere is the HTML body:\\n{{ $('Set Email Variables').item.json.htmlBody }}\\n\\nThe message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\n\"},{\"role\":\"system\",\"content\":\"Please make sure to output all responses using the following structured JSON output:\\n{\\n  \\\"malicious\\\": false,\\n  \\\"summary\\\": \\\"The email appears to be a legitimate communication from a known sender. It contains no suspicious links, attachments, or language that indicates phishing or malicious intent.\\\"\\n}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response. Make the summary as verbose as possible including a full breakdown of why the email is benign or malicious.\"}]},\"jsonOutput\":true},\"credentials\":{\"openAiApi\":{\"id\":\"76\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.6},{\"id\":\"a91f4095-9245-4276-b21f-f415de22df62\",\"name\":\"Create Potentially Malicious Ticket\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3640,400],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10001\",\"cachedResultName\":\"Support\"},\"summary\":\"=Potentially Malicious - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10008\",\"cachedResultName\":\"Task\"},\"additionalFields\":{\"description\":\"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"a5a66a0e-9d8a-45a9-b1ae-aec78ddfec27\",\"name\":\"Create Potentially Benign Ticket\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3640,580],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10001\",\"cachedResultName\":\"Support\"},\"summary\":\"=Potentially Benign - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10008\",\"cachedResultName\":\"Task\"},\"additionalFields\":{\"description\":\"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"5af0d60b-d021-4dd9-98f7-b2842800764a\",\"name\":\"Rename Screenshot\",\"type\":\"n8n-nodes-base.code\",\"position\":[4020,480],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"$('Retrieve Screenshot').item.binary.data.fileName = 'emailScreenshot.png'\\n\\nreturn $('Retrieve Screenshot').item;\"},\"typeVersion\":2},{\"id\":\"441c4cbb-bd93-4213-bd34-e18f2a49389f\",\"name\":\"Set Jira ID\",\"type\":\"n8n-nodes-base.set\",\"position\":[3860,480],\"parameters\":{\"options\":{},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"4c71188c-011d-4f8e-a36c-87900bfab59a\",\"name\":\"Upload Screenshot of Email to Jira\",\"type\":\"n8n-nodes-base.jira\",\"position\":[4220,480],\"parameters\":{\"issueKey\":\"={{ $('Set Jira ID').item.json.key }}\",\"resource\":\"issueAttachment\"},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"3c031c34-8306-44e1-8e0e-a584c5323112\",\"name\":\"Upload Email Body to Jira\",\"type\":\"n8n-nodes-base.jira\",\"position\":[4620,480],\"parameters\":{\"issueKey\":\"={{ $('Set Jira ID').item.json.key }}\",\"resource\":\"issueAttachment\"},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"d033dcbd-7ccb-451f-ab81-cc6d32d2e01f\",\"name\":\"Convert Email Body to File\",\"type\":\"n8n-nodes-base.convertToFile\",\"position\":[2420,420],\"parameters\":{\"options\":{\"fileName\":\"emailBody.txt\"},\"operation\":\"toText\",\"sourceProperty\":\"textBody\"},\"typeVersion\":1.1},{\"id\":\"bda5e2fe-d8c0-456b-975a-35e82ff02816\",\"name\":\"Set Email Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2240,420],\"parameters\":{\"options\":{},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"54ecd8ab-ac4a-4b6b-bd1b-bf8c70082a33\",\"name\":\"Rename Email Body Screenshot\",\"type\":\"n8n-nodes-base.code\",\"position\":[4420,480],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"$('Convert Email Body to File').item.binary.data.fileName = 'emailBody.txt'\\n\\nreturn $('Convert Email Body to File').item;\"},\"typeVersion\":2},{\"id\":\"fe5b82cc-b4bb-4c97-9477-075d5a280e9f\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2574.536755825029,0],\"parameters\":{\"color\":7,\"width\":376.8280004374956,\"height\":595.590013880477,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/hctiapi2.png)\\n## Email Body Screenshot Creation\\n\\nThe **Screenshot HTML** node sends the email's HTML body to the **hcti.io** API, generating a screenshot that visually represents the email's layout. The **Retrieve Screenshot** node then fetches this image, making it available for attachment or review in subsequent steps. This dual-format processing ensures both clarity and flexibility in email analysis workflows.\"},\"typeVersion\":1},{\"id\":\"86b21049-f65e-4c6a-a854-c4376f870da9\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1380,-149.99110983560342],\"parameters\":{\"color\":7,\"width\":814.4556539379754,\"height\":444.5525554815556,\"content\":\"![Gmail](https://uploads.n8n.io/templates/gmail.png)\\n## Gmail Integration and Data Extraction\\n\\nThis section of the workflow connects to a Gmail account using the **Gmail Trigger** node, capturing incoming emails in real-time, with checks performed every minute. Once an email is detected, its key components—such as the subject, recipient, body, and headers—are extracted and assigned to variables using the **Set Gmail Variables** node. These variables are structured for subsequent analysis and processing in later steps.\"},\"typeVersion\":1},{\"id\":\"b1a786cf-7a8d-49e1-90ed-31f3d0e65b13\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1380,308],\"parameters\":{\"color\":7,\"width\":809.7918597571277,\"height\":602.9002284617277,\"content\":\"![Gmail](https://uploads.n8n.io/templates/outlook.png)\\n## Microsoft Outlook Integration and Email Header Processing\\n\\nThis section enables the integration of Microsoft Outlook to monitor and capture incoming emails. The Microsoft Outlook Trigger node checks for new messages every minute. Once an email is detected, the Retrieve Headers of Email node fetches detailed header and body content via the Microsoft Graph API. The Format Headers node organizes the email headers into a structured format using a JavaScript function, ensuring clarity and readiness for further processing. Finally, the Set Outlook Variables node extracts and assigns key details—such as the email subject, recipient, body, and formatted headers—to variables for use in subsequent workflow steps. This section is essential for processing Outlook emails and preparing them for analysis and reporting.\\n\\n\\n\\n\\n\\n\\n\"},\"typeVersion\":1},{\"id\":\"e7ace035-b5f5-4ef3-a117-22c7c938868d\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2958.4325220284563,24.744924120002338],\"parameters\":{\"color\":7,\"width\":593.0990401534098,\"height\":573.1750519720028,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## AI-Powered Email Analysis and Threat Detection\\n\\nThis section leverages ChatGPT for advanced email content and header analysis to determine potential phishing threats. The **Analyze Email with ChatGPT** node processes the email's HTML body and headers, generating a detailed JSON response that categorizes the email as malicious or benign. The response includes a verbose explanation, formatted for Jira, outlining the reasons for the classification. The **Check if Malicious** node evaluates the AI output to determine the next steps based on the email's threat status. If flagged as malicious, subsequent actions like reporting and ticket creation are triggered. This section ensures precise, AI-driven analysis to enhance email security workflows.\"},\"typeVersion\":1},{\"id\":\"02c1ad8e-f952-42d2-ae9f-cf3a77e49e52\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3562.4948140707697,-125.79607719303533],\"parameters\":{\"color\":7,\"width\":1251.7025543502837,\"height\":891.579206098173,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## Automated Jira Ticket Creation and Email Attachment\\n\\nThis section streamlines the process of logging phishing email reports in Jira, complete with detailed analysis and attachments. The workflow creates two distinct Jira tickets depending on the AI classification of the email:\\n\\n1. **Potentially Malicious**: The **Create Potentially Malicious Ticket** node generates a ticket if the email is flagged as a phishing attempt, including a summary of ChatGPT's analysis and the email’s details.\\n2. **Potentially Benign**: If the email is classified as safe, the **Create Potentially Benign Ticket** node logs a ticket with similar details but under a non-malicious category.\\n\\n\\nThe **Set Jira ID** node ensures the generated ticket's ID is tracked for subsequent operations. Attachments are handled efficiently:\\n\\n- **Rename Screenshot** prepares the email screenshot for upload.\\n- **Upload Screenshot of Email to Jira** adds the screenshot to the Jira ticket for visual context.\\n- **Rename Email Body Screenshot** and **Upload Email Body to Jira** manage the attachment of the email's text body as a `.txt` file.\\n\\n\\nThis section enhances reporting by automating ticket creation, ensuring all relevant email data is readily available for review by security teams.\"},\"typeVersion\":1},{\"id\":\"597ef23e-c61c-4e27-8c14-74ec20079c96\",\"name\":\"Check if Malicious\",\"type\":\"n8n-nodes-base.if\",\"position\":[3400,420],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"493f412c-5f11-4173-8940-90f5bc7f5fab\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ $json.message.content.malicious }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"af512af9-924b-4019-bdf9-62aac9cd0dac\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2200,39.041733604283195],\"parameters\":{\"color\":7,\"width\":365.6458805720866,\"height\":559.8072303111675,\"content\":\"![n8n](https://uploads.n8n.io/templates/n8n.png)\\n## Email Body Conversion\\n\\nThis section processes the email body into both text and visual formats for detailed analysis and reporting. The **Set Email Variables** node organizes the email's data, including its HTML body and text content, to prepare it for further steps. The **Convert Email Body to File** node creates a `.txt` file containing the plain text version of the email body, useful for documentation or further analysis.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Set Jira ID\":{\"main\":[[{\"node\":\"Rename Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Gmail Trigger\":{\"main\":[[{\"node\":\"Set Gmail Variables\",\"type\":\"main\",\"index\":0}]]},\"Format Headers\":{\"main\":[[{\"node\":\"Set Outlook Variables\",\"type\":\"main\",\"index\":0}]]},\"Screenshot HTML\":{\"main\":[[{\"node\":\"Retrieve Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Rename Screenshot\":{\"main\":[[{\"node\":\"Upload Screenshot of Email to Jira\",\"type\":\"main\",\"index\":0}]]},\"Check if Malicious\":{\"main\":[[{\"node\":\"Create Potentially Malicious Ticket\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Create Potentially Benign Ticket\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Screenshot\":{\"main\":[[{\"node\":\"Analyze Email with ChatGPT\",\"type\":\"main\",\"index\":0}]]},\"Set Email Variables\":{\"main\":[[{\"node\":\"Convert Email Body to File\",\"type\":\"main\",\"index\":0}]]},\"Set Gmail Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Set Outlook Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Microsoft Outlook Trigger\":{\"main\":[[{\"node\":\"Retrieve Headers of Email\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Headers of Email\":{\"main\":[[{\"node\":\"Format Headers\",\"type\":\"main\",\"index\":0}]]},\"Analyze Email with ChatGPT\":{\"main\":[[{\"node\":\"Check if Malicious\",\"type\":\"main\",\"index\":0}]]},\"Convert Email Body to File\":{\"main\":[[{\"node\":\"Screenshot HTML\",\"type\":\"main\",\"index\":0}]]},\"Rename Email Body Screenshot\":{\"main\":[[{\"node\":\"Upload Email Body to Jira\",\"type\":\"main\",\"index\":0}]]},\"Create Potentially Benign Ticket\":{\"main\":[[{\"node\":\"Set Jira ID\",\"type\":\"main\",\"index\":0}]]},\"Upload Screenshot of Email to Jira\":{\"main\":[[{\"node\":\"Rename Email Body Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Create Potentially Malicious Ticket\":{\"main\":[[{\"node\":\"Set Jira ID\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Analyze & Sort Suspicious Email Contents with ChatGPT and Jira\n\n#### Who is this for?\n\nThis workflow is tailored for IT security teams, managed service providers (MSPs), and organizations aiming to streamline the detection and reporting of phishing emails. It's especially useful for teams handling high email volumes and requiring quick, automated analysis.\n\n#### What problem is this workflow solving?\n\nPhishing emails pose a significant cybersecurity threat, and manual review processes are time-consuming and prone to human error. This workflow automates the identification of malicious emails, provides AI-driven insights, and generates structured reports, enabling faster and more efficient responses to email-based threats.\n\n#### What this workflow does\n\nThis workflow integrates Gmail or Microsoft Outlook to monitor and capture incoming emails. It processes the email content and headers, converts the email's body to a visual screenshot for clarity, and uses ChatGPT's advanced AI to analyze the email for phishing indicators. Based on the analysis, it categorizes emails as potentially malicious or benign, creating detailed Jira tickets for each case. Attachments, including the email body and screenshots, are automatically uploaded for comprehensive reporting.\n\n**Key steps include:**\n\n  1. **Email Integration** : Captures emails from Gmail or Microsoft Outlook.\n  2. **Content Processing** : Extracts and organizes email content and metadata.\n  3. **AI Analysis** : Uses ChatGPT to evaluate email content and headers.\n  4. **Classification** : Categorizes emails as malicious or benign.\n  5. **Automated Reporting** : Creates Jira tickets with detailed analysis and attachments.\n\n\n\n#### Setup\n\n  1. **Authentication** : Configure Gmail or Microsoft Outlook credentials in n8n.\n  2. **API Keys** : Add credentials for the HTML screenshot service (`hcti.io`) and OpenAI.\n  3. **Jira Configuration** : Set up project and issue types in the Jira nodes.\n  4. **Customization** : Update sticky notes and nodes to fit your organizational requirements, such as modifying the AI prompt or Jira ticket fields.\n\n\n\n#### How to customize this workflow to your needs\n\n  * Adjust email triggers to include or exclude specific senders or subjects.\n  * Refine the AI prompt in the ChatGPT node to tailor phishing detection criteria.\n  * Modify Jira ticket content to include additional fields or match specific workflows.\n\n\n\nThis workflow is ideal for automating email threat detection, reducing response times, and enhancing overall cybersecurity processes. By leveraging AI-powered insights, it helps organizations stay ahead of phishing attacks.\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><h3>Analyze &amp; Sort Suspicious Email Contents with ChatGPT and Jira</h3>\n<h4>Who is this for?</h4>\n<p>This workflow is tailored for IT security teams, managed service providers (MSPs), and organizations aiming to streamline the detection and reporting of phishing emails. It's especially useful for teams handling high email volumes and requiring quick, automated analysis.</p>\n<h4>What problem is this workflow solving?</h4>\n<p>Phishing emails pose a significant cybersecurity threat, and manual review processes are time-consuming and prone to human error. This workflow automates the identification of malicious emails, provides AI-driven insights, and generates structured reports, enabling faster and more efficient responses to email-based threats.</p>\n<h4>What this workflow does</h4>\n<p>This workflow integrates Gmail or Microsoft Outlook to monitor and capture incoming emails. It processes the email content and headers, converts the email's body to a visual screenshot for clarity, and uses ChatGPT's advanced AI to analyze the email for phishing indicators. Based on the analysis, it categorizes emails as potentially malicious or benign, creating detailed Jira tickets for each case. Attachments, including the email body and screenshots, are automatically uploaded for comprehensive reporting.</p>\n<p><strong>Key steps include:</strong></p>\n<ol>\n<li><strong>Email Integration</strong>: Captures emails from Gmail or Microsoft Outlook.</li>\n<li><strong>Content Processing</strong>: Extracts and organizes email content and metadata.</li>\n<li><strong>AI Analysis</strong>: Uses ChatGPT to evaluate email content and headers.</li>\n<li><strong>Classification</strong>: Categorizes emails as malicious or benign.</li>\n<li><strong>Automated Reporting</strong>: Creates Jira tickets with detailed analysis and attachments.</li>\n</ol>\n<h4>Setup</h4>\n<ol>\n<li><strong>Authentication</strong>: Configure Gmail or Microsoft Outlook credentials in n8n.</li>\n<li><strong>API Keys</strong>: Add credentials for the HTML screenshot service (<code>hcti.io</code>) and OpenAI.</li>\n<li><strong>Jira Configuration</strong>: Set up project and issue types in the Jira nodes.</li>\n<li><strong>Customization</strong>: Update sticky notes and nodes to fit your organizational requirements, such as modifying the AI prompt or Jira ticket fields.</li>\n</ol>\n<h4>How to customize this workflow to your needs</h4>\n<ul>\n<li>Adjust email triggers to include or exclude specific senders or subjects.</li>\n<li>Refine the AI prompt in the ChatGPT node to tailor phishing detection criteria.</li>\n<li>Modify Jira ticket content to include additional fields or match specific workflows.</li>\n</ul>\n<p>This workflow is ideal for automating email threat detection, reducing response times, and enhancing overall cybersecurity processes. By leveraging AI-powered insights, it helps organizations stay ahead of phishing attacks.</p>\n</div><!--]-->",
  "readme_zh": "### 利用ChatGPT与Jira分析归类可疑邮件内容\n\n#### 适用对象\n\n本流程专为IT安全团队、托管服务提供商（MSP）及希望优化钓鱼邮件检测与上报流程的机构设计，特别适合需要快速自动化分析、处理海量邮件的团队。\n\n#### 解决痛点\n\n钓鱼邮件是重大网络安全威胁，人工审核耗时且易出错。该流程通过自动化识别恶意邮件、提供AI分析洞察并生成结构化报告，显著提升邮件威胁的响应效率。\n\n#### 核心功能\n\n本流程集成Gmail或Microsoft Outlook监控收件箱，自动提取邮件内容与标头数据，将邮件正文转换为可视化截图，并运用ChatGPT高级AI技术检测钓鱼特征。根据分析结果将邮件归类为\"潜在恶意\"或\"安全\"，同时生成带完整附件的Jira工单（含邮件正文与截图）。\n\n**关键步骤：**\n\n  1. **邮件集成**：从Gmail或Microsoft Outlook抓取邮件\n  2. **内容处理**：解析邮件内容与元数据\n  3. **AI分析**：通过ChatGPT评估邮件内容与标头\n  4. **风险分类**：标记邮件风险等级\n  5. **自动上报**：创建带详细分析的Jira工单\n\n#### 配置指南\n\n  1. **身份验证**：在n8n配置邮箱凭证\n  2. **API密钥**：设置HTML截图服务（hcti.io）和OpenAI的密钥\n  3. **Jira配置**：在Jira节点中设置项目与工单类型\n  4. **定制化**：根据组织需求修改便签注释和节点（如调整AI提示词或Jira字段）\n\n#### 个性化定制建议\n\n  * 自定义邮件触发条件（指定发件人或主题）\n  * 优化ChatGPT节点的检测标准\n  * 扩展Jira工单字段以适配现有流程\n\n该流程能有效实现邮件威胁自动化检测，缩短响应时间，强化网络安全防护体系。通过AI驱动的深度分析，助力组织主动防范钓鱼攻击。",
  "title_zh": "利用ChatGPT分析与分类可疑邮件内容",
  "publish_date_zh": "最后更新于4个月前",
  "workflow_json_zh": "{\"meta\": {\"instanceId\": \"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"}, \"nodes\": [{\"id\": \"94dd7f48-0013-4fb5-89c4-826ecd7f2d66\", \"name\": \"Gmail 触发器\", \"type\": \"n8n-nodes-base.gmailTrigger\", \"position\": [1460, 120], \"parameters\": {\"simple\": false, \"filters\": {}, \"options\": {}, \"pollTimes\": {\"item\": [{\"mode\": \"everyMinute\"}]}}, \"credentials\": {\"gmailOAuth2\": {\"id\": \"kkhNhqKpZt6IUZd0\", \"name\": \"Gmail\"}}, \"typeVersion\": 1.2}, {\"id\": \"ca2023fa-ceca-4923-80e4-a3843803536c\", \"name\": \"微软Outlook触发器\", \"type\": \"n8n-nodes-base.microsoftOutlookTrigger\", \"disabled\": true, \"position\": [1480, 680], \"parameters\": {\"fields\": [\"body\", \"toRecipients\", \"subject\", \"bodyPreview\"], \"output\": \"田地\", \"filters\": {}, \"options\": {}, \"pollTimes\": {\"item\": [{\"mode\": \"everyMinute\"}]}}, \"credentials\": {\"microsoftOutlookOAuth2Api\": {\"id\": \"vTCK0oVQ0WjFrI5H\", \"name\": \" Outlook Credential\"}}, \"typeVersion\": 1}, {\"id\": \"1f011214-91a0-4cfa-9d9e-29864937c0a3\", \"name\": \"截图HTML\", \"type\": \"n8n-nodes-base.httpRequest\", \"position\": [2620, 420], \"parameters\": {\"url\": \"https://hcti.io/v1/image\", \"method\": \"邮政\", \"options\": {}, \"sendBody\": true, \"sendQuery\": true, \"authentication\": \"通用凭证类型\", \"bodyParameters\": {\"parameters\": [{\"name\": \"html\", \"value\": \"={{ $('Set Email Variables').item.json.htmlBody }}\"}]}, \"genericAuthType\": \"HTTP基本认证\", \"queryParameters\": {\"parameters\": [{}]}}, \"credentials\": {\"httpBasicAuth\": {\"id\": \"8tm8mUWmPvtmPFPk\", \"name\": \"hcti.io\"}}, \"typeVersion\": 4.2}, {\"id\": \"64f4789f-9de8-414f-af62-ddc339f0d0ac\", \"name\": \"获取截图\", \"type\": \"n8n-nodes-base.httpRequest\", \"position\": [2800, 420], \"parameters\": {\"url\": \"={{ $json.url }}\", \"options\": {}, \"authentication\": \"通用凭证类型\", \"genericAuthType\": \"HTTP基本认证\"}, \"credentials\": {\"httpBasicAuth\": {\"id\": \"8tm8mUWmPvtmPFPk\", \"name\": \"hcti.io\"}}, \"typeVersion\": 4.2}, {\"id\": \"db707bd9-6abc-4ab7-8ffa-ad25c5e8adc4\", \"name\": \"设置Outlook变量\", \"type\": \"n8n-nodes-base.set\", \"position\": [2040, 680], \"parameters\": {\"options\": {}, \"assignments\": {\"assignments\": [{\"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\", \"name\": \"htmlBody\", \"type\": \"string\", \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"}, {\"id\": \"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\", \"name\": \"headers\", \"type\": \"string\", \"value\": \"={{ $json}}\"}, {\"id\": \"20566ad4-7eb7-42b1-8a0d-f8b759610f10\", \"name\": \"subject\", \"type\": \"string\", \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"}, {\"id\": \"7171998f-a5a2-4e23-946a-9c1ad75710e7\", \"name\": \"recipient\", \"type\": \"string\", \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"}, {\"id\": \"cc262634-2470-4524-8319-abe2518a6335\", \"name\": \"textBody\", \"type\": \"string\", \"value\": \"={{ $('Retrieve Headers of Email').item.json.body.content }}\"}]}}, \"typeVersion\": 3.4}, {\"id\": \"7a3622c0-6949-4ea3-ae13-46a1ee26de7b\", \"name\": \"设置Gmail变量\", \"type\": \"n8n-nodes-base.set\", \"position\": [2020, 120], \"parameters\": {\"options\": {}, \"assignments\": {\"assignments\": [{\"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\", \"name\": \"htmlBody\", \"type\": \"string\", \"value\": \"={{ $json.html }}\"}, {\"id\": \"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\", \"name\": \"headers\", \"type\": \"string\", \"value\": \"={{ $json.headers }}\"}, {\"id\": \"1d690098-be2a-4604-baf8-62f314930929\", \"name\": \"subject\", \"type\": \"string\", \"value\": \"={{ $json.subject }}\"}, {\"id\": \"8009f00a-547f-4eb1-b52d-2e7305248885\", \"name\": \"recipient\", \"type\": \"string\", \"value\": \"={{ $json.to.text }}\"}, {\"id\": \"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\", \"name\": \"textBody\", \"type\": \"string\", \"value\": \"={{ $json.text }}\"}]}}, \"typeVersion\": 3.4}, {\"id\": \"4b4c6b34-f74c-4402-91a1-4d002e02a3bd\", \"name\": \"获取邮件标头\", \"type\": \"n8n-nodes-base.httpRequest\", \"position\": [1700, 680], \"parameters\": {\"url\": \"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\", \"options\": {}, \"sendHeaders\": true, \"authentication\": \"预定义凭证类型\", \"headerParameters\": {\"parameters\": [{\"name\": \"Accept\", \"value\": \"application/json\"}, {\"name\": \"Prefer\", \"value\": \"outlook.body-content-type=\\\"text\\\"\"}]}, \"nodeCredentialType\": \"微软Outlook OAuth2接口\"}, \"credentials\": {\"microsoftOutlookOAuth2Api\": {\"id\": \"vTCK0oVQ0WjFrI5H\", \"name\": \" Outlook Credential\"}}, \"typeVersion\": 4.2}, {\"id\": \"0c9883b5-3eb7-45db-9803-d1b30166a3b5\", \"name\": \"格式化标题\", \"type\": \"n8n-nodes-base.code\", \"position\": [1880, 680], \"parameters\": {\"jsCode\": \"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"}, \"typeVersion\": 2}, {\"id\": \"c21a976c-00e5-4823-bd94-4c95a7d60438\", \"name\": \"使用ChatGPT分析邮件\", \"type\": \"@n8n/n8n-nodes-langchain.openAi\", \"position\": [3000, 420], \"parameters\": {\"modelId\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"gpt-4o\", \"cachedResultName\": \"GPT-4O\"}, \"options\": {}, \"messages\": {\"values\": [{\"content\": \"=Describe the following email using the HTML body and headers. Determine if the email could be a phishing email. \\n\\nHere is the HTML body:\\n{{ $('Set Email Variables').item.json.htmlBody }}\\n\\nThe message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\n\"}, {\"role\": \"system\", \"content\": \"Please make sure to output all responses using the following structured JSON output:\\n{\\n  \\\"malicious\\\": false,\\n  \\\"summary\\\": \\\"The email appears to be a legitimate communication from a known sender. It contains no suspicious links, attachments, or language that indicates phishing or malicious intent.\\\"\\n}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response. Make the summary as verbose as possible including a full breakdown of why the email is benign or malicious.\"}]}, \"jsonOutput\": true}, \"credentials\": {\"openAiApi\": {\"id\": \"76\", \"name\": \"OpenAi account\"}}, \"typeVersion\": 1.6}, {\"id\": \"a91f4095-9245-4276-b21f-f415de22df62\", \"name\": \"创建潜在恶意工单\", \"type\": \"n8n-nodes-base.jira\", \"position\": [3640, 400], \"parameters\": {\"project\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"10001\", \"cachedResultName\": \"Support\"}, \"summary\": \"=潜在恶意 - 已报告钓鱼邮件：\\\"{{ $('设置邮件变量').item.json.subject }}\\\"\", \"issueType\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"10008\", \"cachedResultName\": \"Task\"}, \"additionalFields\": {\"description\": \"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}}, \"credentials\": {\"jiraSoftwareCloudApi\": {\"id\": \"BZmmGUrNIsgM9fDj\", \"name\": \"New  Jira Cloud\"}}, \"typeVersion\": 1}, {\"id\": \"a5a66a0e-9d8a-45a9-b1ae-aec78ddfec27\", \"name\": \"创建潜在良性工单\", \"type\": \"n8n-nodes-base.jira\", \"position\": [3640, 580], \"parameters\": {\"project\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"10001\", \"cachedResultName\": \"Support\"}, \"summary\": \"=潜在良性 - 已报告钓鱼邮件：\\\"{{ $('设置邮件变量').item.json.subject }}\\\"\", \"issueType\": {\"__rl\": true, \"mode\": \"list\", \"value\": \"10008\", \"cachedResultName\": \"Task\"}, \"additionalFields\": {\"description\": \"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}}, \"credentials\": {\"jiraSoftwareCloudApi\": {\"id\": \"BZmmGUrNIsgM9fDj\", \"name\": \"New  Jira Cloud\"}}, \"typeVersion\": 1}, {\"id\": \"5af0d60b-d021-4dd9-98f7-b2842800764a\", \"name\": \"重命名截图\", \"type\": \"n8n-nodes-base.code\", \"position\": [4020, 480], \"parameters\": {\"mode\": \"每个项目运行一次\", \"jsCode\": \"$('获取截图').项.二进制数据.文件名 = '邮件截图.png'\\n\\n返回 $('获取截图').项;\"}, \"typeVersion\": 2}, {\"id\": \"441c4cbb-bd93-4213-bd34-e18f2a49389f\", \"name\": \"设置Jira ID\", \"type\": \"n8n-nodes-base.set\", \"position\": [3860, 480], \"parameters\": {\"options\": {}, \"includeOtherFields\": true}, \"typeVersion\": 3.4}, {\"id\": \"4c71188c-011d-4f8e-a36c-87900bfab59a\", \"name\": \"上传邮件截图至Jira\", \"type\": \"n8n-nodes-base.jira\", \"position\": [4220, 480], \"parameters\": {\"issueKey\": \"={{ $('设置Jira ID').item.json.key }}\", \"resource\": \"问题附件\"}, \"credentials\": {\"jiraSoftwareCloudApi\": {\"id\": \"BZmmGUrNIsgM9fDj\", \"name\": \"New  Jira Cloud\"}}, \"typeVersion\": 1}, {\"id\": \"3c031c34-8306-44e1-8e0e-a584c5323112\", \"name\": \"将邮件正文上传至Jira\", \"type\": \"n8n-nodes-base.jira\", \"position\": [4620, 480], \"parameters\": {\"issueKey\": \"={{ $('设置 Jira ID').item.json.key }}\", \"resource\": \"问题附件\"}, \"credentials\": {\"jiraSoftwareCloudApi\": {\"id\": \"BZmmGUrNIsgM9fDj\", \"name\": \"New  Jira Cloud\"}}, \"typeVersion\": 1}, {\"id\": \"d033dcbd-7ccb-451f-ab81-cc6d32d2e01f\", \"name\": \"将邮件正文转换为文件\", \"type\": \"n8n-nodes-base.convertToFile\", \"position\": [2420, 420], \"parameters\": {\"options\": {\"fileName\": \"emailBody.txt\"}, \"operation\": \"转为文本\", \"sourceProperty\": \"正文\"}, \"typeVersion\": 1.1}, {\"id\": \"bda5e2fe-d8c0-456b-975a-35e82ff02816\", \"name\": \"设置电子邮件变量\", \"type\": \"n8n-nodes-base.set\", \"position\": [2240, 420], \"parameters\": {\"options\": {}, \"includeOtherFields\": true}, \"typeVersion\": 3.4}, {\"id\": \"54ecd8ab-ac4a-4b6b-bd1b-bf8c70082a33\", \"name\": \"重命名邮件正文截图\", \"type\": \"n8n-nodes-base.code\", \"position\": [4420, 480], \"parameters\": {\"mode\": \"每个项目运行一次\", \"jsCode\": \"$('将邮件正文转换为文件').项.二进制数据.文件名 = '邮件正文.txt'\\n\\n返回 $('将邮件正文转换为文件').项;\"}, \"typeVersion\": 2}, {\"id\": \"fe5b82cc-b4bb-4c97-9477-075d5a280e9f\", \"name\": \"便利贴2\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [2574.536755825029, 0], \"parameters\": {\"color\": 7, \"width\": 376.8280004374956, \"height\": 595.590013880477, \"content\": \"![hctiapi](https://uploads.n8n.io/templates/hctiapi2.png)\\n## 邮件正文截图生成\\n\\n**HTML截图**节点将邮件的HTML正文发送至**hcti.io** API，生成呈现邮件版式的可视化截图。随后**获取截图**节点会提取该图像，使其可供后续步骤中作为附件添加或进行查阅。这种双重格式处理方式确保了邮件分析工作流程既清晰又灵活。\"}, \"typeVersion\": 1}, {\"id\": \"86b21049-f65e-4c6a-a854-c4376f870da9\", \"name\": \"便利贴\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [1380, -149.99110983560342], \"parameters\": {\"color\": 7, \"width\": 814.4556539379754, \"height\": 444.5525554815556, \"content\": \"![Gmail](https://uploads.n8n.io/templates/gmail.png)  \\n## Gmail集成与数据提取  \\n\\n工作流的这一部分通过**Gmail触发器**节点连接至Gmail账户，实时捕获新邮件（每分钟执行一次检查）。当检测到邮件时，系统会使用**设置Gmail变量**节点提取邮件主题、收件人、正文及标头等关键要素，并将其赋值给相应变量。这些经过结构化的变量将为后续步骤的分析与处理提供支持。  \\n\\n（注：根据技术文档翻译规范，保留节点名称的英文标识符** **格式；\\\"workflow\\\"译为\\\"工作流\\\"符合IT领域术语习惯；\\\"structured\\\"译为\\\"结构化\\\"体现数据处理特性；长句拆分后通过括号补充说明检查频率，确保技术准确性同时提升中文可读性）\"}, \"typeVersion\": 1}, {\"id\": \"b1a786cf-7a8d-49e1-90ed-31f3d0e65b13\", \"name\": \"便利贴1\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [1380, 308], \"parameters\": {\"color\": 7, \"width\": 809.7918597571277, \"height\": 602.9002284617277, \"content\": \"![Gmail](https://uploads.n8n.io/templates/outlook.png)\\n## Microsoft Outlook集成与邮件标头处理\\n\\n本模块实现Microsoft Outlook集成以监控并捕获接收邮件。Microsoft Outlook触发器节点每分钟检测新邮件。当检测到邮件时，\\\"提取邮件标头\\\"节点通过Microsoft Graph API获取详细的邮件标头和正文内容。\\\"格式化标头\\\"节点使用JavaScript函数将邮件标头整理为结构化格式，确保信息清晰且便于后续处理。最后，\\\"设置Outlook变量\\\"节点提取关键信息——包括邮件主题、收件人、正文及格式化后的标头——并将其赋值给变量供后续工作流步骤使用。该模块对于处理Outlook邮件并准备分析报告至关重要。\"}, \"typeVersion\": 1}, {\"id\": \"e7ace035-b5f5-4ef3-a117-22c7c938868d\", \"name\": \"便利贴3\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [2958.4325220284563, 24.744924120002338], \"parameters\": {\"color\": 7, \"width\": 593.0990401534098, \"height\": 573.1750519720028, \"content\": \"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## 人工智能驱动的邮件分析与威胁检测\\n\\n本模块运用ChatGPT实现高级邮件内容及信头分析，用于识别潜在钓鱼威胁。**通过ChatGPT分析邮件**节点会处理邮件的HTML正文和信头数据，生成包含详细分类结果的JSON响应（标记邮件为恶意或良性），并附有符合Jira格式的详尽分类依据说明。**恶意邮件检测**节点将根据AI输出的威胁判定结果执行后续流程——若邮件被标记为恶意，则自动触发举报工单创建等安全处置措施。该模块通过精准的AI分析能力，全面提升邮件安全处理流程的智能化水平。\"}, \"typeVersion\": 1}, {\"id\": \"02c1ad8e-f952-42d2-ae9f-cf3a77e49e52\", \"name\": \"便利贴4\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [3562.4948140707697, -125.79607719303533], \"parameters\": {\"color\": 7, \"width\": 1251.7025543502837, \"height\": 891.579206098173, \"content\": \"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## Jira工单自动创建与邮件附件处理\\n\\n本模块优化了钓鱼邮件报告的Jira记录流程，包含详细分析及附件处理。根据AI对邮件的分类结果，工作流会创建两种不同类型的Jira工单：\\n\\n1. **潜在恶意邮件**：当邮件被标记为钓鱼攻击时，**创建潜在恶意工单**节点将生成包含ChatGPT分析摘要和邮件详情的工单\\n2. **潜在良性邮件**：若邮件被判定为安全邮件，**创建潜在良性工单**节点会以非恶意分类记录包含相似细节的工单\\n\\n**设置Jira ID**节点会追踪生成工单的ID以便后续操作。附件处理环节高效精准：\\n\\n- **重命名截图**节点为邮件截图做好上传准备\\n- **上传邮件截图至Jira**节点将可视化证据添加至工单\\n- **重命名邮件正文截图**与**上传邮件正文至Jira**节点负责将邮件文本以`.txt`格式附加至工单\\n\\n该模块通过自动化工单创建提升报告效率，确保安全团队能便捷查阅所有相关邮件数据。\"}, \"typeVersion\": 1}, {\"id\": \"597ef23e-c61c-4e27-8c14-74ec20079c96\", \"name\": \"检查是否为恶意\", \"type\": \"n8n-nodes-base.if\", \"position\": [3400, 420], \"parameters\": {\"options\": {}, \"conditions\": {\"options\": {\"version\": 2, \"leftValue\": \"\", \"caseSensitive\": true, \"typeValidation\": \"strict\"}, \"combinator\": \"and\", \"conditions\": [{\"id\": \"493f412c-5f11-4173-8940-90f5bc7f5fab\", \"operator\": {\"type\": \"boolean\", \"operation\": \"true\", \"singleValue\": true}, \"leftValue\": \"={{ $json.message.content.malicious }}\", \"rightValue\": \"\"}]}}, \"typeVersion\": 2.2}, {\"id\": \"af512af9-924b-4019-bdf9-62aac9cd0dac\", \"name\": \"便利贴5\", \"type\": \"n8n-nodes-base.stickyNote\", \"position\": [2200, 39.041733604283195], \"parameters\": {\"color\": 7, \"width\": 365.6458805720866, \"height\": 559.8072303111675, \"content\": \"![n8n](https://uploads.n8n.io/templates/n8n.png)\\n## 邮件正文转换\\n\\n此部分将邮件正文处理为文本和可视化格式，以便进行详细分析与报告。**设置邮件变量**节点负责整理邮件数据（包括HTML正文和文本内容），为后续步骤做好准备。**邮件正文转文件**节点会生成包含纯文本版本邮件正文的`.txt`文件，便于存档或深度分析。\"}, \"typeVersion\": 1}], \"pinData\": {}, \"connections\": {\"Set Jira ID\": {\"main\": [[{\"node\": \"Rename Screenshot\", \"type\": \"main\", \"index\": 0}]]}, \"Gmail Trigger\": {\"main\": [[{\"node\": \"Set Gmail Variables\", \"type\": \"main\", \"index\": 0}]]}, \"Format Headers\": {\"main\": [[{\"node\": \"Set Outlook Variables\", \"type\": \"main\", \"index\": 0}]]}, \"Screenshot HTML\": {\"main\": [[{\"node\": \"Retrieve Screenshot\", \"type\": \"main\", \"index\": 0}]]}, \"Rename Screenshot\": {\"main\": [[{\"node\": \"Upload Screenshot of Email to Jira\", \"type\": \"main\", \"index\": 0}]]}, \"Check if Malicious\": {\"main\": [[{\"node\": \"Create Potentially Malicious Ticket\", \"type\": \"main\", \"index\": 0}], [{\"node\": \"Create Potentially Benign Ticket\", \"type\": \"main\", \"index\": 0}]]}, \"Retrieve Screenshot\": {\"main\": [[{\"node\": \"Analyze Email with ChatGPT\", \"type\": \"main\", \"index\": 0}]]}, \"Set Email Variables\": {\"main\": [[{\"node\": \"Convert Email Body to File\", \"type\": \"main\", \"index\": 0}]]}, \"Set Gmail Variables\": {\"main\": [[{\"node\": \"Set Email Variables\", \"type\": \"main\", \"index\": 0}]]}, \"Set Outlook Variables\": {\"main\": [[{\"node\": \"Set Email Variables\", \"type\": \"main\", \"index\": 0}]]}, \"Microsoft Outlook Trigger\": {\"main\": [[{\"node\": \"Retrieve Headers of Email\", \"type\": \"main\", \"index\": 0}]]}, \"Retrieve Headers of Email\": {\"main\": [[{\"node\": \"Format Headers\", \"type\": \"main\", \"index\": 0}]]}, \"Analyze Email with ChatGPT\": {\"main\": [[{\"node\": \"Check if Malicious\", \"type\": \"main\", \"index\": 0}]]}, \"Convert Email Body to File\": {\"main\": [[{\"node\": \"Screenshot HTML\", \"type\": \"main\", \"index\": 0}]]}, \"Rename Email Body Screenshot\": {\"main\": [[{\"node\": \"Upload Email Body to Jira\", \"type\": \"main\", \"index\": 0}]]}, \"Create Potentially Benign Ticket\": {\"main\": [[{\"node\": \"Set Jira ID\", \"type\": \"main\", \"index\": 0}]]}, \"Upload Screenshot of Email to Jira\": {\"main\": [[{\"node\": \"Rename Email Body Screenshot\", \"type\": \"main\", \"index\": 0}]]}, \"Create Potentially Malicious Ticket\": {\"main\": [[{\"node\": \"Set Jira ID\", \"type\": \"main\", \"index\": 0}]]}}}"
}
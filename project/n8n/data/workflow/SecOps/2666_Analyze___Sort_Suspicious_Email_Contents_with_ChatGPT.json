{
  "title": "Analyze & Sort Suspicious Email Contents with ChatGPT",
  "url": "https://n8n.io/workflows/2666-analyze-and-sort-suspicious-email-contents-with-chatgpt/",
  "category": "SecOps",
  "category_url": "https://n8n.io/workflows/categories/secops/?count=20",
  "author": "Angel Menendez",
  "publish_date": "Last update 4 months ago",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"},\"nodes\":[{\"id\":\"94dd7f48-0013-4fb5-89c4-826ecd7f2d66\",\"name\":\"Gmail Trigger\",\"type\":\"n8n-nodes-base.gmailTrigger\",\"position\":[1460,120],\"parameters\":{\"simple\":false,\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"gmailOAuth2\":{\"id\":\"kkhNhqKpZt6IUZd0\",\"name\":\"Gmail\"}},\"typeVersion\":1.2},{\"id\":\"ca2023fa-ceca-4923-80e4-a3843803536c\",\"name\":\"Microsoft Outlook Trigger\",\"type\":\"n8n-nodes-base.microsoftOutlookTrigger\",\"disabled\":true,\"position\":[1480,680],\"parameters\":{\"fields\":[\"body\",\"toRecipients\",\"subject\",\"bodyPreview\"],\"output\":\"fields\",\"filters\":{},\"options\":{},\"pollTimes\":{\"item\":[{\"mode\":\"everyMinute\"}]}},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":1},{\"id\":\"1f011214-91a0-4cfa-9d9e-29864937c0a3\",\"name\":\"Screenshot HTML\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2620,420],\"parameters\":{\"url\":\"https://hcti.io/v1/image\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"sendQuery\":true,\"authentication\":\"genericCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"html\",\"value\":\"={{ $('Set Email Variables').item.json.htmlBody }}\"}]},\"genericAuthType\":\"httpBasicAuth\",\"queryParameters\":{\"parameters\":[{}]}},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"64f4789f-9de8-414f-af62-ddc339f0d0ac\",\"name\":\"Retrieve Screenshot\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2800,420],\"parameters\":{\"url\":\"={{ $json.url }}\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpBasicAuth\"},\"credentials\":{\"httpBasicAuth\":{\"id\":\"8tm8mUWmPvtmPFPk\",\"name\":\"hcti.io\"}},\"typeVersion\":4.2},{\"id\":\"db707bd9-6abc-4ab7-8ffa-ad25c5e8adc4\",\"name\":\"Set Outlook Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2040,680],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"},{\"id\":\"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json}}\"},{\"id\":\"20566ad4-7eb7-42b1-8a0d-f8b759610f10\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"},{\"id\":\"7171998f-a5a2-4e23-946a-9c1ad75710e7\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"},{\"id\":\"cc262634-2470-4524-8319-abe2518a6335\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $('Retrieve Headers of Email').item.json.body.content }}\"}]}},\"typeVersion\":3.4},{\"id\":\"7a3622c0-6949-4ea3-ae13-46a1ee26de7b\",\"name\":\"Set Gmail Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2020,120],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\"name\":\"htmlBody\",\"type\":\"string\",\"value\":\"={{ $json.html }}\"},{\"id\":\"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\",\"name\":\"headers\",\"type\":\"string\",\"value\":\"={{ $json.headers }}\"},{\"id\":\"1d690098-be2a-4604-baf8-62f314930929\",\"name\":\"subject\",\"type\":\"string\",\"value\":\"={{ $json.subject }}\"},{\"id\":\"8009f00a-547f-4eb1-b52d-2e7305248885\",\"name\":\"recipient\",\"type\":\"string\",\"value\":\"={{ $json.to.text }}\"},{\"id\":\"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\",\"name\":\"textBody\",\"type\":\"string\",\"value\":\"={{ $json.text }}\"}]}},\"typeVersion\":3.4},{\"id\":\"4b4c6b34-f74c-4402-91a1-4d002e02a3bd\",\"name\":\"Retrieve Headers of Email\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1700,680],\"parameters\":{\"url\":\"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\",\"options\":{},\"sendHeaders\":true,\"authentication\":\"predefinedCredentialType\",\"headerParameters\":{\"parameters\":[{\"name\":\"Accept\",\"value\":\"application/json\"},{\"name\":\"Prefer\",\"value\":\"outlook.body-content-type=\\\"text\\\"\"}]},\"nodeCredentialType\":\"microsoftOutlookOAuth2Api\"},\"credentials\":{\"microsoftOutlookOAuth2Api\":{\"id\":\"vTCK0oVQ0WjFrI5H\",\"name\":\" Outlook Credential\"}},\"typeVersion\":4.2},{\"id\":\"0c9883b5-3eb7-45db-9803-d1b30166a3b5\",\"name\":\"Format Headers\",\"type\":\"n8n-nodes-base.code\",\"position\":[1880,680],\"parameters\":{\"jsCode\":\"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"},\"typeVersion\":2},{\"id\":\"c21a976c-00e5-4823-bd94-4c95a7d60438\",\"name\":\"Analyze Email with ChatGPT\",\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"position\":[3000,420],\"parameters\":{\"modelId\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"gpt-4o\",\"cachedResultName\":\"GPT-4O\"},\"options\":{},\"messages\":{\"values\":[{\"content\":\"=Describe the following email using the HTML body and headers. Determine if the email could be a phishing email. \\n\\nHere is the HTML body:\\n{{ $('Set Email Variables').item.json.htmlBody }}\\n\\nThe message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\n\"},{\"role\":\"system\",\"content\":\"Please make sure to output all responses using the following structured JSON output:\\n{\\n  \\\"malicious\\\": false,\\n  \\\"summary\\\": \\\"The email appears to be a legitimate communication from a known sender. It contains no suspicious links, attachments, or language that indicates phishing or malicious intent.\\\"\\n}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response. Make the summary as verbose as possible including a full breakdown of why the email is benign or malicious.\"}]},\"jsonOutput\":true},\"credentials\":{\"openAiApi\":{\"id\":\"76\",\"name\":\"OpenAi account\"}},\"typeVersion\":1.6},{\"id\":\"a91f4095-9245-4276-b21f-f415de22df62\",\"name\":\"Create Potentially Malicious Ticket\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3640,400],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10001\",\"cachedResultName\":\"Support\"},\"summary\":\"=Potentially Malicious - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10008\",\"cachedResultName\":\"Task\"},\"additionalFields\":{\"description\":\"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"a5a66a0e-9d8a-45a9-b1ae-aec78ddfec27\",\"name\":\"Create Potentially Benign Ticket\",\"type\":\"n8n-nodes-base.jira\",\"position\":[3640,580],\"parameters\":{\"project\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10001\",\"cachedResultName\":\"Support\"},\"summary\":\"=Potentially Benign - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\"issueType\":{\"__rl\":true,\"mode\":\"list\",\"value\":\"10008\",\"cachedResultName\":\"Task\"},\"additionalFields\":{\"description\":\"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"}},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"5af0d60b-d021-4dd9-98f7-b2842800764a\",\"name\":\"Rename Screenshot\",\"type\":\"n8n-nodes-base.code\",\"position\":[4020,480],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"$('Retrieve Screenshot').item.binary.data.fileName = 'emailScreenshot.png'\\n\\nreturn $('Retrieve Screenshot').item;\"},\"typeVersion\":2},{\"id\":\"441c4cbb-bd93-4213-bd34-e18f2a49389f\",\"name\":\"Set Jira ID\",\"type\":\"n8n-nodes-base.set\",\"position\":[3860,480],\"parameters\":{\"options\":{},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"4c71188c-011d-4f8e-a36c-87900bfab59a\",\"name\":\"Upload Screenshot of Email to Jira\",\"type\":\"n8n-nodes-base.jira\",\"position\":[4220,480],\"parameters\":{\"issueKey\":\"={{ $('Set Jira ID').item.json.key }}\",\"resource\":\"issueAttachment\"},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"3c031c34-8306-44e1-8e0e-a584c5323112\",\"name\":\"Upload Email Body to Jira\",\"type\":\"n8n-nodes-base.jira\",\"position\":[4620,480],\"parameters\":{\"issueKey\":\"={{ $('Set Jira ID').item.json.key }}\",\"resource\":\"issueAttachment\"},\"credentials\":{\"jiraSoftwareCloudApi\":{\"id\":\"BZmmGUrNIsgM9fDj\",\"name\":\"New  Jira Cloud\"}},\"typeVersion\":1},{\"id\":\"d033dcbd-7ccb-451f-ab81-cc6d32d2e01f\",\"name\":\"Convert Email Body to File\",\"type\":\"n8n-nodes-base.convertToFile\",\"position\":[2420,420],\"parameters\":{\"options\":{\"fileName\":\"emailBody.txt\"},\"operation\":\"toText\",\"sourceProperty\":\"textBody\"},\"typeVersion\":1.1},{\"id\":\"bda5e2fe-d8c0-456b-975a-35e82ff02816\",\"name\":\"Set Email Variables\",\"type\":\"n8n-nodes-base.set\",\"position\":[2240,420],\"parameters\":{\"options\":{},\"includeOtherFields\":true},\"typeVersion\":3.4},{\"id\":\"54ecd8ab-ac4a-4b6b-bd1b-bf8c70082a33\",\"name\":\"Rename Email Body Screenshot\",\"type\":\"n8n-nodes-base.code\",\"position\":[4420,480],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"$('Convert Email Body to File').item.binary.data.fileName = 'emailBody.txt'\\n\\nreturn $('Convert Email Body to File').item;\"},\"typeVersion\":2},{\"id\":\"fe5b82cc-b4bb-4c97-9477-075d5a280e9f\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2574.536755825029,0],\"parameters\":{\"color\":7,\"width\":376.8280004374956,\"height\":595.590013880477,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/hctiapi2.png)\\n## Email Body Screenshot Creation\\n\\nThe **Screenshot HTML** node sends the email's HTML body to the **hcti.io** API, generating a screenshot that visually represents the email's layout. The **Retrieve Screenshot** node then fetches this image, making it available for attachment or review in subsequent steps. This dual-format processing ensures both clarity and flexibility in email analysis workflows.\"},\"typeVersion\":1},{\"id\":\"86b21049-f65e-4c6a-a854-c4376f870da9\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1380,-149.99110983560342],\"parameters\":{\"color\":7,\"width\":814.4556539379754,\"height\":444.5525554815556,\"content\":\"![Gmail](https://uploads.n8n.io/templates/gmail.png)\\n## Gmail Integration and Data Extraction\\n\\nThis section of the workflow connects to a Gmail account using the **Gmail Trigger** node, capturing incoming emails in real-time, with checks performed every minute. Once an email is detected, its key components—such as the subject, recipient, body, and headers—are extracted and assigned to variables using the **Set Gmail Variables** node. These variables are structured for subsequent analysis and processing in later steps.\"},\"typeVersion\":1},{\"id\":\"b1a786cf-7a8d-49e1-90ed-31f3d0e65b13\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1380,308],\"parameters\":{\"color\":7,\"width\":809.7918597571277,\"height\":602.9002284617277,\"content\":\"![Gmail](https://uploads.n8n.io/templates/outlook.png)\\n## Microsoft Outlook Integration and Email Header Processing\\n\\nThis section enables the integration of Microsoft Outlook to monitor and capture incoming emails. The Microsoft Outlook Trigger node checks for new messages every minute. Once an email is detected, the Retrieve Headers of Email node fetches detailed header and body content via the Microsoft Graph API. The Format Headers node organizes the email headers into a structured format using a JavaScript function, ensuring clarity and readiness for further processing. Finally, the Set Outlook Variables node extracts and assigns key details—such as the email subject, recipient, body, and formatted headers—to variables for use in subsequent workflow steps. This section is essential for processing Outlook emails and preparing them for analysis and reporting.\\n\\n\\n\\n\\n\\n\\n\"},\"typeVersion\":1},{\"id\":\"e7ace035-b5f5-4ef3-a117-22c7c938868d\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2958.4325220284563,24.744924120002338],\"parameters\":{\"color\":7,\"width\":593.0990401534098,\"height\":573.1750519720028,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## AI-Powered Email Analysis and Threat Detection\\n\\nThis section leverages ChatGPT for advanced email content and header analysis to determine potential phishing threats. The **Analyze Email with ChatGPT** node processes the email's HTML body and headers, generating a detailed JSON response that categorizes the email as malicious or benign. The response includes a verbose explanation, formatted for Jira, outlining the reasons for the classification. The **Check if Malicious** node evaluates the AI output to determine the next steps based on the email's threat status. If flagged as malicious, subsequent actions like reporting and ticket creation are triggered. This section ensures precise, AI-driven analysis to enhance email security workflows.\"},\"typeVersion\":1},{\"id\":\"02c1ad8e-f952-42d2-ae9f-cf3a77e49e52\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3562.4948140707697,-125.79607719303533],\"parameters\":{\"color\":7,\"width\":1251.7025543502837,\"height\":891.579206098173,\"content\":\"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## Automated Jira Ticket Creation and Email Attachment\\n\\nThis section streamlines the process of logging phishing email reports in Jira, complete with detailed analysis and attachments. The workflow creates two distinct Jira tickets depending on the AI classification of the email:\\n\\n1. **Potentially Malicious**: The **Create Potentially Malicious Ticket** node generates a ticket if the email is flagged as a phishing attempt, including a summary of ChatGPT's analysis and the email’s details.\\n2. **Potentially Benign**: If the email is classified as safe, the **Create Potentially Benign Ticket** node logs a ticket with similar details but under a non-malicious category.\\n\\n\\nThe **Set Jira ID** node ensures the generated ticket's ID is tracked for subsequent operations. Attachments are handled efficiently:\\n\\n- **Rename Screenshot** prepares the email screenshot for upload.\\n- **Upload Screenshot of Email to Jira** adds the screenshot to the Jira ticket for visual context.\\n- **Rename Email Body Screenshot** and **Upload Email Body to Jira** manage the attachment of the email's text body as a `.txt` file.\\n\\n\\nThis section enhances reporting by automating ticket creation, ensuring all relevant email data is readily available for review by security teams.\"},\"typeVersion\":1},{\"id\":\"597ef23e-c61c-4e27-8c14-74ec20079c96\",\"name\":\"Check if Malicious\",\"type\":\"n8n-nodes-base.if\",\"position\":[3400,420],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"493f412c-5f11-4173-8940-90f5bc7f5fab\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ $json.message.content.malicious }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"af512af9-924b-4019-bdf9-62aac9cd0dac\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[2200,39.041733604283195],\"parameters\":{\"color\":7,\"width\":365.6458805720866,\"height\":559.8072303111675,\"content\":\"![n8n](https://uploads.n8n.io/templates/n8n.png)\\n## Email Body Conversion\\n\\nThis section processes the email body into both text and visual formats for detailed analysis and reporting. The **Set Email Variables** node organizes the email's data, including its HTML body and text content, to prepare it for further steps. The **Convert Email Body to File** node creates a `.txt` file containing the plain text version of the email body, useful for documentation or further analysis.\"},\"typeVersion\":1}],\"pinData\":{},\"connections\":{\"Set Jira ID\":{\"main\":[[{\"node\":\"Rename Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Gmail Trigger\":{\"main\":[[{\"node\":\"Set Gmail Variables\",\"type\":\"main\",\"index\":0}]]},\"Format Headers\":{\"main\":[[{\"node\":\"Set Outlook Variables\",\"type\":\"main\",\"index\":0}]]},\"Screenshot HTML\":{\"main\":[[{\"node\":\"Retrieve Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Rename Screenshot\":{\"main\":[[{\"node\":\"Upload Screenshot of Email to Jira\",\"type\":\"main\",\"index\":0}]]},\"Check if Malicious\":{\"main\":[[{\"node\":\"Create Potentially Malicious Ticket\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Create Potentially Benign Ticket\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Screenshot\":{\"main\":[[{\"node\":\"Analyze Email with ChatGPT\",\"type\":\"main\",\"index\":0}]]},\"Set Email Variables\":{\"main\":[[{\"node\":\"Convert Email Body to File\",\"type\":\"main\",\"index\":0}]]},\"Set Gmail Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Set Outlook Variables\":{\"main\":[[{\"node\":\"Set Email Variables\",\"type\":\"main\",\"index\":0}]]},\"Microsoft Outlook Trigger\":{\"main\":[[{\"node\":\"Retrieve Headers of Email\",\"type\":\"main\",\"index\":0}]]},\"Retrieve Headers of Email\":{\"main\":[[{\"node\":\"Format Headers\",\"type\":\"main\",\"index\":0}]]},\"Analyze Email with ChatGPT\":{\"main\":[[{\"node\":\"Check if Malicious\",\"type\":\"main\",\"index\":0}]]},\"Convert Email Body to File\":{\"main\":[[{\"node\":\"Screenshot HTML\",\"type\":\"main\",\"index\":0}]]},\"Rename Email Body Screenshot\":{\"main\":[[{\"node\":\"Upload Email Body to Jira\",\"type\":\"main\",\"index\":0}]]},\"Create Potentially Benign Ticket\":{\"main\":[[{\"node\":\"Set Jira ID\",\"type\":\"main\",\"index\":0}]]},\"Upload Screenshot of Email to Jira\":{\"main\":[[{\"node\":\"Rename Email Body Screenshot\",\"type\":\"main\",\"index\":0}]]},\"Create Potentially Malicious Ticket\":{\"main\":[[{\"node\":\"Set Jira ID\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "### Analyze & Sort Suspicious Email Contents with ChatGPT and Jira\n\n#### Who is this for?\n\nThis workflow is tailored for IT security teams, managed service providers (MSPs), and organizations aiming to streamline the detection and reporting of phishing emails. It's especially useful for teams handling high email volumes and requiring quick, automated analysis.\n\n#### What problem is this workflow solving?\n\nPhishing emails pose a significant cybersecurity threat, and manual review processes are time-consuming and prone to human error. This workflow automates the identification of malicious emails, provides AI-driven insights, and generates structured reports, enabling faster and more efficient responses to email-based threats.\n\n#### What this workflow does\n\nThis workflow integrates Gmail or Microsoft Outlook to monitor and capture incoming emails. It processes the email content and headers, converts the email's body to a visual screenshot for clarity, and uses ChatGPT's advanced AI to analyze the email for phishing indicators. Based on the analysis, it categorizes emails as potentially malicious or benign, creating detailed Jira tickets for each case. Attachments, including the email body and screenshots, are automatically uploaded for comprehensive reporting.\n\n**Key steps include:**\n\n  1. **Email Integration** : Captures emails from Gmail or Microsoft Outlook.\n  2. **Content Processing** : Extracts and organizes email content and metadata.\n  3. **AI Analysis** : Uses ChatGPT to evaluate email content and headers.\n  4. **Classification** : Categorizes emails as malicious or benign.\n  5. **Automated Reporting** : Creates Jira tickets with detailed analysis and attachments.\n\n\n\n#### Setup\n\n  1. **Authentication** : Configure Gmail or Microsoft Outlook credentials in n8n.\n  2. **API Keys** : Add credentials for the HTML screenshot service (`hcti.io`) and OpenAI.\n  3. **Jira Configuration** : Set up project and issue types in the Jira nodes.\n  4. **Customization** : Update sticky notes and nodes to fit your organizational requirements, such as modifying the AI prompt or Jira ticket fields.\n\n\n\n#### How to customize this workflow to your needs\n\n  * Adjust email triggers to include or exclude specific senders or subjects.\n  * Refine the AI prompt in the ChatGPT node to tailor phishing detection criteria.\n  * Modify Jira ticket content to include additional fields or match specific workflows.\n\n\n\nThis workflow is ideal for automating email threat detection, reducing response times, and enhancing overall cybersecurity processes. By leveraging AI-powered insights, it helps organizations stay ahead of phishing attacks.\n",
  "readme_html": "<!--[--><div data-v-006f9244=\"\"><h3>Analyze &amp; Sort Suspicious Email Contents with ChatGPT and Jira</h3>\n<h4>Who is this for?</h4>\n<p>This workflow is tailored for IT security teams, managed service providers (MSPs), and organizations aiming to streamline the detection and reporting of phishing emails. It's especially useful for teams handling high email volumes and requiring quick, automated analysis.</p>\n<h4>What problem is this workflow solving?</h4>\n<p>Phishing emails pose a significant cybersecurity threat, and manual review processes are time-consuming and prone to human error. This workflow automates the identification of malicious emails, provides AI-driven insights, and generates structured reports, enabling faster and more efficient responses to email-based threats.</p>\n<h4>What this workflow does</h4>\n<p>This workflow integrates Gmail or Microsoft Outlook to monitor and capture incoming emails. It processes the email content and headers, converts the email's body to a visual screenshot for clarity, and uses ChatGPT's advanced AI to analyze the email for phishing indicators. Based on the analysis, it categorizes emails as potentially malicious or benign, creating detailed Jira tickets for each case. Attachments, including the email body and screenshots, are automatically uploaded for comprehensive reporting.</p>\n<p><strong>Key steps include:</strong></p>\n<ol>\n<li><strong>Email Integration</strong>: Captures emails from Gmail or Microsoft Outlook.</li>\n<li><strong>Content Processing</strong>: Extracts and organizes email content and metadata.</li>\n<li><strong>AI Analysis</strong>: Uses ChatGPT to evaluate email content and headers.</li>\n<li><strong>Classification</strong>: Categorizes emails as malicious or benign.</li>\n<li><strong>Automated Reporting</strong>: Creates Jira tickets with detailed analysis and attachments.</li>\n</ol>\n<h4>Setup</h4>\n<ol>\n<li><strong>Authentication</strong>: Configure Gmail or Microsoft Outlook credentials in n8n.</li>\n<li><strong>API Keys</strong>: Add credentials for the HTML screenshot service (<code>hcti.io</code>) and OpenAI.</li>\n<li><strong>Jira Configuration</strong>: Set up project and issue types in the Jira nodes.</li>\n<li><strong>Customization</strong>: Update sticky notes and nodes to fit your organizational requirements, such as modifying the AI prompt or Jira ticket fields.</li>\n</ol>\n<h4>How to customize this workflow to your needs</h4>\n<ul>\n<li>Adjust email triggers to include or exclude specific senders or subjects.</li>\n<li>Refine the AI prompt in the ChatGPT node to tailor phishing detection criteria.</li>\n<li>Modify Jira ticket content to include additional fields or match specific workflows.</li>\n</ul>\n<p>This workflow is ideal for automating email threat detection, reducing response times, and enhancing overall cybersecurity processes. By leveraging AI-powered insights, it helps organizations stay ahead of phishing attacks.</p>\n</div><!--]-->",
  "readme_zh": "### 利用ChatGPT与Jira分析并分类可疑邮件内容\n\n#### 适用对象\n本工作流专为IT安全团队、托管服务提供商（MSP）及希望优化钓鱼邮件检测与报告流程的机构设计，特别适合需要快速自动化分析、处理大量邮件的团队。\n\n#### 解决痛点\n钓鱼邮件是重大网络安全威胁，人工审核耗时且易出错。该工作流能自动识别恶意邮件，提供AI驱动的分析见解，生成结构化报告，显著提升邮件威胁的响应效率。\n\n#### 核心功能\n工作流集成Gmail或Microsoft Outlook监控收件，通过处理邮件内容与标头、将正文转换为可视化截图，并运用ChatGPT高级AI检测钓鱼特征。根据分析结果将邮件分类为恶意/良性，自动创建带详细分析的Jira工单，并上传邮件正文截图等附件实现完整溯源。\n\n**关键步骤：**\n1. **邮件集成**：从Gmail或Microsoft Outlook抓取邮件\n2. **内容处理**：提取并结构化邮件内容与元数据\n3. **AI分析**：调用ChatGPT评估邮件内容与标头\n4. **风险分类**：标记邮件为恶意或良性\n5. **自动报告**：生成含详细分析及附件的Jira工单\n\n#### 配置指南\n1. **身份验证**：在n8n中配置邮箱凭证\n2. **API密钥**：添加HTML截图服务（hcti.io）和OpenAI的密钥\n3. **Jira设置**：配置Jira节点中的项目与问题类型\n4. **定制化**：根据需求修改便签注释和节点，如调整AI提示词或Jira字段\n\n#### 个性化定制建议\n- 调整邮件触发条件以包含/排除特定发件人或主题\n- 优化ChatGPT节点的提示词以定制钓鱼检测标准\n- 扩展Jira工单字段以适配现有工作流程\n\n该工作流通过AI赋能实现邮件威胁自动化检测，既能缩短响应时间，又能强化整体网络安全防护体系，助力组织在反钓鱼攻防战中抢占先机。",
  "title_zh": "利用ChatGPT分析与分类可疑邮件内容",
  "publish_date_absolute": "2025-01-06",
  "publish_date_zh": "最后更新于4个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"94dd7f48-0013-4fb5-89c4-826ecd7f2d66\",\n      \"name\": \"Gmail Trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        1460,\n        120\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {},\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"kkhNhqKpZt6IUZd0\",\n          \"name\": \"Gmail\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"ca2023fa-ceca-4923-80e4-a3843803536c\",\n      \"name\": \"Microsoft Outlook Trigger\",\n      \"type\": \"n8n-nodes-base.microsoftOutlookTrigger\",\n      \"disabled\": true,\n      \"position\": [\n        1480,\n        680\n      ],\n      \"parameters\": {\n        \"fields\": [\n          \"body\",\n          \"toRecipients\",\n          \"subject\",\n          \"bodyPreview\"\n        ],\n        \"output\": \"fields\",\n        \"filters\": {},\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"microsoftOutlookOAuth2Api\": {\n          \"id\": \"vTCK0oVQ0WjFrI5H\",\n          \"name\": \" Outlook Credential\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1f011214-91a0-4cfa-9d9e-29864937c0a3\",\n      \"name\": \"Screenshot HTML\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2620,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"https://hcti.io/v1/image\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"html\",\n              \"value\": \"={{ $('Set Email Variables').item.json.htmlBody }}\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpBasicAuth\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {}\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"8tm8mUWmPvtmPFPk\",\n          \"name\": \"hcti.io\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"64f4789f-9de8-414f-af62-ddc339f0d0ac\",\n      \"name\": \"Retrieve Screenshot\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2800,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.url }}\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpBasicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"8tm8mUWmPvtmPFPk\",\n          \"name\": \"hcti.io\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"db707bd9-6abc-4ab7-8ffa-ad25c5e8adc4\",\n      \"name\": \"Set Outlook Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2040,\n        680\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\n              \"name\": \"htmlBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.body.content }}\"\n            },\n            {\n              \"id\": \"13bdd95b-ef02-486e-b38b-d14bd05a4a8a\",\n              \"name\": \"headers\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json}}\"\n            },\n            {\n              \"id\": \"20566ad4-7eb7-42b1-8a0d-f8b759610f10\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.subject }}\"\n            },\n            {\n              \"id\": \"7171998f-a5a2-4e23-946a-9c1ad75710e7\",\n              \"name\": \"recipient\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Microsoft Outlook Trigger').item.json.toRecipients[0].emailAddress.address }}\"\n            },\n            {\n              \"id\": \"cc262634-2470-4524-8319-abe2518a6335\",\n              \"name\": \"textBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Retrieve Headers of Email').item.json.body.content }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"7a3622c0-6949-4ea3-ae13-46a1ee26de7b\",\n      \"name\": \"Set Gmail Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2020,\n        120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"38bd3db2-1a8d-4c40-a2dd-336e0cc84224\",\n              \"name\": \"htmlBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.html }}\"\n            },\n            {\n              \"id\": \"18fbcf78-6d3c-4036-b3a2-fb5adf22176a\",\n              \"name\": \"headers\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.headers }}\"\n            },\n            {\n              \"id\": \"1d690098-be2a-4604-baf8-62f314930929\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.subject }}\"\n            },\n            {\n              \"id\": \"8009f00a-547f-4eb1-b52d-2e7305248885\",\n              \"name\": \"recipient\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.to.text }}\"\n            },\n            {\n              \"id\": \"1932e97d-b03b-4964-b8bc-8262aaaa1f7a\",\n              \"name\": \"textBody\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.text }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4b4c6b34-f74c-4402-91a1-4d002e02a3bd\",\n      \"name\": \"Retrieve Headers of Email\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1700,\n        680\n      ],\n      \"parameters\": {\n        \"url\": \"=https://graph.microsoft.com/v1.0/me/messages/{{ $json.id }}?$select=internetMessageHeaders,body\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Accept\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"Prefer\",\n              \"value\": \"outlook.body-content-type=\\\"text\\\"\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"microsoftOutlookOAuth2Api\"\n      },\n      \"credentials\": {\n        \"microsoftOutlookOAuth2Api\": {\n          \"id\": \"vTCK0oVQ0WjFrI5H\",\n          \"name\": \" Outlook Credential\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"0c9883b5-3eb7-45db-9803-d1b30166a3b5\",\n      \"name\": \"Format Headers\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1880,\n        680\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const input = $('Retrieve Headers of Email').item.json.internetMessageHeaders;\\n\\nconst result = input.reduce((acc, { name, value }) => {\\n  if (!acc[name]) acc[name] = [];\\n  acc[name].push(value);\\n  return acc;\\n}, {});\\n\\nreturn result;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"c21a976c-00e5-4823-bd94-4c95a7d60438\",\n      \"name\": \"Analyze Email with ChatGPT\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"position\": [\n        3000,\n        420\n      ],\n      \"parameters\": {\n        \"modelId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o\",\n          \"cachedResultName\": \"GPT-4O\"\n        },\n        \"options\": {},\n        \"messages\": {\n          \"values\": [\n            {\n              \"content\": \"=Describe the following email using the HTML body and headers. Determine if the email could be a phishing email. \\n\\nHere is the HTML body:\\n{{ $('Set Email Variables').item.json.htmlBody }}\\n\\nThe message headers are as follows:\\n{{ $('Set Email Variables').item.json.headers }}\\n\\n\"\n            },\n            {\n              \"role\": \"system\",\n              \"content\": \"Please make sure to output all responses using the following structured JSON output:\\n{\\n  \\\"malicious\\\": false,\\n  \\\"summary\\\": \\\"The email appears to be a legitimate communication from a known sender. It contains no suspicious links, attachments, or language that indicates phishing or malicious intent.\\\"\\n}\\n\\nFormat the response for Jira who uses a wiki-style renderer. Do not include ``` around your response. Make the summary as verbose as possible including a full breakdown of why the email is benign or malicious.\"\n            }\n          ]\n        },\n        \"jsonOutput\": true\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"76\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.6\n    },\n    {\n      \"id\": \"a91f4095-9245-4276-b21f-f415de22df62\",\n      \"name\": \"Create Potentially Malicious Ticket\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        3640,\n        400\n      ],\n      \"parameters\": {\n        \"project\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10001\",\n          \"cachedResultName\": \"Support\"\n        },\n        \"summary\": \"=Potentially Malicious - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\n        \"issueType\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10008\",\n          \"cachedResultName\": \"Task\"\n        },\n        \"additionalFields\": {\n          \"description\": \"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"\n        }\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a5a66a0e-9d8a-45a9-b1ae-aec78ddfec27\",\n      \"name\": \"Create Potentially Benign Ticket\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        3640,\n        580\n      ],\n      \"parameters\": {\n        \"project\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10001\",\n          \"cachedResultName\": \"Support\"\n        },\n        \"summary\": \"=Potentially Benign - Phishing Email Reported: \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\",\n        \"issueType\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10008\",\n          \"cachedResultName\": \"Task\"\n        },\n        \"additionalFields\": {\n          \"description\": \"=A phishing email was reported by {{ $('Set Email Variables').item.json.recipient }} with the subject line \\\"{{ $('Set Email Variables').item.json.subject }}\\\"\\n\\\\\\\\\\nh2. Here is ChatGPT's analysis of the email:\\n{{ $json.message.content.summary }}\"\n        }\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5af0d60b-d021-4dd9-98f7-b2842800764a\",\n      \"name\": \"Rename Screenshot\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        4020,\n        480\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"$('Retrieve Screenshot').item.binary.data.fileName = 'emailScreenshot.png'\\n\\nreturn $('Retrieve Screenshot').item;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"441c4cbb-bd93-4213-bd34-e18f2a49389f\",\n      \"name\": \"Set Jira ID\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        3860,\n        480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4c71188c-011d-4f8e-a36c-87900bfab59a\",\n      \"name\": \"Upload Screenshot of Email to Jira\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        4220,\n        480\n      ],\n      \"parameters\": {\n        \"issueKey\": \"={{ $('Set Jira ID').item.json.key }}\",\n        \"resource\": \"issueAttachment\"\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3c031c34-8306-44e1-8e0e-a584c5323112\",\n      \"name\": \"Upload Email Body to Jira\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        4620,\n        480\n      ],\n      \"parameters\": {\n        \"issueKey\": \"={{ $('Set Jira ID').item.json.key }}\",\n        \"resource\": \"issueAttachment\"\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"BZmmGUrNIsgM9fDj\",\n          \"name\": \"New  Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d033dcbd-7ccb-451f-ab81-cc6d32d2e01f\",\n      \"name\": \"Convert Email Body to File\",\n      \"type\": \"n8n-nodes-base.convertToFile\",\n      \"position\": [\n        2420,\n        420\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"fileName\": \"emailBody.txt\"\n        },\n        \"operation\": \"toText\",\n        \"sourceProperty\": \"textBody\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"bda5e2fe-d8c0-456b-975a-35e82ff02816\",\n      \"name\": \"Set Email Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2240,\n        420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"54ecd8ab-ac4a-4b6b-bd1b-bf8c70082a33\",\n      \"name\": \"Rename Email Body Screenshot\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        4420,\n        480\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"$('Convert Email Body to File').item.binary.data.fileName = 'emailBody.txt'\\n\\nreturn $('Convert Email Body to File').item;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"fe5b82cc-b4bb-4c97-9477-075d5a280e9f\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2574.536755825029,\n        0\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 376.8280004374956,\n        \"height\": 595.590013880477,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/hctiapi2.png)\\n## 邮件正文截图生成\\n\\n**HTML截图**节点将邮件的HTML正文发送至**hcti.io** API，生成呈现邮件布局的可视化截图。随后**获取截图**节点会提取该图像，使其可供后续步骤进行附件添加或审阅。这种双重格式处理方式确保了邮件分析流程既清晰又灵活。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"86b21049-f65e-4c6a-a854-c4376f870da9\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1380,\n        -149.99110983560342\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 814.4556539379754,\n        \"height\": 444.5525554815556,\n        \"content\": \"![Gmail](https://uploads.n8n.io/templates/gmail.png)  \\n## Gmail集成与数据提取  \\n\\n该工作流模块通过**Gmail触发器**节点连接邮箱账户，实时捕获新邮件（每分钟执行一次检查）。当检测到邮件时，**设置Gmail变量**节点将提取邮件主题、收件人、正文及标头等关键要素，并将其赋值给相应变量。这些结构化变量将为后续步骤的分析与处理提供支持。  \\n\\n（注：根据技术文档翻译规范，对以下元素进行了本地化处理：  \\n1. \\\"workflow\\\"译为\\\"工作流\\\"（行业标准术语）  \\n2. \\\"node\\\"保留为\\\"节点\\\"（技术领域通用译法）  \\n3. \\\"variables\\\"译为\\\"变量\\\"（编程术语统一）  \\n4. 长句拆分为符合中文阅读习惯的短句结构  \\n5. 被动语态转换为主动表述（如\\\"are extracted\\\"译为主动式\\\"提取\\\"））\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b1a786cf-7a8d-49e1-90ed-31f3d0e65b13\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1380,\n        308\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 809.7918597571277,\n        \"height\": 602.9002284617277,\n        \"content\": \"![Gmail](https://uploads.n8n.io/templates/outlook.png)  \\n## Microsoft Outlook集成与邮件头处理  \\n\\n本模块实现Microsoft Outlook集成，用于监控并捕获接收的电子邮件。Microsoft Outlook触发器节点每分钟检查新邮件。一旦检测到邮件，通过Microsoft Graph API，\\\"检索邮件头\\\"节点将获取详细的邮件头和正文内容。\\\"格式化邮件头\\\"节点利用JavaScript函数将邮件头整理为结构化格式，确保信息清晰且便于后续处理。最后，\\\"设置Outlook变量\\\"节点提取关键信息（如邮件主题、收件人、正文及格式化后的邮件头）并赋值给变量，供后续工作流步骤使用。该模块对于处理Outlook邮件并准备分析与报告至关重要。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e7ace035-b5f5-4ef3-a117-22c7c938868d\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2958.4325220284563,\n        24.744924120002338\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 593.0990401534098,\n        \"height\": 573.1750519720028,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/openai.png)\\n## 基于AI的邮件分析与威胁检测\\n\\n本模块运用ChatGPT实现高级邮件内容及信头分析，用以识别潜在钓鱼威胁。**通过ChatGPT分析邮件**节点会处理邮件的HTML正文和信头数据，生成包含详细分类结果（恶意/良性）的JSON响应，其中附有面向Jira平台的格式化说明文本，阐述判定依据。**恶意邮件检测**节点将根据AI输出的威胁判定结果自动触发后续流程——若确认为恶意邮件，系统将执行举报、创建工票等处置动作。该模块通过精准的AI驱动分析，有效强化邮件安全处理流程。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"02c1ad8e-f952-42d2-ae9f-cf3a77e49e52\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        3562.4948140707697,\n        -125.79607719303533\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1251.7025543502837,\n        \"height\": 891.579206098173,\n        \"content\": \"![hctiapi](https://uploads.n8n.io/templates/jira.png)\\n## Automated Jira Ticket Creation and Email Attachment\\n\\nThis section streamlines the process of logging phishing email reports in Jira, complete with detailed analysis and attachments. The workflow creates two distinct Jira tickets depending on the AI classification of the email:\\n\\n1. **Potentially Malicious**: The **Create Potentially Malicious Ticket** node generates a ticket if the email is flagged as a phishing attempt, including a summary of ChatGPT's analysis and the email’s details.\\n2. **Potentially Benign**: If the email is classified as safe, the **Create Potentially Benign Ticket** node logs a ticket with similar details but under a non-malicious category.\\n\\n\\nThe **Set Jira ID** node ensures the generated ticket's ID is tracked for subsequent operations. Attachments are handled efficiently:\\n\\n- **Rename Screenshot** prepares the email screenshot for upload.\\n- **Upload Screenshot of Email to Jira** adds the screenshot to the Jira ticket for visual context.\\n- **Rename Email Body Screenshot** and **Upload Email Body to Jira** manage the attachment of the email's text body as a `.txt` file.\\n\\n\\nThis section enhances reporting by automating ticket creation, ensuring all relevant email data is readily available for review by security teams.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"597ef23e-c61c-4e27-8c14-74ec20079c96\",\n      \"name\": \"Check if Malicious\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        3400,\n        420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"493f412c-5f11-4173-8940-90f5bc7f5fab\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.message.content.malicious }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"af512af9-924b-4019-bdf9-62aac9cd0dac\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2200,\n        39.041733604283195\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 365.6458805720866,\n        \"height\": 559.8072303111675,\n        \"content\": \"![n8n](https://uploads.n8n.io/templates/n8n.png)\\n## Email Body Conversion\\n\\nThis section processes the email body into both text and visual formats for detailed analysis and reporting. The **Set Email Variables** node organizes the email's data, including its HTML body and text content, to prepare it for further steps. The **Convert Email Body to File** node creates a `.txt` file containing the plain text version of the email body, useful for documentation or further analysis.\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Set Jira ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Rename Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Gmail Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Format Headers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Outlook Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Screenshot HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Rename Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload Screenshot of Email to Jira\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check if Malicious\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Potentially Malicious Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create Potentially Benign Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Analyze Email with ChatGPT\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Email Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert Email Body to File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Gmail Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Outlook Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Microsoft Outlook Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Headers of Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Headers of Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Format Headers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Analyze Email with ChatGPT\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check if Malicious\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert Email Body to File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Screenshot HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Rename Email Body Screenshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload Email Body to Jira\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Potentially Benign Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Jira ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload Screenshot of Email to Jira\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Rename Email Body Screenshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Potentially Malicious Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Jira ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
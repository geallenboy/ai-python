{
  "title": "URL and IP lookups through Greynoise and VirusTotal",
  "url": "https://n8n.io/workflows/1971-url-and-ip-lookups-through-greynoise-and-virustotal/",
  "category": "SecOps",
  "category_url": "https://n8n.io/workflows/categories/secops/?sort=createdAt:desc",
  "author": "n8n Team",
  "publish_date": "Last update 10 months ago",
  "publish_date_absolute": "2024-07-06",
  "content": "",
  "workflow_json": "{\"meta\":{\"instanceId\":\"8c8c5237b8e37b006a7adce87f4369350c58e41f3ca9de16196d3197f69eabcd\",\"templateId\":\"1971\"},\"nodes\":[{\"id\":\"dbb98f7d-6737-4eaa-9a66-9779c042c575\",\"name\":\"VirusTotal result\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2430,1648],\"parameters\":{\"url\":\"={{ $json.data.links.self }}\",\"options\":{},\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"virusTotalApi\"},\"typeVersion\":4.1},{\"id\":\"fb71337b-ebd3-4331-9f18-ff953c6b068b\",\"name\":\"DNS Lookup\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1330,1028],\"parameters\":{\"url\":\"=https://dns.google/resolve\",\"options\":{},\"sendQuery\":true,\"queryParameters\":{\"parameters\":[{\"name\":\"name\",\"value\":\"={{ $json.url.includes('://') ? $json.url.split('://')[1].split('/')[0] : $json.url }}\"}]}},\"typeVersion\":4.1},{\"id\":\"290c6e9c-31d1-4476-9beb-b72a795ecfbb\",\"name\":\"Set IP From Lookup\",\"type\":\"n8n-nodes-base.code\",\"position\":[1530,1028],\"parameters\":{\"mode\":\"runOnceForEachItem\",\"jsCode\":\"// Get the resolved IP address (last item in the Answer array)\\nconst ip = $json.Answer.pop().data;\\nconst item = {...$('Is IP?').item.json}\\nitem.ip = ip\\n\\nreturn {json: item};\"},\"typeVersion\":2},{\"id\":\"2e25aa5e-479c-4e3b-b866-89f2bdbabbba\",\"name\":\"Set IP\",\"type\":\"n8n-nodes-base.set\",\"position\":[1390,828],\"parameters\":{\"values\":{\"string\":[{\"name\":\"ip\",\"value\":\"={{ $json.url }}\"}]},\"options\":{}},\"typeVersion\":2},{\"id\":\"69b89cd7-1456-4067-a9da-d81ef3f86097\",\"name\":\"Merge VirusTotal & Greynoise results\",\"type\":\"n8n-nodes-base.merge\",\"position\":[3610,948],\"parameters\":{\"mode\":\"combine\",\"options\":{},\"mergeByFields\":{\"values\":[{\"field1\":\"ip\",\"field2\":\"ip\"}]}},\"typeVersion\":2.1},{\"id\":\"1011bb3b-3f75-40b8-a473-e07b70079b60\",\"name\":\"Is IP?\",\"type\":\"n8n-nodes-base.if\",\"position\":[1110,848],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $json.url }}\",\"value2\":\"/^(?:[0-9]{1,3}\\\\.){3}[0-9]{1,3}$/\",\"operation\":\"regex\"}]}},\"typeVersion\":1},{\"id\":\"770b4056-1497-48ed-bcd7-ad6e7106cc7d\",\"name\":\"Start VirusTotal Scan\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[1990,1648],\"parameters\":{\"url\":\"https://www.virustotal.com/api/v3/urls\",\"method\":\"POST\",\"options\":{},\"sendBody\":true,\"contentType\":\"multipart-form-data\",\"authentication\":\"predefinedCredentialType\",\"bodyParameters\":{\"parameters\":[{\"name\":\"url\",\"value\":\"={{ $json.url }}\"}]},\"nodeCredentialType\":\"virusTotalApi\"},\"typeVersion\":4.1},{\"id\":\"d5d31e4a-2f95-4151-af35-bb8129f2e5a3\",\"name\":\"VirusTotal Summary\",\"type\":\"n8n-nodes-base.set\",\"position\":[3230,1628],\"parameters\":{\"values\":{\"string\":[{\"name\":\"virusTotalStats\",\"value\":\"={{ $json.data.attributes.stats }}\"},{\"name\":\"blockList\",\"value\":\"={{ $json.data.attributes.results.BlockList.result }}\"},{\"name\":\"openPhish\",\"value\":\"={{ $json.data.attributes.results.OpenPhish.result }}\"},{\"name\":\"url\",\"value\":\"={{ $('Merge').all()[$itemIndex].json.url }}\"},{\"name\":\"ip\",\"value\":\"={{ $('Merge').all()[$itemIndex].json.ip }}\"}]},\"options\":{\"dotNotation\":false},\"keepOnlySet\":true},\"typeVersion\":2},{\"id\":\"467c795f-6f13-4d6d-a8cf-5cf9be2e7a77\",\"name\":\"VirusTotal ready?\",\"type\":\"n8n-nodes-base.if\",\"position\":[2790,1648],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $json.data.attributes.status }}\",\"value2\":\"queued\",\"operation\":\"notEqual\"}]}},\"typeVersion\":1},{\"id\":\"284728e4-dc74-4c37-890b-5305970960c0\",\"name\":\"Wait 5s\",\"type\":\"n8n-nodes-base.wait\",\"position\":[2230,1648],\"webhookId\":\"18348e84-831d-4ea8-bb39-6ec847c72275\",\"parameters\":{\"unit\":\"seconds\",\"amount\":5},\"typeVersion\":1},{\"id\":\"76e1414a-d690-44df-a3b8-8dbb4a192720\",\"name\":\"Webhook\",\"type\":\"n8n-nodes-base.webhook\",\"notes\":\"Example:\\n\\ncurl -X POST \\\"https://n8n.yourdomain.com/webhook-test/d5124bd8-aada-44da-8050-3070f303ad24\\\" \\\\\\n                 -H \\\"Content-Type: application/json\\\" \\\\\\n                 -d '{\\\"data\\\": [{\\\"url\\\": \\\"1.1.1.1\\\"}, {\\\"url\\\": \\\"88.204.59.2\\\"}, {\\\"url\\\": \\\"54.36.148.188\\\"}, {\\\"url\\\": \\\"facebook.com\\\"}], \\\"email\\\": \\\"user@domain.com\\\"}'\",\"position\":[450,1448],\"webhookId\":\"d5124bd8-aada-44da-8050-3070f303ad24\",\"parameters\":{\"path\":\"d5124bd8-aada-44da-8050-3070f303ad24\",\"options\":{},\"httpMethod\":\"POST\"},\"notesInFlow\":true,\"typeVersion\":1},{\"id\":\"b3e188f3-0a39-4451-ab70-632282243f03\",\"name\":\"Get List of URLs\",\"type\":\"n8n-nodes-base.itemLists\",\"position\":[650,1448],\"parameters\":{\"options\":{},\"fieldToSplitOut\":\"body.data\"},\"typeVersion\":3},{\"id\":\"360628b7-afc0-4444-a8c0-a85fae54b0e3\",\"name\":\"Set Email\",\"type\":\"n8n-nodes-base.set\",\"position\":[850,1448],\"parameters\":{\"values\":{\"string\":[{\"name\":\"Email\",\"value\":\"={{ $('Webhook').item.json.body.email }}\"}]},\"options\":{}},\"typeVersion\":2},{\"id\":\"6df9593b-5f9f-4b50-bddb-97dcb2017d6e\",\"name\":\"Merge Greynoise results\",\"type\":\"n8n-nodes-base.merge\",\"position\":[2370,728],\"parameters\":{\"mode\":\"combine\",\"options\":{},\"combinationMode\":\"mergeByPosition\"},\"typeVersion\":2.1},{\"id\":\"1957a675-7a5a-4ccd-b334-f2c4f9749f58\",\"name\":\"Send Report Slack\",\"type\":\"n8n-nodes-base.slack\",\"position\":[3850,1168],\"parameters\":{\"text\":\"=Successfully scanned {{ $json.url }} {{$json.ip !== $json.url ? `(${$json.ip})`: '' }}\\n\\n\\nVirusTotal Report ({{ $json.virusTotalStats.harmless + $json.virusTotalStats.malicious + $json.virusTotalStats.suspicious + $json.virusTotalStats.undetected}} scans)\\n\\n{{$json.virusTotalStats.harmless}} Harmless\\n{{$json.virusTotalStats.malicious}} Malicious\\n{{$json.virusTotalStats.suspicious}} Suspicious\\n{{$json.virusTotalStats.undetected}} Undetected\\n{{$json.virusTotalStats.timeout}} Timed out\\n\\nBlockList: {{ $json.blockList }}\\nOpenPhish: {{ $json.openPhish }}\\n\\nSummary: {{ $json.virusTotalStats.suspicious + $json.virusTotalStats.malicious === 0 ? \\\"✅ Harmless\\\": \\\"🚨 Malicous\\\" }}\\n\\n\\n\\nGreynoise Report\\n\\nTrust Level: {{ $json.trust_level ?? \\\"Not trusted\\\"}}\\nClassification: {{ $json.classification }}\\n\\nLocation: {{ $json.location || 'n/a' }}\\nCategory: {{ $json.category }}\\nTags: {{$json.tags.join(', ') || 'None'}}\",\"select\":\"channel\",\"channelId\":{\"__rl\":true,\"mode\":\"name\",\"value\":\"#notifications\"},\"otherOptions\":{}},\"typeVersion\":2.1},{\"id\":\"4d64351f-0233-4859-afd2-fc31e3fc37cd\",\"name\":\"Send Report Email\",\"type\":\"n8n-nodes-base.gmail\",\"position\":[3850,948],\"parameters\":{\"sendTo\":\"={{ $('Merge').first().json.Email }}\",\"message\":\"=Successfully scanned {{ $json.url }} {{$json.ip !== $json.url ? `(${$json.ip})`: '' }}<br /><br /><br />\\n\\n\\n<h3>VirusTotal Report ({{ $json.virusTotalStats.harmless + $json.virusTotalStats.malicious + $json.virusTotalStats.suspicious + $json.virusTotalStats.undetected}} scans)</h3><br /><br />\\n\\n{{$json.virusTotalStats.harmless}} Harmless<br />\\n{{$json.virusTotalStats.malicious}} Malicious<br />\\n{{$json.virusTotalStats.suspicious}} Suspicious<br />\\n{{$json.virusTotalStats.undetected}} Undetected<br />\\n{{$json.virusTotalStats.timeout}} Timed out<br /><br />\\n\\nBlockList: {{ $json.blockList }}<br />\\nOpenPhish: {{ $json.openPhish }}<br /><br />\\n\\n<b>Summary: {{ $json.virusTotalStats.suspicious + $json.virusTotalStats.malicious === 0 ? \\\"✅ Harmless\\\": \\\"🚨 Malicous\\\" }}</b><br /><br /><br />\\n\\n\\n\\n<h3>Greynoise Report</h3><br /><br />\\n\\nTrust Level: {{ $json.trust_level ?? \\\"Not trusted\\\"}}<br />\\nClassification: {{ $json.classification }}<br /><br />\\n\\nLocation: {{ $json.location || 'n/a' }}<br />\\nCategory: {{ $json.category }}<br />\\nTags: {{$json.tags.join(', ') || 'None'}}<br /><br /><br /><br />\",\"options\":{},\"subject\":\"={{ $json.url }} Scan Report\"},\"typeVersion\":2},{\"id\":\"e4305eb1-8e57-49d0-97b7-391200bd0042\",\"name\":\"Greynoise Summary\",\"type\":\"n8n-nodes-base.set\",\"position\":[2650,728],\"parameters\":{\"values\":{\"string\":[{\"name\":\"ip\",\"value\":\"={{ $json.ip }}\"},{\"name\":\"classification\",\"value\":\"={{ $json.classification || 'safe' }}\"},{\"name\":\"location\",\"value\":\"={{ $json.metadata?.region ? `${$json.metadata?.region} ${$json.metadata?.country}` : '' }}\"},{\"name\":\"tags\",\"value\":\"={{ $json.tags ?? [] }}\"},{\"name\":\"category\",\"value\":\"={{ $json.category || 'n/a' }}\"},{\"name\":\"trustLevel\",\"value\":\"={{ $json.trust_level }}\"}]},\"options\":{\"dotNotation\":false},\"keepOnlySet\":true},\"typeVersion\":2},{\"id\":\"c149b1f3-e447-4194-a94e-7d8e0bf38241\",\"name\":\"Merge\",\"type\":\"n8n-nodes-base.merge\",\"position\":[1750,848],\"parameters\":{},\"typeVersion\":2.1},{\"id\":\"88c30a1d-c232-4da5-87c3-4d67234b6a29\",\"name\":\"Combine looped items\",\"type\":\"n8n-nodes-base.code\",\"position\":[3010,1628],\"parameters\":{\"jsCode\":\"let results = [],\\n  i = 0;\\n\\ndo {\\n  try {\\n    results = results.concat($(\\\"VirusTotal result\\\").all(0, i)\\n                     .filter(node => node.json.data.attributes.status === 'completed')\\n  );\\n  } catch (error) {\\n    return results;\\n  }\\n  i++;\\n} while (true);\"},\"typeVersion\":2},{\"id\":\"839170f5-7c97-40fd-aeaa-ad57262a586e\",\"name\":\"Filter\",\"type\":\"n8n-nodes-base.filter\",\"position\":[2610,1648],\"parameters\":{\"conditions\":{\"string\":[{\"value1\":\"={{ $json.data.attributes.status }}\",\"value2\":\"completed\",\"operation\":\"notEqual\"}]}},\"typeVersion\":1,\"alwaysOutputData\":true},{\"id\":\"d68db329-4628-44a8-8f97-b06cbf18e238\",\"name\":\"Sticky Note\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[380,240],\"parameters\":{\"width\":651.1325602067182,\"height\":703.911103299255,\"content\":\"## Form Input Overview\\n\\n- **Purpose**: \\n  - Instead of forcing other departments to use a full threat platform, simplify the interaction with our Threat Intel workflow which allows other departments to submit items via URL-accessible forms.\\n\\n- **Form Access URLs**:\\n  - **Execute Mode**: `https://n8n.domain.com/webhook/test/url-scan-form` - Use this to execute the workflow interactively within the n8n canvas. Hit the 'Execute Workflow' button to see real-time execution results.\\n  - **Silent Mode**: `https://n8n.domain.com/webhook/url-scan-form` - Use this for background execution without canvas updates. Results will be logged silently and can be reviewed in the 'Executions' tab.\\n\\n## Details and Best Practices\\nWhen using the form, ensure that all inputs match the required format, like valid URLs for scans, to prevent any workflow interruptions. Keep in mind these forms are not performing input sanitation so incorrectly entered values will trigger an error workflow. Should there be any issues upon form submission, such as an absence of a confirmation message, or if the workflow fails, you can find detailed error information in the 'Executions' tab. \"},\"typeVersion\":1},{\"id\":\"f9081f7d-35ab-489c-87bb-c2deba7515f9\",\"name\":\"Sticky Note1\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[370,968],\"parameters\":{\"width\":653.8285114211884,\"height\":663.9676956356055,\"content\":\"## API Integration\\nWant to submit URLs and IPs automatically? Utilize the JSON structure below to upload multiple indicators simultaneously. The workflow leverages 'Item list' to parse the 'data' field, while 'Set Email' node appends the provided email to each URL.\\n\\n```json\\n{\\n    \\\"email\\\": \\\"johndoe@example.com\\\",\\n    \\\"data\\\": [\\n        {\\n            \\\"url\\\": \\\"aztechsol.com\\\"\\n        },\\n        {\\n            \\\"ip\\\": \\\"8.8.8.8\\\"\\n        }\\n    ]\\n}\\n```\\n\\n## Details and Best Practices\\n- Webhook Usage: Send data with a POST request, e.g., using curl.\\n- Validation & Errors: Ensure URLs are correctly formatted. Check the 'Executions' tab for any submission errors. Keep in mind that there is only basic error handling in this workflow.\"},\"typeVersion\":1},{\"id\":\"aaaac5aa-f0a0-4452-99b4-d78d55a80564\",\"name\":\"Sticky Note2\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1070,266.9400418986032],\"parameters\":{\"width\":827.7173647545219,\"height\":936.2889303743061,\"content\":\"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/320px-Google_2015_logo.svg.png)\\n## Data Standardization & Google DNS Integration\\n-   Purpose:\\n\\n    -   Standardize the diverse input sources---either from form submissions or API calls---by streamlining the input through a uniform processing pipeline. This ensures that whether the data entered is an IP address or a domain name, it can be consistently managed and transformed for threat intelligence tasks.\\n    -   Extract IP from URL by passing it to Google DNS and attaching it to the URL.\\n\\n## Details and Best Practices\\nTo guarantee the efficacy of the workflow, adhere to the prescribed input formats. For IP addresses, ensure they conform to IPv4 or IPv6 standards; for domains, verify that they are properly structured URLs. The system assumes clean inputs, as there are no built-in sanitation mechanisms---erroneous inputs may result in processing errors.\\n\\nIn case of an unsuccessful DNS lookup or other discrepancies, consult the 'Executions' tab for comprehensive error logs and apply the necessary corrections. To mitigate workflow disruptions, establish a set of error-handling protocols to manage and rectify such incidents.\\n\\nBe mindful that while the workflow is designed to automatically discern between IP addresses and domain names, it is imperative that the data entered is accurate to prevent any fallbacks or unnecessary processing overhead.\"},\"typeVersion\":1},{\"id\":\"32e80421-b608-4d89-b6fe-a95ab5b9e3bd\",\"name\":\"Sticky Note3\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1950,68.30371042491026],\"parameters\":{\"width\":1485.5734904392764,\"height\":987.7653566551932,\"content\":\"![VirusTotal](https://i.imgur.com/fd6Ng5R.png)\\n## Greynoise Integration\\n\\n-   Purpose:\\n    -   The aim is to tap into Greynoise's robust API to enrich and contextualize IP-related information within the workflow. By querying Greynoise's specialized noise and RIOT databases, the workflow can quickly ascertain the nature of the IP activity and determine its relevance and potential threat level to an organization.\\n    -   Classify and assess IP addresses by consulting with Greynoise databases, providing an additional layer of security intelligence.\\n\\n## Details and Best Practices\\nTo ensure reliable results from the Greynoise integration, it's important to use well-formatted IP addresses. Confirm that IPs meet standard internet protocols for either IPv4 or IPv6. The workflow assumes that inputs are pre-sanitized, so any deviation may lead to errors or inaccurate assessments.\\n\\nIf the Greynoise lookup does not yield results or encounters errors, investigate the issue using the 'Executions' tab to view detailed error logs. Proactively develop error-handling strategies to effectively manage and recover from these errors.\\n\\nThe workflow is pre-configured to discern and process IP information accurately; however, it relies heavily on the integrity of the input. Incorrectly entered IPs can cause incorrect lookups and potentially miss significant threat data, thereby undermining the security posture.\\n\\n**Please note that this workflow segment is designed for the enterprise edition of Greynoise's API. Users must have a valid API key with enterprise access which should be configured in the HTTP request nodes that perform the API calls.**\"},\"typeVersion\":1},{\"id\":\"adda919b-f65f-4fe0-9f66-11a5a9b65674\",\"name\":\"Sticky Note4\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[1952,1088],\"parameters\":{\"width\":1483.145187368557,\"height\":774.1502041707245,\"content\":\"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/VirusTotal_logo.svg/320px-VirusTotal_logo.svg.png)\\n## VirusTotal Integration\\n-   Purpose:\\n    -   This workflow component is specifically crafted to harness the VirusTotal API's capabilities, allowing URLs to be submitted for thorough scanning. The goal is to seamlessly integrate the scanning process into the workflow, handling the asynchronous nature of VirusTotal scans by effectively managing state checks and result compilation.\\n    -   Implement URL scanning by submitting requests to the VirusTotal API and accurately aggregating the scan results for analysis.\\n\\n## Details and Best Practices\\nFor successful VirusTotal integration, it's crucial to submit URLs following standard web formats. The workflow is configured to expect correct URL inputs; deviations can disrupt the scanning process.\\n\\nUpon submission, if the VirusTotal scan results are pending or if errors are encountered, these can be tracked and examined under the 'Executions' tab. Develop a proactive strategy for handling such cases, including error logging, maximum retry limitations, or implementing a timeout mechanism.\\n\\nThe configuration of the workflow takes into account the need to prevent rapid, repetitive status checks, which can strain the VirusTotal API. As a result, it employs a looping system for status re-evaluation, which should be managed with precision to avoid unnecessary delays or excessive polling.\\n\\nNote that this integration is tailored for workflows that involve the VirusTotal API. While it works with the free VirusTotal license, too many requests may cause errors due to rate limiting. The Public API is limited to 500 requests per day and a rate of 4 requests per minute. It requires valid credentials set up in the HTTP request nodes to authenticate API calls successfully. Users should configure their API keys for access, and handle any API error responses, like HTTP 4xx or 5xx codes, with a robust error-logging and retry mechanism to ensure reliability and effectiveness of the scan process.\"},\"typeVersion\":1},{\"id\":\"cdaec18e-e9f1-4567-89e6-f5474bff42c4\",\"name\":\"Sticky Note5\",\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[3470,247],\"parameters\":{\"width\":898.9279259630971,\"height\":1146.6423884335761,\"content\":\"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Slack_Logo_Pre_2019.svg/320px-Slack_Logo_Pre_2019.svg.png)\\n![VirusTotal](https://i.imgur.com/f6f6my0.png)\\n## Reporting Integration\\n-   Purpose:\\n    -   This component of the workflow is designed to amalgamate and communicate the insights from threat intelligence analysis to the team effectively. By integrating data from VirusTotal and Greynoise, it generates comprehensive reports that are automatically shared via Slack and email, fostering situational awareness and facilitating prompt action.\\n    -   Compile and disseminate threat intelligence reports that highlight the significance and implications of the analyzed IP or domain data, ensuring that the team remains informed and ready to act.\\n\\n## Details and Best Practices\\nThe heart of this workflow lies in the synthesis of threat intelligence gathered from both Greynoise and VirusTotal. By merging these data points, the logic creates a thorough examination of the URLs/IPs under scrutiny.\\n\\nHere's an expanded view of best practices to adhere to in this critical stage of the workflow:\\n\\nThe merging process must be precise, using the 'ip' fields as the common key to unify data from the two distinct sources. This unified view is crucial for accurate analysis and reporting.\\n\\nIt’s advisable to extend the merging capabilities to include additional data fields that may enhance the intelligence report. This could mean incorporating timestamps, geolocation data, or even threat levels.\\n\\nWhen integrating new messaging or reporting nodes, leverage the provided JSON structure to maintain consistency. To replicate the logic in another node, simply copy the JSON snippet from the expression editor and paste it into the configuration of the new node.\"},\"typeVersion\":1},{\"id\":\"577d4b74-9155-440f-a752-6654f8e54669\",\"name\":\"GreyNoise RIOT lookup\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2070,708],\"parameters\":{\"url\":\"=https://api.greynoise.io/v2/riot/{{ $json.ip }}\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\"},\"typeVersion\":4.1},{\"id\":\"9a41df79-3d81-4b2e-b21c-7f31985d8d1e\",\"name\":\"GreyNoise IP Check\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[2070,888],\"parameters\":{\"url\":\"=https://api.greynoise.io/v2/noise/context/{{ $json.ip }}\",\"options\":{},\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\"},\"typeVersion\":4.1},{\"id\":\"006eb997-5851-41bd-9d5c-9f44d3b7ec08\",\"name\":\"Form Trigger\",\"type\":\"n8n-nodes-base.formTrigger\",\"position\":[640,800],\"webhookId\":\"087145f7-3c00-4a1a-8e04-181b536606e7\",\"parameters\":{\"path\":\"url-scan-form\",\"options\":{},\"formTitle\":\"Scan URL or IP and get a report\",\"formFields\":{\"values\":[{\"fieldLabel\":\"url\",\"requiredField\":true},{\"fieldLabel\":\"Email\",\"requiredField\":true}]},\"formDescription\":\"Get a report from Virus Total and Greynoise on an IP address of URL\"},\"typeVersion\":2}],\"pinData\":{},\"connections\":{\"Merge\":{\"main\":[[{\"node\":\"Start VirusTotal Scan\",\"type\":\"main\",\"index\":0},{\"node\":\"GreyNoise IP Check\",\"type\":\"main\",\"index\":0},{\"node\":\"GreyNoise RIOT lookup\",\"type\":\"main\",\"index\":0}]]},\"Filter\":{\"main\":[[{\"node\":\"VirusTotal ready?\",\"type\":\"main\",\"index\":0}]]},\"Is IP?\":{\"main\":[[{\"node\":\"Set IP\",\"type\":\"main\",\"index\":0}],[{\"node\":\"DNS Lookup\",\"type\":\"main\",\"index\":0}]]},\"Set IP\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}]]},\"Wait 5s\":{\"main\":[[{\"node\":\"VirusTotal result\",\"type\":\"main\",\"index\":0}]]},\"Webhook\":{\"main\":[[{\"node\":\"Get List of URLs\",\"type\":\"main\",\"index\":0}]]},\"Set Email\":{\"main\":[[{\"node\":\"Is IP?\",\"type\":\"main\",\"index\":0}]]},\"DNS Lookup\":{\"main\":[[{\"node\":\"Set IP From Lookup\",\"type\":\"main\",\"index\":0}]]},\"Form Trigger\":{\"main\":[[{\"node\":\"Is IP?\",\"type\":\"main\",\"index\":0}]]},\"Get List of URLs\":{\"main\":[[{\"node\":\"Set Email\",\"type\":\"main\",\"index\":0}]]},\"Greynoise Summary\":{\"main\":[[{\"node\":\"Merge VirusTotal & Greynoise results\",\"type\":\"main\",\"index\":0}]]},\"VirusTotal ready?\":{\"main\":[[{\"node\":\"Combine looped items\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Wait 5s\",\"type\":\"main\",\"index\":0}]]},\"VirusTotal result\":{\"main\":[[{\"node\":\"Filter\",\"type\":\"main\",\"index\":0}]]},\"GreyNoise IP Check\":{\"main\":[[{\"node\":\"Merge Greynoise results\",\"type\":\"main\",\"index\":1}]]},\"Set IP From Lookup\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"VirusTotal Summary\":{\"main\":[[{\"node\":\"Merge VirusTotal & Greynoise results\",\"type\":\"main\",\"index\":1}]]},\"Combine looped items\":{\"main\":[[{\"node\":\"VirusTotal Summary\",\"type\":\"main\",\"index\":0}]]},\"GreyNoise RIOT lookup\":{\"main\":[[{\"node\":\"Merge Greynoise results\",\"type\":\"main\",\"index\":0}]]},\"Start VirusTotal Scan\":{\"main\":[[{\"node\":\"Wait 5s\",\"type\":\"main\",\"index\":0}]]},\"Merge Greynoise results\":{\"main\":[[{\"node\":\"Greynoise Summary\",\"type\":\"main\",\"index\":0}]]},\"Merge VirusTotal & Greynoise results\":{\"main\":[[{\"node\":\"Send Report Slack\",\"type\":\"main\",\"index\":0},{\"node\":\"Send Report Email\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "This n8n workflow serves as a powerful cybersecurity and threat intelligence tool to look up URLs or IP addresses through industry standard threat intelligence vendors. It starts with either a form submission or a webhook trigger, allowing users to input data, URLs or IPs that require analysis. The workflow then splits into two paths depending on whether the input data is an IP or URL. If an IP was given, it sets the ip variable to the IP; however if a URL was given the workflow will perform a DNS lookup using Google Public DNS and sets the ip variable based on the results from Google.\n\nThe workflow then checks the obtained IP addresses against GreyNoise services, with one branch utilizing GreyNoise RIOT IP Lookup to assess IP reputation and association with known benign services, and the other using GreyNoise IP Context to evaluate potential threats. The results from both GreyNoise services are merged to create a comprehensive analysis which includes the IP, classification (benign, malicious, or unknown), IP location, tags to identify activity or malware, category, and trust level.\n\nIn parallel, a VirusTotal scan is initiated for the URL/IP to identify if it is malicious. A 5-second wait ensures proper processing, and the workflow subsequently polls the scan result to determine when the analysis is complete. The workflow then summarizes the analysis including the overall security vendor analysis results, blockList analysis, OpenPhish analysis, the URL, and the IP.\n\nFinally, the workflow combines the summarized intelligence from both GreyNoise and VirusTotal to provide a thorough analysis of the URL/IP. This summarized intelligence can then be emailed to the user that filled out the form via Gmail or it can be sent to the user via a Slack message.\n\nSetting up this workflow may require proper configuration of the form submission or webhook trigger, and ensuring that the GreyNoise and VirusTotal API credentials are correctly integrated. Users should also consider the potential volume of data and API rate limits, as excessive requests could lead to issues. Proper documentation and validation of input data are crucial to ensure accurate and meaningful results in the final report.\n",
  "readme_html": "<!--[--><div data-v-50766329=\"\"><p>This n8n workflow serves as a powerful cybersecurity and threat intelligence tool to look up URLs or IP addresses through industry standard threat intelligence vendors. It starts with either a form submission or a webhook trigger, allowing users to input data, URLs or IPs that require analysis. The workflow then splits into two paths depending on whether the input data is an IP or URL. If an IP was given, it sets the ip variable to the IP; however if a URL was given the workflow will perform a DNS lookup using Google Public DNS and sets the ip variable based on the results from Google.</p>\n<p>The workflow then checks the obtained IP addresses against GreyNoise services, with one branch utilizing GreyNoise RIOT IP Lookup to assess IP reputation and association with known benign services, and the other using GreyNoise IP Context to evaluate potential threats. The results from both GreyNoise services are merged to create a comprehensive analysis which includes the IP, classification (benign, malicious, or unknown), IP location, tags to identify activity or malware, category, and trust level.</p>\n<p>In parallel, a VirusTotal scan is initiated for the URL/IP to identify if it is malicious. A 5-second wait ensures proper processing, and the workflow subsequently polls the scan result to determine when the analysis is complete. The workflow then summarizes the analysis including the overall security vendor analysis results, blockList analysis, OpenPhish analysis, the URL, and the IP.</p>\n<p>Finally, the workflow combines the summarized intelligence from both GreyNoise and VirusTotal to provide a thorough analysis of the URL/IP. This summarized intelligence can then be emailed to the user that filled out the form via Gmail or it can be sent to the user via a Slack message.</p>\n<p>Setting up this workflow may require proper configuration of the form submission or webhook trigger, and ensuring that the GreyNoise and VirusTotal API credentials are correctly integrated. Users should also consider the potential volume of data and API rate limits, as excessive requests could lead to issues. Proper documentation and validation of input data are crucial to ensure accurate and meaningful results in the final report.</p>\n</div><!--]-->",
  "readme_zh": "该n8n工作流是一款强大的网络安全与威胁情报工具，可通过行业标准威胁情报供应商对URL或IP地址进行查询。工作流起始于表单提交或网络钩子触发器，允许用户输入待分析的URL或IP数据。随后根据输入数据类型（IP或URL）分叉处理：若为IP则直接赋值；若为URL则通过Google公共DNS进行解析并获取对应IP。\n\n工作流通过双通道检查机制对接GreyNoise服务：一条路径使用GreyNoise RIOT IP查询评估IP信誉及已知良性服务关联性，另一路径通过GreyNoise IP上下文分析潜在威胁。两路结果合并生成包含IP地址、分类（良性/恶意/未知）、地理位置、活动标签、恶意软件标识、类别及可信度评级的综合分析报告。\n\n同步启动的VirusTotal扫描任务会对URL/IP进行恶意性检测，5秒延迟等待后轮询扫描结果。最终生成包含安全厂商综合判定、拦截列表分析、OpenPhish检测结论、原始URL及解析IP的威胁摘要。\n\n工作流将GreyNoise与VirusTotal的智能分析进行整合，形成完整的URL/IP评估报告。该报告既可通过Gmail发送至表单提交者，也能通过Slack消息推送。\n\n部署时需注意：需正确配置表单/网络钩子触发器，确保GreyNoise和VirusTotal API凭证有效集成。用户应关注数据查询量及API速率限制，避免超额请求导致异常。严格的输入数据验证及文档规范对最终报告的准确性和有效性至关重要。",
  "title_zh": "通过GreyNoise和VirusTotal进行URL及IP查询",
  "publish_date_zh": "最后更新于10个月前",
  "workflow_json_zh": "{\n  \"meta\": {\n    \"instanceId\": \"8c8c5237b8e37b006a7adce87f4369350c58e41f3ca9de16196d3197f69eabcd\",\n    \"templateId\": \"1971\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"dbb98f7d-6737-4eaa-9a66-9779c042c575\",\n      \"name\": \"VirusTotal result\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2430,\n        1648\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.data.links.self }}\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"virusTotalApi\"\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"fb71337b-ebd3-4331-9f18-ff953c6b068b\",\n      \"name\": \"DNS Lookup\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1330,\n        1028\n      ],\n      \"parameters\": {\n        \"url\": \"=https://dns.google/resolve\",\n        \"options\": {},\n        \"sendQuery\": true,\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"name\",\n              \"value\": \"={{ $json.url.includes('://') ? $json.url.split('://')[1].split('/')[0] : $json.url }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"290c6e9c-31d1-4476-9beb-b72a795ecfbb\",\n      \"name\": \"Set IP From Lookup\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1530,\n        1028\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"// Get the resolved IP address (last item in the Answer array)\\nconst ip = $json.Answer.pop().data;\\nconst item = {...$('Is IP?').item.json}\\nitem.ip = ip\\n\\nreturn {json: item};\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"2e25aa5e-479c-4e3b-b866-89f2bdbabbba\",\n      \"name\": \"Set IP\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1390,\n        828\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"ip\",\n              \"value\": \"={{ $json.url }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"69b89cd7-1456-4067-a9da-d81ef3f86097\",\n      \"name\": \"Merge VirusTotal & Greynoise results\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        3610,\n        948\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"mergeByFields\": {\n          \"values\": [\n            {\n              \"field1\": \"ip\",\n              \"field2\": \"ip\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"1011bb3b-3f75-40b8-a473-e07b70079b60\",\n      \"name\": \"Is IP?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1110,\n        848\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.url }}\",\n              \"value2\": \"/^(?:[0-9]{1,3}\\\\.){3}[0-9]{1,3}$/\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"770b4056-1497-48ed-bcd7-ad6e7106cc7d\",\n      \"name\": \"Start VirusTotal Scan\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1990,\n        1648\n      ],\n      \"parameters\": {\n        \"url\": \"https://www.virustotal.com/api/v3/urls\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"contentType\": \"multipart-form-data\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"url\",\n              \"value\": \"={{ $json.url }}\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"virusTotalApi\"\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"d5d31e4a-2f95-4151-af35-bb8129f2e5a3\",\n      \"name\": \"VirusTotal Summary\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        3230,\n        1628\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"virusTotalStats\",\n              \"value\": \"={{ $json.data.attributes.stats }}\"\n            },\n            {\n              \"name\": \"blockList\",\n              \"value\": \"={{ $json.data.attributes.results.BlockList.result }}\"\n            },\n            {\n              \"name\": \"openPhish\",\n              \"value\": \"={{ $json.data.attributes.results.OpenPhish.result }}\"\n            },\n            {\n              \"name\": \"url\",\n              \"value\": \"={{ $('Merge').all()[$itemIndex].json.url }}\"\n            },\n            {\n              \"name\": \"ip\",\n              \"value\": \"={{ $('Merge').all()[$itemIndex].json.ip }}\"\n            }\n          ]\n        },\n        \"options\": {\n          \"dotNotation\": false\n        },\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"467c795f-6f13-4d6d-a8cf-5cf9be2e7a77\",\n      \"name\": \"VirusTotal ready?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        2790,\n        1648\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.data.attributes.status }}\",\n              \"value2\": \"queued\",\n              \"operation\": \"notEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"284728e4-dc74-4c37-890b-5305970960c0\",\n      \"name\": \"Wait 5s\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        2230,\n        1648\n      ],\n      \"webhookId\": \"18348e84-831d-4ea8-bb39-6ec847c72275\",\n      \"parameters\": {\n        \"unit\": \"seconds\",\n        \"amount\": 5\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"76e1414a-d690-44df-a3b8-8dbb4a192720\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"notes\": \"Example:\\n\\ncurl -X POST \\\"https://n8n.yourdomain.com/webhook-test/d5124bd8-aada-44da-8050-3070f303ad24\\\" \\\\\\n                 -H \\\"Content-Type: application/json\\\" \\\\\\n                 -d '{\\\"data\\\": [{\\\"url\\\": \\\"1.1.1.1\\\"}, {\\\"url\\\": \\\"88.204.59.2\\\"}, {\\\"url\\\": \\\"54.36.148.188\\\"}, {\\\"url\\\": \\\"facebook.com\\\"}], \\\"email\\\": \\\"user@domain.com\\\"}'\",\n      \"position\": [\n        450,\n        1448\n      ],\n      \"webhookId\": \"d5124bd8-aada-44da-8050-3070f303ad24\",\n      \"parameters\": {\n        \"path\": \"d5124bd8-aada-44da-8050-3070f303ad24\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b3e188f3-0a39-4451-ab70-632282243f03\",\n      \"name\": \"Get List of URLs\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"position\": [\n        650,\n        1448\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"body.data\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"360628b7-afc0-4444-a8c0-a85fae54b0e3\",\n      \"name\": \"Set Email\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        850,\n        1448\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"Email\",\n              \"value\": \"={{ $('Webhook').item.json.body.email }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"6df9593b-5f9f-4b50-bddb-97dcb2017d6e\",\n      \"name\": \"Merge Greynoise results\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2370,\n        728\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"combinationMode\": \"mergeByPosition\"\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"1957a675-7a5a-4ccd-b334-f2c4f9749f58\",\n      \"name\": \"Send Report Slack\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"position\": [\n        3850,\n        1168\n      ],\n      \"parameters\": {\n        \"text\": \"=Successfully scanned {{ $json.url }} {{$json.ip !== $json.url ? `(${$json.ip})`: '' }}\\n\\n\\nVirusTotal Report ({{ $json.virusTotalStats.harmless + $json.virusTotalStats.malicious + $json.virusTotalStats.suspicious + $json.virusTotalStats.undetected}} scans)\\n\\n{{$json.virusTotalStats.harmless}} Harmless\\n{{$json.virusTotalStats.malicious}} Malicious\\n{{$json.virusTotalStats.suspicious}} Suspicious\\n{{$json.virusTotalStats.undetected}} Undetected\\n{{$json.virusTotalStats.timeout}} Timed out\\n\\nBlockList: {{ $json.blockList }}\\nOpenPhish: {{ $json.openPhish }}\\n\\nSummary: {{ $json.virusTotalStats.suspicious + $json.virusTotalStats.malicious === 0 ? \\\"✅ Harmless\\\": \\\"🚨 Malicous\\\" }}\\n\\n\\n\\nGreynoise Report\\n\\nTrust Level: {{ $json.trust_level ?? \\\"Not trusted\\\"}}\\nClassification: {{ $json.classification }}\\n\\nLocation: {{ $json.location || 'n/a' }}\\nCategory: {{ $json.category }}\\nTags: {{$json.tags.join(', ') || 'None'}}\",\n        \"select\": \"channel\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"mode\": \"name\",\n          \"value\": \"#notifications\"\n        },\n        \"otherOptions\": {}\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"4d64351f-0233-4859-afd2-fc31e3fc37cd\",\n      \"name\": \"Send Report Email\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        3850,\n        948\n      ],\n      \"parameters\": {\n        \"sendTo\": \"={{ $('Merge').first().json.Email }}\",\n        \"message\": \"=Successfully scanned {{ $json.url }} {{$json.ip !== $json.url ? `(${$json.ip})`: '' }}<br /><br /><br />\\n\\n\\n<h3>VirusTotal Report ({{ $json.virusTotalStats.harmless + $json.virusTotalStats.malicious + $json.virusTotalStats.suspicious + $json.virusTotalStats.undetected}} scans)</h3><br /><br />\\n\\n{{$json.virusTotalStats.harmless}} Harmless<br />\\n{{$json.virusTotalStats.malicious}} Malicious<br />\\n{{$json.virusTotalStats.suspicious}} Suspicious<br />\\n{{$json.virusTotalStats.undetected}} Undetected<br />\\n{{$json.virusTotalStats.timeout}} Timed out<br /><br />\\n\\nBlockList: {{ $json.blockList }}<br />\\nOpenPhish: {{ $json.openPhish }}<br /><br />\\n\\n<b>Summary: {{ $json.virusTotalStats.suspicious + $json.virusTotalStats.malicious === 0 ? \\\"✅ Harmless\\\": \\\"🚨 Malicous\\\" }}</b><br /><br /><br />\\n\\n\\n\\n<h3>Greynoise Report</h3><br /><br />\\n\\nTrust Level: {{ $json.trust_level ?? \\\"Not trusted\\\"}}<br />\\nClassification: {{ $json.classification }}<br /><br />\\n\\nLocation: {{ $json.location || 'n/a' }}<br />\\nCategory: {{ $json.category }}<br />\\nTags: {{$json.tags.join(', ') || 'None'}}<br /><br /><br /><br />\",\n        \"options\": {},\n        \"subject\": \"={{ $json.url }} Scan Report\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"e4305eb1-8e57-49d0-97b7-391200bd0042\",\n      \"name\": \"Greynoise Summary\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2650,\n        728\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"ip\",\n              \"value\": \"={{ $json.ip }}\"\n            },\n            {\n              \"name\": \"classification\",\n              \"value\": \"={{ $json.classification || 'safe' }}\"\n            },\n            {\n              \"name\": \"location\",\n              \"value\": \"={{ $json.metadata?.region ? `${$json.metadata?.region} ${$json.metadata?.country}` : '' }}\"\n            },\n            {\n              \"name\": \"tags\",\n              \"value\": \"={{ $json.tags ?? [] }}\"\n            },\n            {\n              \"name\": \"category\",\n              \"value\": \"={{ $json.category || 'n/a' }}\"\n            },\n            {\n              \"name\": \"trustLevel\",\n              \"value\": \"={{ $json.trust_level }}\"\n            }\n          ]\n        },\n        \"options\": {\n          \"dotNotation\": false\n        },\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"c149b1f3-e447-4194-a94e-7d8e0bf38241\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1750,\n        848\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"88c30a1d-c232-4da5-87c3-4d67234b6a29\",\n      \"name\": \"Combine looped items\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        3010,\n        1628\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let results = [],\\n  i = 0;\\n\\ndo {\\n  try {\\n    results = results.concat($(\\\"VirusTotal result\\\").all(0, i)\\n                     .filter(node => node.json.data.attributes.status === 'completed')\\n  );\\n  } catch (error) {\\n    return results;\\n  }\\n  i++;\\n} while (true);\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"839170f5-7c97-40fd-aeaa-ad57262a586e\",\n      \"name\": \"Filter\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        2610,\n        1648\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.data.attributes.status }}\",\n              \"value2\": \"completed\",\n              \"operation\": \"notEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"d68db329-4628-44a8-8f97-b06cbf18e238\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        380,\n        240\n      ],\n      \"parameters\": {\n        \"width\": 651.1325602067182,\n        \"height\": 703.911103299255,\n        \"content\": \"## 表单输入概览\\n\\n- **功能目的**:\\n  - 通过URL可访问表单简化与其他部门在威胁情报工作流中的交互，避免强制要求其他部门使用完整威胁平台。\\n\\n- **表单访问地址**:\\n  - **交互模式**: `https://n8n.domain.com/webhook/test/url-scan-form` - 用于在n8n画布中交互式执行工作流。点击\\\"执行工作流\\\"按钮可查看实时执行结果。\\n  - **静默模式**: `https://n8n.domain.com/webhook/url-scan-form` - 用于后台静默执行，不更新画布界面。执行结果将静默记录，可在\\\"执行记录\\\"标签页查看。\\n\\n## 使用细则与最佳实践\\n使用表单时，请确保所有输入符合格式要求（如扫描需提交有效URL），以避免工作流中断。请注意这些表单不会对输入内容进行净化处理，错误值将触发错误工作流。若提交后未显示确认消息或工作流执行失败，可在\\\"执行记录\\\"标签页查看详细错误信息。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f9081f7d-35ab-489c-87bb-c2deba7515f9\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        370,\n        968\n      ],\n      \"parameters\": {\n        \"width\": 653.8285114211884,\n        \"height\": 663.9676956356055,\n        \"content\": \"## API集成\\n想要自动提交网址和IP？使用下方JSON结构即可批量上传多个指标。该工作流通过\\\"项目列表\\\"解析\\\"data\\\"字段，同时\\\"设置邮箱\\\"节点会为每个URL附加提供的邮箱地址。\\n\\n```json\\n{\\n    \\\"email\\\": \\\"johndoe@example.com\\\",\\n    \\\"data\\\": [\\n        {\\n            \\\"url\\\": \\\"aztechsol.com\\\"\\n        },\\n        {\\n            \\\"ip\\\": \\\"8.8.8.8\\\"\\n        }\\n    ]\\n}\\n```\\n\\n## 细节与最佳实践\\n- Webhook调用：使用POST请求发送数据（例如通过curl工具）\\n- 验证与错误：确保网址格式正确。提交异常可通过\\\"执行记录\\\"选项卡查看。请注意当前工作流仅实现基础错误处理机制。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"aaaac5aa-f0a0-4452-99b4-d78d55a80564\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1070,\n        266.9400418986032\n      ],\n      \"parameters\": {\n        \"width\": 827.7173647545219,\n        \"height\": 936.2889303743061,\n        \"content\": \"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/320px-Google_2015_logo.svg.png)\\n## 数据标准化与Google DNS集成\\n-   目标：\\n    - 通过统一处理流程整合表单提交或API调用等多样化输入源，确保无论是IP地址还是域名都能被一致处理并转换为威胁情报任务所需格式。\\n    - 将URL传递至Google DNS解析出IP地址，并将其附加至原始URL中。\\n\\n## 实施细节与最佳实践\\n为确保工作流有效性，请严格遵守规定的输入格式：IP地址需符合IPv4或IPv6标准，域名须为结构完整的URL。本系统默认输入数据已清洁，未内置净化机制——错误输入可能导致处理异常。\\n\\n若出现DNS查询失败或其他异常，可通过\\\"执行记录\\\"选项卡查看完整错误日志并进行修正。建议建立错误处理协议集以缓解工作流中断风险，及时管理并纠正此类事件。\\n\\n需特别注意：虽然工作流会自动识别IP地址与域名，但输入数据的准确性至关重要，可避免回退机制触发或产生不必要的处理开销。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"32e80421-b608-4d89-b6fe-a95ab5b9e3bd\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1950,\n        68.30371042491026\n      ],\n      \"parameters\": {\n        \"width\": 1485.5734904392764,\n        \"height\": 987.7653566551932,\n        \"content\": \"![VirusTotal](https://i.imgur.com/fd6Ng5R.png)\\n## Greynoise集成功能\\n\\n-   核心目标：\\n    -  通过对接Greynoise强大的API接口，在工作流中实现IP情报的深度赋能与场景化分析。该功能通过查询Greynoise专属的互联网噪声数据库和RIOT可信资产库，快速判定IP活动性质，精准评估其对组织的关联度与威胁等级。\\n    -  依托Greynoise双数据库进行IP地址分类研判，为安全运营提供增强型威胁情报层。\\n\\n## 实施规范与最佳实践\\n为确保Greynoise集成结果的可靠性，请严格遵循IP地址格式规范。所有输入的IP地址必须符合IPv4或IPv6标准协议格式。本工作流默认输入数据已通过预处理校验，格式异常可能导致分析失效或误判。\\n\\n当Greynoise查询返回空值或报错时，可通过\\\"执行记录\\\"选项卡查看详细错误日志进行故障排查。建议预先制定错误处理方案，建立完善的异常恢复机制。\\n\\n工作流已预设IP信息智能识别处理逻辑，但其分析准确性高度依赖输入数据的完整性。错误录入的IP地址不仅会导致查询失效，更可能遗漏关键威胁指标，从而削弱整体安全防御效能。\\n\\n**特别注意：本工作流模块仅适配Greynoise企业版API，使用者需配置具有企业权限的有效API密钥（在HTTP请求节点中完成认证设置）。**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"adda919b-f65f-4fe0-9f66-11a5a9b65674\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1952,\n        1088\n      ],\n      \"parameters\": {\n        \"width\": 1483.145187368557,\n        \"height\": 774.1502041707245,\n        \"content\": \"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/VirusTotal_logo.svg/320px-VirusTotal_logo.svg.png)\\n## VirusTotal集成方案\\n-   核心功能：\\n    -  该工作流组件专为调用VirusTotal API设计，可实现URL提交扫描功能。通过智能管理状态检查与结果聚合机制，有效应对VirusTotal异步扫描特性，实现扫描流程的无缝集成。\\n    -  通过向VirusTotal API提交扫描请求，精确汇总扫描结果以供分析。\\n\\n## 实施规范与最佳实践\\n为确保集成成功，必须按照标准网页格式提交URL。工作流预设接收规范化的URL输入，格式错误可能导致扫描流程中断。\\n\\n当扫描结果处于待处理状态或出现错误时，可通过\\\"执行记录\\\"选项卡进行追踪检查。建议建立主动处理机制，包括错误日志记录、最大重试次数限制或超时控制策略。\\n\\n工作流配置特别考虑了避免高频重复查询对VirusTotal API造成的压力。采用精准控制的循环状态检查机制，需注意平衡轮询频率，防止产生不必要的延迟或过量请求。\\n\\n重要说明：本集成方案专为VirusTotal API工作流设计。虽然兼容免费版授权，但需注意请求频次限制——公共API每日上限500次请求，每分钟不超过4次。必须在HTTP请求节点配置有效凭证进行API鉴权。用户需自行设置API密钥，并通过完善的错误日志与重试机制处理HTTP 4xx/5xx等API错误响应，确保扫描流程的可靠性与有效性。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cdaec18e-e9f1-4567-89e6-f5474bff42c4\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        3470,\n        247\n      ],\n      \"parameters\": {\n        \"width\": 898.9279259630971,\n        \"height\": 1146.6423884335761,\n        \"content\": \"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Slack_Logo_Pre_2019.svg/320px-Slack_Logo_Pre_2019.svg.png)\\n![VirusTotal](https://i.imgur.com/f6f6my0.png)\\n## 报告集成\\n-   目的：\\n    -  该工作流组件旨在整合并有效传达威胁情报分析结果。通过融合VirusTotal和Greynoise的数据，自动生成综合性报告并通过Slack和电子邮件共享，从而提升团队态势感知能力并促进快速响应。\\n    -  编制并分发威胁情报报告，重点说明所分析IP或域名数据的重要性及影响，确保团队始终保持信息畅通并做好行动准备。\\n\\n## 实施细则与最佳实践\\n本工作流的核心在于综合来自Greynoise和VirusTotal的威胁情报。通过合并这些数据点，逻辑引擎可对受检URL/IP进行全面审查。\\n\\n以下是该关键阶段需遵循的最佳实践扩展说明：\\n\\n数据合并过程必须精确，使用\\\"ip\\\"字段作为统一两个不同来源数据的共同键值。这种统一视图对于准确分析和报告至关重要。\\n\\n建议扩展合并功能以包含可能增强情报报告的其他数据字段，例如时间戳、地理位置数据或威胁等级指标。\\n\\n在集成新消息或报告节点时，应利用提供的JSON结构保持一致性。若要在其他节点复制该逻辑，只需从表达式编辑器中复制JSON代码片段，并粘贴至新节点的配置中即可。\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"577d4b74-9155-440f-a752-6654f8e54669\",\n      \"name\": \"GreyNoise RIOT lookup\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2070,\n        708\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.greynoise.io/v2/riot/{{ $json.ip }}\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"9a41df79-3d81-4b2e-b21c-7f31985d8d1e\",\n      \"name\": \"GreyNoise IP Check\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2070,\n        888\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.greynoise.io/v2/noise/context/{{ $json.ip }}\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"006eb997-5851-41bd-9d5c-9f44d3b7ec08\",\n      \"name\": \"Form Trigger\",\n      \"type\": \"n8n-nodes-base.formTrigger\",\n      \"position\": [\n        640,\n        800\n      ],\n      \"webhookId\": \"087145f7-3c00-4a1a-8e04-181b536606e7\",\n      \"parameters\": {\n        \"path\": \"url-scan-form\",\n        \"options\": {},\n        \"formTitle\": \"Scan URL or IP and get a report\",\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldLabel\": \"url\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldLabel\": \"Email\",\n              \"requiredField\": true\n            }\n          ]\n        },\n        \"formDescription\": \"Get a report from Virus Total and Greynoise on an IP address of URL\"\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Start VirusTotal Scan\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"GreyNoise IP Check\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"GreyNoise RIOT lookup\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"VirusTotal ready?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is IP?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set IP\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"DNS Lookup\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set IP\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait 5s\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"VirusTotal result\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get List of URLs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is IP?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"DNS Lookup\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set IP From Lookup\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Form Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is IP?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get List of URLs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Greynoise Summary\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge VirusTotal & Greynoise results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"VirusTotal ready?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combine looped items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Wait 5s\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"VirusTotal result\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GreyNoise IP Check\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Greynoise results\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Set IP From Lookup\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"VirusTotal Summary\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge VirusTotal & Greynoise results\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Combine looped items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"VirusTotal Summary\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GreyNoise RIOT lookup\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Greynoise results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Start VirusTotal Scan\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait 5s\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge Greynoise results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Greynoise Summary\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge VirusTotal & Greynoise results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Report Slack\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Send Report Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"
}
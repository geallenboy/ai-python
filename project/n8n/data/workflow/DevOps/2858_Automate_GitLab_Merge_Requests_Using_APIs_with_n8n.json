{
  "title": "Automate GitLab Merge Requests Using APIs with n8n",
  "url": "https://n8n.io/workflows/2858-automate-gitlab-merge-requests-using-apis-with-n8n/",
  "category": "DevOps",
  "category_url": "https://n8n.io/workflows/categories/devops/?sort=createdAt:desc",
  "author": "Aditya Gaur",
  "publish_date": "Last update 3 months ago",
  "publish_date_absolute": "",
  "content": "",
  "workflow_json": "{\"meta\":{\"templateCredsSetupCompleted\":true},\"nodes\":[{\"id\":\"b9a807c3-5847-477a-a242-2fdf5b15ba7e\",\"name\":\"API to Check existing merge request\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-840,-20],\"parameters\":{\"url\":\"=https://gitlab.com/<projectid>/merge_requests\",\"options\":{\"allowUnauthorizedCerts\":false},\"sendQuery\":true,\"sendHeaders\":true,\"queryParameters\":{\"parameters\":[{\"name\":\"state\",\"value\":\"opened\"},{\"name\":\"source_branch\",\"value\":\"=sourceBranchName\"}]},\"headerParameters\":{\"parameters\":[{\"name\":\"PRIVATE-TOKEN\",\"value\":\"=gitlabToken\"}]}},\"typeVersion\":4.2,\"alwaysOutputData\":true},{\"id\":\"42270a5a-d696-44f3-b2f5-16b2ddb3488c\",\"name\":\"Is Exists\",\"type\":\"n8n-nodes-base.if\",\"position\":[-660,-20],\"parameters\":{\"options\":{},\"conditions\":{\"options\":{\"version\":2,\"leftValue\":\"\",\"caseSensitive\":true,\"typeValidation\":\"strict\"},\"combinator\":\"and\",\"conditions\":[{\"id\":\"d895b8cc-5679-442f-a1bf-d8375174a24b\",\"operator\":{\"type\":\"boolean\",\"operation\":\"true\",\"singleValue\":true},\"leftValue\":\"={{ $node[\\\"API to Check existing merge request\\\"].data.isEmpty() }}\",\"rightValue\":\"\"}]}},\"typeVersion\":2.2},{\"id\":\"d380c943-0525-4976-9e70-c90de1177f0c\",\"name\":\"Create New Merge Request\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-440,-200],\"parameters\":{\"url\":\"=https://gitlab.com/<projectid>/merge_requests\",\"method\":\"POST\",\"options\":{\"allowUnauthorizedCerts\":false},\"sendBody\":true,\"contentType\":\"form-urlencoded\",\"sendHeaders\":true,\"bodyParameters\":{\"parameters\":[{\"name\":\"source_branch\",\"value\":\"=sourceBranchName\"},{\"name\":\"target_branch\",\"value\":\"=targetBranchName\"},{\"name\":\"title\",\"value\":\"=mergeTitle\"}]},\"headerParameters\":{\"parameters\":[{\"name\":\"PRIVATE-TOKEN\",\"value\":\"=gitlabToken\"}]}},\"typeVersion\":4.2},{\"id\":\"600a0ed5-cb68-4479-8aee-55b55f0d8630\",\"name\":\"Loop Over Items\",\"type\":\"n8n-nodes-base.splitInBatches\",\"position\":[-440,160],\"parameters\":{\"options\":{}},\"typeVersion\":3},{\"id\":\"555643cb-761c-41ec-b983-8e0194851a8d\",\"name\":\"API to CLOSE existing Merge Request\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-220,180],\"parameters\":{\"url\":\"=https://gitlab.com/<projectid>/merge_requests/<merge_iid>\",\"method\":\"PUT\",\"options\":{\"allowUnauthorizedCerts\":false},\"sendBody\":true,\"contentType\":\"form-urlencoded\",\"sendHeaders\":true,\"bodyParameters\":{\"parameters\":[{\"name\":\"state_event\",\"value\":\"close\"}]},\"headerParameters\":{\"parameters\":[{\"name\":\"PRIVATE-TOKEN\",\"value\":\"=gitlabToken\"}]}},\"typeVersion\":4.2},{\"id\":\"0c94b06a-80e3-4e50-8bac-2bd4015f085e\",\"name\":\"Add Custom Notes To Merge Request\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[-220,-200],\"parameters\":{\"url\":\"=https://gitlab.com/<projectid>/merge_requests/<merge_iid>/notes\",\"method\":\"POST\",\"options\":{\"allowUnauthorizedCerts\":false},\"sendBody\":true,\"contentType\":\"form-urlencoded\",\"sendHeaders\":true,\"bodyParameters\":{\"parameters\":[{\"name\":\"body\",\"value\":\"=<mergeComments>\"}]},\"headerParameters\":{\"parameters\":[{\"name\":\"PRIVATE-TOKEN\",\"value\":\"=gitlabToken\"}]}},\"typeVersion\":4.2},{\"id\":\"8e849f4f-2a52-46ba-9e0a-17126a8d966c\",\"name\":\"30 secs wait to approve merge request and pipeline to finish1\",\"type\":\"n8n-nodes-base.wait\",\"position\":[140,-200],\"webhookId\":\"ac7bb2de-2c6f-479a-8807-13a29d8eaf5e\",\"parameters\":{\"amount\":30},\"typeVersion\":1.1},{\"id\":\"05cca829-b2df-4c1e-9441-56349acc4a0d\",\"name\":\"Merge When Pipeline Succeeds\",\"type\":\"n8n-nodes-base.httpRequest\",\"position\":[720,-200],\"parameters\":{\"url\":\"=https://gitlab.com/<projectid>/merge_requests/<merge_iid>/merge\",\"method\":\"PUT\",\"options\":{\"allowUnauthorizedCerts\":false},\"jsonBody\":\"={\\n\\\"merge_when_pipeline_succeeds\\\": {{ $('setValueForMerge').item.json.merge_when_pipeline_succeeds }},\\n  \\\"should_remove_source_branch\\\": {{ $('setValueForMerge').item.json.should_remove_source_branch }}\\n}\",\"sendBody\":true,\"sendHeaders\":true,\"specifyBody\":\"json\",\"headerParameters\":{\"parameters\":[{\"name\":\"PRIVATE-TOKEN\",\"value\":\"=gitlabToken\"}]}},\"typeVersion\":4.2},{\"id\":\"e3ce9cdc-5484-4b4b-8701-6b9089a1f76d\",\"name\":\"setValueForMerge\",\"type\":\"n8n-nodes-base.set\",\"position\":[460,-200],\"parameters\":{\"options\":{},\"assignments\":{\"assignments\":[{\"id\":\"a22922c7-0c69-4ac1-bd15-4d289fa57737\",\"name\":\"merge_when_pipeline_succeeds\",\"type\":\"boolean\",\"value\":false},{\"id\":\"17580668-84d9-4ad6-b93b-e7b6c9c0f8ea\",\"name\":\"should_remove_source_branch\",\"type\":\"boolean\",\"value\":true}]}},\"typeVersion\":3.4},{\"id\":\"0d49ec98-4806-492e-a6c2-a298ed8bb11a\",\"name\":\"Schedule Trigger\",\"type\":\"n8n-nodes-base.scheduleTrigger\",\"position\":[-1160,-20],\"parameters\":{\"rule\":{\"interval\":[{}]}},\"typeVersion\":1.2}],\"pinData\":{},\"connections\":{\"Is Exists\":{\"main\":[[{\"node\":\"Create New Merge Request\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Loop Over Items\":{\"main\":[[{\"node\":\"API to Check existing merge request\",\"type\":\"main\",\"index\":0}],[{\"node\":\"API to CLOSE existing Merge Request\",\"type\":\"main\",\"index\":0}]]},\"Schedule Trigger\":{\"main\":[[{\"node\":\"API to Check existing merge request\",\"type\":\"main\",\"index\":0}]]},\"setValueForMerge\":{\"main\":[[{\"node\":\"Merge When Pipeline Succeeds\",\"type\":\"main\",\"index\":0}]]},\"Create New Merge Request\":{\"main\":[[{\"node\":\"Add Custom Notes To Merge Request\",\"type\":\"main\",\"index\":0}]]},\"Add Custom Notes To Merge Request\":{\"main\":[[{\"node\":\"30 secs wait to approve merge request and pipeline to finish1\",\"type\":\"main\",\"index\":0}]]},\"API to CLOSE existing Merge Request\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"API to Check existing merge request\":{\"main\":[[{\"node\":\"Is Exists\",\"type\":\"main\",\"index\":0}]]},\"30 secs wait to approve merge request and pipeline to finish1\":{\"main\":[[{\"node\":\"setValueForMerge\",\"type\":\"main\",\"index\":0}]]}}}",
  "readme": "# **Who is this template for?**\n\nThis template is designed for developers, DevOps engineers, and automation enthusiasts who want to streamline their GitLab merge request process using n8n, a low-code workflow automation tool. It eliminates manual intervention by automating the merging of GitLab branches through API calls.\n\n# **How it works ?**\n\n  * Trigger the workflow: The workflow can be triggered by a webhook, a scheduled event, or a GitLab event (e.g., a new merge request is created or approved).\n\n  * Fetch Merge Request Details: n8n makes an API call to GitLab to retrieve merge request details.\n\n  * Check Merge Conditions: The workflow validates whether the merge request meets predefined conditions (e.g., approvals met, CI/CD pipelines passed).\n\n  * Perform the Merge: If all conditions are met, n8n sends a request to the GitLab API to merge the branch automatically.\n\n\n\n\n# **Setup Steps**\n\n**1\\. Prerequisites**\n\nAn n8n instance (Self-hosted or Cloud)\n\nA GitLab personal access token with API access\n\nA GitLab repository with merge requests enabled\n\n**2\\. Create the n8n Workflow**\n\nSet up a trigger: Choose a trigger node (Webhook, Cron, or GitLab Trigger).\n\nFetch merge request details: Add an HTTP Request node to call GET /merge_requests/:id from GitLab API.\n\nValidate conditions:\n\nCheck if the merge request has necessary approvals.\n\nEnsure CI/CD pipelines have passed.\n\nMerge the request:\n\nUse an HTTP Request node to call PUT /merge_requests/:id/merge API.\n\n**3\\. Test the Workflow**\n\nCreate a test merge request.\n\nCheck if the workflow triggers and merges automatically.\n\nDebug using n8n logs if needed.\n\n**4\\. Deploy and Monitor**\n\nDeploy the workflow in production.\n\nUse n8nâ€™s monitoring features to track execution.\n\nThis template enables seamless GitLab merge automation, improving efficiency and reducing manual work!\n\n#### Note:\n\nNever hard code API token or secret in your https request.\n",
  "readme_html": "<!--[--><div data-v-859c7806=\"\"><h1><strong>Who is this template for?</strong></h1>\n<p>This template is designed for developers, DevOps engineers, and automation enthusiasts who want to streamline their GitLab merge request process using n8n, a low-code workflow automation tool. It eliminates manual intervention by automating the merging of GitLab branches through API calls.</p>\n<h1><strong>How it works ?</strong></h1>\n<ul>\n<li>\n<p>Trigger the workflow: The workflow can be triggered by a webhook, a scheduled event, or a GitLab event (e.g., a new merge request is created or approved).</p>\n</li>\n<li>\n<p>Fetch Merge Request Details: n8n makes an API call to GitLab to retrieve merge request details.</p>\n</li>\n<li>\n<p>Check Merge Conditions: The workflow validates whether the merge request meets predefined conditions (e.g., approvals met, CI/CD pipelines passed).</p>\n</li>\n<li>\n<p>Perform the Merge: If all conditions are met, n8n sends a request to the GitLab API to merge the branch automatically.</p>\n</li>\n</ul>\n<h1><strong>Setup Steps</strong></h1>\n<p><strong>1. Prerequisites</strong></p>\n<p>An n8n instance (Self-hosted or Cloud)</p>\n<p>A GitLab personal access token with API access</p>\n<p>A GitLab repository with merge requests enabled</p>\n<p><strong>2. Create the n8n Workflow</strong></p>\n<p>Set up a trigger: Choose a trigger node (Webhook, Cron, or GitLab Trigger).</p>\n<p>Fetch merge request details: Add an HTTP Request node to call GET /merge_requests/:id from GitLab API.</p>\n<p>Validate conditions:</p>\n<p>Check if the merge request has necessary approvals.</p>\n<p>Ensure CI/CD pipelines have passed.</p>\n<p>Merge the request:</p>\n<p>Use an HTTP Request node to call PUT /merge_requests/:id/merge API.</p>\n<p><strong>3. Test the Workflow</strong></p>\n<p>Create a test merge request.</p>\n<p>Check if the workflow triggers and merges automatically.</p>\n<p>Debug using n8n logs if needed.</p>\n<p><strong>4. Deploy and Monitor</strong></p>\n<p>Deploy the workflow in production.</p>\n<p>Use n8nâ€™s monitoring features to track execution.</p>\n<p>This template enables seamless GitLab merge automation, improving efficiency and reducing manual work!</p>\n<h4>Note:</h4>\n<p>Never hard code API token or secret in your https request.</p>\n</div><!--]-->"
}